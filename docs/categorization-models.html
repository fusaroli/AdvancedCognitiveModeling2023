<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Categorization models | 11 - Reinforcement Learning</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Categorization models | 11 - Reinforcement Learning" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Categorization models | 11 - Reinforcement Learning" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2023" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2024-02-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bayesian-models-of-cognition.html"/>
<link rel="next" href="categorization-models-1.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-goal-of-the-course"><i class="fa fa-check"></i><b>1.1</b> The goal of the course</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#list-of-lectures-and-practical-exercises"><i class="fa fa-check"></i><b>1.2</b> List of lectures and practical exercises</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preparation-before-the-course"><i class="fa fa-check"></i><b>1.3</b> Preparation before the course</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html"><i class="fa fa-check"></i><b>2</b> Building verbal models of the matching pennies game</a>
<ul>
<li class="chapter" data-level="2.1" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#trying-out-the-game-and-collecting-your-own-data"><i class="fa fa-check"></i><b>2.1</b> Trying out the game and collecting your own data</a></li>
<li class="chapter" data-level="2.2" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#start-theorizing"><i class="fa fa-check"></i><b>2.2</b> Start Theorizing</a></li>
<li class="chapter" data-level="2.3" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>2.3</b> The distinction between participant and researcher perspectives</a></li>
<li class="chapter" data-level="2.4" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#strategies"><i class="fa fa-check"></i><b>2.4</b> Strategies</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#random-strategies"><i class="fa fa-check"></i><b>2.4.1</b> Random strategies</a></li>
<li class="chapter" data-level="2.4.2" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#immediate-reaction"><i class="fa fa-check"></i><b>2.4.2</b> Immediate reaction</a></li>
<li class="chapter" data-level="2.4.3" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>2.4.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="2.4.4" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>2.4.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="2.4.5" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#reinforcement-learning"><i class="fa fa-check"></i><b>2.4.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="2.4.6" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#k-tom"><i class="fa fa-check"></i><b>2.4.6</b> k-ToM</a></li>
<li class="chapter" data-level="2.4.7" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#other-possible-strategies"><i class="fa fa-check"></i><b>2.4.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#cognitive-constraints"><i class="fa fa-check"></i><b>2.5</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#memory"><i class="fa fa-check"></i><b>2.5.1</b> Memory</a></li>
<li class="chapter" data-level="2.5.2" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#perseveration"><i class="fa fa-check"></i><b>2.5.2</b> Perseveration</a></li>
<li class="chapter" data-level="2.5.3" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#errors"><i class="fa fa-check"></i><b>2.5.3</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#continuity-between-models"><i class="fa fa-check"></i><b>2.6</b> Continuity between models</a></li>
<li class="chapter" data-level="2.7" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#mixture-of-strategies"><i class="fa fa-check"></i><b>2.7</b> Mixture of strategies</a></li>
<li class="chapter" data-level="2.8" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#differences-from-more-traditional-general-linear-model-based-approaches"><i class="fa fa-check"></i><b>2.8</b> Differences from more traditional (general linear model-based) approaches</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html"><i class="fa fa-check"></i><b>3</b> From verbal to formal models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>3.1</b> Defining general conditions</a></li>
<li class="chapter" data-level="3.2" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>3.2</b> Implementing a random agent</a></li>
<li class="chapter" data-level="3.3" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>3.3</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="3.4" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>3.4</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>3.4.1</b> And we visualize it</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html"><i class="fa fa-check"></i><b>4</b> Practical exercise 3 - Getting into Stan</a>
<ul>
<li class="chapter" data-level="4.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#simulating-data"><i class="fa fa-check"></i><b>4.2</b> Simulating data</a></li>
<li class="chapter" data-level="4.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#building-our-basic-model-in-stan"><i class="fa fa-check"></i><b>4.3</b> Building our basic model in Stan</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#data"><i class="fa fa-check"></i><b>4.3.1</b> Data</a></li>
<li class="chapter" data-level="4.3.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#model"><i class="fa fa-check"></i><b>4.3.2</b> Model</a></li>
<li class="chapter" data-level="4.3.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#compiling-and-fitting-the-model"><i class="fa fa-check"></i><b>4.3.3</b> Compiling and fitting the model</a></li>
<li class="chapter" data-level="4.3.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-model"><i class="fa fa-check"></i><b>4.3.4</b> Summarizing the model</a></li>
<li class="chapter" data-level="4.3.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#assessing-model-quality"><i class="fa fa-check"></i><b>4.3.5</b> Assessing model quality</a></li>
<li class="chapter" data-level="4.3.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-results"><i class="fa fa-check"></i><b>4.3.6</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#parameter-recovery"><i class="fa fa-check"></i><b>4.4</b> Parameter recovery</a></li>
<li class="chapter" data-level="4.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#the-memory-model-conditioning-theta"><i class="fa fa-check"></i><b>4.5</b> The memory model: conditioning theta</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-results-1"><i class="fa fa-check"></i><b>4.5.1</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#memory-agent-with-internal-parameter"><i class="fa fa-check"></i><b>4.6</b> Memory agent with internal parameter</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#trying-out-a-more-complex-memory-model-with-a-rate-of-forgetting-that-exponentially-discounts-the-past"><i class="fa fa-check"></i><b>4.6.1</b> Trying out a more complex memory model, with a rate of forgetting that exponentially discounts the past</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html"><i class="fa fa-check"></i><b>5</b> Practical exercise 4 - Model quality checks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#generating-and-plotting-additional-variables"><i class="fa fa-check"></i><b>5.1</b> Generating and plotting additional variables</a></li>
<li class="chapter" data-level="5.2" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-priors"><i class="fa fa-check"></i><b>5.2</b> Assessing priors</a></li>
<li class="chapter" data-level="5.3" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-prior-and-posterior-predictions"><i class="fa fa-check"></i><b>5.3</b> Assessing prior and posterior predictions</a></li>
<li class="chapter" data-level="5.4" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>5.4</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="5.5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#the-memory-model"><i class="fa fa-check"></i><b>5.5</b> The memory model</a></li>
<li class="chapter" data-level="5.6" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-check-for-the-memory-model"><i class="fa fa-check"></i><b>5.6</b> Prior sensitivity check for the memory model</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html"><i class="fa fa-check"></i><b>6</b> Multilevel modeling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#intro-to-multilevel-modeling"><i class="fa fa-check"></i><b>6.1</b> Intro to multilevel modeling</a></li>
<li class="chapter" data-level="6.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#a-multilevel-version-of-the-biased-agent-and-of-the-simple-memory-agent"><i class="fa fa-check"></i><b>6.2</b> A multilevel version of the biased agent and of the simple memory agent</a></li>
<li class="chapter" data-level="6.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#generating-the-agents"><i class="fa fa-check"></i><b>6.3</b> Generating the agents</a></li>
<li class="chapter" data-level="6.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#plotting-the-agents"><i class="fa fa-check"></i><b>6.4</b> Plotting the agents</a></li>
<li class="chapter" data-level="6.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#coding-the-multilevel-agents"><i class="fa fa-check"></i><b>6.5</b> Coding the multilevel agents</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-random"><i class="fa fa-check"></i><b>6.5.1</b> Multilevel random</a></li>
<li class="chapter" data-level="6.5.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-random-agents"><i class="fa fa-check"></i><b>6.5.2</b> Assessing multilevel random agents</a></li>
<li class="chapter" data-level="6.5.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory"><i class="fa fa-check"></i><b>6.5.3</b> Multilevel memory</a></li>
<li class="chapter" data-level="6.5.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory"><i class="fa fa-check"></i><b>6.5.4</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization"><i class="fa fa-check"></i><b>6.5.5</b> Multilevel memory with non centered parameterization</a></li>
<li class="chapter" data-level="6.5.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-1"><i class="fa fa-check"></i><b>6.5.6</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.7" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters"><i class="fa fa-check"></i><b>6.5.7</b> Multilevel memory with correlation between parameters</a></li>
<li class="chapter" data-level="6.5.8" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-2"><i class="fa fa-check"></i><b>6.5.8</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.9" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-no-pooling"><i class="fa fa-check"></i><b>6.5.9</b> Multilevel memory no pooling</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-full-pooling"><i class="fa fa-check"></i><b>6.6</b> Multilevel full pooling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="model-comparison.html"><a href="model-comparison.html"><i class="fa fa-check"></i><b>7</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.1" data-path="model-comparison.html"><a href="model-comparison.html#define-parameters"><i class="fa fa-check"></i><b>7.1</b> Define parameters</a></li>
<li class="chapter" data-level="7.2" data-path="model-comparison.html"><a href="model-comparison.html#define-biased-and-memory-agents"><i class="fa fa-check"></i><b>7.2</b> Define biased and memory agents</a></li>
<li class="chapter" data-level="7.3" data-path="model-comparison.html"><a href="model-comparison.html#generating-the-agents-1"><i class="fa fa-check"></i><b>7.3</b> Generating the agents</a></li>
<li class="chapter" data-level="7.4" data-path="model-comparison.html"><a href="model-comparison.html#prep-the-data"><i class="fa fa-check"></i><b>7.4</b> Prep the data</a></li>
<li class="chapter" data-level="7.5" data-path="model-comparison.html"><a href="model-comparison.html#log-posterior-likelihood"><i class="fa fa-check"></i><b>7.5</b> Log posterior likelihood</a></li>
<li class="chapter" data-level="7.6" data-path="model-comparison.html"><a href="model-comparison.html#create-the-models-multilevel-biased-agents"><i class="fa fa-check"></i><b>7.6</b> Create the models: multilevel biased agents</a></li>
<li class="chapter" data-level="7.7" data-path="model-comparison.html"><a href="model-comparison.html#multilevel-memory-model"><i class="fa fa-check"></i><b>7.7</b> Multilevel memory model</a></li>
<li class="chapter" data-level="7.8" data-path="model-comparison.html"><a href="model-comparison.html#fitting-the-models-to-the-data"><i class="fa fa-check"></i><b>7.8</b> Fitting the models to the data</a></li>
<li class="chapter" data-level="7.9" data-path="model-comparison.html"><a href="model-comparison.html#calculating-the-expected-log-predictive-density-of-a-model"><i class="fa fa-check"></i><b>7.9</b> Calculating the expected log predictive density of a model</a></li>
<li class="chapter" data-level="7.10" data-path="model-comparison.html"><a href="model-comparison.html#implementing-cross-validation"><i class="fa fa-check"></i><b>7.10</b> Implementing Cross-Validation</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="model-comparison.html"><a href="model-comparison.html#create-cross-validation-ready-stan-model-for-biased-agents"><i class="fa fa-check"></i><b>7.10.1</b> Create cross-validation ready stan model for biased agents</a></li>
<li class="chapter" data-level="7.10.2" data-path="model-comparison.html"><a href="model-comparison.html#create-cross-validation-ready-stan-model-for-memory-agents"><i class="fa fa-check"></i><b>7.10.2</b> Create cross-validation ready stan model for memory agents</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="model-comparison.html"><a href="model-comparison.html#calculating-elpd-and-comparing"><i class="fa fa-check"></i><b>7.11</b> Calculating elpd and comparing</a></li>
<li class="chapter" data-level="7.12" data-path="model-comparison.html"><a href="model-comparison.html#limitations-of-model-comparison-techniques"><i class="fa fa-check"></i><b>7.12</b> Limitations of model comparison techniques</a></li>
<li class="chapter" data-level="7.13" data-path="model-comparison.html"><a href="model-comparison.html#mixture-models"><i class="fa fa-check"></i><b>7.13</b> Mixture models</a>
<ul>
<li class="chapter" data-level="7.13.1" data-path="model-comparison.html"><a href="model-comparison.html#load-the-dataset"><i class="fa fa-check"></i><b>7.13.1</b> Load the dataset</a></li>
</ul></li>
<li class="chapter" data-level="7.14" data-path="model-comparison.html"><a href="model-comparison.html#stan-model-mixing-biased-and-noise"><i class="fa fa-check"></i><b>7.14</b> Stan model mixing biased and noise</a></li>
<li class="chapter" data-level="7.15" data-path="model-comparison.html"><a href="model-comparison.html#fitting-and-assessing-the-model"><i class="fa fa-check"></i><b>7.15</b> Fitting and assessing the model</a></li>
<li class="chapter" data-level="7.16" data-path="model-comparison.html"><a href="model-comparison.html#basic-evaluation"><i class="fa fa-check"></i><b>7.16</b> Basic evaluation</a></li>
<li class="chapter" data-level="7.17" data-path="model-comparison.html"><a href="model-comparison.html#multilevel-mixture-model"><i class="fa fa-check"></i><b>7.17</b> Multilevel mixture model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html"><i class="fa fa-check"></i><b>8</b> Bonus chapter: Additional models developed by students</a>
<ul>
<li class="chapter" data-level="8.1" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#additional-models"><i class="fa fa-check"></i><b>8.1</b> Additional models</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#probabilistic-win-stay-lose-shift"><i class="fa fa-check"></i><b>8.1.1</b> Probabilistic Win Stay Lose Shift</a></li>
<li class="chapter" data-level="8.1.2" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#probabilistic-asymmetric-win-stay-lose-shift"><i class="fa fa-check"></i><b>8.1.2</b> Probabilistic asymmetric Win Stay Lose Shift</a></li>
<li class="chapter" data-level="8.1.3" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-rate"><i class="fa fa-check"></i><b>8.1.3</b> Memory agent with exponential memory decay (rate)</a></li>
<li class="chapter" data-level="8.1.4" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-exponential"><i class="fa fa-check"></i><b>8.1.4</b> Memory agent with exponential memory decay (exponential)</a></li>
<li class="chapter" data-level="8.1.5" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-but-separate-memory-for-wins-and-losses"><i class="fa fa-check"></i><b>8.1.5</b> Memory agent with exponential memory decay, but separate memory for wins and losses</a></li>
<li class="chapter" data-level="8.1.6" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-and-with-confidence"><i class="fa fa-check"></i><b>8.1.6</b> Memory agent with exponential memory decay, and with confidence</a></li>
<li class="chapter" data-level="8.1.7" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#reinforcement-learning-rescorla-wagner"><i class="fa fa-check"></i><b>8.1.7</b> Reinforcement learning (Rescorla Wagner)</a></li>
<li class="chapter" data-level="8.1.8" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#hierarchical-gaussian-filter"><i class="fa fa-check"></i><b>8.1.8</b> Hierarchical gaussian filter</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#implementing-the-wsls-model"><i class="fa fa-check"></i><b>8.2</b> Implementing the WSLS model</a></li>
<li class="chapter" data-level="8.3" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#load-packages"><i class="fa fa-check"></i><b>8.3</b> Load packages</a></li>
<li class="chapter" data-level="8.4" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#generate-data"><i class="fa fa-check"></i><b>8.4</b> Generate data</a></li>
<li class="chapter" data-level="8.5" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#sanity-check-for-the-data"><i class="fa fa-check"></i><b>8.5</b> Sanity check for the data</a></li>
<li class="chapter" data-level="8.6" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#more-sanity-check"><i class="fa fa-check"></i><b>8.6</b> More sanity check</a></li>
<li class="chapter" data-level="8.7" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-data-for-single-agent-model"><i class="fa fa-check"></i><b>8.7</b> Create data for single agent model</a></li>
<li class="chapter" data-level="8.8" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-the-model"><i class="fa fa-check"></i><b>8.8</b> Create the model</a></li>
<li class="chapter" data-level="8.9" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#basic-assessment"><i class="fa fa-check"></i><b>8.9</b> Basic assessment</a></li>
<li class="chapter" data-level="8.10" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-multilevel-data"><i class="fa fa-check"></i><b>8.10</b> Create multilevel data</a></li>
<li class="chapter" data-level="8.11" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-the-model-1"><i class="fa fa-check"></i><b>8.11</b> Create the model</a></li>
<li class="chapter" data-level="8.12" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#quality-checks"><i class="fa fa-check"></i><b>8.12</b> Quality checks</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html"><i class="fa fa-check"></i><b>9</b> Bayesian models of cognition</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#load-the-packages"><i class="fa fa-check"></i><b>9.1</b> Load the packages</a></li>
<li class="chapter" data-level="9.2" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#design-the-model"><i class="fa fa-check"></i><b>9.2</b> Design the model</a></li>
<li class="chapter" data-level="9.3" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#create-the-data"><i class="fa fa-check"></i><b>9.3</b> Create the data</a></li>
<li class="chapter" data-level="9.4" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#visualize"><i class="fa fa-check"></i><b>9.4</b> Visualize</a></li>
<li class="chapter" data-level="9.5" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#data-for-stan"><i class="fa fa-check"></i><b>9.5</b> Data for Stan</a></li>
<li class="chapter" data-level="9.6" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#create-the-stan-model"><i class="fa fa-check"></i><b>9.6</b> Create the Stan Model</a></li>
<li class="chapter" data-level="9.7" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#fitting-the-model"><i class="fa fa-check"></i><b>9.7</b> Fitting the model</a></li>
<li class="chapter" data-level="9.8" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#basic-evaluation-1"><i class="fa fa-check"></i><b>9.8</b> Basic evaluation</a></li>
<li class="chapter" data-level="9.9" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#weighted-bayes"><i class="fa fa-check"></i><b>9.9</b> Weighted Bayes</a></li>
<li class="chapter" data-level="9.10" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#visualize-1"><i class="fa fa-check"></i><b>9.10</b> Visualize</a></li>
<li class="chapter" data-level="9.11" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#build-the-weighted-bayes-stan-model-simple-formula"><i class="fa fa-check"></i><b>9.11</b> Build the Weighted Bayes Stan model (simple formula)</a></li>
<li class="chapter" data-level="9.12" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#model-evaluation"><i class="fa fa-check"></i><b>9.12</b> Model evaluation</a></li>
<li class="chapter" data-level="9.13" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#model-recovery"><i class="fa fa-check"></i><b>9.13</b> Model recovery</a></li>
<li class="chapter" data-level="9.14" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel"><i class="fa fa-check"></i><b>9.14</b> Multilevel</a></li>
<li class="chapter" data-level="9.15" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#bonus-build-the-weighted-bayes-stan-model-fancier-formula"><i class="fa fa-check"></i><b>9.15</b> Bonus: Build the Weighted Bayes Stan model (fancier formula)</a></li>
<li class="chapter" data-level="9.16" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#evaluation"><i class="fa fa-check"></i><b>9.16</b> Evaluation</a></li>
<li class="chapter" data-level="9.17" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#build-a-temporal-bayes-storing-current-belief-as-prior-for-next-turn"><i class="fa fa-check"></i><b>9.17</b> Build a temporal Bayes (storing current belief as prior for next turn)</a></li>
<li class="chapter" data-level="9.18" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#evaluate"><i class="fa fa-check"></i><b>9.18</b> Evaluate</a></li>
<li class="chapter" data-level="9.19" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel-version-of-the-simple-bayes-model"><i class="fa fa-check"></i><b>9.19</b> Multilevel version of the simple bayes model</a></li>
<li class="chapter" data-level="9.20" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel-version-of-the-weighted-bayes-model"><i class="fa fa-check"></i><b>9.20</b> Multilevel version of the weighted bayes model</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="categorization-models.html"><a href="categorization-models.html"><i class="fa fa-check"></i><b>10</b> Categorization models</a>
<ul>
<li class="chapter" data-level="10.1" data-path="categorization-models.html"><a href="categorization-models.html#multilevel-gcm"><i class="fa fa-check"></i><b>10.1</b> Multilevel GCM</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="categorization-models.html"><a href="categorization-models.html#simulate-hierarchical-simplices"><i class="fa fa-check"></i><b>10.1.1</b> Simulate hierarchical simplices</a></li>
<li class="chapter" data-level="10.1.2" data-path="categorization-models.html"><a href="categorization-models.html#set-up-the-data-simulation"><i class="fa fa-check"></i><b>10.1.2</b> Set up the data simulation</a></li>
<li class="chapter" data-level="10.1.3" data-path="categorization-models.html"><a href="categorization-models.html#set-up-the-stan-model"><i class="fa fa-check"></i><b>10.1.3</b> Set up the Stan model</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="categorization-models.html"><a href="categorization-models.html#now-we-parallelize-n.b.-not-finished"><i class="fa fa-check"></i><b>10.2</b> Now we parallelize [N.B. NOT FINISHED]</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="categorization-models.html"><a href="categorization-models.html#student-produced-models-of-categorization"><i class="fa fa-check"></i><b>10.2.1</b> Student-produced models of categorization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="categorization-models-1.html"><a href="categorization-models-1.html"><i class="fa fa-check"></i><b>11</b> Categorization models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="categorization-models-1.html"><a href="categorization-models-1.html#defining-parameters"><i class="fa fa-check"></i><b>11.1</b> Defining parameters</a></li>
<li class="chapter" data-level="11.2" data-path="categorization-models-1.html"><a href="categorization-models-1.html#simulating-with-alpha-0.9-and-p-0.9"><i class="fa fa-check"></i><b>11.2</b> Simulating with alpha 0.9 and p 0.9</a></li>
<li class="chapter" data-level="11.3" data-path="categorization-models-1.html"><a href="categorization-models-1.html#simulating-with-p-0.75"><i class="fa fa-check"></i><b>11.3</b> Simulating with p = 0.75</a></li>
<li class="chapter" data-level="11.4" data-path="categorization-models-1.html"><a href="categorization-models-1.html#what-about-asymmetric-learning"><i class="fa fa-check"></i><b>11.4</b> What about asymmetric learning?</a></li>
<li class="chapter" data-level="11.5" data-path="categorization-models-1.html"><a href="categorization-models-1.html#model-fitting-symmetric-rl"><i class="fa fa-check"></i><b>11.5</b> Model fitting: symmetric RL</a></li>
<li class="chapter" data-level="11.6" data-path="categorization-models-1.html"><a href="categorization-models-1.html#model-fitting-asymmetric-rl"><i class="fa fa-check"></i><b>11.6</b> Model fitting: asymmetric RL</a></li>
<li class="chapter" data-level="11.7" data-path="categorization-models-1.html"><a href="categorization-models-1.html#model-fitting-multilevel"><i class="fa fa-check"></i><b>11.7</b> Model fitting: multilevel</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">11 - Reinforcement Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="categorization-models" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> Categorization models<a href="categorization-models.html#categorization-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this module the course covers formal models of categorization. In particular, here we implement a version of the Generalized Context Model (from now on GCM).</p>
<p>[MISSING: INTRODUCTION TO THE GCM]</p>
<p>In order to understand the GCM, we will rely on a setup from Kruschke 1993. Participants go through 8 blocks of trials. Within each block, participants see 8 stimuli, the same across every block. Each stimulus has to be categorised (classified) as belonging to either category A or category B. After categorizing a stimulus, feedback is given, so that the participant knows which category the stimulus truly belongs to.</p>
<p>The stimuli differ along two continuous dimensions (more specifically the height of a square and the position of a line with it).</p>
<p>Following on the structure in Kruschke 1993, we need to start simulating data. Let’s start with the stimuli.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="categorization-models.html#cb364-1" tabindex="-1"></a><span class="co"># Defining the stimuli, their height and position features, and their category</span></span>
<span id="cb364-2"><a href="categorization-models.html#cb364-2" tabindex="-1"></a>stimulus <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">4</span>)</span>
<span id="cb364-3"><a href="categorization-models.html#cb364-3" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>, <span class="dv">2</span>,<span class="dv">2</span>, <span class="dv">3</span>,<span class="dv">3</span>, <span class="dv">4</span>,<span class="dv">4</span>)</span>
<span id="cb364-4"><a href="categorization-models.html#cb364-4" tabindex="-1"></a>position <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>, <span class="dv">1</span>,<span class="dv">4</span>, <span class="dv">1</span>,<span class="dv">4</span>, <span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb364-5"><a href="categorization-models.html#cb364-5" tabindex="-1"></a>category <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb364-6"><a href="categorization-models.html#cb364-6" tabindex="-1"></a></span>
<span id="cb364-7"><a href="categorization-models.html#cb364-7" tabindex="-1"></a><span class="co"># Making this into a tibble</span></span>
<span id="cb364-8"><a href="categorization-models.html#cb364-8" tabindex="-1"></a>stimuli <span class="ot">&lt;-</span> <span class="fu">tibble</span>(stimulus, height, position, category)</span>
<span id="cb364-9"><a href="categorization-models.html#cb364-9" tabindex="-1"></a></span>
<span id="cb364-10"><a href="categorization-models.html#cb364-10" tabindex="-1"></a><span class="co"># Plotting to make sure all looks right</span></span>
<span id="cb364-11"><a href="categorization-models.html#cb364-11" tabindex="-1"></a><span class="fu">ggplot</span>(stimuli, <span class="fu">aes</span>(position, height, <span class="at">color =</span> category, <span class="at">label =</span> stimulus)) <span class="sc">+</span></span>
<span id="cb364-12"><a href="categorization-models.html#cb364-12" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb364-13"><a href="categorization-models.html#cb364-13" tabindex="-1"></a>  <span class="fu">geom_label</span>() <span class="sc">+</span></span>
<span id="cb364-14"><a href="categorization-models.html#cb364-14" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb364-15"><a href="categorization-models.html#cb364-15" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="categorization-models.html#cb365-1" tabindex="-1"></a><span class="co"># Generating the sequence of stimuli in the full experiment</span></span>
<span id="cb365-2"><a href="categorization-models.html#cb365-2" tabindex="-1"></a>sequence <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb365-3"><a href="categorization-models.html#cb365-3" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) {</span>
<span id="cb365-4"><a href="categorization-models.html#cb365-4" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">8</span>), <span class="dv">8</span>, <span class="at">replace =</span> F)</span>
<span id="cb365-5"><a href="categorization-models.html#cb365-5" tabindex="-1"></a>  sequence <span class="ot">&lt;-</span> <span class="fu">append</span>(sequence, temp)</span>
<span id="cb365-6"><a href="categorization-models.html#cb365-6" tabindex="-1"></a>}</span>
<span id="cb365-7"><a href="categorization-models.html#cb365-7" tabindex="-1"></a></span>
<span id="cb365-8"><a href="categorization-models.html#cb365-8" tabindex="-1"></a>experiment <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">stimulus =</span> sequence, <span class="at">height =</span> <span class="cn">NA</span>, <span class="at">position =</span> <span class="cn">NA</span>, <span class="at">category =</span> <span class="cn">NA</span>)</span>
<span id="cb365-9"><a href="categorization-models.html#cb365-9" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="fu">nrow</span>(experiment))) {</span>
<span id="cb365-10"><a href="categorization-models.html#cb365-10" tabindex="-1"></a>  experiment<span class="sc">$</span>height[i] <span class="ot">&lt;-</span> stimuli<span class="sc">$</span>height[stimuli<span class="sc">$</span>stimulus <span class="sc">==</span> experiment<span class="sc">$</span>stimulus[i]]</span>
<span id="cb365-11"><a href="categorization-models.html#cb365-11" tabindex="-1"></a>  experiment<span class="sc">$</span>position[i] <span class="ot">&lt;-</span> stimuli<span class="sc">$</span>position[stimuli<span class="sc">$</span>stimulus <span class="sc">==</span> experiment<span class="sc">$</span>stimulus[i]]</span>
<span id="cb365-12"><a href="categorization-models.html#cb365-12" tabindex="-1"></a>  experiment<span class="sc">$</span>category[i] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(stimuli<span class="sc">$</span>category[stimuli<span class="sc">$</span>stimulus <span class="sc">==</span> experiment<span class="sc">$</span>stimulus[i]]))</span>
<span id="cb365-13"><a href="categorization-models.html#cb365-13" tabindex="-1"></a>}</span></code></pre></div>
<p>We then have to simulate an agent using the GCM to assess the stimuli.
N.B. code based on work by Sara Østergaard</p>
<p>First we define functions for distance and similarity and assess them.
Distance takes feature values along n dimensions and calculate their euclidean distance,
weighing dimensions according to pregiven weights (w).
Similarity decays exponentially with distance, with a pre-given exponent (c). See plot.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="categorization-models.html#cb366-1" tabindex="-1"></a><span class="co"># Distance </span></span>
<span id="cb366-2"><a href="categorization-models.html#cb366-2" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="cf">function</span>(vect1, vect2, w) {</span>
<span id="cb366-3"><a href="categorization-models.html#cb366-3" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sum</span>(w <span class="sc">*</span> <span class="fu">abs</span>(vect1 <span class="sc">-</span> vect2)))</span>
<span id="cb366-4"><a href="categorization-models.html#cb366-4" tabindex="-1"></a>}</span>
<span id="cb366-5"><a href="categorization-models.html#cb366-5" tabindex="-1"></a></span>
<span id="cb366-6"><a href="categorization-models.html#cb366-6" tabindex="-1"></a><span class="co"># Similarity</span></span>
<span id="cb366-7"><a href="categorization-models.html#cb366-7" tabindex="-1"></a>similarity <span class="ot">&lt;-</span> <span class="cf">function</span>(distance, c) {</span>
<span id="cb366-8"><a href="categorization-models.html#cb366-8" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">exp</span>(<span class="sc">-</span>c <span class="sc">*</span> distance))</span>
<span id="cb366-9"><a href="categorization-models.html#cb366-9" tabindex="-1"></a>}</span>
<span id="cb366-10"><a href="categorization-models.html#cb366-10" tabindex="-1"></a></span>
<span id="cb366-11"><a href="categorization-models.html#cb366-11" tabindex="-1"></a><span class="co"># Let&#39;s assess similarity</span></span>
<span id="cb366-12"><a href="categorization-models.html#cb366-12" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb366-13"><a href="categorization-models.html#cb366-13" tabindex="-1"></a>  <span class="fu">expand_grid</span>(</span>
<span id="cb366-14"><a href="categorization-models.html#cb366-14" tabindex="-1"></a>    <span class="at">distance =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">1</span>,.<span class="dv">2</span>, .<span class="dv">3</span>,.<span class="dv">4</span>,.<span class="dv">5</span>,<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>), </span>
<span id="cb366-15"><a href="categorization-models.html#cb366-15" tabindex="-1"></a>    <span class="at">c =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb366-16"><a href="categorization-models.html#cb366-16" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb366-17"><a href="categorization-models.html#cb366-17" tabindex="-1"></a>    <span class="at">similarity =</span> <span class="fu">similarity</span>(distance, c)</span>
<span id="cb366-18"><a href="categorization-models.html#cb366-18" tabindex="-1"></a>  )</span>
<span id="cb366-19"><a href="categorization-models.html#cb366-19" tabindex="-1"></a></span>
<span id="cb366-20"><a href="categorization-models.html#cb366-20" tabindex="-1"></a>dd <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">c =</span> <span class="fu">factor</span>(c)) <span class="sc">%&gt;%</span></span>
<span id="cb366-21"><a href="categorization-models.html#cb366-21" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb366-22"><a href="categorization-models.html#cb366-22" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(distance, similarity, <span class="at">group =</span> c, <span class="at">color =</span> c)) <span class="sc">+</span> </span>
<span id="cb366-23"><a href="categorization-models.html#cb366-23" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="categorization-models.html#cb367-1" tabindex="-1"></a><span class="co">#</span></span></code></pre></div>
<p>With distance and similarity in place, we now need to implement an agent that can observe stimuli,
put them into categories according to feedback and - once enough stimuli are collected to have at
least one exemplar in each category - compare stimuli to exemplars in each category and assess
which category is more likely.
In other words: 1) if not enough stimuli have already been observed, the agent picks a category at random,
receives feedback and adjusts accordingly the category; otherwise, 2) it assesses average distance (according to weights) from observed exemplars by category; calculates similarity (according to c); and uses the relative similarity to the two categories to produce a probability of choosing category one. then it receives feedback and adjusts category accordingly.</p>
<p>As usual we make the agent a function, so that we can more easily deploy it.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="categorization-models.html#cb368-1" tabindex="-1"></a><span class="do">### generative model </span><span class="al">###</span></span>
<span id="cb368-2"><a href="categorization-models.html#cb368-2" tabindex="-1"></a>gcm <span class="ot">&lt;-</span> <span class="cf">function</span>(w, c, obs, cat_one, <span class="at">quiet =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb368-3"><a href="categorization-models.html#cb368-3" tabindex="-1"></a>  <span class="co"># create an empty list to save probability of saying &quot;1&quot; for each trial</span></span>
<span id="cb368-4"><a href="categorization-models.html#cb368-4" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb368-5"><a href="categorization-models.html#cb368-5" tabindex="-1"></a>  </span>
<span id="cb368-6"><a href="categorization-models.html#cb368-6" tabindex="-1"></a>  ntrials <span class="ot">&lt;-</span> <span class="fu">nrow</span>(obs)</span>
<span id="cb368-7"><a href="categorization-models.html#cb368-7" tabindex="-1"></a>  </span>
<span id="cb368-8"><a href="categorization-models.html#cb368-8" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ntrials) {</span>
<span id="cb368-9"><a href="categorization-models.html#cb368-9" tabindex="-1"></a>    <span class="co"># If quiet is FALSE, print every ten trials</span></span>
<span id="cb368-10"><a href="categorization-models.html#cb368-10" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>quiet <span class="sc">&amp;&amp;</span> i <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb368-11"><a href="categorization-models.html#cb368-11" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;i =&quot;</span>, i))</span>
<span id="cb368-12"><a href="categorization-models.html#cb368-12" tabindex="-1"></a>    }</span>
<span id="cb368-13"><a href="categorization-models.html#cb368-13" tabindex="-1"></a>    <span class="co"># if this is the first trial, or there any category with no exemplars seen yet, set the choice to random</span></span>
<span id="cb368-14"><a href="categorization-models.html#cb368-14" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">||</span> <span class="fu">sum</span>(cat_one[<span class="dv">1</span><span class="sc">:</span>(i <span class="sc">-</span> <span class="dv">1</span>)]) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(cat_one[<span class="dv">1</span><span class="sc">:</span>(i <span class="sc">-</span> <span class="dv">1</span>)]) <span class="sc">==</span> (i <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb368-15"><a href="categorization-models.html#cb368-15" tabindex="-1"></a>      r <span class="ot">&lt;-</span> <span class="fu">c</span>(r, .<span class="dv">5</span>)</span>
<span id="cb368-16"><a href="categorization-models.html#cb368-16" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb368-17"><a href="categorization-models.html#cb368-17" tabindex="-1"></a>      similarities <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb368-18"><a href="categorization-models.html#cb368-18" tabindex="-1"></a>      <span class="co"># for each previously seen stimulus assess distance and similarity</span></span>
<span id="cb368-19"><a href="categorization-models.html#cb368-19" tabindex="-1"></a>      <span class="cf">for</span> (e <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(i <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb368-20"><a href="categorization-models.html#cb368-20" tabindex="-1"></a>        sim <span class="ot">&lt;-</span> <span class="fu">similarity</span>(<span class="fu">distance</span>(obs[i, ], obs[e, ], w), c)</span>
<span id="cb368-21"><a href="categorization-models.html#cb368-21" tabindex="-1"></a>        similarities <span class="ot">&lt;-</span> <span class="fu">c</span>(similarities, sim)</span>
<span id="cb368-22"><a href="categorization-models.html#cb368-22" tabindex="-1"></a>      }</span>
<span id="cb368-23"><a href="categorization-models.html#cb368-23" tabindex="-1"></a>      <span class="co"># Calculate prob of saying &quot;1&quot; by dividing similarity to 1 by the sum of similarity to 1 and to 2</span></span>
<span id="cb368-24"><a href="categorization-models.html#cb368-24" tabindex="-1"></a>      numerator <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">sum</span>(similarities[cat_one[<span class="dv">1</span><span class="sc">:</span>(i <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb368-25"><a href="categorization-models.html#cb368-25" tabindex="-1"></a>      denominator <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">sum</span>(similarities[cat_one[<span class="dv">1</span><span class="sc">:</span>(i <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">sum</span>(similarities[cat_one[<span class="dv">1</span><span class="sc">:</span>(i <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb368-26"><a href="categorization-models.html#cb368-26" tabindex="-1"></a>      r <span class="ot">&lt;-</span> <span class="fu">c</span>(r, numerator <span class="sc">/</span> denominator)</span>
<span id="cb368-27"><a href="categorization-models.html#cb368-27" tabindex="-1"></a>    }</span>
<span id="cb368-28"><a href="categorization-models.html#cb368-28" tabindex="-1"></a>  }</span>
<span id="cb368-29"><a href="categorization-models.html#cb368-29" tabindex="-1"></a></span>
<span id="cb368-30"><a href="categorization-models.html#cb368-30" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rbinom</span>(ntrials, <span class="dv">1</span>, r))</span>
<span id="cb368-31"><a href="categorization-models.html#cb368-31" tabindex="-1"></a>}</span></code></pre></div>
<p>With the agent in place, we can now simulate behavior on our simulated stimuli and observe the impact of different weights and scaling parameters c.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="categorization-models.html#cb369-1" tabindex="-1"></a><span class="co"># function for simulation responses</span></span>
<span id="cb369-2"><a href="categorization-models.html#cb369-2" tabindex="-1"></a>simulate_responses <span class="ot">&lt;-</span> <span class="cf">function</span>(agent, w, c) {</span>
<span id="cb369-3"><a href="categorization-models.html#cb369-3" tabindex="-1"></a>    </span>
<span id="cb369-4"><a href="categorization-models.html#cb369-4" tabindex="-1"></a>    observations <span class="ot">&lt;-</span> experiment <span class="sc">%&gt;%</span></span>
<span id="cb369-5"><a href="categorization-models.html#cb369-5" tabindex="-1"></a>        <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;position&quot;</span>))</span>
<span id="cb369-6"><a href="categorization-models.html#cb369-6" tabindex="-1"></a>    </span>
<span id="cb369-7"><a href="categorization-models.html#cb369-7" tabindex="-1"></a>    category <span class="ot">&lt;-</span> experiment<span class="sc">$</span>category</span>
<span id="cb369-8"><a href="categorization-models.html#cb369-8" tabindex="-1"></a>    </span>
<span id="cb369-9"><a href="categorization-models.html#cb369-9" tabindex="-1"></a>    <span class="cf">if</span> (w <span class="sc">==</span> <span class="st">&quot;equal&quot;</span>) {</span>
<span id="cb369-10"><a href="categorization-models.html#cb369-10" tabindex="-1"></a>        weight <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb369-11"><a href="categorization-models.html#cb369-11" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (w <span class="sc">==</span> <span class="st">&quot;skewed1&quot;</span>) {</span>
<span id="cb369-12"><a href="categorization-models.html#cb369-12" tabindex="-1"></a>        weight <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb369-13"><a href="categorization-models.html#cb369-13" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (w <span class="sc">==</span> <span class="st">&quot;skewed2&quot;</span>) {</span>
<span id="cb369-14"><a href="categorization-models.html#cb369-14" tabindex="-1"></a>        weight <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>)</span>
<span id="cb369-15"><a href="categorization-models.html#cb369-15" tabindex="-1"></a>    }</span>
<span id="cb369-16"><a href="categorization-models.html#cb369-16" tabindex="-1"></a></span>
<span id="cb369-17"><a href="categorization-models.html#cb369-17" tabindex="-1"></a>    <span class="co"># simulate responses</span></span>
<span id="cb369-18"><a href="categorization-models.html#cb369-18" tabindex="-1"></a>    responses <span class="ot">&lt;-</span> <span class="fu">gcm</span>(</span>
<span id="cb369-19"><a href="categorization-models.html#cb369-19" tabindex="-1"></a>        weight,</span>
<span id="cb369-20"><a href="categorization-models.html#cb369-20" tabindex="-1"></a>        c,</span>
<span id="cb369-21"><a href="categorization-models.html#cb369-21" tabindex="-1"></a>        observations,</span>
<span id="cb369-22"><a href="categorization-models.html#cb369-22" tabindex="-1"></a>        category</span>
<span id="cb369-23"><a href="categorization-models.html#cb369-23" tabindex="-1"></a>    )</span>
<span id="cb369-24"><a href="categorization-models.html#cb369-24" tabindex="-1"></a>    </span>
<span id="cb369-25"><a href="categorization-models.html#cb369-25" tabindex="-1"></a>    tmp_simulated_responses <span class="ot">&lt;-</span> experiment <span class="sc">%&gt;%</span></span>
<span id="cb369-26"><a href="categorization-models.html#cb369-26" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb369-27"><a href="categorization-models.html#cb369-27" tabindex="-1"></a>            <span class="at">trial =</span> <span class="fu">seq</span>(<span class="fu">nrow</span>(experiment)),</span>
<span id="cb369-28"><a href="categorization-models.html#cb369-28" tabindex="-1"></a>            <span class="at">sim_response =</span> responses,</span>
<span id="cb369-29"><a href="categorization-models.html#cb369-29" tabindex="-1"></a>            <span class="at">correct =</span> <span class="fu">ifelse</span>(category <span class="sc">==</span> sim_response, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb369-30"><a href="categorization-models.html#cb369-30" tabindex="-1"></a>            <span class="at">performance =</span> <span class="fu">cumsum</span>(correct) <span class="sc">/</span> <span class="fu">seq_along</span>(correct),</span>
<span id="cb369-31"><a href="categorization-models.html#cb369-31" tabindex="-1"></a>            <span class="at">c =</span> c,</span>
<span id="cb369-32"><a href="categorization-models.html#cb369-32" tabindex="-1"></a>            <span class="at">w =</span> w,</span>
<span id="cb369-33"><a href="categorization-models.html#cb369-33" tabindex="-1"></a>            <span class="at">agent =</span> agent</span>
<span id="cb369-34"><a href="categorization-models.html#cb369-34" tabindex="-1"></a>        )</span>
<span id="cb369-35"><a href="categorization-models.html#cb369-35" tabindex="-1"></a></span>
<span id="cb369-36"><a href="categorization-models.html#cb369-36" tabindex="-1"></a>    <span class="fu">return</span>(tmp_simulated_responses)</span>
<span id="cb369-37"><a href="categorization-models.html#cb369-37" tabindex="-1"></a>}</span>
<span id="cb369-38"><a href="categorization-models.html#cb369-38" tabindex="-1"></a></span>
<span id="cb369-39"><a href="categorization-models.html#cb369-39" tabindex="-1"></a></span>
<span id="cb369-40"><a href="categorization-models.html#cb369-40" tabindex="-1"></a><span class="co"># simulate responses</span></span>
<span id="cb369-41"><a href="categorization-models.html#cb369-41" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="fu">availableCores</span>())</span>
<span id="cb369-42"><a href="categorization-models.html#cb369-42" tabindex="-1"></a></span>
<span id="cb369-43"><a href="categorization-models.html#cb369-43" tabindex="-1"></a>param_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb369-44"><a href="categorization-models.html#cb369-44" tabindex="-1"></a>    <span class="fu">expand_grid</span>(</span>
<span id="cb369-45"><a href="categorization-models.html#cb369-45" tabindex="-1"></a>        <span class="at">agent =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb369-46"><a href="categorization-models.html#cb369-46" tabindex="-1"></a>        <span class="at">c =</span> <span class="fu">seq</span>(.<span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.2</span>),</span>
<span id="cb369-47"><a href="categorization-models.html#cb369-47" tabindex="-1"></a>        <span class="at">w =</span> <span class="fu">c</span>(<span class="st">&quot;equal&quot;</span>, <span class="st">&quot;skewed1&quot;</span>, <span class="st">&quot;skewed2&quot;</span>)</span>
<span id="cb369-48"><a href="categorization-models.html#cb369-48" tabindex="-1"></a>    )</span>
<span id="cb369-49"><a href="categorization-models.html#cb369-49" tabindex="-1"></a>)</span>
<span id="cb369-50"><a href="categorization-models.html#cb369-50" tabindex="-1"></a></span>
<span id="cb369-51"><a href="categorization-models.html#cb369-51" tabindex="-1"></a>simulated_responses <span class="ot">&lt;-</span> <span class="fu">future_pmap_dfr</span>(param_df,</span>
<span id="cb369-52"><a href="categorization-models.html#cb369-52" tabindex="-1"></a>    simulate_responses,</span>
<span id="cb369-53"><a href="categorization-models.html#cb369-53" tabindex="-1"></a>    <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb369-54"><a href="categorization-models.html#cb369-54" tabindex="-1"></a>)</span></code></pre></div>
<p>And now we can try a few plots to better understand how the model fares and the difference made by weights and scaling factors.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="categorization-models.html#cb370-1" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> simulated_responses <span class="sc">%&gt;%</span></span>
<span id="cb370-2"><a href="categorization-models.html#cb370-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">w =</span> <span class="fu">as.factor</span>(w)) <span class="sc">%&gt;%</span></span>
<span id="cb370-3"><a href="categorization-models.html#cb370-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(trial, performance, <span class="at">group =</span> w, <span class="at">color =</span> w)) <span class="sc">+</span></span>
<span id="cb370-4"><a href="categorization-models.html#cb370-4" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb370-5"><a href="categorization-models.html#cb370-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb370-6"><a href="categorization-models.html#cb370-6" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(c <span class="sc">~</span> .)</span>
<span id="cb370-7"><a href="categorization-models.html#cb370-7" tabindex="-1"></a></span>
<span id="cb370-8"><a href="categorization-models.html#cb370-8" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> simulated_responses <span class="sc">%&gt;%</span></span>
<span id="cb370-9"><a href="categorization-models.html#cb370-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">c =</span> <span class="fu">as.factor</span>(c)) <span class="sc">%&gt;%</span></span>
<span id="cb370-10"><a href="categorization-models.html#cb370-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(trial, performance, <span class="at">group =</span> c, <span class="at">color =</span> c)) <span class="sc">+</span></span>
<span id="cb370-11"><a href="categorization-models.html#cb370-11" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb370-12"><a href="categorization-models.html#cb370-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb370-13"><a href="categorization-models.html#cb370-13" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(w <span class="sc">~</span> .)</span>
<span id="cb370-14"><a href="categorization-models.html#cb370-14" tabindex="-1"></a></span>
<span id="cb370-15"><a href="categorization-models.html#cb370-15" tabindex="-1"></a>p3 <span class="sc">+</span> p4</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="categorization-models.html#cb372-1" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> simulated_responses <span class="sc">%&gt;%</span></span>
<span id="cb372-2"><a href="categorization-models.html#cb372-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">c =</span> <span class="fu">as.factor</span>(c)) <span class="sc">%&gt;%</span></span>
<span id="cb372-3"><a href="categorization-models.html#cb372-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(st, performance, <span class="at">group =</span> c, <span class="at">color =</span> c)) <span class="sc">+</span></span>
<span id="cb372-4"><a href="categorization-models.html#cb372-4" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb372-5"><a href="categorization-models.html#cb372-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb372-6"><a href="categorization-models.html#cb372-6" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(w <span class="sc">~</span> .)</span></code></pre></div>
<p>[MISSING: Discussion of how to make sense of the plots: Equal Weights (matching the actual rule) generating better decisions as long as c is above 1]</p>
<p>While we could try different scenarios, let us now move on to inference. We need to build the same GCM model in Stan.</p>
<p>[MISSING: MORE DETAILED EXPLANATION]</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="categorization-models.html#cb373-1" tabindex="-1"></a>gcm_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb373-2"><a href="categorization-models.html#cb373-2" tabindex="-1"></a><span class="st">// Generalized Context Model (GCM)</span></span>
<span id="cb373-3"><a href="categorization-models.html#cb373-3" tabindex="-1"></a></span>
<span id="cb373-4"><a href="categorization-models.html#cb373-4" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb373-5"><a href="categorization-models.html#cb373-5" tabindex="-1"></a><span class="st">    int&lt;lower=1&gt; ntrials;  // number of trials</span></span>
<span id="cb373-6"><a href="categorization-models.html#cb373-6" tabindex="-1"></a><span class="st">    int&lt;lower=1&gt; nfeatures;  // number of predefined relevant features</span></span>
<span id="cb373-7"><a href="categorization-models.html#cb373-7" tabindex="-1"></a><span class="st">    array[ntrials] int&lt;lower=0, upper=1&gt; cat_one; // true responses on a trial by trial basis</span></span>
<span id="cb373-8"><a href="categorization-models.html#cb373-8" tabindex="-1"></a><span class="st">    array[ntrials] int&lt;lower=0, upper=1&gt; y;  // decisions on a trial by trial basis</span></span>
<span id="cb373-9"><a href="categorization-models.html#cb373-9" tabindex="-1"></a><span class="st">    array[ntrials, nfeatures] real obs; // stimuli as vectors of features</span></span>
<span id="cb373-10"><a href="categorization-models.html#cb373-10" tabindex="-1"></a><span class="st">    real&lt;lower=0, upper=1&gt; b;  // initial bias for category one over two</span></span>
<span id="cb373-11"><a href="categorization-models.html#cb373-11" tabindex="-1"></a></span>
<span id="cb373-12"><a href="categorization-models.html#cb373-12" tabindex="-1"></a><span class="st">    // priors</span></span>
<span id="cb373-13"><a href="categorization-models.html#cb373-13" tabindex="-1"></a><span class="st">    vector[nfeatures] w_prior_values;  // concentration parameters for dirichlet distribution &lt;lower=1&gt;</span></span>
<span id="cb373-14"><a href="categorization-models.html#cb373-14" tabindex="-1"></a><span class="st">    array[2] real c_prior_values;  // mean and variance for logit-normal distribution</span></span>
<span id="cb373-15"><a href="categorization-models.html#cb373-15" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb373-16"><a href="categorization-models.html#cb373-16" tabindex="-1"></a></span>
<span id="cb373-17"><a href="categorization-models.html#cb373-17" tabindex="-1"></a><span class="st">transformed data {</span></span>
<span id="cb373-18"><a href="categorization-models.html#cb373-18" tabindex="-1"></a><span class="st">    array[ntrials] int&lt;lower=0, upper=1&gt; cat_two; // dummy variable for category two over cat 1</span></span>
<span id="cb373-19"><a href="categorization-models.html#cb373-19" tabindex="-1"></a><span class="st">    array[sum(cat_one)] int&lt;lower=1, upper=ntrials&gt; cat_one_idx; // array of which stimuli are cat 1</span></span>
<span id="cb373-20"><a href="categorization-models.html#cb373-20" tabindex="-1"></a><span class="st">    array[ntrials-sum(cat_one)] int&lt;lower=1, upper=ntrials&gt; cat_two_idx; //  array of which stimuli are cat 2</span></span>
<span id="cb373-21"><a href="categorization-models.html#cb373-21" tabindex="-1"></a><span class="st">    int idx_one = 1; // Initializing </span></span>
<span id="cb373-22"><a href="categorization-models.html#cb373-22" tabindex="-1"></a><span class="st">    int idx_two = 1;</span></span>
<span id="cb373-23"><a href="categorization-models.html#cb373-23" tabindex="-1"></a><span class="st">    for (i in 1:ntrials){</span></span>
<span id="cb373-24"><a href="categorization-models.html#cb373-24" tabindex="-1"></a><span class="st">        cat_two[i] = abs(cat_one[i]-1);</span></span>
<span id="cb373-25"><a href="categorization-models.html#cb373-25" tabindex="-1"></a></span>
<span id="cb373-26"><a href="categorization-models.html#cb373-26" tabindex="-1"></a><span class="st">        if (cat_one[i]==1){</span></span>
<span id="cb373-27"><a href="categorization-models.html#cb373-27" tabindex="-1"></a><span class="st">            cat_one_idx[idx_one] = i;</span></span>
<span id="cb373-28"><a href="categorization-models.html#cb373-28" tabindex="-1"></a><span class="st">            idx_one +=1;</span></span>
<span id="cb373-29"><a href="categorization-models.html#cb373-29" tabindex="-1"></a><span class="st">        } else {</span></span>
<span id="cb373-30"><a href="categorization-models.html#cb373-30" tabindex="-1"></a><span class="st">            cat_two_idx[idx_two] = i;</span></span>
<span id="cb373-31"><a href="categorization-models.html#cb373-31" tabindex="-1"></a><span class="st">            idx_two += 1;</span></span>
<span id="cb373-32"><a href="categorization-models.html#cb373-32" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb373-33"><a href="categorization-models.html#cb373-33" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb373-34"><a href="categorization-models.html#cb373-34" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb373-35"><a href="categorization-models.html#cb373-35" tabindex="-1"></a></span>
<span id="cb373-36"><a href="categorization-models.html#cb373-36" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb373-37"><a href="categorization-models.html#cb373-37" tabindex="-1"></a><span class="st">    simplex[nfeatures] w;  // simplex means sum(w)=1</span></span>
<span id="cb373-38"><a href="categorization-models.html#cb373-38" tabindex="-1"></a><span class="st">    real logit_c;</span></span>
<span id="cb373-39"><a href="categorization-models.html#cb373-39" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb373-40"><a href="categorization-models.html#cb373-40" tabindex="-1"></a></span>
<span id="cb373-41"><a href="categorization-models.html#cb373-41" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb373-42"><a href="categorization-models.html#cb373-42" tabindex="-1"></a><span class="st">    // parameter c </span></span>
<span id="cb373-43"><a href="categorization-models.html#cb373-43" tabindex="-1"></a><span class="st">    real&lt;lower=0, upper=2&gt; c = inv_logit(logit_c)*2;  // times 2 as c is bounded between 0 and 2</span></span>
<span id="cb373-44"><a href="categorization-models.html#cb373-44" tabindex="-1"></a></span>
<span id="cb373-45"><a href="categorization-models.html#cb373-45" tabindex="-1"></a><span class="st">    // parameter r (probability of response = category 1)</span></span>
<span id="cb373-46"><a href="categorization-models.html#cb373-46" tabindex="-1"></a><span class="st">    array[ntrials] real&lt;lower=0.0001, upper=0.9999&gt; r;</span></span>
<span id="cb373-47"><a href="categorization-models.html#cb373-47" tabindex="-1"></a><span class="st">    array[ntrials] real rr;</span></span>
<span id="cb373-48"><a href="categorization-models.html#cb373-48" tabindex="-1"></a></span>
<span id="cb373-49"><a href="categorization-models.html#cb373-49" tabindex="-1"></a><span class="st">    for (i in 1:ntrials) {</span></span>
<span id="cb373-50"><a href="categorization-models.html#cb373-50" tabindex="-1"></a></span>
<span id="cb373-51"><a href="categorization-models.html#cb373-51" tabindex="-1"></a><span class="st">        // calculate distance from obs to all exemplars</span></span>
<span id="cb373-52"><a href="categorization-models.html#cb373-52" tabindex="-1"></a><span class="st">        array[(i-1)] real exemplar_sim;</span></span>
<span id="cb373-53"><a href="categorization-models.html#cb373-53" tabindex="-1"></a><span class="st">        for (e in 1:(i-1)){</span></span>
<span id="cb373-54"><a href="categorization-models.html#cb373-54" tabindex="-1"></a><span class="st">            array[nfeatures] real tmp_dist;</span></span>
<span id="cb373-55"><a href="categorization-models.html#cb373-55" tabindex="-1"></a><span class="st">            for (j in 1:nfeatures) {</span></span>
<span id="cb373-56"><a href="categorization-models.html#cb373-56" tabindex="-1"></a><span class="st">                tmp_dist[j] = w[j]*abs(obs[e,j] - obs[i,j]);</span></span>
<span id="cb373-57"><a href="categorization-models.html#cb373-57" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb373-58"><a href="categorization-models.html#cb373-58" tabindex="-1"></a><span class="st">            exemplar_sim[e] = exp(-c * sum(tmp_dist));</span></span>
<span id="cb373-59"><a href="categorization-models.html#cb373-59" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb373-60"><a href="categorization-models.html#cb373-60" tabindex="-1"></a></span>
<span id="cb373-61"><a href="categorization-models.html#cb373-61" tabindex="-1"></a><span class="st">        if (sum(cat_one[:(i-1)])==0 || sum(cat_two[:(i-1)])==0){  // if there are no examplars in one of the categories</span></span>
<span id="cb373-62"><a href="categorization-models.html#cb373-62" tabindex="-1"></a><span class="st">            r[i] = 0.5;</span></span>
<span id="cb373-63"><a href="categorization-models.html#cb373-63" tabindex="-1"></a></span>
<span id="cb373-64"><a href="categorization-models.html#cb373-64" tabindex="-1"></a><span class="st">        } else {</span></span>
<span id="cb373-65"><a href="categorization-models.html#cb373-65" tabindex="-1"></a><span class="st">            // calculate similarity</span></span>
<span id="cb373-66"><a href="categorization-models.html#cb373-66" tabindex="-1"></a><span class="st">            array[2] real similarities;</span></span>
<span id="cb373-67"><a href="categorization-models.html#cb373-67" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb373-68"><a href="categorization-models.html#cb373-68" tabindex="-1"></a><span class="st">            array[sum(cat_one[:(i-1)])] int tmp_idx_one = cat_one_idx[:sum(cat_one[:(i-1)])];</span></span>
<span id="cb373-69"><a href="categorization-models.html#cb373-69" tabindex="-1"></a><span class="st">            array[sum(cat_two[:(i-1)])] int tmp_idx_two = cat_two_idx[:sum(cat_two[:(i-1)])];</span></span>
<span id="cb373-70"><a href="categorization-models.html#cb373-70" tabindex="-1"></a><span class="st">            similarities[1] = sum(exemplar_sim[tmp_idx_one]);</span></span>
<span id="cb373-71"><a href="categorization-models.html#cb373-71" tabindex="-1"></a><span class="st">            similarities[2] = sum(exemplar_sim[tmp_idx_two]);</span></span>
<span id="cb373-72"><a href="categorization-models.html#cb373-72" tabindex="-1"></a></span>
<span id="cb373-73"><a href="categorization-models.html#cb373-73" tabindex="-1"></a><span class="st">            // calculate r[i]</span></span>
<span id="cb373-74"><a href="categorization-models.html#cb373-74" tabindex="-1"></a><span class="st">            rr[i] = (b*similarities[1]) / (b*similarities[1] + (1-b)*similarities[2]);</span></span>
<span id="cb373-75"><a href="categorization-models.html#cb373-75" tabindex="-1"></a></span>
<span id="cb373-76"><a href="categorization-models.html#cb373-76" tabindex="-1"></a><span class="st">            // to make the sampling work</span></span>
<span id="cb373-77"><a href="categorization-models.html#cb373-77" tabindex="-1"></a><span class="st">            if (rr[i] &gt; 0.9999){</span></span>
<span id="cb373-78"><a href="categorization-models.html#cb373-78" tabindex="-1"></a><span class="st">                r[i] = 0.9999;</span></span>
<span id="cb373-79"><a href="categorization-models.html#cb373-79" tabindex="-1"></a><span class="st">            } else if (rr[i] &lt; 0.0001) {</span></span>
<span id="cb373-80"><a href="categorization-models.html#cb373-80" tabindex="-1"></a><span class="st">                r[i] = 0.0001;</span></span>
<span id="cb373-81"><a href="categorization-models.html#cb373-81" tabindex="-1"></a><span class="st">            } else if (rr[i] &gt; 0.0001 &amp;&amp; rr[i] &lt; 0.9999) {</span></span>
<span id="cb373-82"><a href="categorization-models.html#cb373-82" tabindex="-1"></a><span class="st">                r[i] = rr[i];</span></span>
<span id="cb373-83"><a href="categorization-models.html#cb373-83" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb373-84"><a href="categorization-models.html#cb373-84" tabindex="-1"></a><span class="st">                r[i] = 0.5;</span></span>
<span id="cb373-85"><a href="categorization-models.html#cb373-85" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb373-86"><a href="categorization-models.html#cb373-86" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb373-87"><a href="categorization-models.html#cb373-87" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb373-88"><a href="categorization-models.html#cb373-88" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb373-89"><a href="categorization-models.html#cb373-89" tabindex="-1"></a></span>
<span id="cb373-90"><a href="categorization-models.html#cb373-90" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb373-91"><a href="categorization-models.html#cb373-91" tabindex="-1"></a><span class="st">    // Priors</span></span>
<span id="cb373-92"><a href="categorization-models.html#cb373-92" tabindex="-1"></a><span class="st">    target += dirichlet_lpdf(w | w_prior_values);</span></span>
<span id="cb373-93"><a href="categorization-models.html#cb373-93" tabindex="-1"></a><span class="st">    target += normal_lpdf(logit_c | c_prior_values[1], c_prior_values[2]);</span></span>
<span id="cb373-94"><a href="categorization-models.html#cb373-94" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb373-95"><a href="categorization-models.html#cb373-95" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb373-96"><a href="categorization-models.html#cb373-96" tabindex="-1"></a><span class="st">    // Decision Data</span></span>
<span id="cb373-97"><a href="categorization-models.html#cb373-97" tabindex="-1"></a><span class="st">    target += bernoulli_lpmf(y | r);</span></span>
<span id="cb373-98"><a href="categorization-models.html#cb373-98" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb373-99"><a href="categorization-models.html#cb373-99" tabindex="-1"></a></span>
<span id="cb373-100"><a href="categorization-models.html#cb373-100" tabindex="-1"></a><span class="st">generated quantities {</span></span>
<span id="cb373-101"><a href="categorization-models.html#cb373-101" tabindex="-1"></a><span class="st">    // priors</span></span>
<span id="cb373-102"><a href="categorization-models.html#cb373-102" tabindex="-1"></a><span class="st">    simplex[nfeatures] w_prior = dirichlet_rng(w_prior_values);</span></span>
<span id="cb373-103"><a href="categorization-models.html#cb373-103" tabindex="-1"></a><span class="st">    real logit_c_prior = normal_rng(c_prior_values[1], c_prior_values[2]);</span></span>
<span id="cb373-104"><a href="categorization-models.html#cb373-104" tabindex="-1"></a><span class="st">    real&lt;lower=0, upper=2&gt; c_prior = inv_logit(logit_c_prior)*2;</span></span>
<span id="cb373-105"><a href="categorization-models.html#cb373-105" tabindex="-1"></a></span>
<span id="cb373-106"><a href="categorization-models.html#cb373-106" tabindex="-1"></a><span class="st">    // prior pred</span></span>
<span id="cb373-107"><a href="categorization-models.html#cb373-107" tabindex="-1"></a><span class="st">    array[ntrials] real&lt;lower=0, upper=1&gt; r_prior;</span></span>
<span id="cb373-108"><a href="categorization-models.html#cb373-108" tabindex="-1"></a><span class="st">    array[ntrials] real rr_prior;</span></span>
<span id="cb373-109"><a href="categorization-models.html#cb373-109" tabindex="-1"></a><span class="st">    for (i in 1:ntrials) {</span></span>
<span id="cb373-110"><a href="categorization-models.html#cb373-110" tabindex="-1"></a></span>
<span id="cb373-111"><a href="categorization-models.html#cb373-111" tabindex="-1"></a><span class="st">        // calculate distance from obs to all exemplars</span></span>
<span id="cb373-112"><a href="categorization-models.html#cb373-112" tabindex="-1"></a><span class="st">        array[(i-1)] real exemplar_dist;</span></span>
<span id="cb373-113"><a href="categorization-models.html#cb373-113" tabindex="-1"></a><span class="st">        for (e in 1:(i-1)){</span></span>
<span id="cb373-114"><a href="categorization-models.html#cb373-114" tabindex="-1"></a><span class="st">            array[nfeatures] real tmp_dist;</span></span>
<span id="cb373-115"><a href="categorization-models.html#cb373-115" tabindex="-1"></a><span class="st">            for (j in 1:nfeatures) {</span></span>
<span id="cb373-116"><a href="categorization-models.html#cb373-116" tabindex="-1"></a><span class="st">                tmp_dist[j] = w_prior[j]*abs(obs[e,j] - obs[i,j]);</span></span>
<span id="cb373-117"><a href="categorization-models.html#cb373-117" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb373-118"><a href="categorization-models.html#cb373-118" tabindex="-1"></a><span class="st">            exemplar_dist[e] = sum(tmp_dist);</span></span>
<span id="cb373-119"><a href="categorization-models.html#cb373-119" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb373-120"><a href="categorization-models.html#cb373-120" tabindex="-1"></a></span>
<span id="cb373-121"><a href="categorization-models.html#cb373-121" tabindex="-1"></a><span class="st">        if (sum(cat_one[:(i-1)])==0 || sum(cat_two[:(i-1)])==0){  // if there are no examplars in one of the categories</span></span>
<span id="cb373-122"><a href="categorization-models.html#cb373-122" tabindex="-1"></a><span class="st">            r_prior[i] = 0.5;</span></span>
<span id="cb373-123"><a href="categorization-models.html#cb373-123" tabindex="-1"></a></span>
<span id="cb373-124"><a href="categorization-models.html#cb373-124" tabindex="-1"></a><span class="st">        } else {</span></span>
<span id="cb373-125"><a href="categorization-models.html#cb373-125" tabindex="-1"></a><span class="st">            // calculate similarity</span></span>
<span id="cb373-126"><a href="categorization-models.html#cb373-126" tabindex="-1"></a><span class="st">            array[2] real similarities;</span></span>
<span id="cb373-127"><a href="categorization-models.html#cb373-127" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb373-128"><a href="categorization-models.html#cb373-128" tabindex="-1"></a><span class="st">            array[sum(cat_one[:(i-1)])] int tmp_idx_one = cat_one_idx[:sum(cat_one[:(i-1)])];</span></span>
<span id="cb373-129"><a href="categorization-models.html#cb373-129" tabindex="-1"></a><span class="st">            array[sum(cat_two[:(i-1)])] int tmp_idx_two = cat_two_idx[:sum(cat_two[:(i-1)])];</span></span>
<span id="cb373-130"><a href="categorization-models.html#cb373-130" tabindex="-1"></a><span class="st">            similarities[1] = exp(-c_prior * sum(exemplar_dist[tmp_idx_one]));</span></span>
<span id="cb373-131"><a href="categorization-models.html#cb373-131" tabindex="-1"></a><span class="st">            similarities[2] = exp(-c_prior * sum(exemplar_dist[tmp_idx_two]));</span></span>
<span id="cb373-132"><a href="categorization-models.html#cb373-132" tabindex="-1"></a></span>
<span id="cb373-133"><a href="categorization-models.html#cb373-133" tabindex="-1"></a><span class="st">            // calculate r[i]</span></span>
<span id="cb373-134"><a href="categorization-models.html#cb373-134" tabindex="-1"></a><span class="st">            rr_prior[i] = (b*similarities[1]) / (b*similarities[1] + (1-b)*similarities[2]);</span></span>
<span id="cb373-135"><a href="categorization-models.html#cb373-135" tabindex="-1"></a></span>
<span id="cb373-136"><a href="categorization-models.html#cb373-136" tabindex="-1"></a><span class="st">            // to make the sampling work</span></span>
<span id="cb373-137"><a href="categorization-models.html#cb373-137" tabindex="-1"></a><span class="st">            if (rr_prior[i] == 1){</span></span>
<span id="cb373-138"><a href="categorization-models.html#cb373-138" tabindex="-1"></a><span class="st">                r_prior[i] = 0.9999;</span></span>
<span id="cb373-139"><a href="categorization-models.html#cb373-139" tabindex="-1"></a><span class="st">            } else if (rr_prior[i] == 0) {</span></span>
<span id="cb373-140"><a href="categorization-models.html#cb373-140" tabindex="-1"></a><span class="st">                r_prior[i] = 0.0001;</span></span>
<span id="cb373-141"><a href="categorization-models.html#cb373-141" tabindex="-1"></a><span class="st">            } else if (rr_prior[i] &gt; 0 &amp;&amp; rr_prior[i] &lt; 1) {</span></span>
<span id="cb373-142"><a href="categorization-models.html#cb373-142" tabindex="-1"></a><span class="st">                r_prior[i] = rr_prior[i];</span></span>
<span id="cb373-143"><a href="categorization-models.html#cb373-143" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb373-144"><a href="categorization-models.html#cb373-144" tabindex="-1"></a><span class="st">                r_prior[i] = 0.5;</span></span>
<span id="cb373-145"><a href="categorization-models.html#cb373-145" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb373-146"><a href="categorization-models.html#cb373-146" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb373-147"><a href="categorization-models.html#cb373-147" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb373-148"><a href="categorization-models.html#cb373-148" tabindex="-1"></a></span>
<span id="cb373-149"><a href="categorization-models.html#cb373-149" tabindex="-1"></a><span class="st">    array[ntrials] int&lt;lower=0, upper=1&gt; priorpred = bernoulli_rng(r_prior);</span></span>
<span id="cb373-150"><a href="categorization-models.html#cb373-150" tabindex="-1"></a></span>
<span id="cb373-151"><a href="categorization-models.html#cb373-151" tabindex="-1"></a><span class="st">    // posterior pred</span></span>
<span id="cb373-152"><a href="categorization-models.html#cb373-152" tabindex="-1"></a><span class="st">    array[ntrials] int&lt;lower=0, upper=1&gt; posteriorpred = bernoulli_rng(r);</span></span>
<span id="cb373-153"><a href="categorization-models.html#cb373-153" tabindex="-1"></a><span class="st">    array[ntrials] int&lt;lower=0, upper=1&gt; posteriorcorrect;</span></span>
<span id="cb373-154"><a href="categorization-models.html#cb373-154" tabindex="-1"></a><span class="st">    for (i in 1:ntrials) {</span></span>
<span id="cb373-155"><a href="categorization-models.html#cb373-155" tabindex="-1"></a><span class="st">        if (posteriorpred[i] == cat_one[i]) {</span></span>
<span id="cb373-156"><a href="categorization-models.html#cb373-156" tabindex="-1"></a><span class="st">            posteriorcorrect[i] = 1;</span></span>
<span id="cb373-157"><a href="categorization-models.html#cb373-157" tabindex="-1"></a><span class="st">        } else {</span></span>
<span id="cb373-158"><a href="categorization-models.html#cb373-158" tabindex="-1"></a><span class="st">            posteriorcorrect[i] = 0;</span></span>
<span id="cb373-159"><a href="categorization-models.html#cb373-159" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb373-160"><a href="categorization-models.html#cb373-160" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb373-161"><a href="categorization-models.html#cb373-161" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb373-162"><a href="categorization-models.html#cb373-162" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb373-163"><a href="categorization-models.html#cb373-163" tabindex="-1"></a><span class="st">    // log likelihood</span></span>
<span id="cb373-164"><a href="categorization-models.html#cb373-164" tabindex="-1"></a><span class="st">   array[ntrials] real log_lik;</span></span>
<span id="cb373-165"><a href="categorization-models.html#cb373-165" tabindex="-1"></a></span>
<span id="cb373-166"><a href="categorization-models.html#cb373-166" tabindex="-1"></a><span class="st">   for (i in 1:ntrials) {</span></span>
<span id="cb373-167"><a href="categorization-models.html#cb373-167" tabindex="-1"></a><span class="st">        log_lik[i] = bernoulli_lpmf(y[i] | r[i]);</span></span>
<span id="cb373-168"><a href="categorization-models.html#cb373-168" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb373-169"><a href="categorization-models.html#cb373-169" tabindex="-1"></a></span>
<span id="cb373-170"><a href="categorization-models.html#cb373-170" tabindex="-1"></a><span class="st">}&quot;</span></span>
<span id="cb373-171"><a href="categorization-models.html#cb373-171" tabindex="-1"></a></span>
<span id="cb373-172"><a href="categorization-models.html#cb373-172" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb373-173"><a href="categorization-models.html#cb373-173" tabindex="-1"></a>  gcm_model,</span>
<span id="cb373-174"><a href="categorization-models.html#cb373-174" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb373-175"><a href="categorization-models.html#cb373-175" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W10_GCM.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W10_GCM.stan&quot;</code></pre>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="categorization-models.html#cb375-1" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W10_GCM.stan&quot;</span>)</span>
<span id="cb375-2"><a href="categorization-models.html#cb375-2" tabindex="-1"></a>mod_GCM <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb375-3"><a href="categorization-models.html#cb375-3" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<p>Now it’s time to fit the data</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="categorization-models.html#cb376-1" tabindex="-1"></a>d <span class="ot">&lt;-</span> simulated_responses <span class="sc">%&gt;%</span> <span class="fu">subset</span>(</span>
<span id="cb376-2"><a href="categorization-models.html#cb376-2" tabindex="-1"></a>  c <span class="sc">==</span> <span class="st">&quot;1.1&quot;</span> <span class="sc">&amp;</span> w <span class="sc">==</span> <span class="st">&quot;equal&quot;</span></span>
<span id="cb376-3"><a href="categorization-models.html#cb376-3" tabindex="-1"></a>)</span>
<span id="cb376-4"><a href="categorization-models.html#cb376-4" tabindex="-1"></a></span>
<span id="cb376-5"><a href="categorization-models.html#cb376-5" tabindex="-1"></a>gcm_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb376-6"><a href="categorization-models.html#cb376-6" tabindex="-1"></a>  <span class="at">ntrials =</span> <span class="fu">nrow</span>(d),</span>
<span id="cb376-7"><a href="categorization-models.html#cb376-7" tabindex="-1"></a>  <span class="at">nfeatures =</span> <span class="dv">2</span>,</span>
<span id="cb376-8"><a href="categorization-models.html#cb376-8" tabindex="-1"></a>  <span class="at">cat_one =</span> d<span class="sc">$</span>category,</span>
<span id="cb376-9"><a href="categorization-models.html#cb376-9" tabindex="-1"></a>  <span class="at">y =</span> d<span class="sc">$</span>sim_response,</span>
<span id="cb376-10"><a href="categorization-models.html#cb376-10" tabindex="-1"></a>  <span class="at">obs =</span> <span class="fu">as.matrix</span>(d[, <span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;position&quot;</span>)]),</span>
<span id="cb376-11"><a href="categorization-models.html#cb376-11" tabindex="-1"></a>  <span class="at">b =</span> <span class="fl">0.5</span>,</span>
<span id="cb376-12"><a href="categorization-models.html#cb376-12" tabindex="-1"></a>  <span class="at">w_prior_values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb376-13"><a href="categorization-models.html#cb376-13" tabindex="-1"></a>  <span class="at">c_prior_values =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb376-14"><a href="categorization-models.html#cb376-14" tabindex="-1"></a>)</span>
<span id="cb376-15"><a href="categorization-models.html#cb376-15" tabindex="-1"></a></span>
<span id="cb376-16"><a href="categorization-models.html#cb376-16" tabindex="-1"></a>samples_gcm <span class="ot">&lt;-</span> mod_GCM<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb376-17"><a href="categorization-models.html#cb376-17" tabindex="-1"></a>  <span class="at">data =</span> gcm_data,</span>
<span id="cb376-18"><a href="categorization-models.html#cb376-18" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb376-19"><a href="categorization-models.html#cb376-19" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb376-20"><a href="categorization-models.html#cb376-20" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb376-21"><a href="categorization-models.html#cb376-21" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb376-22"><a href="categorization-models.html#cb376-22" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb376-23"><a href="categorization-models.html#cb376-23" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb376-24"><a href="categorization-models.html#cb376-24" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span></span>
<span id="cb376-25"><a href="categorization-models.html#cb376-25" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 1 chain, with 4 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 1 finished in 2182.1 seconds.</code></pre>
<p>Now we need to check the model</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="categorization-models.html#cb378-1" tabindex="-1"></a>samples_gcm<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code></pre></div>
<pre><code>## Processing csv files: /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpP3dlfk/W10_GCM-202402150652-1-85a406.csv
## 
## Checking sampler transitions treedepth.
## Treedepth satisfactory for all transitions.
## 
## Checking sampler transitions for divergences.
## No divergent transitions found.
## 
## Checking E-BFMI - sampler transitions HMC potential energy.
## E-BFMI satisfactory.
## 
## Effective sample size satisfactory.
## 
## Split R-hat values satisfactory all parameters.
## 
## Processing complete, no problems detected.</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="categorization-models.html#cb380-1" tabindex="-1"></a>samples_gcm<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5,129 × 10
##    variable      mean    median     sd     mad       q5      q95  rhat ess_bulk ess_tail
##    &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 lp__     -392.     -392.     0.976  0.695   -394.    -391.     1.00     503.     754.
##  2 w[1]        0.485     0.483  0.0590 0.0591     0.389    0.581  1.00     583.     624.
##  3 w[2]        0.515     0.517  0.0590 0.0591     0.419    0.611  1.00     583.     624.
##  4 logit_c    -0.0957   -0.0940 0.166  0.166     -0.371    0.186  1.00     838.     716.
##  5 c           0.953     0.953  0.0823 0.0827     0.817    1.09   1.00     838.     716.
##  6 r[1]        0.5       0.5    0      0          0.5      0.5   NA         NA       NA 
##  7 r[2]        0.5       0.5    0      0          0.5      0.5   NA         NA       NA 
##  8 r[3]        0.5       0.5    0      0          0.5      0.5   NA         NA       NA 
##  9 r[4]        0.394     0.394  0.0382 0.0372     0.331    0.456  1.00     598.     494.
## 10 r[5]        0.385     0.385  0.0101 0.00964    0.367    0.401  1.00     760.     544.
## # ℹ 5,119 more rows</code></pre>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="categorization-models.html#cb382-1" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples_gcm<span class="sc">$</span><span class="fu">draws</span>())</span>
<span id="cb382-2"><a href="categorization-models.html#cb382-2" tabindex="-1"></a></span>
<span id="cb382-3"><a href="categorization-models.html#cb382-3" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, c, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb382-4"><a href="categorization-models.html#cb382-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb382-5"><a href="categorization-models.html#cb382-5" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="categorization-models.html#cb383-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, logit_c, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb383-2"><a href="categorization-models.html#cb383-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb383-3"><a href="categorization-models.html#cb383-3" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="categorization-models.html#cb384-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, <span class="st">`</span><span class="at">w[1]</span><span class="st">`</span>, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb384-2"><a href="categorization-models.html#cb384-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb384-3"><a href="categorization-models.html#cb384-3" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-36-3.png" width="672" /></p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="categorization-models.html#cb385-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, <span class="st">`</span><span class="at">w[2]</span><span class="st">`</span>, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb385-2"><a href="categorization-models.html#cb385-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb385-3"><a href="categorization-models.html#cb385-3" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-36-4.png" width="672" /></p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="categorization-models.html#cb386-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb386-2"><a href="categorization-models.html#cb386-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(c), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb386-3"><a href="categorization-models.html#cb386-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(c_prior), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb386-4"><a href="categorization-models.html#cb386-4" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> d<span class="sc">$</span>c[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb386-5"><a href="categorization-models.html#cb386-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-36-5.png" width="672" /></p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="categorization-models.html#cb388-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb388-2"><a href="categorization-models.html#cb388-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">w[1]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb388-3"><a href="categorization-models.html#cb388-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">w_prior[1]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb388-4"><a href="categorization-models.html#cb388-4" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb388-5"><a href="categorization-models.html#cb388-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-36-6.png" width="672" /></p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="categorization-models.html#cb390-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb390-2"><a href="categorization-models.html#cb390-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">w[2]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb390-3"><a href="categorization-models.html#cb390-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">w_prior[2]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb390-4"><a href="categorization-models.html#cb390-4" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb390-5"><a href="categorization-models.html#cb390-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-36-7.png" width="672" /></p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="categorization-models.html#cb392-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb392-2"><a href="categorization-models.html#cb392-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(c, <span class="st">`</span><span class="at">w[2]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb392-3"><a href="categorization-models.html#cb392-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-36-8.png" width="672" /></p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="categorization-models.html#cb393-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb393-2"><a href="categorization-models.html#cb393-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(c, <span class="st">`</span><span class="at">w[1]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb393-3"><a href="categorization-models.html#cb393-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-36-9.png" width="672" /></p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="categorization-models.html#cb394-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb394-2"><a href="categorization-models.html#cb394-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">w[1]</span><span class="st">`</span>, <span class="st">`</span><span class="at">w[2]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb394-3"><a href="categorization-models.html#cb394-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-36-10.png" width="672" /></p>
<p>C looks like crap, while weights seem decently recovered. Let’s look at the larger picture, but looping through the different combinations of parameter values.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="categorization-models.html#cb395-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(future, purrr, furrr)</span>
<span id="cb395-2"><a href="categorization-models.html#cb395-2" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="fu">availableCores</span>())</span>
<span id="cb395-3"><a href="categorization-models.html#cb395-3" tabindex="-1"></a></span>
<span id="cb395-4"><a href="categorization-models.html#cb395-4" tabindex="-1"></a>sim_d_and_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(agent, scaling, weights) {</span>
<span id="cb395-5"><a href="categorization-models.html#cb395-5" tabindex="-1"></a>  </span>
<span id="cb395-6"><a href="categorization-models.html#cb395-6" tabindex="-1"></a>    </span>
<span id="cb395-7"><a href="categorization-models.html#cb395-7" tabindex="-1"></a>    temp <span class="ot">&lt;-</span> simulated_responses <span class="sc">%&gt;%</span> <span class="fu">subset</span>(</span>
<span id="cb395-8"><a href="categorization-models.html#cb395-8" tabindex="-1"></a>      c <span class="sc">==</span> scaling <span class="sc">&amp;</span> w <span class="sc">==</span> weights <span class="sc">&amp;</span> agent <span class="sc">==</span> agent</span>
<span id="cb395-9"><a href="categorization-models.html#cb395-9" tabindex="-1"></a>      )</span>
<span id="cb395-10"><a href="categorization-models.html#cb395-10" tabindex="-1"></a>    </span>
<span id="cb395-11"><a href="categorization-models.html#cb395-11" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb395-12"><a href="categorization-models.html#cb395-12" tabindex="-1"></a>      <span class="at">ntrials =</span> <span class="fu">nrow</span>(temp),</span>
<span id="cb395-13"><a href="categorization-models.html#cb395-13" tabindex="-1"></a>      <span class="at">nfeatures =</span> <span class="dv">2</span>,</span>
<span id="cb395-14"><a href="categorization-models.html#cb395-14" tabindex="-1"></a>      <span class="at">cat_one =</span> temp<span class="sc">$</span>category,</span>
<span id="cb395-15"><a href="categorization-models.html#cb395-15" tabindex="-1"></a>      <span class="at">y =</span> temp<span class="sc">$</span>sim_response,</span>
<span id="cb395-16"><a href="categorization-models.html#cb395-16" tabindex="-1"></a>      <span class="at">obs =</span> <span class="fu">as.matrix</span>(temp[, <span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;position&quot;</span>)]),</span>
<span id="cb395-17"><a href="categorization-models.html#cb395-17" tabindex="-1"></a>      <span class="at">b =</span> <span class="fl">0.5</span>,</span>
<span id="cb395-18"><a href="categorization-models.html#cb395-18" tabindex="-1"></a>      <span class="at">w_prior_values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb395-19"><a href="categorization-models.html#cb395-19" tabindex="-1"></a>      <span class="at">c_prior_values =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb395-20"><a href="categorization-models.html#cb395-20" tabindex="-1"></a>    )</span>
<span id="cb395-21"><a href="categorization-models.html#cb395-21" tabindex="-1"></a>    </span>
<span id="cb395-22"><a href="categorization-models.html#cb395-22" tabindex="-1"></a>    samples_gcm <span class="ot">&lt;-</span> mod_GCM<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb395-23"><a href="categorization-models.html#cb395-23" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb395-24"><a href="categorization-models.html#cb395-24" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb395-25"><a href="categorization-models.html#cb395-25" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb395-26"><a href="categorization-models.html#cb395-26" tabindex="-1"></a>      <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb395-27"><a href="categorization-models.html#cb395-27" tabindex="-1"></a>      <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb395-28"><a href="categorization-models.html#cb395-28" tabindex="-1"></a>      <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb395-29"><a href="categorization-models.html#cb395-29" tabindex="-1"></a>      <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb395-30"><a href="categorization-models.html#cb395-30" tabindex="-1"></a>      <span class="at">refresh =</span> <span class="dv">500</span></span>
<span id="cb395-31"><a href="categorization-models.html#cb395-31" tabindex="-1"></a>    )</span>
<span id="cb395-32"><a href="categorization-models.html#cb395-32" tabindex="-1"></a>    </span>
<span id="cb395-33"><a href="categorization-models.html#cb395-33" tabindex="-1"></a>    draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples_gcm<span class="sc">$</span><span class="fu">draws</span>()) </span>
<span id="cb395-34"><a href="categorization-models.html#cb395-34" tabindex="-1"></a>    temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">trueC =</span> scaling, <span class="at">trueW =</span> weights, <span class="at">agent =</span> agent,</span>
<span id="cb395-35"><a href="categorization-models.html#cb395-35" tabindex="-1"></a>                   <span class="at">estC =</span> draws_df<span class="sc">$</span>c, </span>
<span id="cb395-36"><a href="categorization-models.html#cb395-36" tabindex="-1"></a>                   <span class="at">estW1 =</span> draws_df<span class="sc">$</span><span class="st">`</span><span class="at">w[1]</span><span class="st">`</span>,</span>
<span id="cb395-37"><a href="categorization-models.html#cb395-37" tabindex="-1"></a>                   <span class="at">estW2 =</span> draws_df<span class="sc">$</span><span class="st">`</span><span class="at">w[2]</span><span class="st">`</span></span>
<span id="cb395-38"><a href="categorization-models.html#cb395-38" tabindex="-1"></a>                   )</span>
<span id="cb395-39"><a href="categorization-models.html#cb395-39" tabindex="-1"></a>    </span>
<span id="cb395-40"><a href="categorization-models.html#cb395-40" tabindex="-1"></a>    <span class="fu">return</span>(temp)</span>
<span id="cb395-41"><a href="categorization-models.html#cb395-41" tabindex="-1"></a>  </span>
<span id="cb395-42"><a href="categorization-models.html#cb395-42" tabindex="-1"></a>}</span>
<span id="cb395-43"><a href="categorization-models.html#cb395-43" tabindex="-1"></a></span>
<span id="cb395-44"><a href="categorization-models.html#cb395-44" tabindex="-1"></a></span>
<span id="cb395-45"><a href="categorization-models.html#cb395-45" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="fu">unique</span>(simulated_responses[,<span class="fu">c</span>(<span class="st">&quot;agent&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;w&quot;</span>)])) <span class="sc">%&gt;%</span></span>
<span id="cb395-46"><a href="categorization-models.html#cb395-46" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb395-47"><a href="categorization-models.html#cb395-47" tabindex="-1"></a>    <span class="at">scaling =</span> c,</span>
<span id="cb395-48"><a href="categorization-models.html#cb395-48" tabindex="-1"></a>    <span class="at">weights =</span> w</span>
<span id="cb395-49"><a href="categorization-models.html#cb395-49" tabindex="-1"></a>  )</span>
<span id="cb395-50"><a href="categorization-models.html#cb395-50" tabindex="-1"></a></span>
<span id="cb395-51"><a href="categorization-models.html#cb395-51" tabindex="-1"></a>recovery_df <span class="ot">&lt;-</span> <span class="fu">future_pmap_dfr</span>(temp, sim_d_and_fit, <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb395-52"><a href="categorization-models.html#cb395-52" tabindex="-1"></a></span>
<span id="cb395-53"><a href="categorization-models.html#cb395-53" tabindex="-1"></a><span class="fu">write_csv</span>(recovery_df, <span class="st">&quot;simdata/W10_GCM_recoverydf.csv&quot;</span>)</span></code></pre></div>
<p>Time to visualize</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="categorization-models.html#cb396-1" tabindex="-1"></a>recovery_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;simdata/W10_GCM_recoverydf.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 300000 Columns: 6
## ── Column specification ────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): trueW
## dbl (5): trueC, agent, estC, estW1, estW2
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="categorization-models.html#cb398-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(recovery_df) <span class="sc">+</span></span>
<span id="cb398-2"><a href="categorization-models.html#cb398-2" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(estC, <span class="at">group =</span> trueW, <span class="at">fill =</span> trueW), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb398-3"><a href="categorization-models.html#cb398-3" tabindex="-1"></a>  <span class="co">#geom_vline(xintercept = trueC) +</span></span>
<span id="cb398-4"><a href="categorization-models.html#cb398-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> trueC) <span class="sc">+</span></span>
<span id="cb398-5"><a href="categorization-models.html#cb398-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb398-6"><a href="categorization-models.html#cb398-6" tabindex="-1"></a></span>
<span id="cb398-7"><a href="categorization-models.html#cb398-7" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(recovery_df) <span class="sc">+</span></span>
<span id="cb398-8"><a href="categorization-models.html#cb398-8" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(estW1, <span class="at">group =</span> trueW, <span class="at">fill =</span> trueW), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb398-9"><a href="categorization-models.html#cb398-9" tabindex="-1"></a>  <span class="co">#geom_vline(xintercept = trueC) +</span></span>
<span id="cb398-10"><a href="categorization-models.html#cb398-10" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(trueC <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb398-11"><a href="categorization-models.html#cb398-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb398-12"><a href="categorization-models.html#cb398-12" tabindex="-1"></a></span>
<span id="cb398-13"><a href="categorization-models.html#cb398-13" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<div id="multilevel-gcm" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Multilevel GCM<a href="categorization-models.html#multilevel-gcm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: quick reminder of what it means to make GCM multilevel: weights and can vary by participants, but they do not do so in correlated ways]</p>
<div id="simulate-hierarchical-simplices" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Simulate hierarchical simplices<a href="categorization-models.html#simulate-hierarchical-simplices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need weights that sum up to 1 at the population level and at the individual level. Let’s simulate the dirichlet distribution to see how it does it.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="categorization-models.html#cb399-1" tabindex="-1"></a>simulate_dirichlet <span class="ot">&lt;-</span> <span class="cf">function</span>(weights, kappa, agents){</span>
<span id="cb399-2"><a href="categorization-models.html#cb399-2" tabindex="-1"></a>  </span>
<span id="cb399-3"><a href="categorization-models.html#cb399-3" tabindex="-1"></a>  w_n <span class="ot">&lt;-</span> <span class="fu">length</span>(weights)</span>
<span id="cb399-4"><a href="categorization-models.html#cb399-4" tabindex="-1"></a>  </span>
<span id="cb399-5"><a href="categorization-models.html#cb399-5" tabindex="-1"></a>  w_ind <span class="ot">&lt;-</span> <span class="fu">rdirichlet</span>(agents, weights <span class="sc">*</span> kappa)</span>
<span id="cb399-6"><a href="categorization-models.html#cb399-6" tabindex="-1"></a>  </span>
<span id="cb399-7"><a href="categorization-models.html#cb399-7" tabindex="-1"></a>  w_ind_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb399-8"><a href="categorization-models.html#cb399-8" tabindex="-1"></a>    <span class="at">agent =</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">seq</span>(agents), <span class="at">each =</span> w_n)),</span>
<span id="cb399-9"><a href="categorization-models.html#cb399-9" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">c</span>(w_ind),</span>
<span id="cb399-10"><a href="categorization-models.html#cb399-10" tabindex="-1"></a>    <span class="at">weight =</span> <span class="fu">rep</span>(<span class="fu">seq</span>(w_n), agents)</span>
<span id="cb399-11"><a href="categorization-models.html#cb399-11" tabindex="-1"></a>  )</span>
<span id="cb399-12"><a href="categorization-models.html#cb399-12" tabindex="-1"></a>  </span>
<span id="cb399-13"><a href="categorization-models.html#cb399-13" tabindex="-1"></a>  <span class="fu">return</span>(w_ind_df)</span>
<span id="cb399-14"><a href="categorization-models.html#cb399-14" tabindex="-1"></a>}</span>
<span id="cb399-15"><a href="categorization-models.html#cb399-15" tabindex="-1"></a></span>
<span id="cb399-16"><a href="categorization-models.html#cb399-16" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">simulate_dirichlet</span>(<span class="at">weights =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="at">kappa =</span> <span class="dv">100</span>, <span class="at">agents =</span> <span class="dv">10</span>)</span>
<span id="cb399-17"><a href="categorization-models.html#cb399-17" tabindex="-1"></a></span>
<span id="cb399-18"><a href="categorization-models.html#cb399-18" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(d, <span class="fu">aes</span>(weight, value, <span class="at">group =</span> agent, <span class="at">color =</span> agent)) <span class="sc">+</span></span>
<span id="cb399-19"><a href="categorization-models.html#cb399-19" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb399-20"><a href="categorization-models.html#cb399-20" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb399-21"><a href="categorization-models.html#cb399-21" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb399-22"><a href="categorization-models.html#cb399-22" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb399-23"><a href="categorization-models.html#cb399-23" tabindex="-1"></a></span>
<span id="cb399-24"><a href="categorization-models.html#cb399-24" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">simulate_dirichlet</span>(<span class="at">weights =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="at">kappa =</span> <span class="dv">1</span>, <span class="at">agents =</span> <span class="dv">10</span>)</span>
<span id="cb399-25"><a href="categorization-models.html#cb399-25" tabindex="-1"></a></span>
<span id="cb399-26"><a href="categorization-models.html#cb399-26" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(d, <span class="fu">aes</span>(weight, value, <span class="at">group =</span> agent, <span class="at">color =</span> agent)) <span class="sc">+</span></span>
<span id="cb399-27"><a href="categorization-models.html#cb399-27" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb399-28"><a href="categorization-models.html#cb399-28" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb399-29"><a href="categorization-models.html#cb399-29" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb399-30"><a href="categorization-models.html#cb399-30" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb399-31"><a href="categorization-models.html#cb399-31" tabindex="-1"></a></span>
<span id="cb399-32"><a href="categorization-models.html#cb399-32" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
<div id="set-up-the-data-simulation" class="section level3 hasAnchor" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> Set up the data simulation<a href="categorization-models.html#set-up-the-data-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need to feed:
- agents
- scaling (M and SD)
- weights (weights and concentration)</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="categorization-models.html#cb400-1" tabindex="-1"></a>agents <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb400-2"><a href="categorization-models.html#cb400-2" tabindex="-1"></a>scalingM <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb400-3"><a href="categorization-models.html#cb400-3" tabindex="-1"></a>scalingSD <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb400-4"><a href="categorization-models.html#cb400-4" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>)</span>
<span id="cb400-5"><a href="categorization-models.html#cb400-5" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb400-6"><a href="categorization-models.html#cb400-6" tabindex="-1"></a></span>
<span id="cb400-7"><a href="categorization-models.html#cb400-7" tabindex="-1"></a><span class="co"># First one agent, just to make sure it works</span></span>
<span id="cb400-8"><a href="categorization-models.html#cb400-8" tabindex="-1"></a>simulate_responses <span class="ot">&lt;-</span> <span class="cf">function</span>(agent, weights, c) {</span>
<span id="cb400-9"><a href="categorization-models.html#cb400-9" tabindex="-1"></a>    </span>
<span id="cb400-10"><a href="categorization-models.html#cb400-10" tabindex="-1"></a>    observations <span class="ot">&lt;-</span> experiment <span class="sc">%&gt;%</span></span>
<span id="cb400-11"><a href="categorization-models.html#cb400-11" tabindex="-1"></a>        <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;position&quot;</span>))</span>
<span id="cb400-12"><a href="categorization-models.html#cb400-12" tabindex="-1"></a>    </span>
<span id="cb400-13"><a href="categorization-models.html#cb400-13" tabindex="-1"></a>    category <span class="ot">&lt;-</span> experiment<span class="sc">$</span>category</span>
<span id="cb400-14"><a href="categorization-models.html#cb400-14" tabindex="-1"></a>    </span>
<span id="cb400-15"><a href="categorization-models.html#cb400-15" tabindex="-1"></a>    <span class="co"># simulate responses</span></span>
<span id="cb400-16"><a href="categorization-models.html#cb400-16" tabindex="-1"></a>    responses <span class="ot">&lt;-</span> <span class="fu">gcm</span>(</span>
<span id="cb400-17"><a href="categorization-models.html#cb400-17" tabindex="-1"></a>        weights,</span>
<span id="cb400-18"><a href="categorization-models.html#cb400-18" tabindex="-1"></a>        c,</span>
<span id="cb400-19"><a href="categorization-models.html#cb400-19" tabindex="-1"></a>        observations,</span>
<span id="cb400-20"><a href="categorization-models.html#cb400-20" tabindex="-1"></a>        category</span>
<span id="cb400-21"><a href="categorization-models.html#cb400-21" tabindex="-1"></a>    )</span>
<span id="cb400-22"><a href="categorization-models.html#cb400-22" tabindex="-1"></a>    </span>
<span id="cb400-23"><a href="categorization-models.html#cb400-23" tabindex="-1"></a>    tmp_simulated_responses <span class="ot">&lt;-</span> experiment <span class="sc">%&gt;%</span></span>
<span id="cb400-24"><a href="categorization-models.html#cb400-24" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb400-25"><a href="categorization-models.html#cb400-25" tabindex="-1"></a>            <span class="at">trial =</span> <span class="fu">seq</span>(<span class="fu">nrow</span>(experiment)),</span>
<span id="cb400-26"><a href="categorization-models.html#cb400-26" tabindex="-1"></a>            <span class="at">sim_response =</span> responses,</span>
<span id="cb400-27"><a href="categorization-models.html#cb400-27" tabindex="-1"></a>            <span class="at">correct =</span> <span class="fu">ifelse</span>(category <span class="sc">==</span> sim_response, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb400-28"><a href="categorization-models.html#cb400-28" tabindex="-1"></a>            <span class="at">performance =</span> <span class="fu">cumsum</span>(correct) <span class="sc">/</span> <span class="fu">seq_along</span>(correct),</span>
<span id="cb400-29"><a href="categorization-models.html#cb400-29" tabindex="-1"></a>            <span class="at">c =</span> c,</span>
<span id="cb400-30"><a href="categorization-models.html#cb400-30" tabindex="-1"></a>            <span class="at">w1 =</span> weights[<span class="dv">1</span>],</span>
<span id="cb400-31"><a href="categorization-models.html#cb400-31" tabindex="-1"></a>            <span class="at">w2 =</span> weights[<span class="dv">2</span>],</span>
<span id="cb400-32"><a href="categorization-models.html#cb400-32" tabindex="-1"></a>            <span class="at">agent =</span> agent</span>
<span id="cb400-33"><a href="categorization-models.html#cb400-33" tabindex="-1"></a>        )</span>
<span id="cb400-34"><a href="categorization-models.html#cb400-34" tabindex="-1"></a></span>
<span id="cb400-35"><a href="categorization-models.html#cb400-35" tabindex="-1"></a>    <span class="fu">return</span>(tmp_simulated_responses)</span>
<span id="cb400-36"><a href="categorization-models.html#cb400-36" tabindex="-1"></a>}</span>
<span id="cb400-37"><a href="categorization-models.html#cb400-37" tabindex="-1"></a></span>
<span id="cb400-38"><a href="categorization-models.html#cb400-38" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">simulate_responses</span>(agents, weights, scalingM)</span>
<span id="cb400-39"><a href="categorization-models.html#cb400-39" tabindex="-1"></a></span>
<span id="cb400-40"><a href="categorization-models.html#cb400-40" tabindex="-1"></a><span class="do">## Then we make sure to simulate n agents</span></span>
<span id="cb400-41"><a href="categorization-models.html#cb400-41" tabindex="-1"></a></span>
<span id="cb400-42"><a href="categorization-models.html#cb400-42" tabindex="-1"></a>simulate_ml_responses <span class="ot">&lt;-</span> <span class="cf">function</span>(agents, scalingM, scalingSD, weights, kappa) {</span>
<span id="cb400-43"><a href="categorization-models.html#cb400-43" tabindex="-1"></a>  </span>
<span id="cb400-44"><a href="categorization-models.html#cb400-44" tabindex="-1"></a>  w_ind <span class="ot">&lt;-</span> <span class="fu">rdirichlet</span>(agents, weights <span class="sc">*</span> kappa)</span>
<span id="cb400-45"><a href="categorization-models.html#cb400-45" tabindex="-1"></a>  c_ind <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(agents, scalingM, scalingSD)</span>
<span id="cb400-46"><a href="categorization-models.html#cb400-46" tabindex="-1"></a>  </span>
<span id="cb400-47"><a href="categorization-models.html#cb400-47" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>agents) {</span>
<span id="cb400-48"><a href="categorization-models.html#cb400-48" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">simulate_responses</span>(i, <span class="at">weights =</span> <span class="fu">c</span>(w_ind[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]), <span class="at">c =</span> c_ind[i])</span>
<span id="cb400-49"><a href="categorization-models.html#cb400-49" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb400-50"><a href="categorization-models.html#cb400-50" tabindex="-1"></a>      simulated_responses <span class="ot">&lt;-</span> tmp</span>
<span id="cb400-51"><a href="categorization-models.html#cb400-51" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb400-52"><a href="categorization-models.html#cb400-52" tabindex="-1"></a>      simulated_responses <span class="ot">&lt;-</span> <span class="fu">rbind</span>(simulated_responses, tmp)</span>
<span id="cb400-53"><a href="categorization-models.html#cb400-53" tabindex="-1"></a>    }</span>
<span id="cb400-54"><a href="categorization-models.html#cb400-54" tabindex="-1"></a>  }</span>
<span id="cb400-55"><a href="categorization-models.html#cb400-55" tabindex="-1"></a>  </span>
<span id="cb400-56"><a href="categorization-models.html#cb400-56" tabindex="-1"></a>  <span class="fu">return</span>(simulated_responses)</span>
<span id="cb400-57"><a href="categorization-models.html#cb400-57" tabindex="-1"></a>}</span>
<span id="cb400-58"><a href="categorization-models.html#cb400-58" tabindex="-1"></a></span>
<span id="cb400-59"><a href="categorization-models.html#cb400-59" tabindex="-1"></a><span class="co"># Simulate and visualize</span></span>
<span id="cb400-60"><a href="categorization-models.html#cb400-60" tabindex="-1"></a></span>
<span id="cb400-61"><a href="categorization-models.html#cb400-61" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">simulate_ml_responses</span>(agents, scalingM, scalingSD, weights, kappa)</span>
<span id="cb400-62"><a href="categorization-models.html#cb400-62" tabindex="-1"></a></span>
<span id="cb400-63"><a href="categorization-models.html#cb400-63" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(trial, performance)) <span class="sc">+</span></span>
<span id="cb400-64"><a href="categorization-models.html#cb400-64" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb400-65"><a href="categorization-models.html#cb400-65" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> agent, <span class="at">color =</span> agent)) <span class="sc">+</span></span>
<span id="cb400-66"><a href="categorization-models.html#cb400-66" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
</div>
<div id="set-up-the-stan-model" class="section level3 hasAnchor" number="10.1.3">
<h3><span class="header-section-number">10.1.3</span> Set up the Stan model<a href="categorization-models.html#set-up-the-stan-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="categorization-models.html#cb402-1" tabindex="-1"></a>gcm_ml_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb402-2"><a href="categorization-models.html#cb402-2" tabindex="-1"></a><span class="st">// Generalized Context Model (GCM) - multilevel version</span></span>
<span id="cb402-3"><a href="categorization-models.html#cb402-3" tabindex="-1"></a></span>
<span id="cb402-4"><a href="categorization-models.html#cb402-4" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb402-5"><a href="categorization-models.html#cb402-5" tabindex="-1"></a><span class="st">    int&lt;lower=1&gt; nsubjects;  // number of subjects</span></span>
<span id="cb402-6"><a href="categorization-models.html#cb402-6" tabindex="-1"></a><span class="st">    int&lt;lower=1&gt; ntrials;  // number of trials</span></span>
<span id="cb402-7"><a href="categorization-models.html#cb402-7" tabindex="-1"></a><span class="st">    int&lt;lower=1&gt; nfeatures;  // number of predefined relevant features</span></span>
<span id="cb402-8"><a href="categorization-models.html#cb402-8" tabindex="-1"></a><span class="st">    array[ntrials] int&lt;lower=0, upper=1&gt; cat_one; // true responses on a trial by trial basis</span></span>
<span id="cb402-9"><a href="categorization-models.html#cb402-9" tabindex="-1"></a><span class="st">    array[ntrials, nsubjects] int&lt;lower=0, upper=1&gt; y;  // decisions on a trial by trial basis</span></span>
<span id="cb402-10"><a href="categorization-models.html#cb402-10" tabindex="-1"></a><span class="st">    array[ntrials, nfeatures] real obs; // stimuli as vectors of features assuming all participants get the same sequence</span></span>
<span id="cb402-11"><a href="categorization-models.html#cb402-11" tabindex="-1"></a><span class="st">    real&lt;lower=0, upper=1&gt; b;  // initial bias for category one over two</span></span>
<span id="cb402-12"><a href="categorization-models.html#cb402-12" tabindex="-1"></a></span>
<span id="cb402-13"><a href="categorization-models.html#cb402-13" tabindex="-1"></a><span class="st">    // priors</span></span>
<span id="cb402-14"><a href="categorization-models.html#cb402-14" tabindex="-1"></a><span class="st">    vector[nfeatures] w_prior_values;  // concentration parameters for dirichlet distribution &lt;lower=1&gt;</span></span>
<span id="cb402-15"><a href="categorization-models.html#cb402-15" tabindex="-1"></a><span class="st">    array[2] real c_prior_values;  // mean and variance for logit-normal distribution</span></span>
<span id="cb402-16"><a href="categorization-models.html#cb402-16" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb402-17"><a href="categorization-models.html#cb402-17" tabindex="-1"></a></span>
<span id="cb402-18"><a href="categorization-models.html#cb402-18" tabindex="-1"></a><span class="st">transformed data { // assuming all participants get the same sequence</span></span>
<span id="cb402-19"><a href="categorization-models.html#cb402-19" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb402-20"><a href="categorization-models.html#cb402-20" tabindex="-1"></a><span class="st">    array[ntrials] int&lt;lower=0, upper=1&gt; cat_two; // dummy variable for category two over cat 1</span></span>
<span id="cb402-21"><a href="categorization-models.html#cb402-21" tabindex="-1"></a><span class="st">    array[sum(cat_one)] int&lt;lower=1, upper = ntrials&gt; cat_one_idx; // array of which stimuli are cat 1</span></span>
<span id="cb402-22"><a href="categorization-models.html#cb402-22" tabindex="-1"></a><span class="st">    array[ntrials - sum(cat_one)] int&lt;lower = 1, upper = ntrials&gt; cat_two_idx; //  array of which stimuli are cat 2</span></span>
<span id="cb402-23"><a href="categorization-models.html#cb402-23" tabindex="-1"></a><span class="st">    int idx_one = 1; // Initializing </span></span>
<span id="cb402-24"><a href="categorization-models.html#cb402-24" tabindex="-1"></a><span class="st">    int idx_two = 1;</span></span>
<span id="cb402-25"><a href="categorization-models.html#cb402-25" tabindex="-1"></a><span class="st">    for (i in 1:ntrials){</span></span>
<span id="cb402-26"><a href="categorization-models.html#cb402-26" tabindex="-1"></a><span class="st">        cat_two[i] = abs(cat_one[i]-1);</span></span>
<span id="cb402-27"><a href="categorization-models.html#cb402-27" tabindex="-1"></a></span>
<span id="cb402-28"><a href="categorization-models.html#cb402-28" tabindex="-1"></a><span class="st">        if (cat_one[i]==1){</span></span>
<span id="cb402-29"><a href="categorization-models.html#cb402-29" tabindex="-1"></a><span class="st">            cat_one_idx[idx_one] = i;</span></span>
<span id="cb402-30"><a href="categorization-models.html#cb402-30" tabindex="-1"></a><span class="st">            idx_one +=1;</span></span>
<span id="cb402-31"><a href="categorization-models.html#cb402-31" tabindex="-1"></a><span class="st">        } else {</span></span>
<span id="cb402-32"><a href="categorization-models.html#cb402-32" tabindex="-1"></a><span class="st">            cat_two_idx[idx_two] = i;</span></span>
<span id="cb402-33"><a href="categorization-models.html#cb402-33" tabindex="-1"></a><span class="st">            idx_two += 1;</span></span>
<span id="cb402-34"><a href="categorization-models.html#cb402-34" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb402-35"><a href="categorization-models.html#cb402-35" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb402-36"><a href="categorization-models.html#cb402-36" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb402-37"><a href="categorization-models.html#cb402-37" tabindex="-1"></a></span>
<span id="cb402-38"><a href="categorization-models.html#cb402-38" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb402-39"><a href="categorization-models.html#cb402-39" tabindex="-1"></a><span class="st">    real logit_c_M;    // Pop Mean of the scaling parameter (how fast similarity decrease with distance). </span></span>
<span id="cb402-40"><a href="categorization-models.html#cb402-40" tabindex="-1"></a><span class="st">    real&lt;lower = 0&gt; logit_c_SD;    // Pop SD of the scaling parameter (how fast similarity decrease with distance). </span></span>
<span id="cb402-41"><a href="categorization-models.html#cb402-41" tabindex="-1"></a><span class="st">    vector[nsubjects] logit_c;    // scaling parameter (how fast similarity decrease with distance). </span></span>
<span id="cb402-42"><a href="categorization-models.html#cb402-42" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb402-43"><a href="categorization-models.html#cb402-43" tabindex="-1"></a><span class="st">    simplex[nfeatures] weight;  // simplex means sum(w)=1</span></span>
<span id="cb402-44"><a href="categorization-models.html#cb402-44" tabindex="-1"></a><span class="st">    real&lt;lower=0&gt; kappa;</span></span>
<span id="cb402-45"><a href="categorization-models.html#cb402-45" tabindex="-1"></a><span class="st">    array[nsubjects] simplex[nfeatures] w_ind;    // weight parameter (how much attention should be paid to feature 1 related to feature 2 - summing up to 1)</span></span>
<span id="cb402-46"><a href="categorization-models.html#cb402-46" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb402-47"><a href="categorization-models.html#cb402-47" tabindex="-1"></a></span>
<span id="cb402-48"><a href="categorization-models.html#cb402-48" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb402-49"><a href="categorization-models.html#cb402-49" tabindex="-1"></a><span class="st">    // parameter w</span></span>
<span id="cb402-50"><a href="categorization-models.html#cb402-50" tabindex="-1"></a><span class="st">    vector[nfeatures] alpha = kappa * weight;</span></span>
<span id="cb402-51"><a href="categorization-models.html#cb402-51" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb402-52"><a href="categorization-models.html#cb402-52" tabindex="-1"></a><span class="st">    // parameter c </span></span>
<span id="cb402-53"><a href="categorization-models.html#cb402-53" tabindex="-1"></a><span class="st">    vector&lt;lower=0,upper=2&gt;[nsubjects] c = inv_logit(logit_c)*2;  // times 2 as c is bounded between 0 and 2</span></span>
<span id="cb402-54"><a href="categorization-models.html#cb402-54" tabindex="-1"></a></span>
<span id="cb402-55"><a href="categorization-models.html#cb402-55" tabindex="-1"></a><span class="st">    // parameter r (probability of response = category 1)</span></span>
<span id="cb402-56"><a href="categorization-models.html#cb402-56" tabindex="-1"></a><span class="st">    array[ntrials, nsubjects] real&lt;lower=0.0001, upper=0.9999&gt; r;</span></span>
<span id="cb402-57"><a href="categorization-models.html#cb402-57" tabindex="-1"></a><span class="st">    array[ntrials, nsubjects] real rr;</span></span>
<span id="cb402-58"><a href="categorization-models.html#cb402-58" tabindex="-1"></a></span>
<span id="cb402-59"><a href="categorization-models.html#cb402-59" tabindex="-1"></a><span class="st">    for (sub in 1:nsubjects) {</span></span>
<span id="cb402-60"><a href="categorization-models.html#cb402-60" tabindex="-1"></a><span class="st">      for (trial in 1:ntrials) {</span></span>
<span id="cb402-61"><a href="categorization-models.html#cb402-61" tabindex="-1"></a></span>
<span id="cb402-62"><a href="categorization-models.html#cb402-62" tabindex="-1"></a><span class="st">        // calculate distance from obs to all exemplars</span></span>
<span id="cb402-63"><a href="categorization-models.html#cb402-63" tabindex="-1"></a><span class="st">        array[(trial-1)] real exemplar_sim;</span></span>
<span id="cb402-64"><a href="categorization-models.html#cb402-64" tabindex="-1"></a><span class="st">        for (e in 1:(trial-1)){</span></span>
<span id="cb402-65"><a href="categorization-models.html#cb402-65" tabindex="-1"></a><span class="st">            array[nfeatures] real tmp_dist;</span></span>
<span id="cb402-66"><a href="categorization-models.html#cb402-66" tabindex="-1"></a><span class="st">            for (feature in 1:nfeatures) {</span></span>
<span id="cb402-67"><a href="categorization-models.html#cb402-67" tabindex="-1"></a><span class="st">                tmp_dist[feature] = w_ind[sub,feature]*abs(obs[e,feature] - obs[trial,feature]);</span></span>
<span id="cb402-68"><a href="categorization-models.html#cb402-68" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb402-69"><a href="categorization-models.html#cb402-69" tabindex="-1"></a><span class="st">            exemplar_sim[e] = exp(-c[sub] * sum(tmp_dist));</span></span>
<span id="cb402-70"><a href="categorization-models.html#cb402-70" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb402-71"><a href="categorization-models.html#cb402-71" tabindex="-1"></a></span>
<span id="cb402-72"><a href="categorization-models.html#cb402-72" tabindex="-1"></a><span class="st">        if (sum(cat_one[:(trial-1)])==0 || sum(cat_two[:(trial-1)])==0){  // if there are no examplars in one of the categories</span></span>
<span id="cb402-73"><a href="categorization-models.html#cb402-73" tabindex="-1"></a><span class="st">            r[trial,sub] = 0.5;</span></span>
<span id="cb402-74"><a href="categorization-models.html#cb402-74" tabindex="-1"></a></span>
<span id="cb402-75"><a href="categorization-models.html#cb402-75" tabindex="-1"></a><span class="st">        } else {</span></span>
<span id="cb402-76"><a href="categorization-models.html#cb402-76" tabindex="-1"></a><span class="st">            // calculate similarity</span></span>
<span id="cb402-77"><a href="categorization-models.html#cb402-77" tabindex="-1"></a><span class="st">            array[2] real similarities;</span></span>
<span id="cb402-78"><a href="categorization-models.html#cb402-78" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb402-79"><a href="categorization-models.html#cb402-79" tabindex="-1"></a><span class="st">            array[sum(cat_one[:(trial-1)])] int tmp_idx_one = cat_one_idx[:sum(cat_one[:(trial-1)])];</span></span>
<span id="cb402-80"><a href="categorization-models.html#cb402-80" tabindex="-1"></a><span class="st">            array[sum(cat_two[:(trial-1)])] int tmp_idx_two = cat_two_idx[:sum(cat_two[:(trial-1)])];</span></span>
<span id="cb402-81"><a href="categorization-models.html#cb402-81" tabindex="-1"></a><span class="st">            similarities[1] = sum(exemplar_sim[tmp_idx_one]);</span></span>
<span id="cb402-82"><a href="categorization-models.html#cb402-82" tabindex="-1"></a><span class="st">            similarities[2] = sum(exemplar_sim[tmp_idx_two]);</span></span>
<span id="cb402-83"><a href="categorization-models.html#cb402-83" tabindex="-1"></a></span>
<span id="cb402-84"><a href="categorization-models.html#cb402-84" tabindex="-1"></a><span class="st">            // calculate r</span></span>
<span id="cb402-85"><a href="categorization-models.html#cb402-85" tabindex="-1"></a><span class="st">            rr[trial,sub] = (b*similarities[1]) / (b*similarities[1] + (1-b)*similarities[2]);</span></span>
<span id="cb402-86"><a href="categorization-models.html#cb402-86" tabindex="-1"></a></span>
<span id="cb402-87"><a href="categorization-models.html#cb402-87" tabindex="-1"></a><span class="st">            // to make the sampling work</span></span>
<span id="cb402-88"><a href="categorization-models.html#cb402-88" tabindex="-1"></a><span class="st">            if (rr[trial,sub] &gt; 0.9999){</span></span>
<span id="cb402-89"><a href="categorization-models.html#cb402-89" tabindex="-1"></a><span class="st">                r[trial,sub] = 0.9999;</span></span>
<span id="cb402-90"><a href="categorization-models.html#cb402-90" tabindex="-1"></a><span class="st">            } else if (rr[trial,sub] &lt; 0.0001) {</span></span>
<span id="cb402-91"><a href="categorization-models.html#cb402-91" tabindex="-1"></a><span class="st">                r[trial,sub] = 0.0001;</span></span>
<span id="cb402-92"><a href="categorization-models.html#cb402-92" tabindex="-1"></a><span class="st">            } else if (rr[trial,sub] &gt; 0.0001 &amp;&amp; rr[trial,sub] &lt; 0.9999) {</span></span>
<span id="cb402-93"><a href="categorization-models.html#cb402-93" tabindex="-1"></a><span class="st">                r[trial,sub] = rr[trial,sub];</span></span>
<span id="cb402-94"><a href="categorization-models.html#cb402-94" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb402-95"><a href="categorization-models.html#cb402-95" tabindex="-1"></a><span class="st">                r[trial,sub] = 0.5;</span></span>
<span id="cb402-96"><a href="categorization-models.html#cb402-96" tabindex="-1"></a><span class="st">            }}}}}</span></span>
<span id="cb402-97"><a href="categorization-models.html#cb402-97" tabindex="-1"></a></span>
<span id="cb402-98"><a href="categorization-models.html#cb402-98" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb402-99"><a href="categorization-models.html#cb402-99" tabindex="-1"></a><span class="st">    // Priors</span></span>
<span id="cb402-100"><a href="categorization-models.html#cb402-100" tabindex="-1"></a><span class="st">    target += exponential_lpdf(kappa | 0.1);</span></span>
<span id="cb402-101"><a href="categorization-models.html#cb402-101" tabindex="-1"></a><span class="st">    target += dirichlet_lpdf(weight | w_prior_values);</span></span>
<span id="cb402-102"><a href="categorization-models.html#cb402-102" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb402-103"><a href="categorization-models.html#cb402-103" tabindex="-1"></a><span class="st">    target += normal_lpdf(logit_c_M | c_prior_values[1], c_prior_values[2]);</span></span>
<span id="cb402-104"><a href="categorization-models.html#cb402-104" tabindex="-1"></a><span class="st">    target += normal_lpdf(logit_c_SD | 0, 1) - normal_lccdf(0 | 0, 1);</span></span>
<span id="cb402-105"><a href="categorization-models.html#cb402-105" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb402-106"><a href="categorization-models.html#cb402-106" tabindex="-1"></a><span class="st">    target += normal_lpdf(logit_c | logit_c_M, logit_c_SD);</span></span>
<span id="cb402-107"><a href="categorization-models.html#cb402-107" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb402-108"><a href="categorization-models.html#cb402-108" tabindex="-1"></a><span class="st">    // Decision Data</span></span>
<span id="cb402-109"><a href="categorization-models.html#cb402-109" tabindex="-1"></a><span class="st">    for (sub in 1:nsubjects){</span></span>
<span id="cb402-110"><a href="categorization-models.html#cb402-110" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb402-111"><a href="categorization-models.html#cb402-111" tabindex="-1"></a><span class="st">      target += dirichlet_lpdf(w_ind[sub] | alpha);</span></span>
<span id="cb402-112"><a href="categorization-models.html#cb402-112" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb402-113"><a href="categorization-models.html#cb402-113" tabindex="-1"></a><span class="st">      for (trial in 1:ntrials){</span></span>
<span id="cb402-114"><a href="categorization-models.html#cb402-114" tabindex="-1"></a><span class="st">        target += bernoulli_lpmf(y[trial,sub] | r[trial,sub]);</span></span>
<span id="cb402-115"><a href="categorization-models.html#cb402-115" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb402-116"><a href="categorization-models.html#cb402-116" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb402-117"><a href="categorization-models.html#cb402-117" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb402-118"><a href="categorization-models.html#cb402-118" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb402-119"><a href="categorization-models.html#cb402-119" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb402-120"><a href="categorization-models.html#cb402-120" tabindex="-1"></a></span>
<span id="cb402-121"><a href="categorization-models.html#cb402-121" tabindex="-1"></a><span class="st">// generated quantities {</span></span>
<span id="cb402-122"><a href="categorization-models.html#cb402-122" tabindex="-1"></a><span class="st">//     // priors</span></span>
<span id="cb402-123"><a href="categorization-models.html#cb402-123" tabindex="-1"></a><span class="st">//     simplex[nfeatures] w_prior = dirichlet_rng(w_prior_values);</span></span>
<span id="cb402-124"><a href="categorization-models.html#cb402-124" tabindex="-1"></a><span class="st">//     real logit_c_prior = normal_rng(c_prior_values[1], c_prior_values[2]);</span></span>
<span id="cb402-125"><a href="categorization-models.html#cb402-125" tabindex="-1"></a><span class="st">//     real&lt;lower=0, upper=2&gt; c_prior = inv_logit(logit_c_prior)*2;</span></span>
<span id="cb402-126"><a href="categorization-models.html#cb402-126" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-127"><a href="categorization-models.html#cb402-127" tabindex="-1"></a><span class="st">//     // prior pred</span></span>
<span id="cb402-128"><a href="categorization-models.html#cb402-128" tabindex="-1"></a><span class="st">//     array[ntrials] real&lt;lower=0, upper=1&gt; r_prior;</span></span>
<span id="cb402-129"><a href="categorization-models.html#cb402-129" tabindex="-1"></a><span class="st">//     array[ntrials] real rr_prior;</span></span>
<span id="cb402-130"><a href="categorization-models.html#cb402-130" tabindex="-1"></a><span class="st">//     for (i in 1:ntrials) {</span></span>
<span id="cb402-131"><a href="categorization-models.html#cb402-131" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-132"><a href="categorization-models.html#cb402-132" tabindex="-1"></a><span class="st">//         // calculate distance from obs to all exemplars</span></span>
<span id="cb402-133"><a href="categorization-models.html#cb402-133" tabindex="-1"></a><span class="st">//         array[(i-1)] real exemplar_dist;</span></span>
<span id="cb402-134"><a href="categorization-models.html#cb402-134" tabindex="-1"></a><span class="st">//         for (e in 1:(i-1)){</span></span>
<span id="cb402-135"><a href="categorization-models.html#cb402-135" tabindex="-1"></a><span class="st">//             array[nfeatures] real tmp_dist;</span></span>
<span id="cb402-136"><a href="categorization-models.html#cb402-136" tabindex="-1"></a><span class="st">//             for (j in 1:nfeatures) {</span></span>
<span id="cb402-137"><a href="categorization-models.html#cb402-137" tabindex="-1"></a><span class="st">//                 tmp_dist[j] = w_prior[j]*abs(obs[e,j] - obs[i,j]);</span></span>
<span id="cb402-138"><a href="categorization-models.html#cb402-138" tabindex="-1"></a><span class="st">//             }</span></span>
<span id="cb402-139"><a href="categorization-models.html#cb402-139" tabindex="-1"></a><span class="st">//             exemplar_dist[e] = sum(tmp_dist);</span></span>
<span id="cb402-140"><a href="categorization-models.html#cb402-140" tabindex="-1"></a><span class="st">//         }</span></span>
<span id="cb402-141"><a href="categorization-models.html#cb402-141" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-142"><a href="categorization-models.html#cb402-142" tabindex="-1"></a><span class="st">//         if (sum(cat_one[:(i-1)])==0 || sum(cat_two[:(i-1)])==0){  // if there are no examplars in one of the categories</span></span>
<span id="cb402-143"><a href="categorization-models.html#cb402-143" tabindex="-1"></a><span class="st">//             r_prior[i] = 0.5;</span></span>
<span id="cb402-144"><a href="categorization-models.html#cb402-144" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-145"><a href="categorization-models.html#cb402-145" tabindex="-1"></a><span class="st">//         } else {</span></span>
<span id="cb402-146"><a href="categorization-models.html#cb402-146" tabindex="-1"></a><span class="st">//             // calculate similarity</span></span>
<span id="cb402-147"><a href="categorization-models.html#cb402-147" tabindex="-1"></a><span class="st">//             array[2] real similarities;</span></span>
<span id="cb402-148"><a href="categorization-models.html#cb402-148" tabindex="-1"></a><span class="st">//             </span></span>
<span id="cb402-149"><a href="categorization-models.html#cb402-149" tabindex="-1"></a><span class="st">//             array[sum(cat_one[:(i-1)])] int tmp_idx_one = cat_one_idx[:sum(cat_one[:(i-1)])];</span></span>
<span id="cb402-150"><a href="categorization-models.html#cb402-150" tabindex="-1"></a><span class="st">//             array[sum(cat_two[:(i-1)])] int tmp_idx_two = cat_two_idx[:sum(cat_two[:(i-1)])];</span></span>
<span id="cb402-151"><a href="categorization-models.html#cb402-151" tabindex="-1"></a><span class="st">//             similarities[1] = exp(-c_prior * sum(exemplar_dist[tmp_idx_one]));</span></span>
<span id="cb402-152"><a href="categorization-models.html#cb402-152" tabindex="-1"></a><span class="st">//             similarities[2] = exp(-c_prior * sum(exemplar_dist[tmp_idx_two]));</span></span>
<span id="cb402-153"><a href="categorization-models.html#cb402-153" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-154"><a href="categorization-models.html#cb402-154" tabindex="-1"></a><span class="st">//             // calculate r[i]</span></span>
<span id="cb402-155"><a href="categorization-models.html#cb402-155" tabindex="-1"></a><span class="st">//             rr_prior[i] = (b*similarities[1]) / (b*similarities[1] + (1-b)*similarities[2]);</span></span>
<span id="cb402-156"><a href="categorization-models.html#cb402-156" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-157"><a href="categorization-models.html#cb402-157" tabindex="-1"></a><span class="st">//             // to make the sampling work</span></span>
<span id="cb402-158"><a href="categorization-models.html#cb402-158" tabindex="-1"></a><span class="st">//             if (rr_prior[i] == 1){</span></span>
<span id="cb402-159"><a href="categorization-models.html#cb402-159" tabindex="-1"></a><span class="st">//                 r_prior[i] = 0.9999;</span></span>
<span id="cb402-160"><a href="categorization-models.html#cb402-160" tabindex="-1"></a><span class="st">//             } else if (rr_prior[i] == 0) {</span></span>
<span id="cb402-161"><a href="categorization-models.html#cb402-161" tabindex="-1"></a><span class="st">//                 r_prior[i] = 0.0001;</span></span>
<span id="cb402-162"><a href="categorization-models.html#cb402-162" tabindex="-1"></a><span class="st">//             } else if (rr_prior[i] &gt; 0 &amp;&amp; rr_prior[i] &lt; 1) {</span></span>
<span id="cb402-163"><a href="categorization-models.html#cb402-163" tabindex="-1"></a><span class="st">//                 r_prior[i] = rr_prior[i];</span></span>
<span id="cb402-164"><a href="categorization-models.html#cb402-164" tabindex="-1"></a><span class="st">//             } else {</span></span>
<span id="cb402-165"><a href="categorization-models.html#cb402-165" tabindex="-1"></a><span class="st">//                 r_prior[i] = 0.5;</span></span>
<span id="cb402-166"><a href="categorization-models.html#cb402-166" tabindex="-1"></a><span class="st">//             }</span></span>
<span id="cb402-167"><a href="categorization-models.html#cb402-167" tabindex="-1"></a><span class="st">//         }</span></span>
<span id="cb402-168"><a href="categorization-models.html#cb402-168" tabindex="-1"></a><span class="st">//     }</span></span>
<span id="cb402-169"><a href="categorization-models.html#cb402-169" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-170"><a href="categorization-models.html#cb402-170" tabindex="-1"></a><span class="st">//     array[ntrials] int&lt;lower=0, upper=1&gt; priorpred = bernoulli_rng(r_prior);</span></span>
<span id="cb402-171"><a href="categorization-models.html#cb402-171" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-172"><a href="categorization-models.html#cb402-172" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-173"><a href="categorization-models.html#cb402-173" tabindex="-1"></a><span class="st">//     // posterior pred</span></span>
<span id="cb402-174"><a href="categorization-models.html#cb402-174" tabindex="-1"></a><span class="st">//     array[ntrials] int&lt;lower=0, upper=1&gt; posteriorpred = bernoulli_rng(r);</span></span>
<span id="cb402-175"><a href="categorization-models.html#cb402-175" tabindex="-1"></a><span class="st">//     array[ntrials] int&lt;lower=0, upper=1&gt; posteriorcorrect;</span></span>
<span id="cb402-176"><a href="categorization-models.html#cb402-176" tabindex="-1"></a><span class="st">//     for (i in 1:ntrials) {</span></span>
<span id="cb402-177"><a href="categorization-models.html#cb402-177" tabindex="-1"></a><span class="st">//         if (posteriorpred[i] == cat_one[i]) {</span></span>
<span id="cb402-178"><a href="categorization-models.html#cb402-178" tabindex="-1"></a><span class="st">//             posteriorcorrect[i] = 1;</span></span>
<span id="cb402-179"><a href="categorization-models.html#cb402-179" tabindex="-1"></a><span class="st">//         } else {</span></span>
<span id="cb402-180"><a href="categorization-models.html#cb402-180" tabindex="-1"></a><span class="st">//             posteriorcorrect[i] = 0;</span></span>
<span id="cb402-181"><a href="categorization-models.html#cb402-181" tabindex="-1"></a><span class="st">//         }</span></span>
<span id="cb402-182"><a href="categorization-models.html#cb402-182" tabindex="-1"></a><span class="st">//     }</span></span>
<span id="cb402-183"><a href="categorization-models.html#cb402-183" tabindex="-1"></a><span class="st">//     </span></span>
<span id="cb402-184"><a href="categorization-models.html#cb402-184" tabindex="-1"></a><span class="st">//     </span></span>
<span id="cb402-185"><a href="categorization-models.html#cb402-185" tabindex="-1"></a><span class="st">//     // log likelihood</span></span>
<span id="cb402-186"><a href="categorization-models.html#cb402-186" tabindex="-1"></a><span class="st">//    array[ntrials] real log_lik;</span></span>
<span id="cb402-187"><a href="categorization-models.html#cb402-187" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-188"><a href="categorization-models.html#cb402-188" tabindex="-1"></a><span class="st">//    for (i in 1:ntrials) {</span></span>
<span id="cb402-189"><a href="categorization-models.html#cb402-189" tabindex="-1"></a><span class="st">//         log_lik[i] = bernoulli_lpmf(y[i] | r[i]);</span></span>
<span id="cb402-190"><a href="categorization-models.html#cb402-190" tabindex="-1"></a><span class="st">//    }</span></span>
<span id="cb402-191"><a href="categorization-models.html#cb402-191" tabindex="-1"></a><span class="st">// </span></span>
<span id="cb402-192"><a href="categorization-models.html#cb402-192" tabindex="-1"></a><span class="st">// }</span></span>
<span id="cb402-193"><a href="categorization-models.html#cb402-193" tabindex="-1"></a></span>
<span id="cb402-194"><a href="categorization-models.html#cb402-194" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb402-195"><a href="categorization-models.html#cb402-195" tabindex="-1"></a></span>
<span id="cb402-196"><a href="categorization-models.html#cb402-196" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb402-197"><a href="categorization-models.html#cb402-197" tabindex="-1"></a>  gcm_ml_model,</span>
<span id="cb402-198"><a href="categorization-models.html#cb402-198" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb402-199"><a href="categorization-models.html#cb402-199" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W10_GCM_ml.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W10_GCM_ml.stan&quot;</code></pre>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="categorization-models.html#cb404-1" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W10_GCM_ml.stan&quot;</span>)</span>
<span id="cb404-2"><a href="categorization-models.html#cb404-2" tabindex="-1"></a>mod_GCM_ml <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb404-3"><a href="categorization-models.html#cb404-3" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="categorization-models.html#cb405-1" tabindex="-1"></a><span class="do">## Fit the simulated data</span></span>
<span id="cb405-2"><a href="categorization-models.html#cb405-2" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d[,<span class="fu">c</span>(<span class="st">&quot;agent&quot;</span>,<span class="st">&quot;trial&quot;</span>,<span class="st">&quot;sim_response&quot;</span>)] <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb405-3"><a href="categorization-models.html#cb405-3" tabindex="-1"></a>  <span class="at">names_from =</span> agent,</span>
<span id="cb405-4"><a href="categorization-models.html#cb405-4" tabindex="-1"></a>  <span class="at">values_from =</span> <span class="fu">c</span>(sim_response))</span>
<span id="cb405-5"><a href="categorization-models.html#cb405-5" tabindex="-1"></a></span>
<span id="cb405-6"><a href="categorization-models.html#cb405-6" tabindex="-1"></a>gcm_ml_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb405-7"><a href="categorization-models.html#cb405-7" tabindex="-1"></a>  <span class="at">nsubjects =</span> agents,</span>
<span id="cb405-8"><a href="categorization-models.html#cb405-8" tabindex="-1"></a>  <span class="at">ntrials =</span> <span class="fu">nrow</span>(experiment),</span>
<span id="cb405-9"><a href="categorization-models.html#cb405-9" tabindex="-1"></a>  <span class="at">nfeatures =</span> <span class="dv">2</span>,</span>
<span id="cb405-10"><a href="categorization-models.html#cb405-10" tabindex="-1"></a>  <span class="at">cat_one =</span> experiment<span class="sc">$</span>category,</span>
<span id="cb405-11"><a href="categorization-models.html#cb405-11" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">as.matrix</span>(d1[, <span class="dv">2</span><span class="sc">:</span>(agents <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb405-12"><a href="categorization-models.html#cb405-12" tabindex="-1"></a>  <span class="at">obs =</span> <span class="fu">as.matrix</span>(experiment[, <span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;position&quot;</span>)]),</span>
<span id="cb405-13"><a href="categorization-models.html#cb405-13" tabindex="-1"></a>  <span class="at">b =</span> <span class="fl">0.5</span>,</span>
<span id="cb405-14"><a href="categorization-models.html#cb405-14" tabindex="-1"></a>  <span class="at">w_prior_values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb405-15"><a href="categorization-models.html#cb405-15" tabindex="-1"></a>  <span class="at">c_prior_values =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb405-16"><a href="categorization-models.html#cb405-16" tabindex="-1"></a>)</span>
<span id="cb405-17"><a href="categorization-models.html#cb405-17" tabindex="-1"></a></span>
<span id="cb405-18"><a href="categorization-models.html#cb405-18" tabindex="-1"></a>samples_gcm_ml <span class="ot">&lt;-</span> mod_GCM_ml<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb405-19"><a href="categorization-models.html#cb405-19" tabindex="-1"></a>  <span class="at">data =</span> gcm_ml_data,</span>
<span id="cb405-20"><a href="categorization-models.html#cb405-20" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb405-21"><a href="categorization-models.html#cb405-21" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb405-22"><a href="categorization-models.html#cb405-22" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb405-23"><a href="categorization-models.html#cb405-23" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb405-24"><a href="categorization-models.html#cb405-24" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb405-25"><a href="categorization-models.html#cb405-25" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb405-26"><a href="categorization-models.html#cb405-26" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">1000</span></span>
<span id="cb405-27"><a href="categorization-models.html#cb405-27" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 2 finished in 174.9 seconds.
## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 1 finished in 208.2 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 191.5 seconds.
## Total execution time: 208.4 seconds.</code></pre>
<pre><code>## Warning: 125 of 2000 (6.0%) transitions ended with a divergence.
## See https://mc-stan.org/misc/warnings for details.</code></pre>
<pre><code>## Warning: 1 of 2 chains had an E-BFMI less than 0.3.
## See https://mc-stan.org/misc/warnings for details.</code></pre>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="categorization-models.html#cb409-1" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples_gcm_ml)</span>
<span id="cb409-2"><a href="categorization-models.html#cb409-2" tabindex="-1"></a></span>
<span id="cb409-3"><a href="categorization-models.html#cb409-3" tabindex="-1"></a><span class="fu">ggplot</span>(draws, <span class="fu">aes</span>(.iteration, logit_c_M, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb409-4"><a href="categorization-models.html#cb409-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb409-5"><a href="categorization-models.html#cb409-5" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="categorization-models.html#cb410-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws, <span class="fu">aes</span>(.iteration, logit_c_SD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb410-2"><a href="categorization-models.html#cb410-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb410-3"><a href="categorization-models.html#cb410-3" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-42-2.png" width="672" /></p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="categorization-models.html#cb411-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws, <span class="fu">aes</span>(.iteration, <span class="st">`</span><span class="at">weight[1]</span><span class="st">`</span>, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb411-2"><a href="categorization-models.html#cb411-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb411-3"><a href="categorization-models.html#cb411-3" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-42-3.png" width="672" /></p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="categorization-models.html#cb412-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws, <span class="fu">aes</span>(.iteration, <span class="st">`</span><span class="at">weight[2]</span><span class="st">`</span>, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb412-2"><a href="categorization-models.html#cb412-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb412-3"><a href="categorization-models.html#cb412-3" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-42-4.png" width="672" /></p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="categorization-models.html#cb413-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws, <span class="fu">aes</span>(.iteration, <span class="st">`</span><span class="at">kappa</span><span class="st">`</span>, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb413-2"><a href="categorization-models.html#cb413-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb413-3"><a href="categorization-models.html#cb413-3" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-42-5.png" width="672" /></p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="categorization-models.html#cb414-1" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">c_prior =</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(draws), <span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb414-2"><a href="categorization-models.html#cb414-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb414-3"><a href="categorization-models.html#cb414-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(logit_c_M), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb414-4"><a href="categorization-models.html#cb414-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(c_prior), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb414-5"><a href="categorization-models.html#cb414-5" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">logit_scaled</span>(scalingM,<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb414-6"><a href="categorization-models.html#cb414-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-42-6.png" width="672" /></p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="categorization-models.html#cb417-1" tabindex="-1"></a><span class="fu">library</span>(msm)</span>
<span id="cb417-2"><a href="categorization-models.html#cb417-2" tabindex="-1"></a></span>
<span id="cb417-3"><a href="categorization-models.html#cb417-3" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">c_prior =</span> <span class="fu">rtnorm</span>(<span class="fu">nrow</span>(draws), <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">lower =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb417-4"><a href="categorization-models.html#cb417-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb417-5"><a href="categorization-models.html#cb417-5" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(logit_c_SD), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb417-6"><a href="categorization-models.html#cb417-6" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(c_prior), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb417-7"><a href="categorization-models.html#cb417-7" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb417-8"><a href="categorization-models.html#cb417-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-42-7.png" width="672" /></p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="categorization-models.html#cb419-1" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="st">`</span><span class="at">w_prior[1]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rdirichlet</span>(<span class="fu">nrow</span>(draws), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))[,<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb419-2"><a href="categorization-models.html#cb419-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb419-3"><a href="categorization-models.html#cb419-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">weight[1]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb419-4"><a href="categorization-models.html#cb419-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">w_prior[1]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb419-5"><a href="categorization-models.html#cb419-5" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb419-6"><a href="categorization-models.html#cb419-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-42-8.png" width="672" /></p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="categorization-models.html#cb421-1" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="st">`</span><span class="at">w_prior[2]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rdirichlet</span>(<span class="fu">nrow</span>(draws), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))[,<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb421-2"><a href="categorization-models.html#cb421-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb421-3"><a href="categorization-models.html#cb421-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">weight[2]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb421-4"><a href="categorization-models.html#cb421-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">w_prior[2]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb421-5"><a href="categorization-models.html#cb421-5" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb421-6"><a href="categorization-models.html#cb421-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-42-9.png" width="672" /></p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="categorization-models.html#cb423-1" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="st">`</span><span class="at">kappa_prior</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rexp</span>(<span class="fu">nrow</span>(draws), <span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb423-2"><a href="categorization-models.html#cb423-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb423-3"><a href="categorization-models.html#cb423-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">kappa</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb423-4"><a href="categorization-models.html#cb423-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">kappa_prior</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb423-5"><a href="categorization-models.html#cb423-5" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb423-6"><a href="categorization-models.html#cb423-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-42-10.png" width="672" /></p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="categorization-models.html#cb425-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws) <span class="sc">+</span></span>
<span id="cb425-2"><a href="categorization-models.html#cb425-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">weight[1]</span><span class="st">`</span>, <span class="st">`</span><span class="at">weight[2]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb425-3"><a href="categorization-models.html#cb425-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-42-11.png" width="672" /></p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="categorization-models.html#cb426-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws) <span class="sc">+</span></span>
<span id="cb426-2"><a href="categorization-models.html#cb426-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(logit_c_M, logit_c_SD), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb426-3"><a href="categorization-models.html#cb426-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-42-12.png" width="672" /></p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="categorization-models.html#cb427-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws) <span class="sc">+</span></span>
<span id="cb427-2"><a href="categorization-models.html#cb427-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(kappa, <span class="st">`</span><span class="at">weight[1]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb427-3"><a href="categorization-models.html#cb427-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-42-13.png" width="672" /></p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="categorization-models.html#cb428-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws) <span class="sc">+</span></span>
<span id="cb428-2"><a href="categorization-models.html#cb428-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(kappa, <span class="st">`</span><span class="at">weight[2]</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb428-3"><a href="categorization-models.html#cb428-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-42-14.png" width="672" /></p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="categorization-models.html#cb429-1" tabindex="-1"></a><span class="fu">ggplot</span>(draws) <span class="sc">+</span></span>
<span id="cb429-2"><a href="categorization-models.html#cb429-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(kappa, <span class="st">`</span><span class="at">logit_c_M</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb429-3"><a href="categorization-models.html#cb429-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-42-15.png" width="672" /></p>
</div>
</div>
<div id="now-we-parallelize-n.b.-not-finished" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Now we parallelize [N.B. NOT FINISHED]<a href="categorization-models.html#now-we-parallelize-n.b.-not-finished" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="categorization-models.html#cb430-1" tabindex="-1"></a><span class="co"># ## Then we create the function that simulates data and fits the model, so we can quickly go through multiple parameter values in the simulation</span></span>
<span id="cb430-2"><a href="categorization-models.html#cb430-2" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb430-3"><a href="categorization-models.html#cb430-3" tabindex="-1"></a><span class="co"># sim_ml_and_fit &lt;- function(agents, scalingM, scalingSD, weights, kappa) {</span></span>
<span id="cb430-4"><a href="categorization-models.html#cb430-4" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb430-5"><a href="categorization-models.html#cb430-5" tabindex="-1"></a><span class="co">#   d &lt;- simulate_ml_responses(agents, scalingM, scalingSD, weights, kappa)</span></span>
<span id="cb430-6"><a href="categorization-models.html#cb430-6" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb430-7"><a href="categorization-models.html#cb430-7" tabindex="-1"></a><span class="co">#   d1 &lt;- d[,c(&quot;agent&quot;,&quot;trial&quot;,&quot;sim_response&quot;)] %&gt;% pivot_wider(</span></span>
<span id="cb430-8"><a href="categorization-models.html#cb430-8" tabindex="-1"></a><span class="co">#     names_from = agent,</span></span>
<span id="cb430-9"><a href="categorization-models.html#cb430-9" tabindex="-1"></a><span class="co">#     values_from = c(sim_response))</span></span>
<span id="cb430-10"><a href="categorization-models.html#cb430-10" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb430-11"><a href="categorization-models.html#cb430-11" tabindex="-1"></a><span class="co">#   gcm_ml_data &lt;- list(</span></span>
<span id="cb430-12"><a href="categorization-models.html#cb430-12" tabindex="-1"></a><span class="co">#     nsubjects = agents,</span></span>
<span id="cb430-13"><a href="categorization-models.html#cb430-13" tabindex="-1"></a><span class="co">#     ntrials = nrow(experiment),</span></span>
<span id="cb430-14"><a href="categorization-models.html#cb430-14" tabindex="-1"></a><span class="co">#     nfeatures = 2,</span></span>
<span id="cb430-15"><a href="categorization-models.html#cb430-15" tabindex="-1"></a><span class="co">#     cat_one = experiment$category,</span></span>
<span id="cb430-16"><a href="categorization-models.html#cb430-16" tabindex="-1"></a><span class="co">#     y = as.matrix(d1[, 2:(agents + 1)]),</span></span>
<span id="cb430-17"><a href="categorization-models.html#cb430-17" tabindex="-1"></a><span class="co">#     obs = as.matrix(experiment[, c(&quot;height&quot;, &quot;position&quot;)]),</span></span>
<span id="cb430-18"><a href="categorization-models.html#cb430-18" tabindex="-1"></a><span class="co">#     b = 0.5,</span></span>
<span id="cb430-19"><a href="categorization-models.html#cb430-19" tabindex="-1"></a><span class="co">#     w_prior_values = c(1, 1),</span></span>
<span id="cb430-20"><a href="categorization-models.html#cb430-20" tabindex="-1"></a><span class="co">#     c_prior_values = c(0, 1)</span></span>
<span id="cb430-21"><a href="categorization-models.html#cb430-21" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb430-22"><a href="categorization-models.html#cb430-22" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb430-23"><a href="categorization-models.html#cb430-23" tabindex="-1"></a><span class="co">#   samples_gcm_ml &lt;- mod_GCM_ml$sample(</span></span>
<span id="cb430-24"><a href="categorization-models.html#cb430-24" tabindex="-1"></a><span class="co">#     data = gcm_ml_data,</span></span>
<span id="cb430-25"><a href="categorization-models.html#cb430-25" tabindex="-1"></a><span class="co">#     seed = 123,</span></span>
<span id="cb430-26"><a href="categorization-models.html#cb430-26" tabindex="-1"></a><span class="co">#     chains = 2,</span></span>
<span id="cb430-27"><a href="categorization-models.html#cb430-27" tabindex="-1"></a><span class="co">#     parallel_chains = 2,</span></span>
<span id="cb430-28"><a href="categorization-models.html#cb430-28" tabindex="-1"></a><span class="co">#     threads_per_chain = 2,</span></span>
<span id="cb430-29"><a href="categorization-models.html#cb430-29" tabindex="-1"></a><span class="co">#     iter_warmup = 1000,</span></span>
<span id="cb430-30"><a href="categorization-models.html#cb430-30" tabindex="-1"></a><span class="co">#     iter_sampling = 1000,</span></span>
<span id="cb430-31"><a href="categorization-models.html#cb430-31" tabindex="-1"></a><span class="co">#     refresh = 1000</span></span>
<span id="cb430-32"><a href="categorization-models.html#cb430-32" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb430-33"><a href="categorization-models.html#cb430-33" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb430-34"><a href="categorization-models.html#cb430-34" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb430-35"><a href="categorization-models.html#cb430-35" tabindex="-1"></a><span class="co">#   draws_df &lt;- as_draws_df(samples_gcm$draws()) </span></span>
<span id="cb430-36"><a href="categorization-models.html#cb430-36" tabindex="-1"></a><span class="co">#   temp &lt;- tibble(trueC_M = scalingM, </span></span>
<span id="cb430-37"><a href="categorization-models.html#cb430-37" tabindex="-1"></a><span class="co">#                  trueC_SD = scalingSD, </span></span>
<span id="cb430-38"><a href="categorization-models.html#cb430-38" tabindex="-1"></a><span class="co">#                  trueW1 = weights[1], </span></span>
<span id="cb430-39"><a href="categorization-models.html#cb430-39" tabindex="-1"></a><span class="co">#                  trueW2 = weights[2], </span></span>
<span id="cb430-40"><a href="categorization-models.html#cb430-40" tabindex="-1"></a><span class="co">#                  trueKappa = kappa, </span></span>
<span id="cb430-41"><a href="categorization-models.html#cb430-41" tabindex="-1"></a><span class="co">#                  agents = agents,</span></span>
<span id="cb430-42"><a href="categorization-models.html#cb430-42" tabindex="-1"></a><span class="co">#                  # FROM HERE</span></span>
<span id="cb430-43"><a href="categorization-models.html#cb430-43" tabindex="-1"></a><span class="co">#                  estC = draws_df$c, </span></span>
<span id="cb430-44"><a href="categorization-models.html#cb430-44" tabindex="-1"></a><span class="co">#                  estW1 = draws_df$`w[1]`,</span></span>
<span id="cb430-45"><a href="categorization-models.html#cb430-45" tabindex="-1"></a><span class="co">#                  estW2 = draws_df$`w[2]`</span></span>
<span id="cb430-46"><a href="categorization-models.html#cb430-46" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb430-47"><a href="categorization-models.html#cb430-47" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb430-48"><a href="categorization-models.html#cb430-48" tabindex="-1"></a><span class="co">#   return(temp)</span></span>
<span id="cb430-49"><a href="categorization-models.html#cb430-49" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb430-50"><a href="categorization-models.html#cb430-50" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb430-51"><a href="categorization-models.html#cb430-51" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb430-52"><a href="categorization-models.html#cb430-52" tabindex="-1"></a><span class="co"># ## Now I need to make a list of lists</span></span>
<span id="cb430-53"><a href="categorization-models.html#cb430-53" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb430-54"><a href="categorization-models.html#cb430-54" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb430-55"><a href="categorization-models.html#cb430-55" tabindex="-1"></a><span class="co"># temp &lt;- tibble(unique(simulated_responses[,c(&quot;agent&quot;, &quot;c&quot;, &quot;w&quot;)])) %&gt;%</span></span>
<span id="cb430-56"><a href="categorization-models.html#cb430-56" tabindex="-1"></a><span class="co">#   rename(</span></span>
<span id="cb430-57"><a href="categorization-models.html#cb430-57" tabindex="-1"></a><span class="co">#     scaling = c,</span></span>
<span id="cb430-58"><a href="categorization-models.html#cb430-58" tabindex="-1"></a><span class="co">#     weights = w</span></span>
<span id="cb430-59"><a href="categorization-models.html#cb430-59" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb430-60"><a href="categorization-models.html#cb430-60" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb430-61"><a href="categorization-models.html#cb430-61" tabindex="-1"></a><span class="co"># recovery_df &lt;- future_pmap_dfr(temp, sim_d_and_fit, .options = furrr_options(seed = TRUE))</span></span>
<span id="cb430-62"><a href="categorization-models.html#cb430-62" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb430-63"><a href="categorization-models.html#cb430-63" tabindex="-1"></a><span class="co"># write_csv(recovery_df, &quot;simdata/W10_GCM_recoverydf.csv&quot;)</span></span></code></pre></div>
<div id="student-produced-models-of-categorization" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Student-produced models of categorization<a href="categorization-models.html#student-produced-models-of-categorization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Attempting to identify features</p></li>
<li><p>Attempting to associate 1 of the features to one of the outcome dimensions (e.g. green as danger), test hypothesis, stay if positive, try different trait if negative. [missing details on how to define the hypothesized association, and how much evidence needed to shift]</p></li>
<li><p>Remembering the rule and/or remembering the single exemplars</p></li>
<li><p>Focusing on 1 feature 1 outcome vs trying to incorporate additional features</p></li>
<li><p>Using arbitrary associations btw features and outcomes vs. relying on intuition (raised arms are dangerous)</p></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bayesian-models-of-cognition.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="categorization-models-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/10-CategorizationModels.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
