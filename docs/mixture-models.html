<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Mixture models | 08-MixtureModels</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2025" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Mixture models | 08-MixtureModels" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2025" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Mixture models | 08-MixtureModels" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2025" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2025-03-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-comparison-in-cognitive-science.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-philosophy-and-approach"><i class="fa fa-check"></i><b>1.1</b> Course Philosophy and Approach</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#course-structure-and-learning-path"><i class="fa fa-check"></i><b>1.2</b> Course Structure and Learning Path</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#prerequisites-and-preparation"><i class="fa fa-check"></i><b>1.3</b> Prerequisites and Preparation</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#course-resources"><i class="fa fa-check"></i><b>1.4</b> Course Resources</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#about-these-notes"><i class="fa fa-check"></i><b>1.5</b> About These Notes</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="foundations.html"><a href="foundations.html"><i class="fa fa-check"></i><b>2</b> Foundations</a>
<ul>
<li class="chapter" data-level="2.1" data-path="foundations.html"><a href="foundations.html#from-pizza-to-cognitive-models-an-introduction"><i class="fa fa-check"></i><b>2.1</b> From Pizza to Cognitive Models: An Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="foundations.html"><a href="foundations.html#why-start-with-pizza"><i class="fa fa-check"></i><b>2.2</b> Why Start with Pizza?</a></li>
<li class="chapter" data-level="2.3" data-path="foundations.html"><a href="foundations.html#learning-objectives"><i class="fa fa-check"></i><b>2.3</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.4" data-path="foundations.html"><a href="foundations.html#part-1-exploring-the-pizza-stone-temperature-data"><i class="fa fa-check"></i><b>2.4</b> Part 1: Exploring the Pizza Stone Temperature Data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="foundations.html"><a href="foundations.html#initial-data-visualization"><i class="fa fa-check"></i><b>2.4.1</b> Initial Data Visualization</a></li>
<li class="chapter" data-level="2.4.2" data-path="foundations.html"><a href="foundations.html#key-observations"><i class="fa fa-check"></i><b>2.4.2</b> Key Observations</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="foundations.html"><a href="foundations.html#part-2-initial-statistical-modeling"><i class="fa fa-check"></i><b>2.5</b> Part 2: Initial Statistical Modeling</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="foundations.html"><a href="foundations.html#model-setup-and-priors"><i class="fa fa-check"></i><b>2.5.1</b> Model Setup and Priors</a></li>
<li class="chapter" data-level="2.5.2" data-path="foundations.html"><a href="foundations.html#linear-mixed-effects-model"><i class="fa fa-check"></i><b>2.5.2</b> Linear Mixed-Effects Model</a></li>
<li class="chapter" data-level="2.5.3" data-path="foundations.html"><a href="foundations.html#lognormal-mixed-effects-model"><i class="fa fa-check"></i><b>2.5.3</b> Lognormal Mixed-Effects Model</a></li>
<li class="chapter" data-level="2.5.4" data-path="foundations.html"><a href="foundations.html#model-comparison-and-visualization"><i class="fa fa-check"></i><b>2.5.4</b> Model Comparison and Visualization</a></li>
<li class="chapter" data-level="2.5.5" data-path="foundations.html"><a href="foundations.html#model-assessment"><i class="fa fa-check"></i><b>2.5.5</b> Model Assessment</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="foundations.html"><a href="foundations.html#part-3-understanding-the-physics-model"><i class="fa fa-check"></i><b>2.6</b> Part 3: Understanding the Physics Model</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="foundations.html"><a href="foundations.html#the-basic-temperature-evolution-equation"><i class="fa fa-check"></i><b>2.6.1</b> The Basic Temperature Evolution Equation</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="foundations.html"><a href="foundations.html#part-4-implementing-the-physics-based-model"><i class="fa fa-check"></i><b>2.7</b> Part 4: Implementing the Physics-Based Model</a></li>
<li class="chapter" data-level="2.8" data-path="foundations.html"><a href="foundations.html#part-5-model-analysis-and-practical-applications"><i class="fa fa-check"></i><b>2.8</b> Part 5: Model Analysis and Practical Applications</a></li>
<li class="chapter" data-level="2.9" data-path="foundations.html"><a href="foundations.html#conclusion-from-pizza-to-principles"><i class="fa fa-check"></i><b>2.9</b> Conclusion: From Pizza to Principles</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html"><i class="fa fa-check"></i><b>3</b> Building Models of Strategic Decision-Making</a>
<ul>
<li class="chapter" data-level="3.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#learning-goals"><i class="fa fa-check"></i><b>3.1</b> Learning goals</a></li>
<li class="chapter" data-level="3.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#introduction"><i class="fa fa-check"></i><b>3.2</b> Introduction</a></li>
<li class="chapter" data-level="3.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#the-matching-pennies-game"><i class="fa fa-check"></i><b>3.3</b> The Matching Pennies Game</a></li>
<li class="chapter" data-level="3.4" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#game-structure"><i class="fa fa-check"></i><b>3.4</b> Game Structure</a></li>
<li class="chapter" data-level="3.5" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#empirical-investigation"><i class="fa fa-check"></i><b>3.5</b> Empirical Investigation</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#data-collection-protocol"><i class="fa fa-check"></i><b>3.5.1</b> Data Collection Protocol</a></li>
<li class="chapter" data-level="3.5.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#initial-observations"><i class="fa fa-check"></i><b>3.5.2</b> Initial Observations</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#empirical-explorations"><i class="fa fa-check"></i><b>3.6</b> Empirical explorations</a></li>
<li class="chapter" data-level="3.7" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#notes-from-previous-years"><i class="fa fa-check"></i><b>3.7</b> Notes from previous years</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#from-observation-to-theory"><i class="fa fa-check"></i><b>3.7.1</b> From Observation to Theory</a></li>
<li class="chapter" data-level="3.7.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#core-modeling-considerations"><i class="fa fa-check"></i><b>3.7.2</b> Core Modeling Considerations</a></li>
<li class="chapter" data-level="3.7.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>3.7.3</b> The distinction between participant and researcher perspectives</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#building-formal-models"><i class="fa fa-check"></i><b>3.8</b> Building Formal Models</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#random-choice-model"><i class="fa fa-check"></i><b>3.8.1</b> Random Choice Model</a></li>
<li class="chapter" data-level="3.8.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#immediate-reaction-win-stay-lose-shift"><i class="fa fa-check"></i><b>3.8.2</b> Immediate reaction (Win-Stay-Lose-Shift)</a></li>
<li class="chapter" data-level="3.8.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>3.8.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="3.8.4" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>3.8.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="3.8.5" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#reinforcement-learning"><i class="fa fa-check"></i><b>3.8.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="3.8.6" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#k-tom"><i class="fa fa-check"></i><b>3.8.6</b> k-ToM</a></li>
<li class="chapter" data-level="3.8.7" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#other-possible-strategies"><i class="fa fa-check"></i><b>3.8.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#cognitive-constraints"><i class="fa fa-check"></i><b>3.9</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#memory"><i class="fa fa-check"></i><b>3.9.1</b> Memory</a></li>
<li class="chapter" data-level="3.9.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#perseveration"><i class="fa fa-check"></i><b>3.9.2</b> Perseveration</a></li>
<li class="chapter" data-level="3.9.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#errors"><i class="fa fa-check"></i><b>3.9.3</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#continuity-between-models"><i class="fa fa-check"></i><b>3.10</b> Continuity between models</a></li>
<li class="chapter" data-level="3.11" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#mixture-of-strategies"><i class="fa fa-check"></i><b>3.11</b> Mixture of strategies</a></li>
<li class="chapter" data-level="3.12" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#differences-from-more-traditional-general-linear-model-based-approaches"><i class="fa fa-check"></i><b>3.12</b> Differences from more traditional (general linear model-based) approaches</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html"><i class="fa fa-check"></i><b>4</b> From verbal descriptions to formal models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#learning-goals-1"><i class="fa fa-check"></i><b>4.1</b> Learning Goals</a></li>
<li class="chapter" data-level="4.2" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#the-value-of-formalization"><i class="fa fa-check"></i><b>4.2</b> The Value of Formalization</a></li>
<li class="chapter" data-level="4.3" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>4.3</b> Defining general conditions</a></li>
<li class="chapter" data-level="4.4" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>4.4</b> Implementing a random agent</a></li>
<li class="chapter" data-level="4.5" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>4.5</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="4.6" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>4.6</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>4.6.1</b> And we visualize it</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#conclusion"><i class="fa fa-check"></i><b>4.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html"><i class="fa fa-check"></i><b>5</b> From simulation to model fitting</a>
<ul>
<li class="chapter" data-level="5.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#learning-goals-2"><i class="fa fa-check"></i><b>5.1</b> Learning Goals</a></li>
<li class="chapter" data-level="5.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#the-challenge-of-model-fitting"><i class="fa fa-check"></i><b>5.2</b> The Challenge of Model Fitting</a></li>
<li class="chapter" data-level="5.3" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#simulating-data"><i class="fa fa-check"></i><b>5.3</b> Simulating data</a></li>
<li class="chapter" data-level="5.4" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#building-our-basic-model-in-stan"><i class="fa fa-check"></i><b>5.4</b> Building our basic model in Stan</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#data"><i class="fa fa-check"></i><b>5.4.1</b> Data</a></li>
<li class="chapter" data-level="5.4.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#model"><i class="fa fa-check"></i><b>5.4.2</b> Model</a></li>
<li class="chapter" data-level="5.4.3" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#compiling-and-fitting-the-model"><i class="fa fa-check"></i><b>5.4.3</b> Compiling and fitting the model</a></li>
<li class="chapter" data-level="5.4.4" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#assessing-model-quality"><i class="fa fa-check"></i><b>5.4.4</b> Assessing model quality</a></li>
<li class="chapter" data-level="5.4.5" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#summarizing-the-results"><i class="fa fa-check"></i><b>5.4.5</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#parameter-recovery"><i class="fa fa-check"></i><b>5.5</b> Parameter recovery</a></li>
<li class="chapter" data-level="5.6" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#the-memory-model-conditioning-theta"><i class="fa fa-check"></i><b>5.6</b> The memory model: conditioning theta</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#summarizing-the-results-1"><i class="fa fa-check"></i><b>5.6.1</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#memory-agent-with-internal-parameter"><i class="fa fa-check"></i><b>5.7</b> Memory agent with internal parameter</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#trying-out-a-more-complex-memory-model-with-a-rate-of-forgetting-that-exponentially-discounts-the-past"><i class="fa fa-check"></i><b>5.7.1</b> Trying out a more complex memory model, with a rate of forgetting that exponentially discounts the past</a></li>
<li class="chapter" data-level="5.7.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#connection-to-kalman-filters"><i class="fa fa-check"></i><b>5.7.2</b> Connection to Kalman Filters</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#relationship-to-rescorla-wagner"><i class="fa fa-check"></i><b>5.8</b> Relationship to Rescorla-Wagner</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#connection-to-hierarchical-gaussian-filter-hgf"><i class="fa fa-check"></i><b>5.8.1</b> Connection to Hierarchical Gaussian Filter (HGF)</a></li>
<li class="chapter" data-level="5.8.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#implications-for-model-development"><i class="fa fa-check"></i><b>5.8.2</b> Implications for Model Development</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#bayesian-memory-agent"><i class="fa fa-check"></i><b>5.9</b> Bayesian memory agent</a></li>
<li class="chapter" data-level="5.10" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#conclusion-from-simple-models-to-complex-cognitive-processes"><i class="fa fa-check"></i><b>5.10</b> Conclusion: From Simple Models to Complex Cognitive Processes</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html"><i class="fa fa-check"></i><b>6</b> Model Quality Assessment</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#introduction-1"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#generating-and-plotting-additional-variables"><i class="fa fa-check"></i><b>6.2</b> Generating and plotting additional variables</a></li>
<li class="chapter" data-level="6.3" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#assessing-priors"><i class="fa fa-check"></i><b>6.3</b> Assessing priors</a></li>
<li class="chapter" data-level="6.4" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#prior-predictive-checks"><i class="fa fa-check"></i><b>6.4</b> Prior Predictive Checks</a></li>
<li class="chapter" data-level="6.5" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>6.5</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="6.6" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>6.6</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="6.7" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#the-memory-model"><i class="fa fa-check"></i><b>6.7</b> The memory model</a></li>
<li class="chapter" data-level="6.8" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#prior-sensitivity-check-for-the-memory-model"><i class="fa fa-check"></i><b>6.8</b> Prior sensitivity check for the memory model</a></li>
<li class="chapter" data-level="6.9" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#conclusion-1"><i class="fa fa-check"></i><b>6.9</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><i class="fa fa-check"></i><b>7</b> Individual Differences in Cognitive Strategies (Multilevel modeling)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#learning-objectives-1"><i class="fa fa-check"></i><b>7.2</b> Learning Objectives</a></li>
<li class="chapter" data-level="7.3" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#the-value-of-multilevel-modeling"><i class="fa fa-check"></i><b>7.3</b> The Value of Multilevel Modeling</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#complete-pooling"><i class="fa fa-check"></i><b>7.3.1</b> Complete Pooling</a></li>
<li class="chapter" data-level="7.3.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#no-pooling"><i class="fa fa-check"></i><b>7.3.2</b> No Pooling</a></li>
<li class="chapter" data-level="7.3.3" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#partial-pooling-multilevel-modeling"><i class="fa fa-check"></i><b>7.3.3</b> Partial Pooling (Multilevel Modeling)</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#graphical-model-visualization"><i class="fa fa-check"></i><b>7.4</b> Graphical Model Visualization</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#biased-agent-model"><i class="fa fa-check"></i><b>7.4.1</b> Biased Agent Model</a></li>
<li class="chapter" data-level="7.4.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#memory-agent-model"><i class="fa fa-check"></i><b>7.4.2</b> Memory Agent Model</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#generating-the-agents"><i class="fa fa-check"></i><b>7.5</b> Generating the agents</a></li>
<li class="chapter" data-level="7.6" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#plotting-the-agents"><i class="fa fa-check"></i><b>7.6</b> Plotting the agents</a></li>
<li class="chapter" data-level="7.7" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#coding-the-multilevel-agents"><i class="fa fa-check"></i><b>7.7</b> Coding the multilevel agents</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-random"><i class="fa fa-check"></i><b>7.7.1</b> Multilevel random</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-random-agent-model"><i class="fa fa-check"></i><b>7.8</b> Multilevel Random Agent Model</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-random-agents"><i class="fa fa-check"></i><b>7.8.1</b> Assessing multilevel random agents</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#lets-look-at-individuals"><i class="fa fa-check"></i><b>7.9</b> Letâ€™s look at individuals</a></li>
<li class="chapter" data-level="7.10" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#prior-sensitivity-checks"><i class="fa fa-check"></i><b>7.10</b> Prior sensitivity checks</a></li>
<li class="chapter" data-level="7.11" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#parameter-recovery-1"><i class="fa fa-check"></i><b>7.11</b> Parameter recovery</a></li>
<li class="chapter" data-level="7.12" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-memory-agent-model"><i class="fa fa-check"></i><b>7.12</b> Multilevel Memory Agent Model</a>
<ul>
<li class="chapter" data-level="7.12.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-memory"><i class="fa fa-check"></i><b>7.12.1</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="7.12.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#diagnosing-the-issue-with-bias-and-beta"><i class="fa fa-check"></i><b>7.12.2</b> Diagnosing the issue with bias and beta</a></li>
<li class="chapter" data-level="7.12.3" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization"><i class="fa fa-check"></i><b>7.12.3</b> Multilevel memory with non centered parameterization</a></li>
<li class="chapter" data-level="7.12.4" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-memory-1"><i class="fa fa-check"></i><b>7.12.4</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="7.12.5" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters"><i class="fa fa-check"></i><b>7.12.5</b> Multilevel memory with correlation between parameters</a></li>
<li class="chapter" data-level="7.12.6" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-memory-2"><i class="fa fa-check"></i><b>7.12.6</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="7.12.7" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#section"><i class="fa fa-check"></i><b>7.12.7</b> </a></li>
</ul></li>
<li class="chapter" data-level="7.13" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#comparing-pooling-approaches"><i class="fa fa-check"></i><b>7.13</b> Comparing Pooling Approaches</a></li>
<li class="chapter" data-level="7.14" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#comparing-pooling-approaches-1"><i class="fa fa-check"></i><b>7.14</b> Comparing Pooling Approaches</a></li>
<li class="chapter" data-level="7.15" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-modeling-cheatsheet"><i class="fa fa-check"></i><b>7.15</b> Multilevel Modeling Cheatsheet</a>
<ul>
<li class="chapter" data-level="7.15.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#when-to-use-each-pooling-approach"><i class="fa fa-check"></i><b>7.15.1</b> When to Use Each Pooling Approach:</a></li>
<li class="chapter" data-level="7.15.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#parameter-recovery-rules-of-thumb"><i class="fa fa-check"></i><b>7.15.2</b> Parameter Recovery Rules of Thumb:</a></li>
</ul></li>
<li class="chapter" data-level="7.16" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#conclusion-the-power-and-challenges-of-multilevel-modeling"><i class="fa fa-check"></i><b>7.16</b> Conclusion: The Power and Challenges of Multilevel Modeling</a></li>
<li class="chapter" data-level="7.17" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#exercises-just-some-ideas"><i class="fa fa-check"></i><b>7.17</b> Exercises (just some ideas)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html"><i class="fa fa-check"></i><b>8</b> Model Comparison in Cognitive Science</a>
<ul>
<li class="chapter" data-level="8.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#learning-objectives-2"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#why-compare-models"><i class="fa fa-check"></i><b>8.2</b> Why Compare Models?</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#the-challenge-of-model-selection"><i class="fa fa-check"></i><b>8.2.1</b> The Challenge of Model Selection</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#cross-validation-the-foundation-of-model-comparison"><i class="fa fa-check"></i><b>8.3</b> Cross-Validation: The Foundation of Model Comparison</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#the-problem-of-overfitting"><i class="fa fa-check"></i><b>8.3.1</b> The Problem of Overfitting</a></li>
<li class="chapter" data-level="8.3.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#how-cross-validation-works"><i class="fa fa-check"></i><b>8.3.2</b> How Cross-Validation Works</a></li>
<li class="chapter" data-level="8.3.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#cross-validation-in-bayesian-models"><i class="fa fa-check"></i><b>8.3.3</b> Cross-Validation in Bayesian Models</a></li>
<li class="chapter" data-level="8.3.4" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#expected-log-predictive-density-elpd"><i class="fa fa-check"></i><b>8.3.4</b> Expected Log Predictive Density (ELPD)</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#psis-loo-an-efficient-approximation-to-loo-cv"><i class="fa fa-check"></i><b>8.4</b> PSIS-LOO: An Efficient Approximation to LOO-CV</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#how-importance-sampling-works"><i class="fa fa-check"></i><b>8.4.1</b> How Importance Sampling Works</a></li>
<li class="chapter" data-level="8.4.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#pareto-smoothing-for-stability"><i class="fa fa-check"></i><b>8.4.2</b> Pareto Smoothing for Stability</a></li>
<li class="chapter" data-level="8.4.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#the-complete-psis-loo-process"><i class="fa fa-check"></i><b>8.4.3</b> The Complete PSIS-LOO Process</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#simulation-based-model-comparison"><i class="fa fa-check"></i><b>8.5</b> Simulation-Based Model Comparison</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#define-simulation-parameters"><i class="fa fa-check"></i><b>8.5.1</b> Define Simulation Parameters</a></li>
<li class="chapter" data-level="8.5.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#define-agent-functions"><i class="fa fa-check"></i><b>8.5.2</b> Define Agent Functions</a></li>
<li class="chapter" data-level="8.5.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#generate-simulation-data"><i class="fa fa-check"></i><b>8.5.3</b> Generate Simulation Data</a></li>
<li class="chapter" data-level="8.5.4" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#visualize-the-simulation-data"><i class="fa fa-check"></i><b>8.5.4</b> Visualize the Simulation Data</a></li>
<li class="chapter" data-level="8.5.5" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#prepare-data-for-stan-models"><i class="fa fa-check"></i><b>8.5.5</b> Prepare Data for Stan Models</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#implementing-models-for-comparison"><i class="fa fa-check"></i><b>8.6</b> Implementing Models for Comparison</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#understanding-log-likelihood-in-model-comparison"><i class="fa fa-check"></i><b>8.6.1</b> Understanding Log-Likelihood in Model Comparison</a></li>
<li class="chapter" data-level="8.6.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#multilevel-biased-agent-model"><i class="fa fa-check"></i><b>8.6.2</b> Multilevel Biased Agent Model</a></li>
<li class="chapter" data-level="8.6.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#multilevel-memory-agent-model-1"><i class="fa fa-check"></i><b>8.6.3</b> Multilevel Memory Agent Model</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#fitting-models-and-calculating-expected-log-predictive-density"><i class="fa fa-check"></i><b>8.7</b> Fitting Models and Calculating Expected Log Predictive Density</a></li>
<li class="chapter" data-level="8.8" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#fitting-the-models-to-the-data"><i class="fa fa-check"></i><b>8.8</b> Fitting the models to the data</a></li>
<li class="chapter" data-level="8.9" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#cross-validation-for-model-comparison"><i class="fa fa-check"></i><b>8.9</b> Cross-Validation for Model Comparison</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#psis-loo-comparison"><i class="fa fa-check"></i><b>8.9.1</b> PSIS-LOO Comparison</a></li>
<li class="chapter" data-level="8.9.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#visualizing-loo-cv-results"><i class="fa fa-check"></i><b>8.9.2</b> Visualizing LOO-CV Results</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#formal-model-comparison"><i class="fa fa-check"></i><b>8.10</b> Formal Model Comparison</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#k-fold-cross-validation-for-validation"><i class="fa fa-check"></i><b>8.10.1</b> K-Fold Cross-Validation for Validation</a></li>
<li class="chapter" data-level="8.10.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#comparing-loo-and-k-fold-results"><i class="fa fa-check"></i><b>8.10.2</b> Comparing LOO and K-Fold Results</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#limitations-of-model-comparison-approaches"><i class="fa fa-check"></i><b>8.11</b> Limitations of Model Comparison Approaches</a></li>
<li class="chapter" data-level="8.12" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#exercises"><i class="fa fa-check"></i><b>8.12</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.12.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#rant-on-internal-vs-external-validity"><i class="fa fa-check"></i><b>8.12.1</b> Rant on internal vs external validity</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>9</b> Mixture models</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="mixture-models.html"><a href="mixture-models.html#learning-objectives-3"><i class="fa fa-check"></i><b>9.0.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="9.0.2" data-path="mixture-models.html"><a href="mixture-models.html#chapter-roadmap"><i class="fa fa-check"></i><b>9.0.2</b> Chapter Roadmap</a></li>
<li class="chapter" data-level="9.1" data-path="mixture-models.html"><a href="mixture-models.html#visualizing-mixture-distributions-reaction-time-example"><i class="fa fa-check"></i><b>9.1</b> Visualizing Mixture Distributions: Reaction Time Example</a></li>
<li class="chapter" data-level="9.2" data-path="mixture-models.html"><a href="mixture-models.html#theoretical-foundation-for-mixture-models"><i class="fa fa-check"></i><b>9.2</b> Theoretical Foundation for Mixture Models</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="mixture-models.html"><a href="mixture-models.html#the-mixture-model-framework"><i class="fa fa-check"></i><b>9.2.1</b> The Mixture Model Framework</a></li>
<li class="chapter" data-level="9.2.2" data-path="mixture-models.html"><a href="mixture-models.html#mixture-models-and-latent-variables"><i class="fa fa-check"></i><b>9.2.2</b> Mixture Models and Latent Variables</a></li>
<li class="chapter" data-level="9.2.3" data-path="mixture-models.html"><a href="mixture-models.html#applications-in-cognitive-modeling"><i class="fa fa-check"></i><b>9.2.3</b> Applications in Cognitive Modeling</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="mixture-models.html"><a href="mixture-models.html#implementing-a-basic-mixture-model"><i class="fa fa-check"></i><b>9.3</b> Implementing a Basic Mixture Model</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="mixture-models.html"><a href="mixture-models.html#simulating-mixed-strategy-data"><i class="fa fa-check"></i><b>9.3.1</b> Simulating Mixed Strategy Data</a></li>
<li class="chapter" data-level="9.3.2" data-path="mixture-models.html"><a href="mixture-models.html#stan-implementation-of-a-mixture-model"><i class="fa fa-check"></i><b>9.3.2</b> Stan Implementation of a Mixture Model</a></li>
<li class="chapter" data-level="9.3.3" data-path="mixture-models.html"><a href="mixture-models.html#fitting-and-evaluating-the-mixture-model"><i class="fa fa-check"></i><b>9.3.3</b> Fitting and Evaluating the Mixture Model</a></li>
<li class="chapter" data-level="9.3.4" data-path="mixture-models.html"><a href="mixture-models.html#model-diagnostics"><i class="fa fa-check"></i><b>9.3.4</b> Model Diagnostics</a></li>
<li class="chapter" data-level="9.3.5" data-path="mixture-models.html"><a href="mixture-models.html#parameter-recovery-analysis"><i class="fa fa-check"></i><b>9.3.5</b> Parameter Recovery Analysis</a></li>
<li class="chapter" data-level="9.3.6" data-path="mixture-models.html"><a href="mixture-models.html#posterior-predictive-checks-1"><i class="fa fa-check"></i><b>9.3.6</b> Posterior Predictive Checks</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="mixture-models.html"><a href="mixture-models.html#parameter-interpretation"><i class="fa fa-check"></i><b>9.4</b> Parameter Interpretation</a></li>
<li class="chapter" data-level="9.5" data-path="mixture-models.html"><a href="mixture-models.html#multilevel-mixture-models"><i class="fa fa-check"></i><b>9.5</b> Multilevel Mixture Models</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="mixture-models.html"><a href="mixture-models.html#stan-implementation"><i class="fa fa-check"></i><b>9.5.1</b> Stan Implementation</a></li>
<li class="chapter" data-level="9.5.2" data-path="mixture-models.html"><a href="mixture-models.html#preparing-data-for-the-multilevel-model"><i class="fa fa-check"></i><b>9.5.2</b> Preparing Data for the Multilevel Model</a></li>
<li class="chapter" data-level="9.5.3" data-path="mixture-models.html"><a href="mixture-models.html#fitting-and-evaluating-the-multilevel-model"><i class="fa fa-check"></i><b>9.5.3</b> Fitting and Evaluating the Multilevel Model</a></li>
<li class="chapter" data-level="9.5.4" data-path="mixture-models.html"><a href="mixture-models.html#examining-individual-differences"><i class="fa fa-check"></i><b>9.5.4</b> Examining Individual Differences</a></li>
<li class="chapter" data-level="9.5.5" data-path="mixture-models.html"><a href="mixture-models.html#interpreting-parameter-correlations"><i class="fa fa-check"></i><b>9.5.5</b> Interpreting Parameter Correlations</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="mixture-models.html"><a href="mixture-models.html#comparing-single-process-and-mixture-models"><i class="fa fa-check"></i><b>9.6</b> Comparing Single-Process and Mixture Models</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="mixture-models.html"><a href="mixture-models.html#single-process-model"><i class="fa fa-check"></i><b>9.6.1</b> Single-Process Model</a></li>
<li class="chapter" data-level="9.6.2" data-path="mixture-models.html"><a href="mixture-models.html#model-comparison"><i class="fa fa-check"></i><b>9.6.2</b> Model Comparison</a></li>
<li class="chapter" data-level="9.6.3" data-path="mixture-models.html"><a href="mixture-models.html#applications-of-mixture-models-in-cognitive-science"><i class="fa fa-check"></i><b>9.6.3</b> Applications of Mixture Models in Cognitive Science</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="mixture-models.html"><a href="mixture-models.html#conclusion-2"><i class="fa fa-check"></i><b>9.7</b> Conclusion</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">08-MixtureModels</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mixture-models" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Chapter 9</span> Mixture models<a href="mixture-models.html#mixture-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>When we model human cognition and behavior, we often find ourselves facing a puzzling reality: people donâ€™t always follow a single, consistent strategy. Consider a person playing our matching pennies game - sometimes they might carefully track their opponentâ€™s patterns, other times they might rely on a simple bias toward choosing â€œheads,â€ and occasionally they might respond completely randomly when their attention lapses. Traditional cognitive models that assume a single process are ill-equipped to capture this complexity.</p>
<p>Mixture models provide an elegant solution to this challenge. Rather than assuming behavior reflects just one cognitive process, mixture models allow us to combine multiple different processes within a unified modeling framework.</p>
<p>In the previous chapter, we explored model comparison techniques that help us select between competing cognitive models. Mixture models approach in a sense reframe that very problem - instead of asking â€œwhich model is correct?â€, they allow us to ask â€œhow much does each model contribute?â€ This shift acknowledges the possibility that multiple cognitive processes might coexist, either within a single individual or across a population.</p>
<div id="learning-objectives-3" class="section level3 hasAnchor" number="9.0.1">
<h3><span class="header-section-number">9.0.1</span> Learning Objectives<a href="mixture-models.html#learning-objectives-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After completing this chapter, you will be able to:</p>
<ol style="list-style-type: decimal">
<li><p>Understand how mixture models combine multiple cognitive processes</p></li>
<li><p>Implement mixture models for different types of behavioral data using Stan</p></li>
<li><p>Estimate mixture weights and component-specific parameters</p></li>
<li><p>Evaluate mixture models through posterior predictive checks</p></li>
<li><p>Compare mixture models to single-process alternatives</p></li>
</ol>
</div>
<div id="chapter-roadmap" class="section level3 hasAnchor" number="9.0.2">
<h3><span class="header-section-number">9.0.2</span> Chapter Roadmap<a href="mixture-models.html#chapter-roadmap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this chapter, we will:</p>
<ol style="list-style-type: decimal">
<li><p>Examine reaction time data to visualize how mixture distributions appear in practice</p></li>
<li><p>Develop a theoretical foundation for mixture modeling</p></li>
<li><p>Implement a simple mixture model combining biased and random choice processes (thus going back to our matching pennies example)</p></li>
<li><p>Evaluate and validate this model through posterior checks</p></li>
<li><p>Extend to multilevel mixture models that capture individual differences</p></li>
<li><p>Compare mixture models with traditional single-process approaches</p></li>
</ol>
</div>
<div id="visualizing-mixture-distributions-reaction-time-example" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Visualizing Mixture Distributions: Reaction Time Example<a href="mixture-models.html#visualizing-mixture-distributions-reaction-time-example" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before diving into the mathematics and implementation of mixture models, letâ€™s start with a concrete example that visually demonstrates why we need them. Reaction time (RT) data provides a particularly clear window into the mixture of cognitive processes.</p>
<p>In many cognitive tasks, participants are asked to respond as quickly as possible while still being accurate. However, attention fluctuates over time. Letâ€™s simulate a scenario where participants sometimes engage in deliberate thinking (producing a log-normal distribution of RTs) and sometimes experience attentional lapses (producing more or less random responses with a uniform distribution of RTs).</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="mixture-models.html#cb343-1" tabindex="-1"></a><span class="co"># Flag to control whether to regenerate simulations</span></span>
<span id="cb343-2"><a href="mixture-models.html#cb343-2" tabindex="-1"></a>regenerate_simulations <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb343-3"><a href="mixture-models.html#cb343-3" tabindex="-1"></a></span>
<span id="cb343-4"><a href="mixture-models.html#cb343-4" tabindex="-1"></a><span class="co"># Load necessary packages</span></span>
<span id="cb343-5"><a href="mixture-models.html#cb343-5" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb343-6"><a href="mixture-models.html#cb343-6" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb343-7"><a href="mixture-models.html#cb343-7" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb343-8"><a href="mixture-models.html#cb343-8" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb343-9"><a href="mixture-models.html#cb343-9" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb343-10"><a href="mixture-models.html#cb343-10" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb343-11"><a href="mixture-models.html#cb343-11" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb343-12"><a href="mixture-models.html#cb343-12" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># For reproducible results</span></span>
<span id="cb343-13"><a href="mixture-models.html#cb343-13" tabindex="-1"></a></span>
<span id="cb343-14"><a href="mixture-models.html#cb343-14" tabindex="-1"></a></span>
<span id="cb343-15"><a href="mixture-models.html#cb343-15" tabindex="-1"></a><span class="co"># Number of observations</span></span>
<span id="cb343-16"><a href="mixture-models.html#cb343-16" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb343-17"><a href="mixture-models.html#cb343-17" tabindex="-1"></a></span>
<span id="cb343-18"><a href="mixture-models.html#cb343-18" tabindex="-1"></a><span class="co"># Parameters for the two processes</span></span>
<span id="cb343-19"><a href="mixture-models.html#cb343-19" tabindex="-1"></a><span class="co"># Process 1: Deliberate thinking (log-normal distribution)</span></span>
<span id="cb343-20"><a href="mixture-models.html#cb343-20" tabindex="-1"></a>mu_delib <span class="ot">&lt;-</span> <span class="fl">6.2</span>     <span class="co"># Mean of log(RT) for deliberate process (â‰ˆ 500ms)</span></span>
<span id="cb343-21"><a href="mixture-models.html#cb343-21" tabindex="-1"></a>sigma_delib <span class="ot">&lt;-</span> <span class="fl">0.2</span>  <span class="co"># SD of log(RT) for deliberate process</span></span>
<span id="cb343-22"><a href="mixture-models.html#cb343-22" tabindex="-1"></a></span>
<span id="cb343-23"><a href="mixture-models.html#cb343-23" tabindex="-1"></a><span class="co"># Process 2: Attentional lapses (uniform distribution)</span></span>
<span id="cb343-24"><a href="mixture-models.html#cb343-24" tabindex="-1"></a>min_lapse <span class="ot">&lt;-</span> <span class="dv">200</span>    <span class="co"># Minimum RT during attentional lapses (ms)</span></span>
<span id="cb343-25"><a href="mixture-models.html#cb343-25" tabindex="-1"></a>max_lapse <span class="ot">&lt;-</span> <span class="dv">2000</span>   <span class="co"># Maximum RT during attentional lapses (ms)</span></span>
<span id="cb343-26"><a href="mixture-models.html#cb343-26" tabindex="-1"></a></span>
<span id="cb343-27"><a href="mixture-models.html#cb343-27" tabindex="-1"></a><span class="co"># Mixture weight (proportion of deliberate responses)</span></span>
<span id="cb343-28"><a href="mixture-models.html#cb343-28" tabindex="-1"></a>pi_delib <span class="ot">&lt;-</span> <span class="fl">0.8</span>    <span class="co"># 80% deliberate thinking, 20% attentional lapses</span></span>
<span id="cb343-29"><a href="mixture-models.html#cb343-29" tabindex="-1"></a></span>
<span id="cb343-30"><a href="mixture-models.html#cb343-30" tabindex="-1"></a><span class="co"># Simulate the mixture</span></span>
<span id="cb343-31"><a href="mixture-models.html#cb343-31" tabindex="-1"></a>process <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_obs, <span class="dv">1</span>, pi_delib)  <span class="co"># 1 = deliberate, 0 = lapse</span></span>
<span id="cb343-32"><a href="mixture-models.html#cb343-32" tabindex="-1"></a></span>
<span id="cb343-33"><a href="mixture-models.html#cb343-33" tabindex="-1"></a><span class="co"># Generate RTs from the appropriate distribution based on process</span></span>
<span id="cb343-34"><a href="mixture-models.html#cb343-34" tabindex="-1"></a>rt <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_obs)</span>
<span id="cb343-35"><a href="mixture-models.html#cb343-35" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_obs) {</span>
<span id="cb343-36"><a href="mixture-models.html#cb343-36" tabindex="-1"></a>  <span class="cf">if</span> (process[i] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb343-37"><a href="mixture-models.html#cb343-37" tabindex="-1"></a>    <span class="co"># Deliberate process - log-normal distribution</span></span>
<span id="cb343-38"><a href="mixture-models.html#cb343-38" tabindex="-1"></a>    rt[i] <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(<span class="dv">1</span>, mu_delib, sigma_delib)</span>
<span id="cb343-39"><a href="mixture-models.html#cb343-39" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb343-40"><a href="mixture-models.html#cb343-40" tabindex="-1"></a>    <span class="co"># Attentional lapse - uniform distribution</span></span>
<span id="cb343-41"><a href="mixture-models.html#cb343-41" tabindex="-1"></a>    rt[i] <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, min_lapse, max_lapse)</span>
<span id="cb343-42"><a href="mixture-models.html#cb343-42" tabindex="-1"></a>  }</span>
<span id="cb343-43"><a href="mixture-models.html#cb343-43" tabindex="-1"></a>}</span>
<span id="cb343-44"><a href="mixture-models.html#cb343-44" tabindex="-1"></a></span>
<span id="cb343-45"><a href="mixture-models.html#cb343-45" tabindex="-1"></a><span class="co"># Combine into a data frame</span></span>
<span id="cb343-46"><a href="mixture-models.html#cb343-46" tabindex="-1"></a>rt_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb343-47"><a href="mixture-models.html#cb343-47" tabindex="-1"></a>  <span class="at">observation =</span> <span class="dv">1</span><span class="sc">:</span>n_obs,</span>
<span id="cb343-48"><a href="mixture-models.html#cb343-48" tabindex="-1"></a>  <span class="at">rt =</span> rt,</span>
<span id="cb343-49"><a href="mixture-models.html#cb343-49" tabindex="-1"></a>  <span class="at">process =</span> <span class="fu">ifelse</span>(process <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Deliberate&quot;</span>, <span class="st">&quot;Attentional Lapse&quot;</span>),</span>
<span id="cb343-50"><a href="mixture-models.html#cb343-50" tabindex="-1"></a>  <span class="at">log_rt =</span> <span class="fu">log</span>(rt)</span>
<span id="cb343-51"><a href="mixture-models.html#cb343-51" tabindex="-1"></a>)</span>
<span id="cb343-52"><a href="mixture-models.html#cb343-52" tabindex="-1"></a></span>
<span id="cb343-53"><a href="mixture-models.html#cb343-53" tabindex="-1"></a><span class="co"># Summary statistics by process</span></span>
<span id="cb343-54"><a href="mixture-models.html#cb343-54" tabindex="-1"></a>rt_summary <span class="ot">&lt;-</span> rt_data <span class="sc">%&gt;%</span></span>
<span id="cb343-55"><a href="mixture-models.html#cb343-55" tabindex="-1"></a>  <span class="fu">group_by</span>(process) <span class="sc">%&gt;%</span></span>
<span id="cb343-56"><a href="mixture-models.html#cb343-56" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb343-57"><a href="mixture-models.html#cb343-57" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb343-58"><a href="mixture-models.html#cb343-58" tabindex="-1"></a>    <span class="at">proportion =</span> <span class="fu">n</span>()<span class="sc">/</span>n_obs,</span>
<span id="cb343-59"><a href="mixture-models.html#cb343-59" tabindex="-1"></a>    <span class="at">mean_rt =</span> <span class="fu">mean</span>(rt),</span>
<span id="cb343-60"><a href="mixture-models.html#cb343-60" tabindex="-1"></a>    <span class="at">median_rt =</span> <span class="fu">median</span>(rt),</span>
<span id="cb343-61"><a href="mixture-models.html#cb343-61" tabindex="-1"></a>    <span class="at">sd_rt =</span> <span class="fu">sd</span>(rt)</span>
<span id="cb343-62"><a href="mixture-models.html#cb343-62" tabindex="-1"></a>  )</span>
<span id="cb343-63"><a href="mixture-models.html#cb343-63" tabindex="-1"></a></span>
<span id="cb343-64"><a href="mixture-models.html#cb343-64" tabindex="-1"></a><span class="co"># Display summary</span></span>
<span id="cb343-65"><a href="mixture-models.html#cb343-65" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(rt_summary, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">process</th>
<th align="right">count</th>
<th align="right">proportion</th>
<th align="right">mean_rt</th>
<th align="right">median_rt</th>
<th align="right">sd_rt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Attentional Lapse</td>
<td align="right">94</td>
<td align="right">0.19</td>
<td align="right">1076.04</td>
<td align="right">1106.17</td>
<td align="right">552.71</td>
</tr>
<tr class="even">
<td align="left">Deliberate</td>
<td align="right">406</td>
<td align="right">0.81</td>
<td align="right">494.98</td>
<td align="right">490.17</td>
<td align="right">92.08</td>
</tr>
</tbody>
</table>
<p>Now, letâ€™s visualize the reaction time distribution:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="mixture-models.html#cb344-1" tabindex="-1"></a><span class="co"># Create histogram of reaction times with overlaid density curves</span></span>
<span id="cb344-2"><a href="mixture-models.html#cb344-2" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb344-3"><a href="mixture-models.html#cb344-3" tabindex="-1"></a>  <span class="co"># Histogram of all data</span></span>
<span id="cb344-4"><a href="mixture-models.html#cb344-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> rt_data, <span class="fu">aes</span>(<span class="at">x =</span> rt, <span class="at">y =</span> ..density..), </span>
<span id="cb344-5"><a href="mixture-models.html#cb344-5" tabindex="-1"></a>                <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">&quot;gray80&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb344-6"><a href="mixture-models.html#cb344-6" tabindex="-1"></a>  </span>
<span id="cb344-7"><a href="mixture-models.html#cb344-7" tabindex="-1"></a>  <span class="co"># Density curves for each component</span></span>
<span id="cb344-8"><a href="mixture-models.html#cb344-8" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> rt_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(process <span class="sc">==</span> <span class="st">&quot;Deliberate&quot;</span>), </span>
<span id="cb344-9"><a href="mixture-models.html#cb344-9" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> rt, <span class="at">fill =</span> <span class="st">&quot;Deliberate Thinking&quot;</span>), </span>
<span id="cb344-10"><a href="mixture-models.html#cb344-10" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb344-11"><a href="mixture-models.html#cb344-11" tabindex="-1"></a>  </span>
<span id="cb344-12"><a href="mixture-models.html#cb344-12" tabindex="-1"></a>  <span class="co"># We can&#39;t use geom_density for uniform distribution (it would smooth it)</span></span>
<span id="cb344-13"><a href="mixture-models.html#cb344-13" tabindex="-1"></a>  <span class="co"># Instead, overlay the theoretical uniform density</span></span>
<span id="cb344-14"><a href="mixture-models.html#cb344-14" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_lapse, <span class="at">xend =</span> max_lapse, </span>
<span id="cb344-15"><a href="mixture-models.html#cb344-15" tabindex="-1"></a>                  <span class="at">y =</span> <span class="dv">1</span><span class="sc">/</span>(max_lapse<span class="sc">-</span>min_lapse), <span class="at">yend =</span> <span class="dv">1</span><span class="sc">/</span>(max_lapse<span class="sc">-</span>min_lapse),</span>
<span id="cb344-16"><a href="mixture-models.html#cb344-16" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;Attentional Lapse&quot;</span>), </span>
<span id="cb344-17"><a href="mixture-models.html#cb344-17" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb344-18"><a href="mixture-models.html#cb344-18" tabindex="-1"></a>  </span>
<span id="cb344-19"><a href="mixture-models.html#cb344-19" tabindex="-1"></a>  <span class="co"># Overall density</span></span>
<span id="cb344-20"><a href="mixture-models.html#cb344-20" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> rt_data, <span class="fu">aes</span>(<span class="at">x =</span> rt), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb344-21"><a href="mixture-models.html#cb344-21" tabindex="-1"></a>  </span>
<span id="cb344-22"><a href="mixture-models.html#cb344-22" tabindex="-1"></a>  <span class="co"># Aesthetics</span></span>
<span id="cb344-23"><a href="mixture-models.html#cb344-23" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Deliberate Thinking&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb344-24"><a href="mixture-models.html#cb344-24" tabindex="-1"></a>                   <span class="at">name =</span> <span class="st">&quot;Process&quot;</span>) <span class="sc">+</span></span>
<span id="cb344-25"><a href="mixture-models.html#cb344-25" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Attentional Lapse&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>),</span>
<span id="cb344-26"><a href="mixture-models.html#cb344-26" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&quot;Process&quot;</span>) <span class="sc">+</span></span>
<span id="cb344-27"><a href="mixture-models.html#cb344-27" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Reaction Time Distribution&quot;</span>,</span>
<span id="cb344-28"><a href="mixture-models.html#cb344-28" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;A mixture of deliberate thinking and attentional lapses&quot;</span>,</span>
<span id="cb344-29"><a href="mixture-models.html#cb344-29" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Reaction Time (ms)&quot;</span>,</span>
<span id="cb344-30"><a href="mixture-models.html#cb344-30" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb344-31"><a href="mixture-models.html#cb344-31" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2000</span>)) <span class="sc">+</span></span>
<span id="cb344-32"><a href="mixture-models.html#cb344-32" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb344-33"><a href="mixture-models.html#cb344-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb344-34"><a href="mixture-models.html#cb344-34" tabindex="-1"></a></span>
<span id="cb344-35"><a href="mixture-models.html#cb344-35" tabindex="-1"></a><span class="co"># Also plot the log RT</span></span>
<span id="cb344-36"><a href="mixture-models.html#cb344-36" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb344-37"><a href="mixture-models.html#cb344-37" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> rt_data, <span class="fu">aes</span>(<span class="at">x =</span> log_rt, <span class="at">y =</span> ..density..), </span>
<span id="cb344-38"><a href="mixture-models.html#cb344-38" tabindex="-1"></a>                <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">&quot;gray80&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb344-39"><a href="mixture-models.html#cb344-39" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> rt_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(process <span class="sc">==</span> <span class="st">&quot;Deliberate&quot;</span>), </span>
<span id="cb344-40"><a href="mixture-models.html#cb344-40" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> log_rt, <span class="at">fill =</span> <span class="st">&quot;Deliberate Thinking&quot;</span>), </span>
<span id="cb344-41"><a href="mixture-models.html#cb344-41" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb344-42"><a href="mixture-models.html#cb344-42" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> rt_data, <span class="fu">aes</span>(<span class="at">x =</span> log_rt), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb344-43"><a href="mixture-models.html#cb344-43" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Deliberate Thinking&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb344-44"><a href="mixture-models.html#cb344-44" tabindex="-1"></a>                   <span class="at">name =</span> <span class="st">&quot;Process&quot;</span>) <span class="sc">+</span></span>
<span id="cb344-45"><a href="mixture-models.html#cb344-45" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Log Reaction Time Distribution&quot;</span>,</span>
<span id="cb344-46"><a href="mixture-models.html#cb344-46" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Log transformation highlights the mixture components&quot;</span>,</span>
<span id="cb344-47"><a href="mixture-models.html#cb344-47" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Log Reaction Time&quot;</span>,</span>
<span id="cb344-48"><a href="mixture-models.html#cb344-48" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb344-49"><a href="mixture-models.html#cb344-49" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb344-50"><a href="mixture-models.html#cb344-50" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb344-51"><a href="mixture-models.html#cb344-51" tabindex="-1"></a></span>
<span id="cb344-52"><a href="mixture-models.html#cb344-52" tabindex="-1"></a><span class="co"># Display both plots</span></span>
<span id="cb344-53"><a href="mixture-models.html#cb344-53" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-39-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>In this example, we can clearly see how the overall reaction time distribution (black line) is a combination of two distinct processes:</p>
<ul>
<li><p>Deliberate Thinking (Blue): A log-normal distribution centered around 500ms, representing focused cognitive processing of the task.</p></li>
<li><p>Attentional Lapses (Red Line): A uniform distribution spanning from very quick to very slow responses, representing trials where attention has drifted, leading to either impulsive responses or delayed responses due to mind-wandering.</p></li>
</ul>
<p>The mixture of these processes creates a complex distribution with a prominent peak (from the deliberate process) and extended tails (from the attentional lapses). A standard single-process model assuming only a log-normal distribution would fail to capture these extended tails, leading to poor fit and potentially misleading conclusions about the cognitive processes involved.</p>
<p>This is exactly the situation where mixture models excel. They allow us to represent observed data as coming from a weighted combination of different underlying processes. Next, weâ€™ll formalize this intuition and extend it to decision-making models.</p>
</div>
<div id="theoretical-foundation-for-mixture-models" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Theoretical Foundation for Mixture Models<a href="mixture-models.html#theoretical-foundation-for-mixture-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="the-mixture-model-framework" class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> The Mixture Model Framework<a href="mixture-models.html#the-mixture-model-framework" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>At their core, mixture models represent data as coming from a weighted combination of different â€œcomponentâ€ distributions or processes. Mathematically, a mixture model can be expressed as:</p>
<p>p(y) = Ï€_1p_1(y) + Ï€_2p_2(y) + â€¦ + Ï€_kp_k(y)</p>
<p>Where:</p>
<ul>
<li><p>p(y) is the overall probability of observing data point y</p></li>
<li><p>p_j(y) is the probability of y according to component model j</p></li>
<li><p>Ï€_j is the weight or mixing proportion of component j (with all Ï€_j summing to 1)</p></li>
</ul>
<p>Each component distribution p_j(y) can have its own parameters, and the mixing proportions Ï€_j determine how much each component contributes to the overall model.</p>
</div>
<div id="mixture-models-and-latent-variables" class="section level3 hasAnchor" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Mixture Models and Latent Variables<a href="mixture-models.html#mixture-models-and-latent-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An alternative and often useful way to think about mixture models is through latent (unobserved) variables. We can introduce a latent categorical variable z that indicates which component generated each observation. For example, in a two-component mixture:</p>
<ul>
<li>z_i = 1 means observation i came from component 1</li>
<li>z_i=2 means observation i came from component 2</li>
</ul>
<p>We can then formulate the mixture model as:</p>
<p>p(y_i, z_i) = p(z_i)p(y_iâˆ£z_i)</p>
<p>Where p(z_i=j)=Ï€_j is the prior probability of component j, and p(y_iâˆ£z_i = j) is the likelihood of y_i under component j.</p>
<p>This latent variable perspective is particularly useful for implementing mixture models in Bayesian frameworks like Stan.</p>
</div>
<div id="applications-in-cognitive-modeling" class="section level3 hasAnchor" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Applications in Cognitive Modeling<a href="mixture-models.html#applications-in-cognitive-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In cognitive modeling, mixture models can represent several important phenomena:</p>
<ul>
<li><p>Attentional fluctuations: As in our reaction time example, performance may reflect both focused engagement and attentional lapses</p></li>
<li><p>Strategy switching: Individuals might switch between different strategies over time</p></li>
<li><p>Dual-process theories: Behavior might arise from multiple cognitive systems (e.g., automatic vs.Â controlled)</p></li>
<li><p>Individual differences: Different individuals might use different strategies</p></li>
<li><p>Exploration vs.Â exploitation: Some decisions might reflect exploring new options while others exploit known rewards</p></li>
</ul>
</div>
</div>
<div id="implementing-a-basic-mixture-model" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Implementing a Basic Mixture Model<a href="mixture-models.html#implementing-a-basic-mixture-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that we understand the theoretical foundation, letâ€™s implement a simple mixture model for choice data. Weâ€™ll model behavior as a mixture of two processes:</p>
<ul>
<li>A biased process that chooses option 1, letâ€™s say â€œrightâ€, with some probability Î¸</li>
<li>A random process that chooses randomly (50/50) between options 1 and 0, or â€œrightâ€ and â€œleftâ€</li>
</ul>
<p>This could represent, for example, a person who sometimes carefully performs a task but occasionally responds randomly due to attentional lapses.</p>
<div id="simulating-mixed-strategy-data" class="section level3 hasAnchor" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Simulating Mixed Strategy Data<a href="mixture-models.html#simulating-mixed-strategy-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In previous chapters we generated data to use for fitting models. Letâ€™s use that same data but focus on a particular agent who might be mixing strategies:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="mixture-models.html#cb345-1" tabindex="-1"></a><span class="co"># Load data from a previous chapter</span></span>
<span id="cb345-2"><a href="mixture-models.html#cb345-2" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;simdata/W3_randomnoise.csv&quot;</span>)</span>
<span id="cb345-3"><a href="mixture-models.html#cb345-3" tabindex="-1"></a></span>
<span id="cb345-4"><a href="mixture-models.html#cb345-4" tabindex="-1"></a><span class="co"># Choose data with some bias (0.8) and noise (0.1)</span></span>
<span id="cb345-5"><a href="mixture-models.html#cb345-5" tabindex="-1"></a>dd <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(rate <span class="sc">==</span> <span class="fl">0.8</span> <span class="sc">&amp;</span> noise <span class="sc">==</span> <span class="fl">0.1</span>)</span>
<span id="cb345-6"><a href="mixture-models.html#cb345-6" tabindex="-1"></a></span>
<span id="cb345-7"><a href="mixture-models.html#cb345-7" tabindex="-1"></a><span class="co"># Prepare data for Stan</span></span>
<span id="cb345-8"><a href="mixture-models.html#cb345-8" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb345-9"><a href="mixture-models.html#cb345-9" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">120</span>,</span>
<span id="cb345-10"><a href="mixture-models.html#cb345-10" tabindex="-1"></a>  <span class="at">h =</span> dd<span class="sc">$</span>choice</span>
<span id="cb345-11"><a href="mixture-models.html#cb345-11" tabindex="-1"></a>)</span>
<span id="cb345-12"><a href="mixture-models.html#cb345-12" tabindex="-1"></a></span>
<span id="cb345-13"><a href="mixture-models.html#cb345-13" tabindex="-1"></a><span class="co"># Display summary statistics</span></span>
<span id="cb345-14"><a href="mixture-models.html#cb345-14" tabindex="-1"></a>mean_choice <span class="ot">&lt;-</span> <span class="fu">mean</span>(dd<span class="sc">$</span>choice)</span>
<span id="cb345-15"><a href="mixture-models.html#cb345-15" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean choice (proportion of &#39;right&#39; choices):&quot;</span>, mean_choice, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mean choice (proportion of &#39;right&#39; choices): 0.7666667</code></pre>
<p>Letâ€™s visualize this data to see if we can detect patterns suggestive of a mixture:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="mixture-models.html#cb347-1" tabindex="-1"></a><span class="co"># Calculate running proportion of right choices</span></span>
<span id="cb347-2"><a href="mixture-models.html#cb347-2" tabindex="-1"></a>running_prop <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(dd<span class="sc">$</span>choice) <span class="sc">/</span> <span class="fu">seq_along</span>(dd<span class="sc">$</span>choice)</span>
<span id="cb347-3"><a href="mixture-models.html#cb347-3" tabindex="-1"></a></span>
<span id="cb347-4"><a href="mixture-models.html#cb347-4" tabindex="-1"></a><span class="co"># Plot actual choices over time</span></span>
<span id="cb347-5"><a href="mixture-models.html#cb347-5" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dd, <span class="fu">aes</span>(<span class="at">x =</span> trial)) <span class="sc">+</span></span>
<span id="cb347-6"><a href="mixture-models.html#cb347-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> choice), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb347-7"><a href="mixture-models.html#cb347-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb347-8"><a href="mixture-models.html#cb347-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Sequence of Choices&quot;</span>,</span>
<span id="cb347-9"><a href="mixture-models.html#cb347-9" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;0 = left, 1 = right&quot;</span>,</span>
<span id="cb347-10"><a href="mixture-models.html#cb347-10" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Trial&quot;</span>,</span>
<span id="cb347-11"><a href="mixture-models.html#cb347-11" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Choice&quot;</span>) <span class="sc">+</span></span>
<span id="cb347-12"><a href="mixture-models.html#cb347-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb347-13"><a href="mixture-models.html#cb347-13" tabindex="-1"></a></span>
<span id="cb347-14"><a href="mixture-models.html#cb347-14" tabindex="-1"></a><span class="co"># Plot running average</span></span>
<span id="cb347-15"><a href="mixture-models.html#cb347-15" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dd, <span class="fu">aes</span>(<span class="at">x =</span> trial)) <span class="sc">+</span></span>
<span id="cb347-16"><a href="mixture-models.html#cb347-16" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> running_prop)) <span class="sc">+</span></span>
<span id="cb347-17"><a href="mixture-models.html#cb347-17" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb347-18"><a href="mixture-models.html#cb347-18" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb347-19"><a href="mixture-models.html#cb347-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Running Proportion of Right Choices&quot;</span>,</span>
<span id="cb347-20"><a href="mixture-models.html#cb347-20" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Red: random choice (0.5), Blue: true bias (0.8)&quot;</span>,</span>
<span id="cb347-21"><a href="mixture-models.html#cb347-21" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Trial&quot;</span>,</span>
<span id="cb347-22"><a href="mixture-models.html#cb347-22" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Proportion Right&quot;</span>) <span class="sc">+</span></span>
<span id="cb347-23"><a href="mixture-models.html#cb347-23" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb347-24"><a href="mixture-models.html#cb347-24" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb347-25"><a href="mixture-models.html#cb347-25" tabindex="-1"></a></span>
<span id="cb347-26"><a href="mixture-models.html#cb347-26" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-41-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>For binary choice data, itâ€™s harder to visually detect a mixture compared to reaction times. The overall proportion of right choices falls between what weâ€™d expect from random choice (0.5) and fully biased choice with rate 0.8, which is consistent with a mixture of these processes.</p>
</div>
<div id="stan-implementation-of-a-mixture-model" class="section level3 hasAnchor" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Stan Implementation of a Mixture Model<a href="mixture-models.html#stan-implementation-of-a-mixture-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now letâ€™s implement a Stan model that represents choices as coming from a mixture of a biased process and a random process:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="mixture-models.html#cb348-1" tabindex="-1"></a>stan_mixture_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb348-2"><a href="mixture-models.html#cb348-2" tabindex="-1"></a><span class="st">// Mixture model for binary choice data</span></span>
<span id="cb348-3"><a href="mixture-models.html#cb348-3" tabindex="-1"></a><span class="st">// Combines a biased choice process with a random choice process</span></span>
<span id="cb348-4"><a href="mixture-models.html#cb348-4" tabindex="-1"></a></span>
<span id="cb348-5"><a href="mixture-models.html#cb348-5" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb348-6"><a href="mixture-models.html#cb348-6" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; n;  // Number of trials</span></span>
<span id="cb348-7"><a href="mixture-models.html#cb348-7" tabindex="-1"></a><span class="st">  array[n] int h;  // Choice data (0/1)</span></span>
<span id="cb348-8"><a href="mixture-models.html#cb348-8" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb348-9"><a href="mixture-models.html#cb348-9" tabindex="-1"></a></span>
<span id="cb348-10"><a href="mixture-models.html#cb348-10" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb348-11"><a href="mixture-models.html#cb348-11" tabindex="-1"></a><span class="st">  real bias;        // Bias parameter for biased process (logit scale)</span></span>
<span id="cb348-12"><a href="mixture-models.html#cb348-12" tabindex="-1"></a><span class="st">  real noise_logit; // Mixing weight for random process (logit scale)</span></span>
<span id="cb348-13"><a href="mixture-models.html#cb348-13" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb348-14"><a href="mixture-models.html#cb348-14" tabindex="-1"></a></span>
<span id="cb348-15"><a href="mixture-models.html#cb348-15" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb348-16"><a href="mixture-models.html#cb348-16" tabindex="-1"></a><span class="st">  // Priors</span></span>
<span id="cb348-17"><a href="mixture-models.html#cb348-17" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | 0, 1);          // Prior for bias parameter (centered at 0.5 in prob scale)</span></span>
<span id="cb348-18"><a href="mixture-models.html#cb348-18" tabindex="-1"></a><span class="st">  target += normal_lpdf(noise_logit | -1, 1);  // Prior for noise proportion (favors lower noise)</span></span>
<span id="cb348-19"><a href="mixture-models.html#cb348-19" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb348-20"><a href="mixture-models.html#cb348-20" tabindex="-1"></a><span class="st">  // Mixture likelihood using log_sum_exp for numerical stability</span></span>
<span id="cb348-21"><a href="mixture-models.html#cb348-21" tabindex="-1"></a><span class="st">  target += log_sum_exp(</span></span>
<span id="cb348-22"><a href="mixture-models.html#cb348-22" tabindex="-1"></a><span class="st">    log(inv_logit(noise_logit)) +            // Log probability of random process</span></span>
<span id="cb348-23"><a href="mixture-models.html#cb348-23" tabindex="-1"></a><span class="st">    bernoulli_logit_lpmf(h | 0),             // Log likelihood under random process (p=0.5)</span></span>
<span id="cb348-24"><a href="mixture-models.html#cb348-24" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb348-25"><a href="mixture-models.html#cb348-25" tabindex="-1"></a><span class="st">    log1m(inv_logit(noise_logit)) +          // Log probability of biased process</span></span>
<span id="cb348-26"><a href="mixture-models.html#cb348-26" tabindex="-1"></a><span class="st">    bernoulli_logit_lpmf(h | bias)           // Log likelihood under biased process</span></span>
<span id="cb348-27"><a href="mixture-models.html#cb348-27" tabindex="-1"></a><span class="st">  );</span></span>
<span id="cb348-28"><a href="mixture-models.html#cb348-28" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb348-29"><a href="mixture-models.html#cb348-29" tabindex="-1"></a></span>
<span id="cb348-30"><a href="mixture-models.html#cb348-30" tabindex="-1"></a><span class="st">generated quantities {</span></span>
<span id="cb348-31"><a href="mixture-models.html#cb348-31" tabindex="-1"></a><span class="st">  // Transform parameters to probability scale for easier interpretation</span></span>
<span id="cb348-32"><a href="mixture-models.html#cb348-32" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; noise_p = inv_logit(noise_logit);  // Proportion of random choices</span></span>
<span id="cb348-33"><a href="mixture-models.html#cb348-33" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; bias_p = inv_logit(bias);          // Bias toward right in biased choices</span></span>
<span id="cb348-34"><a href="mixture-models.html#cb348-34" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb348-35"><a href="mixture-models.html#cb348-35" tabindex="-1"></a><span class="st">  // Predicted distributions</span></span>
<span id="cb348-36"><a href="mixture-models.html#cb348-36" tabindex="-1"></a><span class="st">  vector[n] log_lik;</span></span>
<span id="cb348-37"><a href="mixture-models.html#cb348-37" tabindex="-1"></a><span class="st">  array[n] int pred_component;  // Which component generated each prediction (1=random, 0=biased)</span></span>
<span id="cb348-38"><a href="mixture-models.html#cb348-38" tabindex="-1"></a><span class="st">  array[n] int pred_choice;     // Predicted choices</span></span>
<span id="cb348-39"><a href="mixture-models.html#cb348-39" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb348-40"><a href="mixture-models.html#cb348-40" tabindex="-1"></a><span class="st">  // Calculate log likelihood for each observation (for model comparison)</span></span>
<span id="cb348-41"><a href="mixture-models.html#cb348-41" tabindex="-1"></a><span class="st">  for (i in 1:n) {</span></span>
<span id="cb348-42"><a href="mixture-models.html#cb348-42" tabindex="-1"></a><span class="st">    log_lik[i] = log_sum_exp(</span></span>
<span id="cb348-43"><a href="mixture-models.html#cb348-43" tabindex="-1"></a><span class="st">      log(noise_p) + bernoulli_logit_lpmf(h[i] | 0),</span></span>
<span id="cb348-44"><a href="mixture-models.html#cb348-44" tabindex="-1"></a><span class="st">      log1m(noise_p) + bernoulli_logit_lpmf(h[i] | bias)</span></span>
<span id="cb348-45"><a href="mixture-models.html#cb348-45" tabindex="-1"></a><span class="st">    );</span></span>
<span id="cb348-46"><a href="mixture-models.html#cb348-46" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb348-47"><a href="mixture-models.html#cb348-47" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb348-48"><a href="mixture-models.html#cb348-48" tabindex="-1"></a><span class="st">  // Generate posterior predictions</span></span>
<span id="cb348-49"><a href="mixture-models.html#cb348-49" tabindex="-1"></a><span class="st">  for (i in 1:n) {</span></span>
<span id="cb348-50"><a href="mixture-models.html#cb348-50" tabindex="-1"></a><span class="st">    // First determine which component to use</span></span>
<span id="cb348-51"><a href="mixture-models.html#cb348-51" tabindex="-1"></a><span class="st">    pred_component[i] = bernoulli_rng(noise_p);</span></span>
<span id="cb348-52"><a href="mixture-models.html#cb348-52" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb348-53"><a href="mixture-models.html#cb348-53" tabindex="-1"></a><span class="st">    // Then generate prediction from appropriate component</span></span>
<span id="cb348-54"><a href="mixture-models.html#cb348-54" tabindex="-1"></a><span class="st">    if (pred_component[i] == 1) {</span></span>
<span id="cb348-55"><a href="mixture-models.html#cb348-55" tabindex="-1"></a><span class="st">      // Random component</span></span>
<span id="cb348-56"><a href="mixture-models.html#cb348-56" tabindex="-1"></a><span class="st">      pred_choice[i] = bernoulli_rng(0.5);</span></span>
<span id="cb348-57"><a href="mixture-models.html#cb348-57" tabindex="-1"></a><span class="st">    } else {</span></span>
<span id="cb348-58"><a href="mixture-models.html#cb348-58" tabindex="-1"></a><span class="st">      // Biased component</span></span>
<span id="cb348-59"><a href="mixture-models.html#cb348-59" tabindex="-1"></a><span class="st">      pred_choice[i] = bernoulli_rng(bias_p);</span></span>
<span id="cb348-60"><a href="mixture-models.html#cb348-60" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb348-61"><a href="mixture-models.html#cb348-61" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb348-62"><a href="mixture-models.html#cb348-62" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb348-63"><a href="mixture-models.html#cb348-63" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb348-64"><a href="mixture-models.html#cb348-64" tabindex="-1"></a></span>
<span id="cb348-65"><a href="mixture-models.html#cb348-65" tabindex="-1"></a><span class="co"># Write the Stan model to a file</span></span>
<span id="cb348-66"><a href="mixture-models.html#cb348-66" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb348-67"><a href="mixture-models.html#cb348-67" tabindex="-1"></a>  stan_mixture_model,</span>
<span id="cb348-68"><a href="mixture-models.html#cb348-68" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb348-69"><a href="mixture-models.html#cb348-69" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W8_MixtureSingle.stan&quot;</span></span>
<span id="cb348-70"><a href="mixture-models.html#cb348-70" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W8_MixtureSingle.stan&quot;</code></pre>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="mixture-models.html#cb350-1" tabindex="-1"></a><span class="co"># Compile the model</span></span>
<span id="cb350-2"><a href="mixture-models.html#cb350-2" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W8_MixtureSingle.stan&quot;</span>)</span>
<span id="cb350-3"><a href="mixture-models.html#cb350-3" tabindex="-1"></a>mod_mixture <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb350-4"><a href="mixture-models.html#cb350-4" tabindex="-1"></a>                           <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb350-5"><a href="mixture-models.html#cb350-5" tabindex="-1"></a>                           <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
</div>
<div id="fitting-and-evaluating-the-mixture-model" class="section level3 hasAnchor" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Fitting and Evaluating the Mixture Model<a href="mixture-models.html#fitting-and-evaluating-the-mixture-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now letâ€™s fit the model and evaluate its performance:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="mixture-models.html#cb351-1" tabindex="-1"></a><span class="co"># File path for saved model results</span></span>
<span id="cb351-2"><a href="mixture-models.html#cb351-2" tabindex="-1"></a>model_file <span class="ot">&lt;-</span> <span class="st">&quot;simmodels/W8_singlemixture.RDS&quot;</span></span>
<span id="cb351-3"><a href="mixture-models.html#cb351-3" tabindex="-1"></a></span>
<span id="cb351-4"><a href="mixture-models.html#cb351-4" tabindex="-1"></a><span class="co"># Check if we need to rerun the simulation</span></span>
<span id="cb351-5"><a href="mixture-models.html#cb351-5" tabindex="-1"></a><span class="cf">if</span> (regenerate_simulations <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(model_file)) {</span>
<span id="cb351-6"><a href="mixture-models.html#cb351-6" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb351-7"><a href="mixture-models.html#cb351-7" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> mod_mixture<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb351-8"><a href="mixture-models.html#cb351-8" tabindex="-1"></a>    <span class="at">data =</span> data,</span>
<span id="cb351-9"><a href="mixture-models.html#cb351-9" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb351-10"><a href="mixture-models.html#cb351-10" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb351-11"><a href="mixture-models.html#cb351-11" tabindex="-1"></a>    <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb351-12"><a href="mixture-models.html#cb351-12" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">1</span>,</span>
<span id="cb351-13"><a href="mixture-models.html#cb351-13" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb351-14"><a href="mixture-models.html#cb351-14" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb351-15"><a href="mixture-models.html#cb351-15" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb351-16"><a href="mixture-models.html#cb351-16" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb351-17"><a href="mixture-models.html#cb351-17" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb351-18"><a href="mixture-models.html#cb351-18" tabindex="-1"></a>  )</span>
<span id="cb351-19"><a href="mixture-models.html#cb351-19" tabindex="-1"></a>  </span>
<span id="cb351-20"><a href="mixture-models.html#cb351-20" tabindex="-1"></a>  <span class="co"># Save the results</span></span>
<span id="cb351-21"><a href="mixture-models.html#cb351-21" tabindex="-1"></a>  samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> model_file)</span>
<span id="cb351-22"><a href="mixture-models.html#cb351-22" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Generated new model fit and saved to&quot;</span>, model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb351-23"><a href="mixture-models.html#cb351-23" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb351-24"><a href="mixture-models.html#cb351-24" tabindex="-1"></a>  <span class="co"># Load existing results</span></span>
<span id="cb351-25"><a href="mixture-models.html#cb351-25" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(model_file)</span>
<span id="cb351-26"><a href="mixture-models.html#cb351-26" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Loaded existing model fit from&quot;</span>, model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb351-27"><a href="mixture-models.html#cb351-27" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 1 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 finished in 0.3 seconds.
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 0.3 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 0.3 seconds.
## Total execution time: 0.5 seconds.
## 
## Generated new model fit and saved to simmodels/W8_singlemixture.RDS</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="mixture-models.html#cb353-1" tabindex="-1"></a><span class="co"># Extract summary statistics</span></span>
<span id="cb353-2"><a href="mixture-models.html#cb353-2" tabindex="-1"></a>summary <span class="ot">&lt;-</span> samples<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;bias_p&quot;</span>, <span class="st">&quot;noise_p&quot;</span>))</span>
<span id="cb353-3"><a href="mixture-models.html#cb353-3" tabindex="-1"></a><span class="fu">print</span>(summary)</span></code></pre></div>
<pre><code>## # A tibble: 2 Ã— 10
##   variable  mean median     sd    mad     q5   q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 bias_p   0.756  0.758 0.0381 0.0392 0.692  0.816  1.00    2276.    2058.
## 2 noise_p  0.253  0.224 0.152  0.149  0.0608 0.549  1.00    2298.    1875.</code></pre>
</div>
<div id="model-diagnostics" class="section level3 hasAnchor" number="9.3.4">
<h3><span class="header-section-number">9.3.4</span> Model Diagnostics<a href="mixture-models.html#model-diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Letâ€™s check the model diagnostics to ensure our inference is reliable:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="mixture-models.html#cb355-1" tabindex="-1"></a><span class="co"># Extract draws for diagnostics</span></span>
<span id="cb355-2"><a href="mixture-models.html#cb355-2" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>())</span>
<span id="cb355-3"><a href="mixture-models.html#cb355-3" tabindex="-1"></a></span>
<span id="cb355-4"><a href="mixture-models.html#cb355-4" tabindex="-1"></a><span class="co"># Check for convergence with trace plots</span></span>
<span id="cb355-5"><a href="mixture-models.html#cb355-5" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(draws, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;bias_p&quot;</span>, <span class="st">&quot;noise_p&quot;</span>)) <span class="sc">+</span></span>
<span id="cb355-6"><a href="mixture-models.html#cb355-6" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Trace Plots for Mixture Model Parameters&quot;</span>) <span class="sc">+</span></span>
<span id="cb355-7"><a href="mixture-models.html#cb355-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb355-8"><a href="mixture-models.html#cb355-8" tabindex="-1"></a></span>
<span id="cb355-9"><a href="mixture-models.html#cb355-9" tabindex="-1"></a><span class="co"># Examine parameter distributions</span></span>
<span id="cb355-10"><a href="mixture-models.html#cb355-10" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">mcmc_hist</span>(draws, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;bias_p&quot;</span>, <span class="st">&quot;noise_p&quot;</span>)) <span class="sc">+</span></span>
<span id="cb355-11"><a href="mixture-models.html#cb355-11" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Posterior Distributions&quot;</span>) <span class="sc">+</span></span>
<span id="cb355-12"><a href="mixture-models.html#cb355-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb355-13"><a href="mixture-models.html#cb355-13" tabindex="-1"></a></span>
<span id="cb355-14"><a href="mixture-models.html#cb355-14" tabindex="-1"></a><span class="co"># Display diagnostics</span></span>
<span id="cb355-15"><a href="mixture-models.html#cb355-15" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-44-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="mixture-models.html#cb356-1" tabindex="-1"></a>p2</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-44-2.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="mixture-models.html#cb357-1" tabindex="-1"></a><span class="co"># Check for potential divergences</span></span>
<span id="cb357-2"><a href="mixture-models.html#cb357-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Number of divergent transitions:&quot;</span>, <span class="fu">sum</span>(draws<span class="sc">$</span>.divergent), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Number of divergent transitions: 0</code></pre>
</div>
<div id="parameter-recovery-analysis" class="section level3 hasAnchor" number="9.3.5">
<h3><span class="header-section-number">9.3.5</span> Parameter Recovery Analysis<a href="mixture-models.html#parameter-recovery-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To verify that our model can accurately recover parameters, letâ€™s examine how close our inferred parameters are to the true values used in the simulation:</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="mixture-models.html#cb359-1" tabindex="-1"></a><span class="co"># True parameters (from the simulation)</span></span>
<span id="cb359-2"><a href="mixture-models.html#cb359-2" tabindex="-1"></a>true_bias <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb359-3"><a href="mixture-models.html#cb359-3" tabindex="-1"></a>true_noise <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb359-4"><a href="mixture-models.html#cb359-4" tabindex="-1"></a></span>
<span id="cb359-5"><a href="mixture-models.html#cb359-5" tabindex="-1"></a><span class="co"># Calculate parameter recovery metrics</span></span>
<span id="cb359-6"><a href="mixture-models.html#cb359-6" tabindex="-1"></a>bias_error <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws<span class="sc">$</span>bias_p) <span class="sc">-</span> true_bias</span>
<span id="cb359-7"><a href="mixture-models.html#cb359-7" tabindex="-1"></a>noise_error <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws<span class="sc">$</span>noise_p) <span class="sc">-</span> true_noise</span>
<span id="cb359-8"><a href="mixture-models.html#cb359-8" tabindex="-1"></a></span>
<span id="cb359-9"><a href="mixture-models.html#cb359-9" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Parameter Recovery Results:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Parameter Recovery Results:</code></pre>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="mixture-models.html#cb361-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Bias parameter - True:&quot;</span>, true_bias, <span class="st">&quot;Estimated:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(draws<span class="sc">$</span>bias_p), <span class="dv">3</span>), </span>
<span id="cb361-2"><a href="mixture-models.html#cb361-2" tabindex="-1"></a>    <span class="st">&quot;Error:&quot;</span>, <span class="fu">round</span>(bias_error, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Bias parameter - True: 0.8 Estimated: 0.756 Error: -0.044</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="mixture-models.html#cb363-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Noise parameter - True:&quot;</span>, true_noise, <span class="st">&quot;Estimated:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(draws<span class="sc">$</span>noise_p), <span class="dv">3</span>), </span>
<span id="cb363-2"><a href="mixture-models.html#cb363-2" tabindex="-1"></a>    <span class="st">&quot;Error:&quot;</span>, <span class="fu">round</span>(noise_error, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Noise parameter - True: 0.1 Estimated: 0.253 Error: 0.153</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="mixture-models.html#cb365-1" tabindex="-1"></a><span class="co"># Generate prior samples in probability space</span></span>
<span id="cb365-2"><a href="mixture-models.html#cb365-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb365-3"><a href="mixture-models.html#cb365-3" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="fu">nrow</span>(draws)</span>
<span id="cb365-4"><a href="mixture-models.html#cb365-4" tabindex="-1"></a>prior_samples <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb365-5"><a href="mixture-models.html#cb365-5" tabindex="-1"></a>  <span class="at">bias_prior =</span> <span class="fu">inv_logit_scaled</span>(<span class="fu">rnorm</span>(n_samples, <span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb365-6"><a href="mixture-models.html#cb365-6" tabindex="-1"></a>  <span class="at">noise_prior =</span> <span class="fu">inv_logit_scaled</span>(<span class="fu">rnorm</span>(n_samples, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb365-7"><a href="mixture-models.html#cb365-7" tabindex="-1"></a>)</span>
<span id="cb365-8"><a href="mixture-models.html#cb365-8" tabindex="-1"></a></span>
<span id="cb365-9"><a href="mixture-models.html#cb365-9" tabindex="-1"></a><span class="co"># Prepare data for plotting</span></span>
<span id="cb365-10"><a href="mixture-models.html#cb365-10" tabindex="-1"></a>recovery_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb365-11"><a href="mixture-models.html#cb365-11" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Bias&quot;</span>, <span class="st">&quot;Noise&quot;</span>), <span class="at">each =</span> <span class="fu">nrow</span>(draws)),</span>
<span id="cb365-12"><a href="mixture-models.html#cb365-12" tabindex="-1"></a>  <span class="at">posterior =</span> <span class="fu">c</span>(draws<span class="sc">$</span>bias_p, draws<span class="sc">$</span>noise_p),</span>
<span id="cb365-13"><a href="mixture-models.html#cb365-13" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(prior_samples<span class="sc">$</span>bias_prior, prior_samples<span class="sc">$</span>noise_prior),</span>
<span id="cb365-14"><a href="mixture-models.html#cb365-14" tabindex="-1"></a>  <span class="at">true_value =</span> <span class="fu">rep</span>(<span class="fu">c</span>(true_bias, true_noise), <span class="at">each =</span> <span class="fu">nrow</span>(draws)),</span>
<span id="cb365-15"><a href="mixture-models.html#cb365-15" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;Posterior&quot;</span></span>
<span id="cb365-16"><a href="mixture-models.html#cb365-16" tabindex="-1"></a>)</span>
<span id="cb365-17"><a href="mixture-models.html#cb365-17" tabindex="-1"></a></span>
<span id="cb365-18"><a href="mixture-models.html#cb365-18" tabindex="-1"></a>prior_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb365-19"><a href="mixture-models.html#cb365-19" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Bias&quot;</span>, <span class="st">&quot;Noise&quot;</span>), <span class="at">each =</span> <span class="fu">nrow</span>(prior_samples)),</span>
<span id="cb365-20"><a href="mixture-models.html#cb365-20" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(prior_samples<span class="sc">$</span>bias_prior, prior_samples<span class="sc">$</span>noise_prior),</span>
<span id="cb365-21"><a href="mixture-models.html#cb365-21" tabindex="-1"></a>  <span class="at">true_value =</span> <span class="fu">rep</span>(<span class="fu">c</span>(true_bias, true_noise), <span class="at">each =</span> <span class="fu">nrow</span>(prior_samples)),</span>
<span id="cb365-22"><a href="mixture-models.html#cb365-22" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;Prior&quot;</span></span>
<span id="cb365-23"><a href="mixture-models.html#cb365-23" tabindex="-1"></a>)</span>
<span id="cb365-24"><a href="mixture-models.html#cb365-24" tabindex="-1"></a></span>
<span id="cb365-25"><a href="mixture-models.html#cb365-25" tabindex="-1"></a><span class="co"># Visualize parameter recovery with priors</span></span>
<span id="cb365-26"><a href="mixture-models.html#cb365-26" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb365-27"><a href="mixture-models.html#cb365-27" tabindex="-1"></a>  <span class="co"># Add prior densities</span></span>
<span id="cb365-28"><a href="mixture-models.html#cb365-28" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> prior_data, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> type), </span>
<span id="cb365-29"><a href="mixture-models.html#cb365-29" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb365-30"><a href="mixture-models.html#cb365-30" tabindex="-1"></a>  <span class="co"># Add posterior densities</span></span>
<span id="cb365-31"><a href="mixture-models.html#cb365-31" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> recovery_data, <span class="fu">aes</span>(<span class="at">x =</span> posterior, <span class="at">fill =</span> type), </span>
<span id="cb365-32"><a href="mixture-models.html#cb365-32" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb365-33"><a href="mixture-models.html#cb365-33" tabindex="-1"></a>  <span class="co"># Add true values</span></span>
<span id="cb365-34"><a href="mixture-models.html#cb365-34" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> recovery_data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(parameter, true_value), </span>
<span id="cb365-35"><a href="mixture-models.html#cb365-35" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> true_value), </span>
<span id="cb365-36"><a href="mixture-models.html#cb365-36" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb365-37"><a href="mixture-models.html#cb365-37" tabindex="-1"></a>  <span class="co"># Facet by parameter</span></span>
<span id="cb365-38"><a href="mixture-models.html#cb365-38" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb365-39"><a href="mixture-models.html#cb365-39" tabindex="-1"></a>  <span class="co"># Formatting</span></span>
<span id="cb365-40"><a href="mixture-models.html#cb365-40" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Posterior&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;Prior&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>),</span>
<span id="cb365-41"><a href="mixture-models.html#cb365-41" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&quot;Distribution&quot;</span>) <span class="sc">+</span></span>
<span id="cb365-42"><a href="mixture-models.html#cb365-42" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Parameter Recovery Analysis&quot;</span>,</span>
<span id="cb365-43"><a href="mixture-models.html#cb365-43" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Dashed lines show true values used in simulation&quot;</span>,</span>
<span id="cb365-44"><a href="mixture-models.html#cb365-44" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Parameter Value (probability scale)&quot;</span>,</span>
<span id="cb365-45"><a href="mixture-models.html#cb365-45" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb365-46"><a href="mixture-models.html#cb365-46" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb365-47"><a href="mixture-models.html#cb365-47" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-45-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The model has recovered the true parameters reasonably well, providing confidence in our approach. In a real project, weâ€™d want to run this across a broad range of parameter values!</p>
</div>
<div id="posterior-predictive-checks-1" class="section level3 hasAnchor" number="9.3.6">
<h3><span class="header-section-number">9.3.6</span> Posterior Predictive Checks<a href="mixture-models.html#posterior-predictive-checks-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="mixture-models.html#cb366-1" tabindex="-1"></a><span class="co"># Generate posterior and prior predictive samples</span></span>
<span id="cb366-2"><a href="mixture-models.html#cb366-2" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb366-3"><a href="mixture-models.html#cb366-3" tabindex="-1"></a></span>
<span id="cb366-4"><a href="mixture-models.html#cb366-4" tabindex="-1"></a><span class="co"># First, generate posterior predictive samples</span></span>
<span id="cb366-5"><a href="mixture-models.html#cb366-5" tabindex="-1"></a>post_pred_samples <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_samples, <span class="at">ncol =</span> data<span class="sc">$</span>n)</span>
<span id="cb366-6"><a href="mixture-models.html#cb366-6" tabindex="-1"></a>post_component_samples <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_samples, <span class="at">ncol =</span> data<span class="sc">$</span>n)</span>
<span id="cb366-7"><a href="mixture-models.html#cb366-7" tabindex="-1"></a></span>
<span id="cb366-8"><a href="mixture-models.html#cb366-8" tabindex="-1"></a><span class="co"># Sample from posterior distributions</span></span>
<span id="cb366-9"><a href="mixture-models.html#cb366-9" tabindex="-1"></a>post_sample_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(draws), n_samples, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb366-10"><a href="mixture-models.html#cb366-10" tabindex="-1"></a></span>
<span id="cb366-11"><a href="mixture-models.html#cb366-11" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_samples) {</span>
<span id="cb366-12"><a href="mixture-models.html#cb366-12" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> post_sample_indices[i]</span>
<span id="cb366-13"><a href="mixture-models.html#cb366-13" tabindex="-1"></a>  noise_p_sample <span class="ot">&lt;-</span> draws<span class="sc">$</span>noise_p[idx]</span>
<span id="cb366-14"><a href="mixture-models.html#cb366-14" tabindex="-1"></a>  bias_p_sample <span class="ot">&lt;-</span> draws<span class="sc">$</span>bias_p[idx]</span>
<span id="cb366-15"><a href="mixture-models.html#cb366-15" tabindex="-1"></a>  </span>
<span id="cb366-16"><a href="mixture-models.html#cb366-16" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>data<span class="sc">$</span>n) {</span>
<span id="cb366-17"><a href="mixture-models.html#cb366-17" tabindex="-1"></a>    <span class="co"># Determine component (0 = biased, 1 = random)</span></span>
<span id="cb366-18"><a href="mixture-models.html#cb366-18" tabindex="-1"></a>    component <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise_p_sample)</span>
<span id="cb366-19"><a href="mixture-models.html#cb366-19" tabindex="-1"></a>    post_component_samples[i,j] <span class="ot">&lt;-</span> component</span>
<span id="cb366-20"><a href="mixture-models.html#cb366-20" tabindex="-1"></a>    </span>
<span id="cb366-21"><a href="mixture-models.html#cb366-21" tabindex="-1"></a>    <span class="cf">if</span>(component <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb366-22"><a href="mixture-models.html#cb366-22" tabindex="-1"></a>      <span class="co"># Random component</span></span>
<span id="cb366-23"><a href="mixture-models.html#cb366-23" tabindex="-1"></a>      post_pred_samples[i,j] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb366-24"><a href="mixture-models.html#cb366-24" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb366-25"><a href="mixture-models.html#cb366-25" tabindex="-1"></a>      <span class="co"># Biased component</span></span>
<span id="cb366-26"><a href="mixture-models.html#cb366-26" tabindex="-1"></a>      post_pred_samples[i,j] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, bias_p_sample)</span>
<span id="cb366-27"><a href="mixture-models.html#cb366-27" tabindex="-1"></a>    }</span>
<span id="cb366-28"><a href="mixture-models.html#cb366-28" tabindex="-1"></a>  }</span>
<span id="cb366-29"><a href="mixture-models.html#cb366-29" tabindex="-1"></a>}</span>
<span id="cb366-30"><a href="mixture-models.html#cb366-30" tabindex="-1"></a></span>
<span id="cb366-31"><a href="mixture-models.html#cb366-31" tabindex="-1"></a><span class="co"># Now, generate prior predictive samples in the same way</span></span>
<span id="cb366-32"><a href="mixture-models.html#cb366-32" tabindex="-1"></a>prior_pred_samples <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_samples, <span class="at">ncol =</span> data<span class="sc">$</span>n)</span>
<span id="cb366-33"><a href="mixture-models.html#cb366-33" tabindex="-1"></a>prior_component_samples <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_samples, <span class="at">ncol =</span> data<span class="sc">$</span>n)</span>
<span id="cb366-34"><a href="mixture-models.html#cb366-34" tabindex="-1"></a></span>
<span id="cb366-35"><a href="mixture-models.html#cb366-35" tabindex="-1"></a><span class="co"># Generate samples from prior distributions</span></span>
<span id="cb366-36"><a href="mixture-models.html#cb366-36" tabindex="-1"></a>prior_noise_samples <span class="ot">&lt;-</span> <span class="fu">inv_logit_scaled</span>(<span class="fu">rnorm</span>(n_samples, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb366-37"><a href="mixture-models.html#cb366-37" tabindex="-1"></a>prior_bias_samples <span class="ot">&lt;-</span> <span class="fu">inv_logit_scaled</span>(<span class="fu">rnorm</span>(n_samples, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb366-38"><a href="mixture-models.html#cb366-38" tabindex="-1"></a></span>
<span id="cb366-39"><a href="mixture-models.html#cb366-39" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_samples) {</span>
<span id="cb366-40"><a href="mixture-models.html#cb366-40" tabindex="-1"></a>  noise_p_prior <span class="ot">&lt;-</span> prior_noise_samples[i]</span>
<span id="cb366-41"><a href="mixture-models.html#cb366-41" tabindex="-1"></a>  bias_p_prior <span class="ot">&lt;-</span> prior_bias_samples[i]</span>
<span id="cb366-42"><a href="mixture-models.html#cb366-42" tabindex="-1"></a>  </span>
<span id="cb366-43"><a href="mixture-models.html#cb366-43" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>data<span class="sc">$</span>n) {</span>
<span id="cb366-44"><a href="mixture-models.html#cb366-44" tabindex="-1"></a>    <span class="co"># Determine component (0 = biased, 1 = random)</span></span>
<span id="cb366-45"><a href="mixture-models.html#cb366-45" tabindex="-1"></a>    component <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise_p_prior)</span>
<span id="cb366-46"><a href="mixture-models.html#cb366-46" tabindex="-1"></a>    prior_component_samples[i,j] <span class="ot">&lt;-</span> component</span>
<span id="cb366-47"><a href="mixture-models.html#cb366-47" tabindex="-1"></a>    </span>
<span id="cb366-48"><a href="mixture-models.html#cb366-48" tabindex="-1"></a>    <span class="cf">if</span>(component <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb366-49"><a href="mixture-models.html#cb366-49" tabindex="-1"></a>      <span class="co"># Random component</span></span>
<span id="cb366-50"><a href="mixture-models.html#cb366-50" tabindex="-1"></a>      prior_pred_samples[i,j] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb366-51"><a href="mixture-models.html#cb366-51" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb366-52"><a href="mixture-models.html#cb366-52" tabindex="-1"></a>      <span class="co"># Biased component</span></span>
<span id="cb366-53"><a href="mixture-models.html#cb366-53" tabindex="-1"></a>      prior_pred_samples[i,j] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, bias_p_prior)</span>
<span id="cb366-54"><a href="mixture-models.html#cb366-54" tabindex="-1"></a>    }</span>
<span id="cb366-55"><a href="mixture-models.html#cb366-55" tabindex="-1"></a>  }</span>
<span id="cb366-56"><a href="mixture-models.html#cb366-56" tabindex="-1"></a>}</span>
<span id="cb366-57"><a href="mixture-models.html#cb366-57" tabindex="-1"></a></span>
<span id="cb366-58"><a href="mixture-models.html#cb366-58" tabindex="-1"></a><span class="co"># Calculate summary statistics from predictive samples</span></span>
<span id="cb366-59"><a href="mixture-models.html#cb366-59" tabindex="-1"></a><span class="co"># For posterior</span></span>
<span id="cb366-60"><a href="mixture-models.html#cb366-60" tabindex="-1"></a>post_pred_means <span class="ot">&lt;-</span> <span class="fu">apply</span>(post_pred_samples, <span class="dv">1</span>, mean)</span>
<span id="cb366-61"><a href="mixture-models.html#cb366-61" tabindex="-1"></a>post_pred_run_lengths <span class="ot">&lt;-</span> <span class="fu">apply</span>(post_pred_samples, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">rle</span>(x)<span class="sc">$</span>lengths))</span>
<span id="cb366-62"><a href="mixture-models.html#cb366-62" tabindex="-1"></a></span>
<span id="cb366-63"><a href="mixture-models.html#cb366-63" tabindex="-1"></a><span class="co"># For prior</span></span>
<span id="cb366-64"><a href="mixture-models.html#cb366-64" tabindex="-1"></a>prior_pred_means <span class="ot">&lt;-</span> <span class="fu">apply</span>(prior_pred_samples, <span class="dv">1</span>, mean)</span>
<span id="cb366-65"><a href="mixture-models.html#cb366-65" tabindex="-1"></a>prior_pred_run_lengths <span class="ot">&lt;-</span> <span class="fu">apply</span>(prior_pred_samples, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">rle</span>(x)<span class="sc">$</span>lengths))</span>
<span id="cb366-66"><a href="mixture-models.html#cb366-66" tabindex="-1"></a></span>
<span id="cb366-67"><a href="mixture-models.html#cb366-67" tabindex="-1"></a><span class="co"># Calculate observed statistics</span></span>
<span id="cb366-68"><a href="mixture-models.html#cb366-68" tabindex="-1"></a>obs_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>h)</span>
<span id="cb366-69"><a href="mixture-models.html#cb366-69" tabindex="-1"></a>obs_runs <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">rle</span>(data<span class="sc">$</span>h)<span class="sc">$</span>lengths)</span>
<span id="cb366-70"><a href="mixture-models.html#cb366-70" tabindex="-1"></a></span>
<span id="cb366-71"><a href="mixture-models.html#cb366-71" tabindex="-1"></a><span class="co"># Prepare data for visualization</span></span>
<span id="cb366-72"><a href="mixture-models.html#cb366-72" tabindex="-1"></a>pred_means_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb366-73"><a href="mixture-models.html#cb366-73" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">c</span>(post_pred_means, prior_pred_means),</span>
<span id="cb366-74"><a href="mixture-models.html#cb366-74" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;Posterior&quot;</span>, n_samples), <span class="fu">rep</span>(<span class="st">&quot;Prior&quot;</span>, n_samples)),</span>
<span id="cb366-75"><a href="mixture-models.html#cb366-75" tabindex="-1"></a>                <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Prior&quot;</span>, <span class="st">&quot;Posterior&quot;</span>))</span>
<span id="cb366-76"><a href="mixture-models.html#cb366-76" tabindex="-1"></a>)</span>
<span id="cb366-77"><a href="mixture-models.html#cb366-77" tabindex="-1"></a></span>
<span id="cb366-78"><a href="mixture-models.html#cb366-78" tabindex="-1"></a>pred_runs_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb366-79"><a href="mixture-models.html#cb366-79" tabindex="-1"></a>  <span class="at">run_length =</span> <span class="fu">c</span>(post_pred_run_lengths, prior_pred_run_lengths),</span>
<span id="cb366-80"><a href="mixture-models.html#cb366-80" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;Posterior&quot;</span>, n_samples), <span class="fu">rep</span>(<span class="st">&quot;Prior&quot;</span>, n_samples)),</span>
<span id="cb366-81"><a href="mixture-models.html#cb366-81" tabindex="-1"></a>                <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Prior&quot;</span>, <span class="st">&quot;Posterior&quot;</span>))</span>
<span id="cb366-82"><a href="mixture-models.html#cb366-82" tabindex="-1"></a>)</span>
<span id="cb366-83"><a href="mixture-models.html#cb366-83" tabindex="-1"></a></span>
<span id="cb366-84"><a href="mixture-models.html#cb366-84" tabindex="-1"></a><span class="co"># Visualize posterior and prior predictive checks</span></span>
<span id="cb366-85"><a href="mixture-models.html#cb366-85" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb366-86"><a href="mixture-models.html#cb366-86" tabindex="-1"></a>  <span class="co"># Add prior predictive distribution</span></span>
<span id="cb366-87"><a href="mixture-models.html#cb366-87" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> pred_means_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;Prior&quot;</span>),</span>
<span id="cb366-88"><a href="mixture-models.html#cb366-88" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">fill =</span> type), <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb366-89"><a href="mixture-models.html#cb366-89" tabindex="-1"></a>  <span class="co"># Add posterior predictive distribution</span></span>
<span id="cb366-90"><a href="mixture-models.html#cb366-90" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> pred_means_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;Posterior&quot;</span>),</span>
<span id="cb366-91"><a href="mixture-models.html#cb366-91" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">fill =</span> type), <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb366-92"><a href="mixture-models.html#cb366-92" tabindex="-1"></a>  <span class="co"># Add observed statistic</span></span>
<span id="cb366-93"><a href="mixture-models.html#cb366-93" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> obs_mean, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb366-94"><a href="mixture-models.html#cb366-94" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Prior&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, <span class="st">&quot;Posterior&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb366-95"><a href="mixture-models.html#cb366-95" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&quot;Distribution&quot;</span>) <span class="sc">+</span></span>
<span id="cb366-96"><a href="mixture-models.html#cb366-96" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Predictive Check: Mean&quot;</span>,</span>
<span id="cb366-97"><a href="mixture-models.html#cb366-97" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Dashed line shows observed data value&quot;</span>,</span>
<span id="cb366-98"><a href="mixture-models.html#cb366-98" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Mean (proportion of right choices)&quot;</span>,</span>
<span id="cb366-99"><a href="mixture-models.html#cb366-99" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb366-100"><a href="mixture-models.html#cb366-100" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb366-101"><a href="mixture-models.html#cb366-101" tabindex="-1"></a></span>
<span id="cb366-102"><a href="mixture-models.html#cb366-102" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb366-103"><a href="mixture-models.html#cb366-103" tabindex="-1"></a>  <span class="co"># Add prior predictive distribution</span></span>
<span id="cb366-104"><a href="mixture-models.html#cb366-104" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> pred_runs_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;Prior&quot;</span>),</span>
<span id="cb366-105"><a href="mixture-models.html#cb366-105" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> run_length, <span class="at">fill =</span> type), <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb366-106"><a href="mixture-models.html#cb366-106" tabindex="-1"></a>  <span class="co"># Add posterior predictive distribution</span></span>
<span id="cb366-107"><a href="mixture-models.html#cb366-107" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> pred_runs_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;Posterior&quot;</span>),</span>
<span id="cb366-108"><a href="mixture-models.html#cb366-108" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> run_length, <span class="at">fill =</span> type), <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb366-109"><a href="mixture-models.html#cb366-109" tabindex="-1"></a>  <span class="co"># Add observed statistic</span></span>
<span id="cb366-110"><a href="mixture-models.html#cb366-110" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> obs_runs, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb366-111"><a href="mixture-models.html#cb366-111" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Prior&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, <span class="st">&quot;Posterior&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb366-112"><a href="mixture-models.html#cb366-112" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&quot;Distribution&quot;</span>) <span class="sc">+</span></span>
<span id="cb366-113"><a href="mixture-models.html#cb366-113" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Predictive Check: Run Lengths&quot;</span>,</span>
<span id="cb366-114"><a href="mixture-models.html#cb366-114" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Dashed line shows observed data value&quot;</span>,</span>
<span id="cb366-115"><a href="mixture-models.html#cb366-115" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Mean run length&quot;</span>,</span>
<span id="cb366-116"><a href="mixture-models.html#cb366-116" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb366-117"><a href="mixture-models.html#cb366-117" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb366-118"><a href="mixture-models.html#cb366-118" tabindex="-1"></a></span>
<span id="cb366-119"><a href="mixture-models.html#cb366-119" tabindex="-1"></a><span class="co"># Display the plots side by side with shared legend</span></span>
<span id="cb366-120"><a href="mixture-models.html#cb366-120" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span> </span>
<span id="cb366-121"><a href="mixture-models.html#cb366-121" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-46-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Our model appears to capture both the overall proportion of right choices and the distribution of run lengths in the observed data. This suggests the mixture model is adequately representing the data-generating process.</p>
</div>
</div>
<div id="parameter-interpretation" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Parameter Interpretation<a href="mixture-models.html#parameter-interpretation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The mixture model provides valuable insights into the cognitive processes underlying the observed behavior:</p>
<ul>
<li><p>Bias Parameter (Î¸): The bias parameter (estimated as approximately r round(mean(draws$bias_p), 2)) represents the probability of choosing the right option when the participant is following the biased process.</p></li>
<li><p>Noise Parameter (Ï€): The noise parameter (estimated as approximately r round(mean(draws$noise_p), 2)) represents the proportion of choices that come from the random process rather than the biased process. This can be interpreted as the frequency of attentional lapses or exploratory behavior.</p></li>
</ul>
<p>The mixture model thus decomposes behavior into two distinct processes, providing a more nuanced understanding than a single-process model could offer. This has important cognitive implications: for instance, besides the usual focus on â€œdeliberateâ€ reaction times, individual variations attentional lapses might be affected by the experimental condition, or an underlying diagnosis, thus providing richer information.</p>
</div>
<div id="multilevel-mixture-models" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> Multilevel Mixture Models<a href="mixture-models.html#multilevel-mixture-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now letâ€™s extend our approach to a multilevel (hierarchical) mixture model that can accommodate individual differences across multiple participants. This allows us to estimate both population-level parameters and individual-specific variations.</p>
<div id="stan-implementation" class="section level3 hasAnchor" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> Stan Implementation<a href="mixture-models.html#stan-implementation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="mixture-models.html#cb367-1" tabindex="-1"></a>stan_multilevel_mixture_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb367-2"><a href="mixture-models.html#cb367-2" tabindex="-1"></a><span class="st">// Multilevel mixture model for binary choice data</span></span>
<span id="cb367-3"><a href="mixture-models.html#cb367-3" tabindex="-1"></a><span class="st">// Allows individual differences in both bias and mixture weights</span></span>
<span id="cb367-4"><a href="mixture-models.html#cb367-4" tabindex="-1"></a></span>
<span id="cb367-5"><a href="mixture-models.html#cb367-5" tabindex="-1"></a><span class="st">functions {</span></span>
<span id="cb367-6"><a href="mixture-models.html#cb367-6" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb367-7"><a href="mixture-models.html#cb367-7" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb367-8"><a href="mixture-models.html#cb367-8" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb367-9"><a href="mixture-models.html#cb367-9" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb367-10"><a href="mixture-models.html#cb367-10" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb367-11"><a href="mixture-models.html#cb367-11" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb367-12"><a href="mixture-models.html#cb367-12" tabindex="-1"></a></span>
<span id="cb367-13"><a href="mixture-models.html#cb367-13" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb367-14"><a href="mixture-models.html#cb367-14" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; trials;       // Number of trials per agent</span></span>
<span id="cb367-15"><a href="mixture-models.html#cb367-15" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; agents;       // Number of agents</span></span>
<span id="cb367-16"><a href="mixture-models.html#cb367-16" tabindex="-1"></a><span class="st">  array[trials, agents] int h;  // Choice data (0/1)</span></span>
<span id="cb367-17"><a href="mixture-models.html#cb367-17" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb367-18"><a href="mixture-models.html#cb367-18" tabindex="-1"></a></span>
<span id="cb367-19"><a href="mixture-models.html#cb367-19" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb367-20"><a href="mixture-models.html#cb367-20" tabindex="-1"></a><span class="st">  // Population-level parameters</span></span>
<span id="cb367-21"><a href="mixture-models.html#cb367-21" tabindex="-1"></a><span class="st">  real biasM;                // Population mean of bias (logit scale)</span></span>
<span id="cb367-22"><a href="mixture-models.html#cb367-22" tabindex="-1"></a><span class="st">  real noiseM;               // Population mean of noise proportion (logit scale)</span></span>
<span id="cb367-23"><a href="mixture-models.html#cb367-23" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-24"><a href="mixture-models.html#cb367-24" tabindex="-1"></a><span class="st">  // Population standard deviations</span></span>
<span id="cb367-25"><a href="mixture-models.html#cb367-25" tabindex="-1"></a><span class="st">  vector&lt;lower=0&gt;[2] tau;    // SDs for [bias, noise]</span></span>
<span id="cb367-26"><a href="mixture-models.html#cb367-26" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-27"><a href="mixture-models.html#cb367-27" tabindex="-1"></a><span class="st">  // Individual z-scores (non-centered parameterization)</span></span>
<span id="cb367-28"><a href="mixture-models.html#cb367-28" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb367-29"><a href="mixture-models.html#cb367-29" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-30"><a href="mixture-models.html#cb367-30" tabindex="-1"></a><span class="st">  // Correlation matrix</span></span>
<span id="cb367-31"><a href="mixture-models.html#cb367-31" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb367-32"><a href="mixture-models.html#cb367-32" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb367-33"><a href="mixture-models.html#cb367-33" tabindex="-1"></a></span>
<span id="cb367-34"><a href="mixture-models.html#cb367-34" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb367-35"><a href="mixture-models.html#cb367-35" tabindex="-1"></a><span class="st">  // Individual parameters (constructed from non-centered parameterization)</span></span>
<span id="cb367-36"><a href="mixture-models.html#cb367-36" tabindex="-1"></a><span class="st">  matrix[agents, 2] IDs;</span></span>
<span id="cb367-37"><a href="mixture-models.html#cb367-37" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb367-38"><a href="mixture-models.html#cb367-38" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb367-39"><a href="mixture-models.html#cb367-39" tabindex="-1"></a></span>
<span id="cb367-40"><a href="mixture-models.html#cb367-40" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb367-41"><a href="mixture-models.html#cb367-41" tabindex="-1"></a><span class="st">  // Priors for population means</span></span>
<span id="cb367-42"><a href="mixture-models.html#cb367-42" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);     // Prior for population bias mean</span></span>
<span id="cb367-43"><a href="mixture-models.html#cb367-43" tabindex="-1"></a><span class="st">  target += normal_lpdf(noiseM | -1, 0.5); // Prior for population noise mean (favoring lower noise)</span></span>
<span id="cb367-44"><a href="mixture-models.html#cb367-44" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-45"><a href="mixture-models.html#cb367-45" tabindex="-1"></a><span class="st">  // Priors for population SDs (half-normal)</span></span>
<span id="cb367-46"><a href="mixture-models.html#cb367-46" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, 0.3) - normal_lccdf(0 | 0, 0.3);</span></span>
<span id="cb367-47"><a href="mixture-models.html#cb367-47" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, 0.3) - normal_lccdf(0 | 0, 0.3);</span></span>
<span id="cb367-48"><a href="mixture-models.html#cb367-48" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-49"><a href="mixture-models.html#cb367-49" tabindex="-1"></a><span class="st">  // Prior for correlation matrix</span></span>
<span id="cb367-50"><a href="mixture-models.html#cb367-50" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb367-51"><a href="mixture-models.html#cb367-51" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-52"><a href="mixture-models.html#cb367-52" tabindex="-1"></a><span class="st">  // Prior for individual z-scores</span></span>
<span id="cb367-53"><a href="mixture-models.html#cb367-53" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb367-54"><a href="mixture-models.html#cb367-54" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-55"><a href="mixture-models.html#cb367-55" tabindex="-1"></a><span class="st">  // Likelihood</span></span>
<span id="cb367-56"><a href="mixture-models.html#cb367-56" tabindex="-1"></a><span class="st">  for (i in 1:agents) {</span></span>
<span id="cb367-57"><a href="mixture-models.html#cb367-57" tabindex="-1"></a><span class="st">    target += log_sum_exp(</span></span>
<span id="cb367-58"><a href="mixture-models.html#cb367-58" tabindex="-1"></a><span class="st">      log(inv_logit(noiseM + IDs[i,2])) +          // Prob of random process for agent i</span></span>
<span id="cb367-59"><a href="mixture-models.html#cb367-59" tabindex="-1"></a><span class="st">      bernoulli_logit_lpmf(h[,i] | 0),             // Likelihood under random process</span></span>
<span id="cb367-60"><a href="mixture-models.html#cb367-60" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb367-61"><a href="mixture-models.html#cb367-61" tabindex="-1"></a><span class="st">      log1m(inv_logit(noiseM + IDs[i,2])) +        // Prob of biased process for agent i</span></span>
<span id="cb367-62"><a href="mixture-models.html#cb367-62" tabindex="-1"></a><span class="st">      bernoulli_logit_lpmf(h[,i] | biasM + IDs[i,1])  // Likelihood under biased process</span></span>
<span id="cb367-63"><a href="mixture-models.html#cb367-63" tabindex="-1"></a><span class="st">    );</span></span>
<span id="cb367-64"><a href="mixture-models.html#cb367-64" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb367-65"><a href="mixture-models.html#cb367-65" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb367-66"><a href="mixture-models.html#cb367-66" tabindex="-1"></a></span>
<span id="cb367-67"><a href="mixture-models.html#cb367-67" tabindex="-1"></a><span class="st">generated quantities {</span></span>
<span id="cb367-68"><a href="mixture-models.html#cb367-68" tabindex="-1"></a><span class="st">  // Prior predictive samples</span></span>
<span id="cb367-69"><a href="mixture-models.html#cb367-69" tabindex="-1"></a><span class="st">  real biasM_prior = normal_rng(0, 1);</span></span>
<span id="cb367-70"><a href="mixture-models.html#cb367-70" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; biasSD_prior = normal_lb_rng(0, 0.3, 0);</span></span>
<span id="cb367-71"><a href="mixture-models.html#cb367-71" tabindex="-1"></a><span class="st">  real noiseM_prior = normal_rng(-1, 0.5);</span></span>
<span id="cb367-72"><a href="mixture-models.html#cb367-72" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; noiseSD_prior = normal_lb_rng(0, 0.3, 0);</span></span>
<span id="cb367-73"><a href="mixture-models.html#cb367-73" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-74"><a href="mixture-models.html#cb367-74" tabindex="-1"></a><span class="st">  // Transform to probability scale for easier interpretation</span></span>
<span id="cb367-75"><a href="mixture-models.html#cb367-75" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; bias_mean = inv_logit(biasM);</span></span>
<span id="cb367-76"><a href="mixture-models.html#cb367-76" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; noise_mean = inv_logit(noiseM);</span></span>
<span id="cb367-77"><a href="mixture-models.html#cb367-77" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-78"><a href="mixture-models.html#cb367-78" tabindex="-1"></a><span class="st">  // Correlation between parameters</span></span>
<span id="cb367-79"><a href="mixture-models.html#cb367-79" tabindex="-1"></a><span class="st">  corr_matrix[2] Omega = multiply_lower_tri_self_transpose(L_u);</span></span>
<span id="cb367-80"><a href="mixture-models.html#cb367-80" tabindex="-1"></a><span class="st">  real bias_noise_corr = Omega[1,2];</span></span>
<span id="cb367-81"><a href="mixture-models.html#cb367-81" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-82"><a href="mixture-models.html#cb367-82" tabindex="-1"></a><span class="st">  // For each agent, generate individual parameters and predictions</span></span>
<span id="cb367-83"><a href="mixture-models.html#cb367-83" tabindex="-1"></a><span class="st">  array[agents] real&lt;lower=0, upper=1&gt; agent_bias;</span></span>
<span id="cb367-84"><a href="mixture-models.html#cb367-84" tabindex="-1"></a><span class="st">  array[agents] real&lt;lower=0, upper=1&gt; agent_noise;</span></span>
<span id="cb367-85"><a href="mixture-models.html#cb367-85" tabindex="-1"></a><span class="st">  array[trials, agents] int pred_component;</span></span>
<span id="cb367-86"><a href="mixture-models.html#cb367-86" tabindex="-1"></a><span class="st">  array[trials, agents] int pred_choice;</span></span>
<span id="cb367-87"><a href="mixture-models.html#cb367-87" tabindex="-1"></a><span class="st">  array[trials, agents] real log_lik;</span></span>
<span id="cb367-88"><a href="mixture-models.html#cb367-88" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb367-89"><a href="mixture-models.html#cb367-89" tabindex="-1"></a><span class="st">  // Calculate individual parameters and generate predictions</span></span>
<span id="cb367-90"><a href="mixture-models.html#cb367-90" tabindex="-1"></a><span class="st">  for (i in 1:agents) {</span></span>
<span id="cb367-91"><a href="mixture-models.html#cb367-91" tabindex="-1"></a><span class="st">    // Individual parameters</span></span>
<span id="cb367-92"><a href="mixture-models.html#cb367-92" tabindex="-1"></a><span class="st">    agent_bias[i] = inv_logit(biasM + IDs[i,1]);</span></span>
<span id="cb367-93"><a href="mixture-models.html#cb367-93" tabindex="-1"></a><span class="st">    agent_noise[i] = inv_logit(noiseM + IDs[i,2]);</span></span>
<span id="cb367-94"><a href="mixture-models.html#cb367-94" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb367-95"><a href="mixture-models.html#cb367-95" tabindex="-1"></a><span class="st">    // Log likelihood calculations</span></span>
<span id="cb367-96"><a href="mixture-models.html#cb367-96" tabindex="-1"></a><span class="st">    for (t in 1:trials) {</span></span>
<span id="cb367-97"><a href="mixture-models.html#cb367-97" tabindex="-1"></a><span class="st">      log_lik[t,i] = log_sum_exp(</span></span>
<span id="cb367-98"><a href="mixture-models.html#cb367-98" tabindex="-1"></a><span class="st">        log(agent_noise[i]) + bernoulli_logit_lpmf(h[t,i] | 0),</span></span>
<span id="cb367-99"><a href="mixture-models.html#cb367-99" tabindex="-1"></a><span class="st">        log1m(agent_noise[i]) + bernoulli_logit_lpmf(h[t,i] | logit(agent_bias[i]))</span></span>
<span id="cb367-100"><a href="mixture-models.html#cb367-100" tabindex="-1"></a><span class="st">      );</span></span>
<span id="cb367-101"><a href="mixture-models.html#cb367-101" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb367-102"><a href="mixture-models.html#cb367-102" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb367-103"><a href="mixture-models.html#cb367-103" tabindex="-1"></a><span class="st">    // Generate predictions</span></span>
<span id="cb367-104"><a href="mixture-models.html#cb367-104" tabindex="-1"></a><span class="st">    for (t in 1:trials) {</span></span>
<span id="cb367-105"><a href="mixture-models.html#cb367-105" tabindex="-1"></a><span class="st">      pred_component[t,i] = bernoulli_rng(agent_noise[i]);</span></span>
<span id="cb367-106"><a href="mixture-models.html#cb367-106" tabindex="-1"></a><span class="st">      if (pred_component[t,i] == 1) {</span></span>
<span id="cb367-107"><a href="mixture-models.html#cb367-107" tabindex="-1"></a><span class="st">        // Random component</span></span>
<span id="cb367-108"><a href="mixture-models.html#cb367-108" tabindex="-1"></a><span class="st">        pred_choice[t,i] = bernoulli_rng(0.5);</span></span>
<span id="cb367-109"><a href="mixture-models.html#cb367-109" tabindex="-1"></a><span class="st">      } else {</span></span>
<span id="cb367-110"><a href="mixture-models.html#cb367-110" tabindex="-1"></a><span class="st">        // Biased component</span></span>
<span id="cb367-111"><a href="mixture-models.html#cb367-111" tabindex="-1"></a><span class="st">        pred_choice[t,i] = bernoulli_rng(agent_bias[i]);</span></span>
<span id="cb367-112"><a href="mixture-models.html#cb367-112" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb367-113"><a href="mixture-models.html#cb367-113" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb367-114"><a href="mixture-models.html#cb367-114" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb367-115"><a href="mixture-models.html#cb367-115" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb367-116"><a href="mixture-models.html#cb367-116" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb367-117"><a href="mixture-models.html#cb367-117" tabindex="-1"></a></span>
<span id="cb367-118"><a href="mixture-models.html#cb367-118" tabindex="-1"></a><span class="co"># Write the model to a file</span></span>
<span id="cb367-119"><a href="mixture-models.html#cb367-119" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb367-120"><a href="mixture-models.html#cb367-120" tabindex="-1"></a>  stan_multilevel_mixture_model,</span>
<span id="cb367-121"><a href="mixture-models.html#cb367-121" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb367-122"><a href="mixture-models.html#cb367-122" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W8_MixtureMultilevel.stan&quot;</span></span>
<span id="cb367-123"><a href="mixture-models.html#cb367-123" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W8_MixtureMultilevel.stan&quot;</code></pre>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="mixture-models.html#cb369-1" tabindex="-1"></a><span class="co"># Compile the model</span></span>
<span id="cb369-2"><a href="mixture-models.html#cb369-2" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W8_MixtureMultilevel.stan&quot;</span>)</span>
<span id="cb369-3"><a href="mixture-models.html#cb369-3" tabindex="-1"></a>mod_multilevel_mixture <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(</span>
<span id="cb369-4"><a href="mixture-models.html#cb369-4" tabindex="-1"></a>  file, </span>
<span id="cb369-5"><a href="mixture-models.html#cb369-5" tabindex="-1"></a>  <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb369-6"><a href="mixture-models.html#cb369-6" tabindex="-1"></a>  <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>)</span>
<span id="cb369-7"><a href="mixture-models.html#cb369-7" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="preparing-data-for-the-multilevel-model" class="section level3 hasAnchor" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> Preparing Data for the Multilevel Model<a href="mixture-models.html#preparing-data-for-the-multilevel-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now weâ€™ll prepare data from multiple agents for the multilevel model:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="mixture-models.html#cb370-1" tabindex="-1"></a><span class="co"># Set random seed for reproducibility</span></span>
<span id="cb370-2"><a href="mixture-models.html#cb370-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb370-3"><a href="mixture-models.html#cb370-3" tabindex="-1"></a></span>
<span id="cb370-4"><a href="mixture-models.html#cb370-4" tabindex="-1"></a><span class="co"># Simulation parameters</span></span>
<span id="cb370-5"><a href="mixture-models.html#cb370-5" tabindex="-1"></a>agents <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb370-6"><a href="mixture-models.html#cb370-6" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb370-7"><a href="mixture-models.html#cb370-7" tabindex="-1"></a></span>
<span id="cb370-8"><a href="mixture-models.html#cb370-8" tabindex="-1"></a><span class="co"># Population-level parameters</span></span>
<span id="cb370-9"><a href="mixture-models.html#cb370-9" tabindex="-1"></a>rate_M <span class="ot">&lt;-</span> <span class="fl">1.386</span>  <span class="co"># Population mean of bias (~0.8 in probability space)</span></span>
<span id="cb370-10"><a href="mixture-models.html#cb370-10" tabindex="-1"></a>rate_SD <span class="ot">&lt;-</span> <span class="fl">0.65</span>  <span class="co"># Population SD of bias</span></span>
<span id="cb370-11"><a href="mixture-models.html#cb370-11" tabindex="-1"></a>noise_M <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">2.2</span>  <span class="co"># Population mean of noise (~0.1 in probability space)</span></span>
<span id="cb370-12"><a href="mixture-models.html#cb370-12" tabindex="-1"></a>noise_SD <span class="ot">&lt;-</span> <span class="fl">0.5</span>  <span class="co"># Population SD of noise</span></span>
<span id="cb370-13"><a href="mixture-models.html#cb370-13" tabindex="-1"></a></span>
<span id="cb370-14"><a href="mixture-models.html#cb370-14" tabindex="-1"></a><span class="co"># Print population parameters in probability space for clarity</span></span>
<span id="cb370-15"><a href="mixture-models.html#cb370-15" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Population parameters in probability space:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Population parameters in probability space:</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="mixture-models.html#cb372-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean rate:&quot;</span>, <span class="fu">round</span>(<span class="fu">plogis</span>(rate_M), <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mean rate: 0.8</code></pre>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="mixture-models.html#cb374-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean noise:&quot;</span>, <span class="fu">round</span>(<span class="fu">plogis</span>(noise_M), <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mean noise: 0.1</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="mixture-models.html#cb376-1" tabindex="-1"></a><span class="co"># Generate random agent parameters</span></span>
<span id="cb376-2"><a href="mixture-models.html#cb376-2" tabindex="-1"></a>agent_rates <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(agents, rate_M, rate_SD)</span>
<span id="cb376-3"><a href="mixture-models.html#cb376-3" tabindex="-1"></a>agent_noises <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(agents, noise_M, noise_SD)</span>
<span id="cb376-4"><a href="mixture-models.html#cb376-4" tabindex="-1"></a></span>
<span id="cb376-5"><a href="mixture-models.html#cb376-5" tabindex="-1"></a><span class="co"># Convert to probability space for easier interpretation</span></span>
<span id="cb376-6"><a href="mixture-models.html#cb376-6" tabindex="-1"></a>agent_rates_prob <span class="ot">&lt;-</span> <span class="fu">plogis</span>(agent_rates)</span>
<span id="cb376-7"><a href="mixture-models.html#cb376-7" tabindex="-1"></a>agent_noises_prob <span class="ot">&lt;-</span> <span class="fu">plogis</span>(agent_noises)</span>
<span id="cb376-8"><a href="mixture-models.html#cb376-8" tabindex="-1"></a></span>
<span id="cb376-9"><a href="mixture-models.html#cb376-9" tabindex="-1"></a><span class="co"># Generate choice data</span></span>
<span id="cb376-10"><a href="mixture-models.html#cb376-10" tabindex="-1"></a>generate_agent_data <span class="ot">&lt;-</span> <span class="cf">function</span>(agent_id, rate, noise, n_trials) {</span>
<span id="cb376-11"><a href="mixture-models.html#cb376-11" tabindex="-1"></a>  <span class="co"># Convert parameters to probability space</span></span>
<span id="cb376-12"><a href="mixture-models.html#cb376-12" tabindex="-1"></a>  rate_p <span class="ot">&lt;-</span> <span class="fu">plogis</span>(rate)</span>
<span id="cb376-13"><a href="mixture-models.html#cb376-13" tabindex="-1"></a>  noise_p <span class="ot">&lt;-</span> <span class="fu">plogis</span>(noise)</span>
<span id="cb376-14"><a href="mixture-models.html#cb376-14" tabindex="-1"></a>  </span>
<span id="cb376-15"><a href="mixture-models.html#cb376-15" tabindex="-1"></a>  <span class="co"># Initialize vectors</span></span>
<span id="cb376-16"><a href="mixture-models.html#cb376-16" tabindex="-1"></a>  choices <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_trials)</span>
<span id="cb376-17"><a href="mixture-models.html#cb376-17" tabindex="-1"></a>  components <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_trials)  <span class="co"># 0 = biased, 1 = random</span></span>
<span id="cb376-18"><a href="mixture-models.html#cb376-18" tabindex="-1"></a>  </span>
<span id="cb376-19"><a href="mixture-models.html#cb376-19" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_trials) {</span>
<span id="cb376-20"><a href="mixture-models.html#cb376-20" tabindex="-1"></a>    <span class="co"># Determine which component generates this choice</span></span>
<span id="cb376-21"><a href="mixture-models.html#cb376-21" tabindex="-1"></a>    component <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise_p)</span>
<span id="cb376-22"><a href="mixture-models.html#cb376-22" tabindex="-1"></a>    components[t] <span class="ot">&lt;-</span> component</span>
<span id="cb376-23"><a href="mixture-models.html#cb376-23" tabindex="-1"></a>    </span>
<span id="cb376-24"><a href="mixture-models.html#cb376-24" tabindex="-1"></a>    <span class="cf">if</span> (component <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb376-25"><a href="mixture-models.html#cb376-25" tabindex="-1"></a>      <span class="co"># Random component (0.5 probability)</span></span>
<span id="cb376-26"><a href="mixture-models.html#cb376-26" tabindex="-1"></a>      choices[t] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb376-27"><a href="mixture-models.html#cb376-27" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb376-28"><a href="mixture-models.html#cb376-28" tabindex="-1"></a>      <span class="co"># Biased component</span></span>
<span id="cb376-29"><a href="mixture-models.html#cb376-29" tabindex="-1"></a>      choices[t] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, rate_p)</span>
<span id="cb376-30"><a href="mixture-models.html#cb376-30" tabindex="-1"></a>    }</span>
<span id="cb376-31"><a href="mixture-models.html#cb376-31" tabindex="-1"></a>  }</span>
<span id="cb376-32"><a href="mixture-models.html#cb376-32" tabindex="-1"></a>  </span>
<span id="cb376-33"><a href="mixture-models.html#cb376-33" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">tibble</span>(</span>
<span id="cb376-34"><a href="mixture-models.html#cb376-34" tabindex="-1"></a>    <span class="at">agent =</span> agent_id,</span>
<span id="cb376-35"><a href="mixture-models.html#cb376-35" tabindex="-1"></a>    <span class="at">trial =</span> <span class="dv">1</span><span class="sc">:</span>n_trials,</span>
<span id="cb376-36"><a href="mixture-models.html#cb376-36" tabindex="-1"></a>    <span class="at">choice =</span> choices,</span>
<span id="cb376-37"><a href="mixture-models.html#cb376-37" tabindex="-1"></a>    <span class="at">component =</span> components,</span>
<span id="cb376-38"><a href="mixture-models.html#cb376-38" tabindex="-1"></a>    <span class="at">true_rate =</span> rate,</span>
<span id="cb376-39"><a href="mixture-models.html#cb376-39" tabindex="-1"></a>    <span class="at">true_rate_prob =</span> rate_p,</span>
<span id="cb376-40"><a href="mixture-models.html#cb376-40" tabindex="-1"></a>    <span class="at">true_noise =</span> noise,</span>
<span id="cb376-41"><a href="mixture-models.html#cb376-41" tabindex="-1"></a>    <span class="at">true_noise_prob =</span> noise_p</span>
<span id="cb376-42"><a href="mixture-models.html#cb376-42" tabindex="-1"></a>  ))</span>
<span id="cb376-43"><a href="mixture-models.html#cb376-43" tabindex="-1"></a>}</span>
<span id="cb376-44"><a href="mixture-models.html#cb376-44" tabindex="-1"></a></span>
<span id="cb376-45"><a href="mixture-models.html#cb376-45" tabindex="-1"></a><span class="co"># Generate data for all agents</span></span>
<span id="cb376-46"><a href="mixture-models.html#cb376-46" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="dv">1</span><span class="sc">:</span>agents, <span class="cf">function</span>(id) {</span>
<span id="cb376-47"><a href="mixture-models.html#cb376-47" tabindex="-1"></a>  <span class="fu">generate_agent_data</span>(</span>
<span id="cb376-48"><a href="mixture-models.html#cb376-48" tabindex="-1"></a>    <span class="at">agent_id =</span> id,</span>
<span id="cb376-49"><a href="mixture-models.html#cb376-49" tabindex="-1"></a>    <span class="at">rate =</span> agent_rates[id],</span>
<span id="cb376-50"><a href="mixture-models.html#cb376-50" tabindex="-1"></a>    <span class="at">noise =</span> agent_noises[id],</span>
<span id="cb376-51"><a href="mixture-models.html#cb376-51" tabindex="-1"></a>    <span class="at">n_trials =</span> trials</span>
<span id="cb376-52"><a href="mixture-models.html#cb376-52" tabindex="-1"></a>  )</span>
<span id="cb376-53"><a href="mixture-models.html#cb376-53" tabindex="-1"></a>})</span>
<span id="cb376-54"><a href="mixture-models.html#cb376-54" tabindex="-1"></a></span>
<span id="cb376-55"><a href="mixture-models.html#cb376-55" tabindex="-1"></a><span class="co"># Create matrix where columns are agents, rows are trials</span></span>
<span id="cb376-56"><a href="mixture-models.html#cb376-56" tabindex="-1"></a>h_matrix <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb376-57"><a href="mixture-models.html#cb376-57" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(agent, trial, choice) <span class="sc">%&gt;%</span></span>
<span id="cb376-58"><a href="mixture-models.html#cb376-58" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb376-59"><a href="mixture-models.html#cb376-59" tabindex="-1"></a>    <span class="at">names_from =</span> agent,</span>
<span id="cb376-60"><a href="mixture-models.html#cb376-60" tabindex="-1"></a>    <span class="at">values_from =</span> choice</span>
<span id="cb376-61"><a href="mixture-models.html#cb376-61" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb376-62"><a href="mixture-models.html#cb376-62" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>trial) <span class="sc">%&gt;%</span></span>
<span id="cb376-63"><a href="mixture-models.html#cb376-63" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb376-64"><a href="mixture-models.html#cb376-64" tabindex="-1"></a></span>
<span id="cb376-65"><a href="mixture-models.html#cb376-65" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb376-66"><a href="mixture-models.html#cb376-66" tabindex="-1"></a>agent_summary <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb376-67"><a href="mixture-models.html#cb376-67" tabindex="-1"></a>  <span class="fu">group_by</span>(agent, true_rate_prob, true_noise_prob) <span class="sc">%&gt;%</span></span>
<span id="cb376-68"><a href="mixture-models.html#cb376-68" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb376-69"><a href="mixture-models.html#cb376-69" tabindex="-1"></a>    <span class="at">mean_choice =</span> <span class="fu">mean</span>(choice),</span>
<span id="cb376-70"><a href="mixture-models.html#cb376-70" tabindex="-1"></a>    <span class="at">prop_component_1 =</span> <span class="fu">mean</span>(component),</span>
<span id="cb376-71"><a href="mixture-models.html#cb376-71" tabindex="-1"></a>    <span class="at">n_trials =</span> <span class="fu">n</span>()</span>
<span id="cb376-72"><a href="mixture-models.html#cb376-72" tabindex="-1"></a>  )</span>
<span id="cb376-73"><a href="mixture-models.html#cb376-73" tabindex="-1"></a></span>
<span id="cb376-74"><a href="mixture-models.html#cb376-74" tabindex="-1"></a><span class="co"># Prepare data for Stan</span></span>
<span id="cb376-75"><a href="mixture-models.html#cb376-75" tabindex="-1"></a>data_multilevel <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb376-76"><a href="mixture-models.html#cb376-76" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb376-77"><a href="mixture-models.html#cb376-77" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb376-78"><a href="mixture-models.html#cb376-78" tabindex="-1"></a>  <span class="at">h =</span> h_matrix</span>
<span id="cb376-79"><a href="mixture-models.html#cb376-79" tabindex="-1"></a>)</span>
<span id="cb376-80"><a href="mixture-models.html#cb376-80" tabindex="-1"></a></span>
<span id="cb376-81"><a href="mixture-models.html#cb376-81" tabindex="-1"></a><span class="co"># Verify the dimensions of the matrix</span></span>
<span id="cb376-82"><a href="mixture-models.html#cb376-82" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Matrix dimensions (trials Ã— agents):&quot;</span>, <span class="fu">paste</span>(<span class="fu">dim</span>(h_matrix), <span class="at">collapse =</span> <span class="st">&quot; Ã— &quot;</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;Matrix dimensions (trials Ã— agents): 120 Ã— 20&quot;</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="mixture-models.html#cb378-1" tabindex="-1"></a><span class="co"># Display summary of agent parameters</span></span>
<span id="cb378-2"><a href="mixture-models.html#cb378-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Agent parameters summary:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Agent parameters summary:</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="mixture-models.html#cb380-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(agent_summary))</span></code></pre></div>
<pre><code>##      agent       true_rate_prob   true_noise_prob    mean_choice     prop_component_1 
##  Min.   : 1.00   Min.   :0.5509   Min.   :0.04604   Min.   :0.6083   Min.   :0.02500  
##  1st Qu.: 5.75   1st Qu.:0.7596   1st Qu.:0.08461   1st Qu.:0.7375   1st Qu.:0.06458  
##  Median :10.50   Median :0.8088   Median :0.12743   Median :0.8083   Median :0.12083  
##  Mean   :10.50   Mean   :0.7952   Mean   :0.13278   Mean   :0.7771   Mean   :0.12500  
##  3rd Qu.:15.25   3rd Qu.:0.8562   3rd Qu.:0.19007   3rd Qu.:0.8187   3rd Qu.:0.16042  
##  Max.   :20.00   Max.   :0.9287   Max.   :0.24944   Max.   :0.8750   Max.   :0.30000  
##     n_trials  
##  Min.   :120  
##  1st Qu.:120  
##  Median :120  
##  Mean   :120  
##  3rd Qu.:120  
##  Max.   :120</code></pre>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="mixture-models.html#cb382-1" tabindex="-1"></a><span class="co"># Plot agent-level parameters</span></span>
<span id="cb382-2"><a href="mixture-models.html#cb382-2" tabindex="-1"></a><span class="fu">ggplot</span>(agent_summary, <span class="fu">aes</span>(<span class="at">x =</span> true_rate_prob, <span class="at">y =</span> true_noise_prob)) <span class="sc">+</span></span>
<span id="cb382-3"><a href="mixture-models.html#cb382-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb382-4"><a href="mixture-models.html#cb382-4" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> agent), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">vjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb382-5"><a href="mixture-models.html#cb382-5" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb382-6"><a href="mixture-models.html#cb382-6" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;True Agent Parameters&quot;</span>,</span>
<span id="cb382-7"><a href="mixture-models.html#cb382-7" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Each point represents one agent&quot;</span>,</span>
<span id="cb382-8"><a href="mixture-models.html#cb382-8" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Rate (probability of choosing right when using biased component)&quot;</span>,</span>
<span id="cb382-9"><a href="mixture-models.html#cb382-9" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Noise (probability of using random component)&quot;</span>,</span>
<span id="cb382-10"><a href="mixture-models.html#cb382-10" tabindex="-1"></a>    <span class="at">size =</span> <span class="st">&quot;Mean Choice&quot;</span></span>
<span id="cb382-11"><a href="mixture-models.html#cb382-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb382-12"><a href="mixture-models.html#cb382-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-48-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="mixture-models.html#cb383-1" tabindex="-1"></a><span class="co"># Plot choice patterns for a few selected agents</span></span>
<span id="cb383-2"><a href="mixture-models.html#cb383-2" tabindex="-1"></a>selected_agents <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)</span>
<span id="cb383-3"><a href="mixture-models.html#cb383-3" tabindex="-1"></a>d_selected <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(agent <span class="sc">%in%</span> selected_agents)</span>
<span id="cb383-4"><a href="mixture-models.html#cb383-4" tabindex="-1"></a></span>
<span id="cb383-5"><a href="mixture-models.html#cb383-5" tabindex="-1"></a><span class="fu">ggplot</span>(d_selected, <span class="fu">aes</span>(<span class="at">x =</span> trial, <span class="at">y =</span> choice, <span class="at">color =</span> <span class="fu">factor</span>(agent))) <span class="sc">+</span></span>
<span id="cb383-6"><a href="mixture-models.html#cb383-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb383-7"><a href="mixture-models.html#cb383-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">factor</span>(component)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb383-8"><a href="mixture-models.html#cb383-8" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">4</span>), </span>
<span id="cb383-9"><a href="mixture-models.html#cb383-9" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Biased&quot;</span>, <span class="st">&quot;Random&quot;</span>),</span>
<span id="cb383-10"><a href="mixture-models.html#cb383-10" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&quot;Component&quot;</span>) <span class="sc">+</span></span>
<span id="cb383-11"><a href="mixture-models.html#cb383-11" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb383-12"><a href="mixture-models.html#cb383-12" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Choice Patterns for Selected Agents&quot;</span>,</span>
<span id="cb383-13"><a href="mixture-models.html#cb383-13" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Circles = biased component, X = random component&quot;</span>,</span>
<span id="cb383-14"><a href="mixture-models.html#cb383-14" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Trial&quot;</span>,</span>
<span id="cb383-15"><a href="mixture-models.html#cb383-15" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Choice (0/1)&quot;</span>,</span>
<span id="cb383-16"><a href="mixture-models.html#cb383-16" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Agent&quot;</span></span>
<span id="cb383-17"><a href="mixture-models.html#cb383-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb383-18"><a href="mixture-models.html#cb383-18" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb383-19"><a href="mixture-models.html#cb383-19" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>agent, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-48-2.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="fitting-and-evaluating-the-multilevel-model" class="section level3 hasAnchor" number="9.5.3">
<h3><span class="header-section-number">9.5.3</span> Fitting and Evaluating the Multilevel Model<a href="mixture-models.html#fitting-and-evaluating-the-multilevel-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="mixture-models.html#cb384-1" tabindex="-1"></a><span class="co"># File path for saved multilevel model results</span></span>
<span id="cb384-2"><a href="mixture-models.html#cb384-2" tabindex="-1"></a>multilevel_model_file <span class="ot">&lt;-</span> <span class="st">&quot;simmodels/W8_multimixture.RDS&quot;</span></span>
<span id="cb384-3"><a href="mixture-models.html#cb384-3" tabindex="-1"></a></span>
<span id="cb384-4"><a href="mixture-models.html#cb384-4" tabindex="-1"></a><span class="co"># Check if we need to rerun the simulation</span></span>
<span id="cb384-5"><a href="mixture-models.html#cb384-5" tabindex="-1"></a><span class="cf">if</span> (regenerate_simulations <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(multilevel_model_file)) {</span>
<span id="cb384-6"><a href="mixture-models.html#cb384-6" tabindex="-1"></a>  <span class="co"># Fit the multilevel model</span></span>
<span id="cb384-7"><a href="mixture-models.html#cb384-7" tabindex="-1"></a>  multilevel_samples <span class="ot">&lt;-</span> mod_multilevel_mixture<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb384-8"><a href="mixture-models.html#cb384-8" tabindex="-1"></a>    <span class="at">data =</span> data_multilevel,</span>
<span id="cb384-9"><a href="mixture-models.html#cb384-9" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb384-10"><a href="mixture-models.html#cb384-10" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb384-11"><a href="mixture-models.html#cb384-11" tabindex="-1"></a>    <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb384-12"><a href="mixture-models.html#cb384-12" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb384-13"><a href="mixture-models.html#cb384-13" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb384-14"><a href="mixture-models.html#cb384-14" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb384-15"><a href="mixture-models.html#cb384-15" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb384-16"><a href="mixture-models.html#cb384-16" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb384-17"><a href="mixture-models.html#cb384-17" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb384-18"><a href="mixture-models.html#cb384-18" tabindex="-1"></a>  )</span>
<span id="cb384-19"><a href="mixture-models.html#cb384-19" tabindex="-1"></a>  </span>
<span id="cb384-20"><a href="mixture-models.html#cb384-20" tabindex="-1"></a>  <span class="co"># Save the results</span></span>
<span id="cb384-21"><a href="mixture-models.html#cb384-21" tabindex="-1"></a>  multilevel_samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> multilevel_model_file)</span>
<span id="cb384-22"><a href="mixture-models.html#cb384-22" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Generated new multilevel model fit and saved to&quot;</span>, multilevel_model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb384-23"><a href="mixture-models.html#cb384-23" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb384-24"><a href="mixture-models.html#cb384-24" tabindex="-1"></a>  <span class="co"># Load existing results</span></span>
<span id="cb384-25"><a href="mixture-models.html#cb384-25" tabindex="-1"></a>  multilevel_samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(multilevel_model_file)</span>
<span id="cb384-26"><a href="mixture-models.html#cb384-26" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Loaded existing multilevel model fit from&quot;</span>, multilevel_model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb384-27"><a href="mixture-models.html#cb384-27" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup)</code></pre>
<pre><code>## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 12.1 seconds.
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 14.0 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 13.0 seconds.
## Total execution time: 14.3 seconds.
## 
## Generated new multilevel model fit and saved to simmodels/W8_multimixture.RDS</code></pre>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="mixture-models.html#cb387-1" tabindex="-1"></a><span class="co"># Summary of population-level parameters</span></span>
<span id="cb387-2"><a href="mixture-models.html#cb387-2" tabindex="-1"></a>summary_ml <span class="ot">&lt;-</span> multilevel_samples<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;bias_mean&quot;</span>, <span class="st">&quot;noise_mean&quot;</span>, <span class="st">&quot;bias_noise_corr&quot;</span>))</span>
<span id="cb387-3"><a href="mixture-models.html#cb387-3" tabindex="-1"></a><span class="fu">print</span>(summary_ml)</span></code></pre></div>
<pre><code>## # A tibble: 3 Ã— 10
##   variable            mean  median     sd    mad      q5   q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 bias_mean        0.782   0.783   0.0152 0.0148  0.756  0.805  1.00    1643.    2204.
## 2 noise_mean       0.159   0.153   0.0538 0.0522  0.0823 0.257  1.00    4433.    2085.
## 3 bias_noise_corr -0.00263 0.00248 0.444  0.512  -0.721  0.715  1.00    5316.    2615.</code></pre>
</div>
<div id="examining-individual-differences" class="section level3 hasAnchor" number="9.5.4">
<h3><span class="header-section-number">9.5.4</span> Examining Individual Differences<a href="mixture-models.html#examining-individual-differences" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The multilevel mixture model allows us to examine individual differences in both bias and mixture weights:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="mixture-models.html#cb389-1" tabindex="-1"></a><span class="co"># Extract draws for individual parameters</span></span>
<span id="cb389-2"><a href="mixture-models.html#cb389-2" tabindex="-1"></a>draws_ml <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(multilevel_samples<span class="sc">$</span><span class="fu">draws</span>())</span>
<span id="cb389-3"><a href="mixture-models.html#cb389-3" tabindex="-1"></a></span>
<span id="cb389-4"><a href="mixture-models.html#cb389-4" tabindex="-1"></a><span class="co"># First, we need to extract all the necessary parameters</span></span>
<span id="cb389-5"><a href="mixture-models.html#cb389-5" tabindex="-1"></a><span class="co"># Population-level parameters</span></span>
<span id="cb389-6"><a href="mixture-models.html#cb389-6" tabindex="-1"></a>biasM <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws_ml<span class="sc">$</span>biasM)</span>
<span id="cb389-7"><a href="mixture-models.html#cb389-7" tabindex="-1"></a>noiseM <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws_ml<span class="sc">$</span>noiseM)</span>
<span id="cb389-8"><a href="mixture-models.html#cb389-8" tabindex="-1"></a>tau1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws_ml<span class="sc">$</span><span class="st">`</span><span class="at">tau[1]</span><span class="st">`</span>)</span>
<span id="cb389-9"><a href="mixture-models.html#cb389-9" tabindex="-1"></a>tau2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws_ml<span class="sc">$</span><span class="st">`</span><span class="at">tau[2]</span><span class="st">`</span>)</span>
<span id="cb389-10"><a href="mixture-models.html#cb389-10" tabindex="-1"></a></span>
<span id="cb389-11"><a href="mixture-models.html#cb389-11" tabindex="-1"></a><span class="co"># Create a dataframe to store the individual parameters</span></span>
<span id="cb389-12"><a href="mixture-models.html#cb389-12" tabindex="-1"></a>individual_params <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb389-13"><a href="mixture-models.html#cb389-13" tabindex="-1"></a>  <span class="at">agent =</span> <span class="dv">1</span><span class="sc">:</span>data_multilevel<span class="sc">$</span>agents,</span>
<span id="cb389-14"><a href="mixture-models.html#cb389-14" tabindex="-1"></a>  <span class="at">bias =</span> <span class="fu">numeric</span>(data_multilevel<span class="sc">$</span>agents),</span>
<span id="cb389-15"><a href="mixture-models.html#cb389-15" tabindex="-1"></a>  <span class="at">noise =</span> <span class="fu">numeric</span>(data_multilevel<span class="sc">$</span>agents)</span>
<span id="cb389-16"><a href="mixture-models.html#cb389-16" tabindex="-1"></a>)</span>
<span id="cb389-17"><a href="mixture-models.html#cb389-17" tabindex="-1"></a></span>
<span id="cb389-18"><a href="mixture-models.html#cb389-18" tabindex="-1"></a><span class="co"># Loop through agents to extract and transform z_IDs to actual parameter values</span></span>
<span id="cb389-19"><a href="mixture-models.html#cb389-19" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>data_multilevel<span class="sc">$</span>agents) {</span>
<span id="cb389-20"><a href="mixture-models.html#cb389-20" tabindex="-1"></a>  <span class="co"># Extract the z-scores for this agent</span></span>
<span id="cb389-21"><a href="mixture-models.html#cb389-21" tabindex="-1"></a>  z1_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;z_IDs[1,&quot;</span>, i, <span class="st">&quot;]&quot;</span>)</span>
<span id="cb389-22"><a href="mixture-models.html#cb389-22" tabindex="-1"></a>  z2_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;z_IDs[2,&quot;</span>, i, <span class="st">&quot;]&quot;</span>)</span>
<span id="cb389-23"><a href="mixture-models.html#cb389-23" tabindex="-1"></a>  </span>
<span id="cb389-24"><a href="mixture-models.html#cb389-24" tabindex="-1"></a>  <span class="co"># Calculate bias and noise based on the multilevel structure</span></span>
<span id="cb389-25"><a href="mixture-models.html#cb389-25" tabindex="-1"></a>  <span class="co"># Note: This assumes the model uses z-scores to represent deviations from population means</span></span>
<span id="cb389-26"><a href="mixture-models.html#cb389-26" tabindex="-1"></a>  z1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws_ml[[z1_name]])</span>
<span id="cb389-27"><a href="mixture-models.html#cb389-27" tabindex="-1"></a>  z2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws_ml[[z2_name]])</span>
<span id="cb389-28"><a href="mixture-models.html#cb389-28" tabindex="-1"></a>  </span>
<span id="cb389-29"><a href="mixture-models.html#cb389-29" tabindex="-1"></a>  <span class="co"># Transform back to original scale</span></span>
<span id="cb389-30"><a href="mixture-models.html#cb389-30" tabindex="-1"></a>  individual_params<span class="sc">$</span>bias[i] <span class="ot">&lt;-</span> <span class="fu">plogis</span>(biasM <span class="sc">+</span> z1 <span class="sc">*</span> tau1)  <span class="co"># Convert to probability scale</span></span>
<span id="cb389-31"><a href="mixture-models.html#cb389-31" tabindex="-1"></a>  individual_params<span class="sc">$</span>noise[i] <span class="ot">&lt;-</span> <span class="fu">plogis</span>(noiseM <span class="sc">+</span> z2 <span class="sc">*</span> tau2)  <span class="co"># Convert to probability scale</span></span>
<span id="cb389-32"><a href="mixture-models.html#cb389-32" tabindex="-1"></a>}</span>
<span id="cb389-33"><a href="mixture-models.html#cb389-33" tabindex="-1"></a></span>
<span id="cb389-34"><a href="mixture-models.html#cb389-34" tabindex="-1"></a><span class="co"># Get the true values from our generated data frame &#39;d&#39;</span></span>
<span id="cb389-35"><a href="mixture-models.html#cb389-35" tabindex="-1"></a>true_params <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb389-36"><a href="mixture-models.html#cb389-36" tabindex="-1"></a>  <span class="fu">group_by</span>(agent) <span class="sc">%&gt;%</span></span>
<span id="cb389-37"><a href="mixture-models.html#cb389-37" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb389-38"><a href="mixture-models.html#cb389-38" tabindex="-1"></a>    <span class="at">true_rate =</span> <span class="fu">first</span>(true_rate),</span>
<span id="cb389-39"><a href="mixture-models.html#cb389-39" tabindex="-1"></a>    <span class="at">true_rate_prob =</span> <span class="fu">first</span>(true_rate_prob),</span>
<span id="cb389-40"><a href="mixture-models.html#cb389-40" tabindex="-1"></a>    <span class="at">true_noise =</span> <span class="fu">first</span>(true_noise),</span>
<span id="cb389-41"><a href="mixture-models.html#cb389-41" tabindex="-1"></a>    <span class="at">true_noise_prob =</span> <span class="fu">first</span>(true_noise_prob)</span>
<span id="cb389-42"><a href="mixture-models.html#cb389-42" tabindex="-1"></a>  )</span>
<span id="cb389-43"><a href="mixture-models.html#cb389-43" tabindex="-1"></a></span>
<span id="cb389-44"><a href="mixture-models.html#cb389-44" tabindex="-1"></a><span class="co"># Join with the true parameter values</span></span>
<span id="cb389-45"><a href="mixture-models.html#cb389-45" tabindex="-1"></a>individual_params <span class="ot">&lt;-</span> individual_params <span class="sc">%&gt;%</span></span>
<span id="cb389-46"><a href="mixture-models.html#cb389-46" tabindex="-1"></a>  <span class="fu">left_join</span>(true_params, <span class="at">by =</span> <span class="st">&quot;agent&quot;</span>)</span>
<span id="cb389-47"><a href="mixture-models.html#cb389-47" tabindex="-1"></a></span>
<span id="cb389-48"><a href="mixture-models.html#cb389-48" tabindex="-1"></a><span class="co"># Check the result</span></span>
<span id="cb389-49"><a href="mixture-models.html#cb389-49" tabindex="-1"></a><span class="fu">head</span>(individual_params)</span></code></pre></div>
<pre><code>## # A tibble: 6 Ã— 7
##   agent  bias noise true_rate true_rate_prob true_noise true_noise_prob
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;
## 1     1 0.800 0.151     1.77           0.854      -1.81          0.141 
## 2     2 0.815 0.151     1.85           0.864      -1.47          0.187 
## 3     3 0.758 0.150     1.31           0.788      -2.52          0.0743
## 4     4 0.800 0.150     1.09           0.749      -2.98          0.0485
## 5     5 0.840 0.151     1.78           0.856      -3.00          0.0475
## 6     6 0.709 0.153     0.204          0.551      -1.30          0.215</code></pre>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="mixture-models.html#cb391-1" tabindex="-1"></a><span class="co"># Plot individual parameter estimates</span></span>
<span id="cb391-2"><a href="mixture-models.html#cb391-2" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(individual_params, <span class="fu">aes</span>(<span class="at">x =</span> bias, <span class="at">y =</span> noise)) <span class="sc">+</span></span>
<span id="cb391-3"><a href="mixture-models.html#cb391-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb391-4"><a href="mixture-models.html#cb391-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(draws_ml<span class="sc">$</span>noise_mean), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb391-5"><a href="mixture-models.html#cb391-5" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(draws_ml<span class="sc">$</span>bias_mean), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb391-6"><a href="mixture-models.html#cb391-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Individual Parameter Estimates&quot;</span>,</span>
<span id="cb391-7"><a href="mixture-models.html#cb391-7" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Each point represents one agent&quot;</span>,</span>
<span id="cb391-8"><a href="mixture-models.html#cb391-8" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Bias Parameter (Î¸)&quot;</span>,</span>
<span id="cb391-9"><a href="mixture-models.html#cb391-9" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Noise Parameter (Ï€)&quot;</span>) <span class="sc">+</span></span>
<span id="cb391-10"><a href="mixture-models.html#cb391-10" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb391-11"><a href="mixture-models.html#cb391-11" tabindex="-1"></a></span>
<span id="cb391-12"><a href="mixture-models.html#cb391-12" tabindex="-1"></a><span class="co"># Plot correlation between true and estimated parameters</span></span>
<span id="cb391-13"><a href="mixture-models.html#cb391-13" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(individual_params, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">inv_logit_scaled</span>(true_rate), <span class="at">y =</span> bias)) <span class="sc">+</span></span>
<span id="cb391-14"><a href="mixture-models.html#cb391-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb391-15"><a href="mixture-models.html#cb391-15" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb391-16"><a href="mixture-models.html#cb391-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Parameter Recovery: Bias&quot;</span>,</span>
<span id="cb391-17"><a href="mixture-models.html#cb391-17" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;True vs. estimated bias parameter&quot;</span>,</span>
<span id="cb391-18"><a href="mixture-models.html#cb391-18" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;True Bias&quot;</span>,</span>
<span id="cb391-19"><a href="mixture-models.html#cb391-19" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Estimated Bias&quot;</span>) <span class="sc">+</span></span>
<span id="cb391-20"><a href="mixture-models.html#cb391-20" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb391-21"><a href="mixture-models.html#cb391-21" tabindex="-1"></a></span>
<span id="cb391-22"><a href="mixture-models.html#cb391-22" tabindex="-1"></a><span class="co"># Display plots</span></span>
<span id="cb391-23"><a href="mixture-models.html#cb391-23" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-50-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="mixture-models.html#cb392-1" tabindex="-1"></a>p2</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-50-2.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="interpreting-parameter-correlations" class="section level3 hasAnchor" number="9.5.5">
<h3><span class="header-section-number">9.5.5</span> Interpreting Parameter Correlations<a href="mixture-models.html#interpreting-parameter-correlations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An important advantage of multilevel mixture models is their ability to reveal correlations between parameters across individuals:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="mixture-models.html#cb393-1" tabindex="-1"></a><span class="co"># Visualize correlation between parameters</span></span>
<span id="cb393-2"><a href="mixture-models.html#cb393-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb393-3"><a href="mixture-models.html#cb393-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> draws_ml<span class="sc">$</span>bias_noise_corr), <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb393-4"><a href="mixture-models.html#cb393-4" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb393-5"><a href="mixture-models.html#cb393-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Correlation Between Bias and Noise Parameters&quot;</span>,</span>
<span id="cb393-6"><a href="mixture-models.html#cb393-6" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Population-level correlation across individuals&quot;</span>,</span>
<span id="cb393-7"><a href="mixture-models.html#cb393-7" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Correlation Coefficient&quot;</span>,</span>
<span id="cb393-8"><a href="mixture-models.html#cb393-8" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb393-9"><a href="mixture-models.html#cb393-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-51-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The correlation between bias and noise parameters can provide important insights into cognitive processes. For example, a negative correlation might suggest that individuals with stronger biases tend to have fewer random lapses, while a positive correlation could indicate that strong biases are associated with more exploratory behavior.
However, in the simulation process we did not include any correlation between the bias and noise parameters, so the correlation we observe here is correctly estimated as centered at 0.</p>
</div>
</div>
<div id="comparing-single-process-and-mixture-models" class="section level2 hasAnchor" number="9.6">
<h2><span class="header-section-number">9.6</span> Comparing Single-Process and Mixture Models<a href="mixture-models.html#comparing-single-process-and-mixture-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Finally, letâ€™s compare our mixture model with a single-process alternative to determine which better captures the observed behavior.</p>
<div id="single-process-model" class="section level3 hasAnchor" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> Single-Process Model<a href="mixture-models.html#single-process-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, letâ€™s implement a simple single-process model that assumes all choices come from a biased process:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="mixture-models.html#cb394-1" tabindex="-1"></a><span class="co"># Stan model for single-process biased agent</span></span>
<span id="cb394-2"><a href="mixture-models.html#cb394-2" tabindex="-1"></a>stan_biased_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb394-3"><a href="mixture-models.html#cb394-3" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb394-4"><a href="mixture-models.html#cb394-4" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; n;  // Number of trials</span></span>
<span id="cb394-5"><a href="mixture-models.html#cb394-5" tabindex="-1"></a><span class="st">  array[n] int h;  // Choice data (0/1)</span></span>
<span id="cb394-6"><a href="mixture-models.html#cb394-6" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb394-7"><a href="mixture-models.html#cb394-7" tabindex="-1"></a></span>
<span id="cb394-8"><a href="mixture-models.html#cb394-8" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb394-9"><a href="mixture-models.html#cb394-9" tabindex="-1"></a><span class="st">  real bias;  // Bias parameter (logit scale)</span></span>
<span id="cb394-10"><a href="mixture-models.html#cb394-10" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb394-11"><a href="mixture-models.html#cb394-11" tabindex="-1"></a></span>
<span id="cb394-12"><a href="mixture-models.html#cb394-12" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb394-13"><a href="mixture-models.html#cb394-13" tabindex="-1"></a><span class="st">  // Prior</span></span>
<span id="cb394-14"><a href="mixture-models.html#cb394-14" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | 0, 1);</span></span>
<span id="cb394-15"><a href="mixture-models.html#cb394-15" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb394-16"><a href="mixture-models.html#cb394-16" tabindex="-1"></a><span class="st">  // Likelihood (all choices come from biased process)</span></span>
<span id="cb394-17"><a href="mixture-models.html#cb394-17" tabindex="-1"></a><span class="st">  target += bernoulli_logit_lpmf(h | bias);</span></span>
<span id="cb394-18"><a href="mixture-models.html#cb394-18" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb394-19"><a href="mixture-models.html#cb394-19" tabindex="-1"></a></span>
<span id="cb394-20"><a href="mixture-models.html#cb394-20" tabindex="-1"></a><span class="st">generated quantities {</span></span>
<span id="cb394-21"><a href="mixture-models.html#cb394-21" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; bias_p = inv_logit(bias);  // Bias on probability scale</span></span>
<span id="cb394-22"><a href="mixture-models.html#cb394-22" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb394-23"><a href="mixture-models.html#cb394-23" tabindex="-1"></a><span class="st">  // Log likelihood for model comparison</span></span>
<span id="cb394-24"><a href="mixture-models.html#cb394-24" tabindex="-1"></a><span class="st">  vector[n] log_lik;</span></span>
<span id="cb394-25"><a href="mixture-models.html#cb394-25" tabindex="-1"></a><span class="st">  for (i in 1:n) {</span></span>
<span id="cb394-26"><a href="mixture-models.html#cb394-26" tabindex="-1"></a><span class="st">    log_lik[i] = bernoulli_logit_lpmf(h[i] | bias);</span></span>
<span id="cb394-27"><a href="mixture-models.html#cb394-27" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb394-28"><a href="mixture-models.html#cb394-28" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb394-29"><a href="mixture-models.html#cb394-29" tabindex="-1"></a><span class="st">  // Posterior predictions</span></span>
<span id="cb394-30"><a href="mixture-models.html#cb394-30" tabindex="-1"></a><span class="st">  array[n] int pred_choice;</span></span>
<span id="cb394-31"><a href="mixture-models.html#cb394-31" tabindex="-1"></a><span class="st">  for (i in 1:n) {</span></span>
<span id="cb394-32"><a href="mixture-models.html#cb394-32" tabindex="-1"></a><span class="st">    pred_choice[i] = bernoulli_rng(bias_p);</span></span>
<span id="cb394-33"><a href="mixture-models.html#cb394-33" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb394-34"><a href="mixture-models.html#cb394-34" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb394-35"><a href="mixture-models.html#cb394-35" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb394-36"><a href="mixture-models.html#cb394-36" tabindex="-1"></a></span>
<span id="cb394-37"><a href="mixture-models.html#cb394-37" tabindex="-1"></a><span class="co"># Write the model to a file</span></span>
<span id="cb394-38"><a href="mixture-models.html#cb394-38" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb394-39"><a href="mixture-models.html#cb394-39" tabindex="-1"></a>  stan_biased_model,</span>
<span id="cb394-40"><a href="mixture-models.html#cb394-40" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb394-41"><a href="mixture-models.html#cb394-41" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W8_BiasedSingle.stan&quot;</span></span>
<span id="cb394-42"><a href="mixture-models.html#cb394-42" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W8_BiasedSingle.stan&quot;</code></pre>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="mixture-models.html#cb396-1" tabindex="-1"></a><span class="co"># Compile the model</span></span>
<span id="cb396-2"><a href="mixture-models.html#cb396-2" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W8_BiasedSingle.stan&quot;</span>)</span>
<span id="cb396-3"><a href="mixture-models.html#cb396-3" tabindex="-1"></a>mod_biased <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(</span>
<span id="cb396-4"><a href="mixture-models.html#cb396-4" tabindex="-1"></a>  file, </span>
<span id="cb396-5"><a href="mixture-models.html#cb396-5" tabindex="-1"></a>  <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb396-6"><a href="mixture-models.html#cb396-6" tabindex="-1"></a>  <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>)</span>
<span id="cb396-7"><a href="mixture-models.html#cb396-7" tabindex="-1"></a>)</span>
<span id="cb396-8"><a href="mixture-models.html#cb396-8" tabindex="-1"></a></span>
<span id="cb396-9"><a href="mixture-models.html#cb396-9" tabindex="-1"></a><span class="co"># File path for saved single-process model results</span></span>
<span id="cb396-10"><a href="mixture-models.html#cb396-10" tabindex="-1"></a>biased_model_file <span class="ot">&lt;-</span> <span class="st">&quot;simmodels/W8_biased_single.RDS&quot;</span></span>
<span id="cb396-11"><a href="mixture-models.html#cb396-11" tabindex="-1"></a></span>
<span id="cb396-12"><a href="mixture-models.html#cb396-12" tabindex="-1"></a><span class="co"># Check if we need to rerun the simulation</span></span>
<span id="cb396-13"><a href="mixture-models.html#cb396-13" tabindex="-1"></a><span class="cf">if</span> (regenerate_simulations <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(biased_model_file)) {</span>
<span id="cb396-14"><a href="mixture-models.html#cb396-14" tabindex="-1"></a>  <span class="co"># Fit the single-process model</span></span>
<span id="cb396-15"><a href="mixture-models.html#cb396-15" tabindex="-1"></a>  biased_samples <span class="ot">&lt;-</span> mod_biased<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb396-16"><a href="mixture-models.html#cb396-16" tabindex="-1"></a>    <span class="at">data =</span> data,</span>
<span id="cb396-17"><a href="mixture-models.html#cb396-17" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb396-18"><a href="mixture-models.html#cb396-18" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb396-19"><a href="mixture-models.html#cb396-19" tabindex="-1"></a>    <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb396-20"><a href="mixture-models.html#cb396-20" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb396-21"><a href="mixture-models.html#cb396-21" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb396-22"><a href="mixture-models.html#cb396-22" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb396-23"><a href="mixture-models.html#cb396-23" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb396-24"><a href="mixture-models.html#cb396-24" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb396-25"><a href="mixture-models.html#cb396-25" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb396-26"><a href="mixture-models.html#cb396-26" tabindex="-1"></a>  )</span>
<span id="cb396-27"><a href="mixture-models.html#cb396-27" tabindex="-1"></a>  </span>
<span id="cb396-28"><a href="mixture-models.html#cb396-28" tabindex="-1"></a>  <span class="co"># Save the results</span></span>
<span id="cb396-29"><a href="mixture-models.html#cb396-29" tabindex="-1"></a>  biased_samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> biased_model_file)</span>
<span id="cb396-30"><a href="mixture-models.html#cb396-30" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Generated new single-process model fit and saved to&quot;</span>, biased_model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb396-31"><a href="mixture-models.html#cb396-31" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb396-32"><a href="mixture-models.html#cb396-32" tabindex="-1"></a>  <span class="co"># Load existing results</span></span>
<span id="cb396-33"><a href="mixture-models.html#cb396-33" tabindex="-1"></a>  biased_samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(biased_model_file)</span>
<span id="cb396-34"><a href="mixture-models.html#cb396-34" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Loaded existing single-process model fit from&quot;</span>, biased_model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb396-35"><a href="mixture-models.html#cb396-35" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 finished in 0.1 seconds.
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 0.2 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 0.2 seconds.
## Total execution time: 0.4 seconds.
## 
## Generated new single-process model fit and saved to simmodels/W8_biased_single.RDS</code></pre>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="mixture-models.html#cb398-1" tabindex="-1"></a><span class="co"># Summary of single-process model</span></span>
<span id="cb398-2"><a href="mixture-models.html#cb398-2" tabindex="-1"></a>summary_biased <span class="ot">&lt;-</span> biased_samples<span class="sc">$</span><span class="fu">summary</span>(<span class="st">&quot;bias_p&quot;</span>)</span>
<span id="cb398-3"><a href="mixture-models.html#cb398-3" tabindex="-1"></a><span class="fu">print</span>(summary_biased)</span></code></pre></div>
<pre><code>## # A tibble: 1 Ã— 10
##   variable  mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 bias_p   0.754  0.756 0.0373 0.0386 0.692 0.814  1.00     797.     994.</code></pre>
</div>
<div id="model-comparison" class="section level3 hasAnchor" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> Model Comparison<a href="mixture-models.html#model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now letâ€™s compare the single-process model with our mixture model using leave-one-out cross-validation (LOO-CV):</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="mixture-models.html#cb400-1" tabindex="-1"></a><span class="co"># Calculate LOO for both models</span></span>
<span id="cb400-2"><a href="mixture-models.html#cb400-2" tabindex="-1"></a>loo_mixture <span class="ot">&lt;-</span> samples<span class="sc">$</span><span class="fu">loo</span>()</span>
<span id="cb400-3"><a href="mixture-models.html#cb400-3" tabindex="-1"></a>loo_biased <span class="ot">&lt;-</span> biased_samples<span class="sc">$</span><span class="fu">loo</span>()</span>
<span id="cb400-4"><a href="mixture-models.html#cb400-4" tabindex="-1"></a></span>
<span id="cb400-5"><a href="mixture-models.html#cb400-5" tabindex="-1"></a><span class="co"># Compare models</span></span>
<span id="cb400-6"><a href="mixture-models.html#cb400-6" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(loo_mixture, loo_biased)</span>
<span id="cb400-7"><a href="mixture-models.html#cb400-7" tabindex="-1"></a><span class="fu">print</span>(comparison)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model2  0.0       0.0   
## model1 -1.9       1.5</code></pre>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="mixture-models.html#cb402-1" tabindex="-1"></a><span class="co"># Calculate model weights</span></span>
<span id="cb402-2"><a href="mixture-models.html#cb402-2" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">loo_model_weights</span>(<span class="fu">list</span>(</span>
<span id="cb402-3"><a href="mixture-models.html#cb402-3" tabindex="-1"></a>  <span class="st">&quot;Mixture&quot;</span> <span class="ot">=</span> loo_mixture, </span>
<span id="cb402-4"><a href="mixture-models.html#cb402-4" tabindex="-1"></a>  <span class="st">&quot;Single-Process&quot;</span> <span class="ot">=</span> loo_biased</span>
<span id="cb402-5"><a href="mixture-models.html#cb402-5" tabindex="-1"></a>))</span>
<span id="cb402-6"><a href="mixture-models.html#cb402-6" tabindex="-1"></a><span class="fu">print</span>(weights)</span></code></pre></div>
<pre><code>## Method: stacking
## ------
##                weight
## Mixture        0.000 
## Single-Process 1.000</code></pre>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="mixture-models.html#cb404-1" tabindex="-1"></a><span class="co"># Visualize model comparison</span></span>
<span id="cb404-2"><a href="mixture-models.html#cb404-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">tibble</span>(</span>
<span id="cb404-3"><a href="mixture-models.html#cb404-3" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">names</span>(weights),</span>
<span id="cb404-4"><a href="mixture-models.html#cb404-4" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">as.numeric</span>(weights)</span>
<span id="cb404-5"><a href="mixture-models.html#cb404-5" tabindex="-1"></a>)) <span class="sc">+</span></span>
<span id="cb404-6"><a href="mixture-models.html#cb404-6" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> weight, <span class="at">fill =</span> model), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb404-7"><a href="mixture-models.html#cb404-7" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb404-8"><a href="mixture-models.html#cb404-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Model Comparison via LOO-CV&quot;</span>,</span>
<span id="cb404-9"><a href="mixture-models.html#cb404-9" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Higher weights indicate better predictive performance&quot;</span>,</span>
<span id="cb404-10"><a href="mixture-models.html#cb404-10" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb404-11"><a href="mixture-models.html#cb404-11" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Model Weight&quot;</span>) <span class="sc">+</span></span>
<span id="cb404-12"><a href="mixture-models.html#cb404-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb404-13"><a href="mixture-models.html#cb404-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb404-14"><a href="mixture-models.html#cb404-14" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> weight <span class="sc">+</span> <span class="fl">0.05</span>, </span>
<span id="cb404-15"><a href="mixture-models.html#cb404-15" tabindex="-1"></a>                <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(weight, <span class="at">accuracy =</span> <span class="fl">0.1</span>)))</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-53-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Based on the model comparison, the single model appears to better capture the data-generating process than the single-process alternative. This might seem counterintuitive, but it highlights that predictive performance is not necessarily the best way of choosing your model.
What happens here is that a combination of two binomials can be mathematically reduced to a single binomial (in this case with a lower rate that the biased component). This is why the single-process model performs better in terms of LOO-CV, even though the mixture model is more realistic and provides a richer interpretation of the data. Theory should guide you in this case.</p>
</div>
<div id="applications-of-mixture-models-in-cognitive-science" class="section level3 hasAnchor" number="9.6.3">
<h3><span class="header-section-number">9.6.3</span> Applications of Mixture Models in Cognitive Science<a href="mixture-models.html#applications-of-mixture-models-in-cognitive-science" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Mixture models have found numerous applications in cognitive science. Here are a few examples that highlight their versatility:</p>
<ul>
<li><p>Attention and Vigilance: Modeling attentional lapses during sustained attention tasks as a mixture of focused and random responses.</p></li>
<li><p>Memory: Representing recognition memory as a mixture of more implicit familiarity and more explicit recollection processes, each with distinct characteristics.</p></li>
</ul>
<p>*Decision Making: Modeling economic choices as combinations of heuristic and deliberative processes, with the proportion varying based on task demands.</p>
<ul>
<li><p>Learning: Capturing the transition from rule-based to automatic processing during skill acquisition, with the mixture weights shifting over time.</p></li>
<li><p>Individual Differences: Identifying subgroups of participants who employ qualitatively different strategies to solve the same task.</p></li>
</ul>
</div>
</div>
<div id="conclusion-2" class="section level2 hasAnchor" number="9.7">
<h2><span class="header-section-number">9.7</span> Conclusion<a href="mixture-models.html#conclusion-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Mixture models represent a crucial step forward in our cognitive modeling toolkit, allowing us to capture the complexity and variability inherent in human behavior. Through this chapter, weâ€™ve seen how combining multiple cognitive strategies within a single model can provide richer and more realistic accounts of decision-making processes.</p>
<p>Several key insights emerge from our exploration of mixture models:</p>
<ul>
<li><p>Beyond Single-Process Simplifications: Mixture models allow us to move beyond the false choice between oversimplified single-strategy models and intractably complex specifications. By combining a small number of interpretable components, we can capture substantial behavioral complexity while maintaining mathematical and computational tractability.</p></li>
<li><p>Bayesian Implementation: The Bayesian implementation of mixture models in Stan provides powerful tools for inference. We can estimate not only the parameters of different cognitive strategies but also their relative contributions to behavior and how they might vary across individuals.</p></li>
<li><p>Model Validation: Mixture models require careful attention to identifiability and validation. Through parameter recovery studies and posterior predictive checks, weâ€™ve seen how to verify that our specifications can reliably recover true parameter values and generate realistic behavioral patterns.</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-comparison-in-cognitive-science.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/08-MixtureModels.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
