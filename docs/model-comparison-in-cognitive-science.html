<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Model Comparison in Cognitive Science | 08-MixtureModels</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2025" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Model Comparison in Cognitive Science | 08-MixtureModels" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2025" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Model Comparison in Cognitive Science | 08-MixtureModels" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2025" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2025-03-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="individual-differences-in-cognitive-strategies-multilevel-modeling.html"/>
<link rel="next" href="mixture-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-philosophy-and-approach"><i class="fa fa-check"></i><b>1.1</b> Course Philosophy and Approach</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#course-structure-and-learning-path"><i class="fa fa-check"></i><b>1.2</b> Course Structure and Learning Path</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#prerequisites-and-preparation"><i class="fa fa-check"></i><b>1.3</b> Prerequisites and Preparation</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#course-resources"><i class="fa fa-check"></i><b>1.4</b> Course Resources</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#about-these-notes"><i class="fa fa-check"></i><b>1.5</b> About These Notes</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="foundations.html"><a href="foundations.html"><i class="fa fa-check"></i><b>2</b> Foundations</a>
<ul>
<li class="chapter" data-level="2.1" data-path="foundations.html"><a href="foundations.html#from-pizza-to-cognitive-models-an-introduction"><i class="fa fa-check"></i><b>2.1</b> From Pizza to Cognitive Models: An Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="foundations.html"><a href="foundations.html#why-start-with-pizza"><i class="fa fa-check"></i><b>2.2</b> Why Start with Pizza?</a></li>
<li class="chapter" data-level="2.3" data-path="foundations.html"><a href="foundations.html#learning-objectives"><i class="fa fa-check"></i><b>2.3</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.4" data-path="foundations.html"><a href="foundations.html#part-1-exploring-the-pizza-stone-temperature-data"><i class="fa fa-check"></i><b>2.4</b> Part 1: Exploring the Pizza Stone Temperature Data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="foundations.html"><a href="foundations.html#initial-data-visualization"><i class="fa fa-check"></i><b>2.4.1</b> Initial Data Visualization</a></li>
<li class="chapter" data-level="2.4.2" data-path="foundations.html"><a href="foundations.html#key-observations"><i class="fa fa-check"></i><b>2.4.2</b> Key Observations</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="foundations.html"><a href="foundations.html#part-2-initial-statistical-modeling"><i class="fa fa-check"></i><b>2.5</b> Part 2: Initial Statistical Modeling</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="foundations.html"><a href="foundations.html#model-setup-and-priors"><i class="fa fa-check"></i><b>2.5.1</b> Model Setup and Priors</a></li>
<li class="chapter" data-level="2.5.2" data-path="foundations.html"><a href="foundations.html#linear-mixed-effects-model"><i class="fa fa-check"></i><b>2.5.2</b> Linear Mixed-Effects Model</a></li>
<li class="chapter" data-level="2.5.3" data-path="foundations.html"><a href="foundations.html#lognormal-mixed-effects-model"><i class="fa fa-check"></i><b>2.5.3</b> Lognormal Mixed-Effects Model</a></li>
<li class="chapter" data-level="2.5.4" data-path="foundations.html"><a href="foundations.html#model-comparison-and-visualization"><i class="fa fa-check"></i><b>2.5.4</b> Model Comparison and Visualization</a></li>
<li class="chapter" data-level="2.5.5" data-path="foundations.html"><a href="foundations.html#model-assessment"><i class="fa fa-check"></i><b>2.5.5</b> Model Assessment</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="foundations.html"><a href="foundations.html#part-3-understanding-the-physics-model"><i class="fa fa-check"></i><b>2.6</b> Part 3: Understanding the Physics Model</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="foundations.html"><a href="foundations.html#the-basic-temperature-evolution-equation"><i class="fa fa-check"></i><b>2.6.1</b> The Basic Temperature Evolution Equation</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="foundations.html"><a href="foundations.html#part-4-implementing-the-physics-based-model"><i class="fa fa-check"></i><b>2.7</b> Part 4: Implementing the Physics-Based Model</a></li>
<li class="chapter" data-level="2.8" data-path="foundations.html"><a href="foundations.html#part-5-model-analysis-and-practical-applications"><i class="fa fa-check"></i><b>2.8</b> Part 5: Model Analysis and Practical Applications</a></li>
<li class="chapter" data-level="2.9" data-path="foundations.html"><a href="foundations.html#conclusion-from-pizza-to-principles"><i class="fa fa-check"></i><b>2.9</b> Conclusion: From Pizza to Principles</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html"><i class="fa fa-check"></i><b>3</b> Building Models of Strategic Decision-Making</a>
<ul>
<li class="chapter" data-level="3.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#learning-goals"><i class="fa fa-check"></i><b>3.1</b> Learning goals</a></li>
<li class="chapter" data-level="3.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#introduction"><i class="fa fa-check"></i><b>3.2</b> Introduction</a></li>
<li class="chapter" data-level="3.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#the-matching-pennies-game"><i class="fa fa-check"></i><b>3.3</b> The Matching Pennies Game</a></li>
<li class="chapter" data-level="3.4" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#game-structure"><i class="fa fa-check"></i><b>3.4</b> Game Structure</a></li>
<li class="chapter" data-level="3.5" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#empirical-investigation"><i class="fa fa-check"></i><b>3.5</b> Empirical Investigation</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#data-collection-protocol"><i class="fa fa-check"></i><b>3.5.1</b> Data Collection Protocol</a></li>
<li class="chapter" data-level="3.5.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#initial-observations"><i class="fa fa-check"></i><b>3.5.2</b> Initial Observations</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#empirical-explorations"><i class="fa fa-check"></i><b>3.6</b> Empirical explorations</a></li>
<li class="chapter" data-level="3.7" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#notes-from-previous-years"><i class="fa fa-check"></i><b>3.7</b> Notes from previous years</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#from-observation-to-theory"><i class="fa fa-check"></i><b>3.7.1</b> From Observation to Theory</a></li>
<li class="chapter" data-level="3.7.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#core-modeling-considerations"><i class="fa fa-check"></i><b>3.7.2</b> Core Modeling Considerations</a></li>
<li class="chapter" data-level="3.7.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>3.7.3</b> The distinction between participant and researcher perspectives</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#building-formal-models"><i class="fa fa-check"></i><b>3.8</b> Building Formal Models</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#random-choice-model"><i class="fa fa-check"></i><b>3.8.1</b> Random Choice Model</a></li>
<li class="chapter" data-level="3.8.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#immediate-reaction-win-stay-lose-shift"><i class="fa fa-check"></i><b>3.8.2</b> Immediate reaction (Win-Stay-Lose-Shift)</a></li>
<li class="chapter" data-level="3.8.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>3.8.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="3.8.4" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>3.8.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="3.8.5" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#reinforcement-learning"><i class="fa fa-check"></i><b>3.8.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="3.8.6" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#k-tom"><i class="fa fa-check"></i><b>3.8.6</b> k-ToM</a></li>
<li class="chapter" data-level="3.8.7" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#other-possible-strategies"><i class="fa fa-check"></i><b>3.8.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#cognitive-constraints"><i class="fa fa-check"></i><b>3.9</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#memory"><i class="fa fa-check"></i><b>3.9.1</b> Memory</a></li>
<li class="chapter" data-level="3.9.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#perseveration"><i class="fa fa-check"></i><b>3.9.2</b> Perseveration</a></li>
<li class="chapter" data-level="3.9.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#errors"><i class="fa fa-check"></i><b>3.9.3</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#continuity-between-models"><i class="fa fa-check"></i><b>3.10</b> Continuity between models</a></li>
<li class="chapter" data-level="3.11" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#mixture-of-strategies"><i class="fa fa-check"></i><b>3.11</b> Mixture of strategies</a></li>
<li class="chapter" data-level="3.12" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#differences-from-more-traditional-general-linear-model-based-approaches"><i class="fa fa-check"></i><b>3.12</b> Differences from more traditional (general linear model-based) approaches</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html"><i class="fa fa-check"></i><b>4</b> From verbal descriptions to formal models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#learning-goals-1"><i class="fa fa-check"></i><b>4.1</b> Learning Goals</a></li>
<li class="chapter" data-level="4.2" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#the-value-of-formalization"><i class="fa fa-check"></i><b>4.2</b> The Value of Formalization</a></li>
<li class="chapter" data-level="4.3" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>4.3</b> Defining general conditions</a></li>
<li class="chapter" data-level="4.4" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>4.4</b> Implementing a random agent</a></li>
<li class="chapter" data-level="4.5" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>4.5</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="4.6" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>4.6</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>4.6.1</b> And we visualize it</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#conclusion"><i class="fa fa-check"></i><b>4.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html"><i class="fa fa-check"></i><b>5</b> From simulation to model fitting</a>
<ul>
<li class="chapter" data-level="5.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#learning-goals-2"><i class="fa fa-check"></i><b>5.1</b> Learning Goals</a></li>
<li class="chapter" data-level="5.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#the-challenge-of-model-fitting"><i class="fa fa-check"></i><b>5.2</b> The Challenge of Model Fitting</a></li>
<li class="chapter" data-level="5.3" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#simulating-data"><i class="fa fa-check"></i><b>5.3</b> Simulating data</a></li>
<li class="chapter" data-level="5.4" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#building-our-basic-model-in-stan"><i class="fa fa-check"></i><b>5.4</b> Building our basic model in Stan</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#data"><i class="fa fa-check"></i><b>5.4.1</b> Data</a></li>
<li class="chapter" data-level="5.4.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#model"><i class="fa fa-check"></i><b>5.4.2</b> Model</a></li>
<li class="chapter" data-level="5.4.3" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#compiling-and-fitting-the-model"><i class="fa fa-check"></i><b>5.4.3</b> Compiling and fitting the model</a></li>
<li class="chapter" data-level="5.4.4" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#assessing-model-quality"><i class="fa fa-check"></i><b>5.4.4</b> Assessing model quality</a></li>
<li class="chapter" data-level="5.4.5" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#summarizing-the-results"><i class="fa fa-check"></i><b>5.4.5</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#parameter-recovery"><i class="fa fa-check"></i><b>5.5</b> Parameter recovery</a></li>
<li class="chapter" data-level="5.6" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#the-memory-model-conditioning-theta"><i class="fa fa-check"></i><b>5.6</b> The memory model: conditioning theta</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#summarizing-the-results-1"><i class="fa fa-check"></i><b>5.6.1</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#memory-agent-with-internal-parameter"><i class="fa fa-check"></i><b>5.7</b> Memory agent with internal parameter</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#trying-out-a-more-complex-memory-model-with-a-rate-of-forgetting-that-exponentially-discounts-the-past"><i class="fa fa-check"></i><b>5.7.1</b> Trying out a more complex memory model, with a rate of forgetting that exponentially discounts the past</a></li>
<li class="chapter" data-level="5.7.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#connection-to-kalman-filters"><i class="fa fa-check"></i><b>5.7.2</b> Connection to Kalman Filters</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#relationship-to-rescorla-wagner"><i class="fa fa-check"></i><b>5.8</b> Relationship to Rescorla-Wagner</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#connection-to-hierarchical-gaussian-filter-hgf"><i class="fa fa-check"></i><b>5.8.1</b> Connection to Hierarchical Gaussian Filter (HGF)</a></li>
<li class="chapter" data-level="5.8.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#implications-for-model-development"><i class="fa fa-check"></i><b>5.8.2</b> Implications for Model Development</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#bayesian-memory-agent"><i class="fa fa-check"></i><b>5.9</b> Bayesian memory agent</a></li>
<li class="chapter" data-level="5.10" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#conclusion-from-simple-models-to-complex-cognitive-processes"><i class="fa fa-check"></i><b>5.10</b> Conclusion: From Simple Models to Complex Cognitive Processes</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html"><i class="fa fa-check"></i><b>6</b> Model Quality Assessment</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#introduction-1"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#generating-and-plotting-additional-variables"><i class="fa fa-check"></i><b>6.2</b> Generating and plotting additional variables</a></li>
<li class="chapter" data-level="6.3" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#assessing-priors"><i class="fa fa-check"></i><b>6.3</b> Assessing priors</a></li>
<li class="chapter" data-level="6.4" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#prior-predictive-checks"><i class="fa fa-check"></i><b>6.4</b> Prior Predictive Checks</a></li>
<li class="chapter" data-level="6.5" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>6.5</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="6.6" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>6.6</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="6.7" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#the-memory-model"><i class="fa fa-check"></i><b>6.7</b> The memory model</a></li>
<li class="chapter" data-level="6.8" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#prior-sensitivity-check-for-the-memory-model"><i class="fa fa-check"></i><b>6.8</b> Prior sensitivity check for the memory model</a></li>
<li class="chapter" data-level="6.9" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#conclusion-1"><i class="fa fa-check"></i><b>6.9</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><i class="fa fa-check"></i><b>7</b> Individual Differences in Cognitive Strategies (Multilevel modeling)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#learning-objectives-1"><i class="fa fa-check"></i><b>7.2</b> Learning Objectives</a></li>
<li class="chapter" data-level="7.3" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#the-value-of-multilevel-modeling"><i class="fa fa-check"></i><b>7.3</b> The Value of Multilevel Modeling</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#complete-pooling"><i class="fa fa-check"></i><b>7.3.1</b> Complete Pooling</a></li>
<li class="chapter" data-level="7.3.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#no-pooling"><i class="fa fa-check"></i><b>7.3.2</b> No Pooling</a></li>
<li class="chapter" data-level="7.3.3" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#partial-pooling-multilevel-modeling"><i class="fa fa-check"></i><b>7.3.3</b> Partial Pooling (Multilevel Modeling)</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#graphical-model-visualization"><i class="fa fa-check"></i><b>7.4</b> Graphical Model Visualization</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#biased-agent-model"><i class="fa fa-check"></i><b>7.4.1</b> Biased Agent Model</a></li>
<li class="chapter" data-level="7.4.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#memory-agent-model"><i class="fa fa-check"></i><b>7.4.2</b> Memory Agent Model</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#generating-the-agents"><i class="fa fa-check"></i><b>7.5</b> Generating the agents</a></li>
<li class="chapter" data-level="7.6" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#plotting-the-agents"><i class="fa fa-check"></i><b>7.6</b> Plotting the agents</a></li>
<li class="chapter" data-level="7.7" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#coding-the-multilevel-agents"><i class="fa fa-check"></i><b>7.7</b> Coding the multilevel agents</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-random"><i class="fa fa-check"></i><b>7.7.1</b> Multilevel random</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-random-agent-model"><i class="fa fa-check"></i><b>7.8</b> Multilevel Random Agent Model</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-random-agents"><i class="fa fa-check"></i><b>7.8.1</b> Assessing multilevel random agents</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#lets-look-at-individuals"><i class="fa fa-check"></i><b>7.9</b> Letâ€™s look at individuals</a></li>
<li class="chapter" data-level="7.10" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#prior-sensitivity-checks"><i class="fa fa-check"></i><b>7.10</b> Prior sensitivity checks</a></li>
<li class="chapter" data-level="7.11" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#parameter-recovery-1"><i class="fa fa-check"></i><b>7.11</b> Parameter recovery</a></li>
<li class="chapter" data-level="7.12" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-memory-agent-model"><i class="fa fa-check"></i><b>7.12</b> Multilevel Memory Agent Model</a>
<ul>
<li class="chapter" data-level="7.12.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-memory"><i class="fa fa-check"></i><b>7.12.1</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="7.12.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#diagnosing-the-issue-with-bias-and-beta"><i class="fa fa-check"></i><b>7.12.2</b> Diagnosing the issue with bias and beta</a></li>
<li class="chapter" data-level="7.12.3" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization"><i class="fa fa-check"></i><b>7.12.3</b> Multilevel memory with non centered parameterization</a></li>
<li class="chapter" data-level="7.12.4" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-memory-1"><i class="fa fa-check"></i><b>7.12.4</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="7.12.5" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters"><i class="fa fa-check"></i><b>7.12.5</b> Multilevel memory with correlation between parameters</a></li>
<li class="chapter" data-level="7.12.6" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-memory-2"><i class="fa fa-check"></i><b>7.12.6</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="7.12.7" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#section"><i class="fa fa-check"></i><b>7.12.7</b> </a></li>
</ul></li>
<li class="chapter" data-level="7.13" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#comparing-pooling-approaches"><i class="fa fa-check"></i><b>7.13</b> Comparing Pooling Approaches</a></li>
<li class="chapter" data-level="7.14" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#comparing-pooling-approaches-1"><i class="fa fa-check"></i><b>7.14</b> Comparing Pooling Approaches</a></li>
<li class="chapter" data-level="7.15" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-modeling-cheatsheet"><i class="fa fa-check"></i><b>7.15</b> Multilevel Modeling Cheatsheet</a>
<ul>
<li class="chapter" data-level="7.15.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#when-to-use-each-pooling-approach"><i class="fa fa-check"></i><b>7.15.1</b> When to Use Each Pooling Approach:</a></li>
<li class="chapter" data-level="7.15.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#parameter-recovery-rules-of-thumb"><i class="fa fa-check"></i><b>7.15.2</b> Parameter Recovery Rules of Thumb:</a></li>
</ul></li>
<li class="chapter" data-level="7.16" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#conclusion-the-power-and-challenges-of-multilevel-modeling"><i class="fa fa-check"></i><b>7.16</b> Conclusion: The Power and Challenges of Multilevel Modeling</a></li>
<li class="chapter" data-level="7.17" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#exercises-just-some-ideas"><i class="fa fa-check"></i><b>7.17</b> Exercises (just some ideas)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html"><i class="fa fa-check"></i><b>8</b> Model Comparison in Cognitive Science</a>
<ul>
<li class="chapter" data-level="8.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#learning-objectives-2"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#why-compare-models"><i class="fa fa-check"></i><b>8.2</b> Why Compare Models?</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#the-challenge-of-model-selection"><i class="fa fa-check"></i><b>8.2.1</b> The Challenge of Model Selection</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#cross-validation-the-foundation-of-model-comparison"><i class="fa fa-check"></i><b>8.3</b> Cross-Validation: The Foundation of Model Comparison</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#the-problem-of-overfitting"><i class="fa fa-check"></i><b>8.3.1</b> The Problem of Overfitting</a></li>
<li class="chapter" data-level="8.3.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#how-cross-validation-works"><i class="fa fa-check"></i><b>8.3.2</b> How Cross-Validation Works</a></li>
<li class="chapter" data-level="8.3.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#cross-validation-in-bayesian-models"><i class="fa fa-check"></i><b>8.3.3</b> Cross-Validation in Bayesian Models</a></li>
<li class="chapter" data-level="8.3.4" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#expected-log-predictive-density-elpd"><i class="fa fa-check"></i><b>8.3.4</b> Expected Log Predictive Density (ELPD)</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#psis-loo-an-efficient-approximation-to-loo-cv"><i class="fa fa-check"></i><b>8.4</b> PSIS-LOO: An Efficient Approximation to LOO-CV</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#how-importance-sampling-works"><i class="fa fa-check"></i><b>8.4.1</b> How Importance Sampling Works</a></li>
<li class="chapter" data-level="8.4.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#pareto-smoothing-for-stability"><i class="fa fa-check"></i><b>8.4.2</b> Pareto Smoothing for Stability</a></li>
<li class="chapter" data-level="8.4.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#the-complete-psis-loo-process"><i class="fa fa-check"></i><b>8.4.3</b> The Complete PSIS-LOO Process</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#simulation-based-model-comparison"><i class="fa fa-check"></i><b>8.5</b> Simulation-Based Model Comparison</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#define-simulation-parameters"><i class="fa fa-check"></i><b>8.5.1</b> Define Simulation Parameters</a></li>
<li class="chapter" data-level="8.5.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#define-agent-functions"><i class="fa fa-check"></i><b>8.5.2</b> Define Agent Functions</a></li>
<li class="chapter" data-level="8.5.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#generate-simulation-data"><i class="fa fa-check"></i><b>8.5.3</b> Generate Simulation Data</a></li>
<li class="chapter" data-level="8.5.4" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#visualize-the-simulation-data"><i class="fa fa-check"></i><b>8.5.4</b> Visualize the Simulation Data</a></li>
<li class="chapter" data-level="8.5.5" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#prepare-data-for-stan-models"><i class="fa fa-check"></i><b>8.5.5</b> Prepare Data for Stan Models</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#implementing-models-for-comparison"><i class="fa fa-check"></i><b>8.6</b> Implementing Models for Comparison</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#understanding-log-likelihood-in-model-comparison"><i class="fa fa-check"></i><b>8.6.1</b> Understanding Log-Likelihood in Model Comparison</a></li>
<li class="chapter" data-level="8.6.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#multilevel-biased-agent-model"><i class="fa fa-check"></i><b>8.6.2</b> Multilevel Biased Agent Model</a></li>
<li class="chapter" data-level="8.6.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#multilevel-memory-agent-model-1"><i class="fa fa-check"></i><b>8.6.3</b> Multilevel Memory Agent Model</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#fitting-models-and-calculating-expected-log-predictive-density"><i class="fa fa-check"></i><b>8.7</b> Fitting Models and Calculating Expected Log Predictive Density</a></li>
<li class="chapter" data-level="8.8" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#fitting-the-models-to-the-data"><i class="fa fa-check"></i><b>8.8</b> Fitting the models to the data</a></li>
<li class="chapter" data-level="8.9" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#cross-validation-for-model-comparison"><i class="fa fa-check"></i><b>8.9</b> Cross-Validation for Model Comparison</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#psis-loo-comparison"><i class="fa fa-check"></i><b>8.9.1</b> PSIS-LOO Comparison</a></li>
<li class="chapter" data-level="8.9.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#visualizing-loo-cv-results"><i class="fa fa-check"></i><b>8.9.2</b> Visualizing LOO-CV Results</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#formal-model-comparison"><i class="fa fa-check"></i><b>8.10</b> Formal Model Comparison</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#k-fold-cross-validation-for-validation"><i class="fa fa-check"></i><b>8.10.1</b> K-Fold Cross-Validation for Validation</a></li>
<li class="chapter" data-level="8.10.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#comparing-loo-and-k-fold-results"><i class="fa fa-check"></i><b>8.10.2</b> Comparing LOO and K-Fold Results</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#limitations-of-model-comparison-approaches"><i class="fa fa-check"></i><b>8.11</b> Limitations of Model Comparison Approaches</a></li>
<li class="chapter" data-level="8.12" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#exercises"><i class="fa fa-check"></i><b>8.12</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.12.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#rant-on-internal-vs-external-validity"><i class="fa fa-check"></i><b>8.12.1</b> Rant on internal vs external validity</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>9</b> Mixture models</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="mixture-models.html"><a href="mixture-models.html#learning-objectives-3"><i class="fa fa-check"></i><b>9.0.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="9.0.2" data-path="mixture-models.html"><a href="mixture-models.html#chapter-roadmap"><i class="fa fa-check"></i><b>9.0.2</b> Chapter Roadmap</a></li>
<li class="chapter" data-level="9.1" data-path="mixture-models.html"><a href="mixture-models.html#visualizing-mixture-distributions-reaction-time-example"><i class="fa fa-check"></i><b>9.1</b> Visualizing Mixture Distributions: Reaction Time Example</a></li>
<li class="chapter" data-level="9.2" data-path="mixture-models.html"><a href="mixture-models.html#theoretical-foundation-for-mixture-models"><i class="fa fa-check"></i><b>9.2</b> Theoretical Foundation for Mixture Models</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="mixture-models.html"><a href="mixture-models.html#the-mixture-model-framework"><i class="fa fa-check"></i><b>9.2.1</b> The Mixture Model Framework</a></li>
<li class="chapter" data-level="9.2.2" data-path="mixture-models.html"><a href="mixture-models.html#mixture-models-and-latent-variables"><i class="fa fa-check"></i><b>9.2.2</b> Mixture Models and Latent Variables</a></li>
<li class="chapter" data-level="9.2.3" data-path="mixture-models.html"><a href="mixture-models.html#applications-in-cognitive-modeling"><i class="fa fa-check"></i><b>9.2.3</b> Applications in Cognitive Modeling</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="mixture-models.html"><a href="mixture-models.html#implementing-a-basic-mixture-model"><i class="fa fa-check"></i><b>9.3</b> Implementing a Basic Mixture Model</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="mixture-models.html"><a href="mixture-models.html#simulating-mixed-strategy-data"><i class="fa fa-check"></i><b>9.3.1</b> Simulating Mixed Strategy Data</a></li>
<li class="chapter" data-level="9.3.2" data-path="mixture-models.html"><a href="mixture-models.html#stan-implementation-of-a-mixture-model"><i class="fa fa-check"></i><b>9.3.2</b> Stan Implementation of a Mixture Model</a></li>
<li class="chapter" data-level="9.3.3" data-path="mixture-models.html"><a href="mixture-models.html#fitting-and-evaluating-the-mixture-model"><i class="fa fa-check"></i><b>9.3.3</b> Fitting and Evaluating the Mixture Model</a></li>
<li class="chapter" data-level="9.3.4" data-path="mixture-models.html"><a href="mixture-models.html#model-diagnostics"><i class="fa fa-check"></i><b>9.3.4</b> Model Diagnostics</a></li>
<li class="chapter" data-level="9.3.5" data-path="mixture-models.html"><a href="mixture-models.html#parameter-recovery-analysis"><i class="fa fa-check"></i><b>9.3.5</b> Parameter Recovery Analysis</a></li>
<li class="chapter" data-level="9.3.6" data-path="mixture-models.html"><a href="mixture-models.html#posterior-predictive-checks-1"><i class="fa fa-check"></i><b>9.3.6</b> Posterior Predictive Checks</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="mixture-models.html"><a href="mixture-models.html#parameter-interpretation"><i class="fa fa-check"></i><b>9.4</b> Parameter Interpretation</a></li>
<li class="chapter" data-level="9.5" data-path="mixture-models.html"><a href="mixture-models.html#multilevel-mixture-models"><i class="fa fa-check"></i><b>9.5</b> Multilevel Mixture Models</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="mixture-models.html"><a href="mixture-models.html#stan-implementation"><i class="fa fa-check"></i><b>9.5.1</b> Stan Implementation</a></li>
<li class="chapter" data-level="9.5.2" data-path="mixture-models.html"><a href="mixture-models.html#preparing-data-for-the-multilevel-model"><i class="fa fa-check"></i><b>9.5.2</b> Preparing Data for the Multilevel Model</a></li>
<li class="chapter" data-level="9.5.3" data-path="mixture-models.html"><a href="mixture-models.html#fitting-and-evaluating-the-multilevel-model"><i class="fa fa-check"></i><b>9.5.3</b> Fitting and Evaluating the Multilevel Model</a></li>
<li class="chapter" data-level="9.5.4" data-path="mixture-models.html"><a href="mixture-models.html#examining-individual-differences"><i class="fa fa-check"></i><b>9.5.4</b> Examining Individual Differences</a></li>
<li class="chapter" data-level="9.5.5" data-path="mixture-models.html"><a href="mixture-models.html#interpreting-parameter-correlations"><i class="fa fa-check"></i><b>9.5.5</b> Interpreting Parameter Correlations</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="mixture-models.html"><a href="mixture-models.html#comparing-single-process-and-mixture-models"><i class="fa fa-check"></i><b>9.6</b> Comparing Single-Process and Mixture Models</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="mixture-models.html"><a href="mixture-models.html#single-process-model"><i class="fa fa-check"></i><b>9.6.1</b> Single-Process Model</a></li>
<li class="chapter" data-level="9.6.2" data-path="mixture-models.html"><a href="mixture-models.html#model-comparison"><i class="fa fa-check"></i><b>9.6.2</b> Model Comparison</a></li>
<li class="chapter" data-level="9.6.3" data-path="mixture-models.html"><a href="mixture-models.html#applications-of-mixture-models-in-cognitive-science"><i class="fa fa-check"></i><b>9.6.3</b> Applications of Mixture Models in Cognitive Science</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="mixture-models.html"><a href="mixture-models.html#conclusion-2"><i class="fa fa-check"></i><b>9.7</b> Conclusion</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">08-MixtureModels</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-comparison-in-cognitive-science" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Model Comparison in Cognitive Science<a href="model-comparison-in-cognitive-science.html#model-comparison-in-cognitive-science" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Cognitive science aims to understand the processes that give rise to human thought and behavior. To do this effectively, we often create formal models that represent our hypotheses about these underlying processes. However, human cognition is complex, and multiple theoretical accounts might plausibly explain the same observed behaviors. This is where model comparison becomes essential.
Model comparison is the principled evaluation of competing models to determine which best explains observed data. Model comparison techniques as described here balance a modelâ€™s ability to fit existing data against its ability to generalize to new observations, helping us avoid the trap of overfitting. But remember, model comparison is not a fail-safe procedure to determine which model embodies the truth, as always we need to be careful, tentative and open about the probabilistic and fallible nature of our inference.</p>
<div id="learning-objectives-2" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Learning Objectives<a href="model-comparison-in-cognitive-science.html#learning-objectives-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After completing this chapter, you will be able to:</p>
<ul>
<li><p>Implement cross-validation techniques for comparing cognitive models using Stan</p></li>
<li><p>Calculate and interpret expected log predictive density (ELPD) scores</p></li>
<li><p>Assess model predictions through posterior and prior predictive checks</p></li>
<li><p>Understand the strengths and limitations of different model comparison approaches</p></li>
<li><p>Apply these techniques to compare competing cognitive models using real data</p></li>
</ul>
</div>
<div id="why-compare-models" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Why Compare Models?<a href="model-comparison-in-cognitive-science.html#why-compare-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Model comparison serves multiple purposes in cognitive science:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Theory Testing</strong>: Different models often represent competing theoretical accounts of cognitive processes. Comparing their fit to data helps evaluate these theories.</p></li>
<li><p><strong>Parsimony</strong>: When multiple models can explain the data, more complex models should only be preferred if they are justified by better predictive performance.</p></li>
<li><p><strong>Generalization</strong>: By assessing how well different models predict new data, we can evaluate their ability to capture general patterns rather than just fitting to specific samples.</p></li>
<li><p><strong>Individual Differences</strong>: Model comparison can reveal whether different individuals or groups are better described by different cognitive strategies.</p></li>
</ol>
<p>This chapter demonstrates these principles using our matching pennies models as concrete examples. Weâ€™ll compare simple random choice models against more sophisticated memory-based approaches, showing how to rigorously evaluate which better explains observed behavior.</p>
<div id="the-challenge-of-model-selection" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> The Challenge of Model Selection<a href="model-comparison-in-cognitive-science.html#the-challenge-of-model-selection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Imagine having several models of what might be going on and wanting to know which is the best explanation of the data. For example:</p>
<ul>
<li>Are people more likely to use a memory strategy or a win-stay-lose-shift strategy?</li>
<li>Are we justified in assuming that people react differently to losses than to wins?</li>
<li>Would we be justified in assuming that capuchin monkeys and cognitive science students use the same model?</li>
</ul>
<p>Model comparison defines a broad range of practices aimed at identifying the best model for a given dataset. What â€œbestâ€ means is, however, a non-trivial question. Ideally, â€œbestâ€ would mean the model describing the mechanism that actually generated the data. However, knowing the truth is a tricky proposition and we need to use proxies. There are many of such proxies in the literature, for instance Bayes Factors (see Nicenboim et al 2023, <a href="https://vasishth.github.io/bayescogsci/book/ch-comparison.html" class="uri">https://vasishth.github.io/bayescogsci/book/ch-comparison.html</a>). In this course, we rely on predictive performance - this helps combat overfitting, but has limitations weâ€™ll discuss at the end.</p>
<p>In other words, this chapter will assess models in terms of their (estimated) ability to predict new (test) data. Remember that predictive performance is a very useful tool, but not a magical solution. It allows us to combat overfitting to the training sample (your model snuggling to your data so much that it fits both signal and noise), but it has key limitations, which we will discuss at the end of the chapter.</p>
<p>To learn how to make model comparison, in this chapter, we rely on our usual simulation based approach to ensure that the method is doing what we want. We simulate the behavior of biased agents playing against the memory agents. This provides us with data generated according to two different mechanisms: biased agents and memory agents. We can fit both models separately on each of the two sets of agents, so we can compare the relative performance of the two models: can we identify the true model generating the data (in a setup where truth is known)? This is what is usually called â€œmodel recoveryâ€ and complements nicely â€œparameter recoveryâ€. In model recovery we assess whether we can identify the correct model, in parameter recovery we assess whether - once we know the correct model - we can identify the correct parameter values.</p>
<p>Letâ€™s get going.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="model-comparison-in-cognitive-science.html#cb220-1" tabindex="-1"></a><span class="co"># Flag to control whether to regenerate simulations</span></span>
<span id="cb220-2"><a href="model-comparison-in-cognitive-science.html#cb220-2" tabindex="-1"></a><span class="co"># Set this to TRUE when you need to rerun the models</span></span>
<span id="cb220-3"><a href="model-comparison-in-cognitive-science.html#cb220-3" tabindex="-1"></a>regenerate_simulations <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb220-4"><a href="model-comparison-in-cognitive-science.html#cb220-4" tabindex="-1"></a></span>
<span id="cb220-5"><a href="model-comparison-in-cognitive-science.html#cb220-5" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb220-6"><a href="model-comparison-in-cognitive-science.html#cb220-6" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb220-7"><a href="model-comparison-in-cognitive-science.html#cb220-7" tabindex="-1"></a>  tidyverse,    <span class="co"># For data manipulation and visualization</span></span>
<span id="cb220-8"><a href="model-comparison-in-cognitive-science.html#cb220-8" tabindex="-1"></a>  here,         <span class="co"># For file path management</span></span>
<span id="cb220-9"><a href="model-comparison-in-cognitive-science.html#cb220-9" tabindex="-1"></a>  posterior,    <span class="co"># For working with posterior samples</span></span>
<span id="cb220-10"><a href="model-comparison-in-cognitive-science.html#cb220-10" tabindex="-1"></a>  cmdstanr,     <span class="co"># For interfacing with Stan</span></span>
<span id="cb220-11"><a href="model-comparison-in-cognitive-science.html#cb220-11" tabindex="-1"></a>  brms,         <span class="co"># For Bayesian regression models</span></span>
<span id="cb220-12"><a href="model-comparison-in-cognitive-science.html#cb220-12" tabindex="-1"></a>  tidybayes,    <span class="co"># For working with Bayesian samples</span></span>
<span id="cb220-13"><a href="model-comparison-in-cognitive-science.html#cb220-13" tabindex="-1"></a>  loo,          <span class="co"># For leave-one-out cross-validation</span></span>
<span id="cb220-14"><a href="model-comparison-in-cognitive-science.html#cb220-14" tabindex="-1"></a>  patchwork,    <span class="co"># For combining plots</span></span>
<span id="cb220-15"><a href="model-comparison-in-cognitive-science.html#cb220-15" tabindex="-1"></a>  bayesplot,     <span class="co"># For Bayesian visualization</span></span>
<span id="cb220-16"><a href="model-comparison-in-cognitive-science.html#cb220-16" tabindex="-1"></a>  MASS</span>
<span id="cb220-17"><a href="model-comparison-in-cognitive-science.html#cb220-17" tabindex="-1"></a>)</span>
<span id="cb220-18"><a href="model-comparison-in-cognitive-science.html#cb220-18" tabindex="-1"></a></span>
<span id="cb220-19"><a href="model-comparison-in-cognitive-science.html#cb220-19" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb220-20"><a href="model-comparison-in-cognitive-science.html#cb220-20" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb220-21"><a href="model-comparison-in-cognitive-science.html#cb220-21" tabindex="-1"></a></span>
<span id="cb220-22"><a href="model-comparison-in-cognitive-science.html#cb220-22" tabindex="-1"></a><span class="co"># Generate demonstration data</span></span>
<span id="cb220-23"><a href="model-comparison-in-cognitive-science.html#cb220-23" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb220-24"><a href="model-comparison-in-cognitive-science.html#cb220-24" tabindex="-1"></a></span>
<span id="cb220-25"><a href="model-comparison-in-cognitive-science.html#cb220-25" tabindex="-1"></a><span class="co"># Model 1: Random biased agent (80% right choice)</span></span>
<span id="cb220-26"><a href="model-comparison-in-cognitive-science.html#cb220-26" tabindex="-1"></a>biased_agent <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(trials, <span class="dv">1</span>, <span class="fl">0.8</span>)</span>
<span id="cb220-27"><a href="model-comparison-in-cognitive-science.html#cb220-27" tabindex="-1"></a>cumulative_biased <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(biased_agent) <span class="sc">/</span> <span class="fu">seq_along</span>(biased_agent)</span>
<span id="cb220-28"><a href="model-comparison-in-cognitive-science.html#cb220-28" tabindex="-1"></a></span>
<span id="cb220-29"><a href="model-comparison-in-cognitive-science.html#cb220-29" tabindex="-1"></a><span class="co"># Model 2: Memory-based agent (adjusts based on past patterns)</span></span>
<span id="cb220-30"><a href="model-comparison-in-cognitive-science.html#cb220-30" tabindex="-1"></a>memory_agent <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb220-31"><a href="model-comparison-in-cognitive-science.html#cb220-31" tabindex="-1"></a>memory_agent[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)  <span class="co"># First choice is random</span></span>
<span id="cb220-32"><a href="model-comparison-in-cognitive-science.html#cb220-32" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>trials) {</span>
<span id="cb220-33"><a href="model-comparison-in-cognitive-science.html#cb220-33" tabindex="-1"></a>  <span class="co"># Agent uses memory of past choices with some randomness</span></span>
<span id="cb220-34"><a href="model-comparison-in-cognitive-science.html#cb220-34" tabindex="-1"></a>  memory_agent[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.3</span> <span class="sc">+</span> <span class="fl">0.4</span> <span class="sc">*</span> <span class="fu">mean</span>(biased_agent[<span class="dv">1</span><span class="sc">:</span>(i <span class="sc">-</span> <span class="dv">1</span>)]))</span>
<span id="cb220-35"><a href="model-comparison-in-cognitive-science.html#cb220-35" tabindex="-1"></a>}</span>
<span id="cb220-36"><a href="model-comparison-in-cognitive-science.html#cb220-36" tabindex="-1"></a>cumulative_memory <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(memory_agent) <span class="sc">/</span> <span class="fu">seq_along</span>(memory_agent)</span>
<span id="cb220-37"><a href="model-comparison-in-cognitive-science.html#cb220-37" tabindex="-1"></a></span>
<span id="cb220-38"><a href="model-comparison-in-cognitive-science.html#cb220-38" tabindex="-1"></a><span class="co"># Create plotting data</span></span>
<span id="cb220-39"><a href="model-comparison-in-cognitive-science.html#cb220-39" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb220-40"><a href="model-comparison-in-cognitive-science.html#cb220-40" tabindex="-1"></a>  <span class="at">trial =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>trials, <span class="dv">2</span>),</span>
<span id="cb220-41"><a href="model-comparison-in-cognitive-science.html#cb220-41" tabindex="-1"></a>  <span class="at">choice =</span> <span class="fu">c</span>(biased_agent, memory_agent),</span>
<span id="cb220-42"><a href="model-comparison-in-cognitive-science.html#cb220-42" tabindex="-1"></a>  <span class="at">cumulative =</span> <span class="fu">c</span>(cumulative_biased, cumulative_memory),</span>
<span id="cb220-43"><a href="model-comparison-in-cognitive-science.html#cb220-43" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Biased Agent&quot;</span>, <span class="st">&quot;Memory Agent&quot;</span>), <span class="at">each =</span> trials)</span>
<span id="cb220-44"><a href="model-comparison-in-cognitive-science.html#cb220-44" tabindex="-1"></a>)</span>
<span id="cb220-45"><a href="model-comparison-in-cognitive-science.html#cb220-45" tabindex="-1"></a></span>
<span id="cb220-46"><a href="model-comparison-in-cognitive-science.html#cb220-46" tabindex="-1"></a><span class="co"># Generate simulated data that could come from either model</span></span>
<span id="cb220-47"><a href="model-comparison-in-cognitive-science.html#cb220-47" tabindex="-1"></a>observed_data <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&gt;</span> <span class="fl">0.5</span>) biased_agent <span class="cf">else</span> memory_agent</span>
<span id="cb220-48"><a href="model-comparison-in-cognitive-science.html#cb220-48" tabindex="-1"></a>observed_cumulative <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(observed_data) <span class="sc">/</span> <span class="fu">seq_along</span>(observed_data)</span>
<span id="cb220-49"><a href="model-comparison-in-cognitive-science.html#cb220-49" tabindex="-1"></a></span>
<span id="cb220-50"><a href="model-comparison-in-cognitive-science.html#cb220-50" tabindex="-1"></a>observed_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb220-51"><a href="model-comparison-in-cognitive-science.html#cb220-51" tabindex="-1"></a>  <span class="at">trial =</span> <span class="dv">1</span><span class="sc">:</span>trials,</span>
<span id="cb220-52"><a href="model-comparison-in-cognitive-science.html#cb220-52" tabindex="-1"></a>  <span class="at">choice =</span> observed_data,</span>
<span id="cb220-53"><a href="model-comparison-in-cognitive-science.html#cb220-53" tabindex="-1"></a>  <span class="at">cumulative =</span> observed_cumulative</span>
<span id="cb220-54"><a href="model-comparison-in-cognitive-science.html#cb220-54" tabindex="-1"></a>)</span>
<span id="cb220-55"><a href="model-comparison-in-cognitive-science.html#cb220-55" tabindex="-1"></a></span>
<span id="cb220-56"><a href="model-comparison-in-cognitive-science.html#cb220-56" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb220-57"><a href="model-comparison-in-cognitive-science.html#cb220-57" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb220-58"><a href="model-comparison-in-cognitive-science.html#cb220-58" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">data =</span> observed_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(trial<span class="sc">&gt;</span><span class="dv">2</span>), <span class="fu">aes</span>(<span class="at">x =</span> trial, <span class="at">y =</span> choice), <span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb220-59"><a href="model-comparison-in-cognitive-science.html#cb220-59" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> model_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(trial<span class="sc">&gt;</span><span class="dv">2</span>), <span class="fu">aes</span>(<span class="at">x =</span> trial, <span class="at">y =</span> cumulative, <span class="at">color =</span> model, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb220-60"><a href="model-comparison-in-cognitive-science.html#cb220-60" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb220-61"><a href="model-comparison-in-cognitive-science.html#cb220-61" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb220-62"><a href="model-comparison-in-cognitive-science.html#cb220-62" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Two Competing Models of Decision Making&quot;</span>,</span>
<span id="cb220-63"><a href="model-comparison-in-cognitive-science.html#cb220-63" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;The biased agent makes choices with fixed 80% bias toward right option, regardless of context </span><span class="sc">\n</span><span class="st">The memory agent adjusts choices based on memory of opponent&#39;s previous moves </span><span class="sc">\n</span><span class="st">Just looking at the data (sampled at random from one of the two models) it&#39;s hard to identify the model generating it&quot;</span>, </span>
<span id="cb220-64"><a href="model-comparison-in-cognitive-science.html#cb220-64" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Trial Number&quot;</span>,</span>
<span id="cb220-65"><a href="model-comparison-in-cognitive-science.html#cb220-65" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Choice (0 = Left, 1 = Right)&quot;</span>,</span>
<span id="cb220-66"><a href="model-comparison-in-cognitive-science.html#cb220-66" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Model&quot;</span></span>
<span id="cb220-67"><a href="model-comparison-in-cognitive-science.html#cb220-67" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb220-68"><a href="model-comparison-in-cognitive-science.html#cb220-68" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb220-69"><a href="model-comparison-in-cognitive-science.html#cb220-69" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb220-70"><a href="model-comparison-in-cognitive-science.html#cb220-70" tabindex="-1"></a></span>
<span id="cb220-71"><a href="model-comparison-in-cognitive-science.html#cb220-71" tabindex="-1"></a></span>
<span id="cb220-72"><a href="model-comparison-in-cognitive-science.html#cb220-72" tabindex="-1"></a>p1 </span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-23-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>In this example, we have:</p>
<ul>
<li><p>Model 1 (Biased Agent): Makes choices with a consistent 80% bias toward the right option</p></li>
<li><p>Model 2 (Memory Agent): Adjusts choices based on memory of previous patterns</p></li>
</ul>
<p>The critical insight is that both models can produce similar-looking data, making it difficult to determine which cognitive process generated the observed behavior by simple visual inspection. Formal model comparison techniques give us principled ways to evaluate which model better explains the data while accounting for model complexity and generalization ability.</p>
</div>
</div>
<div id="cross-validation-the-foundation-of-model-comparison" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Cross-Validation: The Foundation of Model Comparison<a href="model-comparison-in-cognitive-science.html#cross-validation-the-foundation-of-model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Cross-validation is a fundamental technique for comparing models based on their predictive performance. The core idea is simple: a good model should not only fit the observed data but also generalize well to new, unseen data.</p>
<div id="the-problem-of-overfitting" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> The Problem of Overfitting<a href="model-comparison-in-cognitive-science.html#the-problem-of-overfitting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we fit a model to data, thereâ€™s always a risk of overfitting - capturing noise or idiosyncrasies in the particular sample rather than the underlying pattern we care about.</p>
<p>[MISSING: A QUICK ILLUSTRATION OF AN EXAMPLE]</p>
<p>Cross-validation helps us find the optimal balance between fitting the training data and generalizing to new data.</p>
<p>When the datasets are small, as it is often the case in cognitive science, keeping a substantial portion of the data out - substantial enough to be representative of a more general population - is problematic as it risks starving the model of data: there might not be enough data for reliable estimation of the parameter values. This is where the notion of cross-validation comes in: we can split the dataset in k folds, letâ€™s say k = 10. Then each fold is in turn kept aside as validation set, the model is fitted on the other folds, and its predictive performance tested on the validation set. Repeat this operation of each of the folds. This operation ensures that all the data can be used for training as well as for validation, and is in its own terms quite genial. However, this does not mean it is free of shortcomings. First, small validation folds might not be representative of the diversity of true out-of-sample populations - and there is a tendency to set k equal to the number of datapoints (leave-one-out cross validation). Second, there are many ways in which information could leak or contaminate across folds if the pipeline is not very careful (e.g.Â via data preprocessing scaling the full dataset, or hyper-parameter estimation). Third, and crucial for our case here, cross validation implies refitting the model k times, which for Bayesian models might be very cumbersome (I once had a model that took 6 weeks to run).</p>
</div>
<div id="how-cross-validation-works" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> How Cross-Validation Works<a href="model-comparison-in-cognitive-science.html#how-cross-validation-works" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The basic idea of cross-validation is to:</p>
<ol style="list-style-type: decimal">
<li>Split your data into training and test sets</li>
<li>Fit your model to the training data</li>
<li>Evaluate the modelâ€™s performance on the test data (which it hasnâ€™t seen during training)</li>
<li>Repeat with different training/test splits and average the results</li>
</ol>
<p>There are several variations of cross-validation:</p>
<div id="k-fold-cross-validation" class="section level4 hasAnchor" number="8.3.2.1">
<h4><span class="header-section-number">8.3.2.1</span> K-Fold Cross-Validation<a href="model-comparison-in-cognitive-science.html#k-fold-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In k-fold cross-validation, we:
1. Divide the data into k equally sized subsets (folds)
2. Use k-1 folds for training and the remaining fold for testing
3. Repeat k times, each time using a different fold as the test set
4. Average the k test performance metrics</p>
<p>This visualization shows how 5-fold cross-validation works:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="model-comparison-in-cognitive-science.html#cb221-1" tabindex="-1"></a><span class="co"># Visualization of k-fold cross-validation</span></span>
<span id="cb221-2"><a href="model-comparison-in-cognitive-science.html#cb221-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb221-3"><a href="model-comparison-in-cognitive-science.html#cb221-3" tabindex="-1"></a>n_data <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb221-4"><a href="model-comparison-in-cognitive-science.html#cb221-4" tabindex="-1"></a></span>
<span id="cb221-5"><a href="model-comparison-in-cognitive-science.html#cb221-5" tabindex="-1"></a><span class="co"># K-Fold CV (k=5)</span></span>
<span id="cb221-6"><a href="model-comparison-in-cognitive-science.html#cb221-6" tabindex="-1"></a>cv_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb221-7"><a href="model-comparison-in-cognitive-science.html#cb221-7" tabindex="-1"></a>  <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span>n_data,</span>
<span id="cb221-8"><a href="model-comparison-in-cognitive-science.html#cb221-8" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">rnorm</span>(n_data)</span>
<span id="cb221-9"><a href="model-comparison-in-cognitive-science.html#cb221-9" tabindex="-1"></a>)</span>
<span id="cb221-10"><a href="model-comparison-in-cognitive-science.html#cb221-10" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb221-11"><a href="model-comparison-in-cognitive-science.html#cb221-11" tabindex="-1"></a>cv_data<span class="sc">$</span>fold <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">length.out =</span> n_data))</span>
<span id="cb221-12"><a href="model-comparison-in-cognitive-science.html#cb221-12" tabindex="-1"></a></span>
<span id="cb221-13"><a href="model-comparison-in-cognitive-science.html#cb221-13" tabindex="-1"></a><span class="co"># Create visualization data for k-fold CV</span></span>
<span id="cb221-14"><a href="model-comparison-in-cognitive-science.html#cb221-14" tabindex="-1"></a>cv_viz_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb221-15"><a href="model-comparison-in-cognitive-science.html#cb221-15" tabindex="-1"></a>  <span class="at">iteration =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each =</span> n_data),</span>
<span id="cb221-16"><a href="model-comparison-in-cognitive-science.html#cb221-16" tabindex="-1"></a>  <span class="at">data_point =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_data, <span class="dv">5</span>),</span>
<span id="cb221-17"><a href="model-comparison-in-cognitive-science.html#cb221-17" tabindex="-1"></a>  <span class="at">role =</span> <span class="fu">ifelse</span>(cv_data<span class="sc">$</span>fold[data_point] <span class="sc">==</span> iteration, <span class="st">&quot;test&quot;</span>, <span class="st">&quot;train&quot;</span>),</span>
<span id="cb221-18"><a href="model-comparison-in-cognitive-science.html#cb221-18" tabindex="-1"></a>  <span class="at">approach =</span> <span class="st">&quot;5-Fold CV&quot;</span></span>
<span id="cb221-19"><a href="model-comparison-in-cognitive-science.html#cb221-19" tabindex="-1"></a>)</span>
<span id="cb221-20"><a href="model-comparison-in-cognitive-science.html#cb221-20" tabindex="-1"></a></span>
<span id="cb221-21"><a href="model-comparison-in-cognitive-science.html#cb221-21" tabindex="-1"></a><span class="co"># Define a consistent color scheme</span></span>
<span id="cb221-22"><a href="model-comparison-in-cognitive-science.html#cb221-22" tabindex="-1"></a>role_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;train&quot;</span> <span class="ot">=</span> <span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;test&quot;</span> <span class="ot">=</span> <span class="st">&quot;firebrick&quot;</span>)</span>
<span id="cb221-23"><a href="model-comparison-in-cognitive-science.html#cb221-23" tabindex="-1"></a></span>
<span id="cb221-24"><a href="model-comparison-in-cognitive-science.html#cb221-24" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb221-25"><a href="model-comparison-in-cognitive-science.html#cb221-25" tabindex="-1"></a><span class="fu">ggplot</span>(cv_viz_data, <span class="fu">aes</span>(<span class="at">x =</span> data_point, <span class="at">y =</span> iteration, <span class="at">fill =</span> role)) <span class="sc">+</span></span>
<span id="cb221-26"><a href="model-comparison-in-cognitive-science.html#cb221-26" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb221-27"><a href="model-comparison-in-cognitive-science.html#cb221-27" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> role_colors, <span class="at">name =</span> <span class="st">&quot;Data Role&quot;</span>) <span class="sc">+</span></span>
<span id="cb221-28"><a href="model-comparison-in-cognitive-science.html#cb221-28" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb221-29"><a href="model-comparison-in-cognitive-science.html#cb221-29" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;K-Fold Cross-Validation (k=5)&quot;</span>,</span>
<span id="cb221-30"><a href="model-comparison-in-cognitive-science.html#cb221-30" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Each row shows one iteration, columns represent data points&quot;</span>,</span>
<span id="cb221-31"><a href="model-comparison-in-cognitive-science.html#cb221-31" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Data Point&quot;</span>,</span>
<span id="cb221-32"><a href="model-comparison-in-cognitive-science.html#cb221-32" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Iteration&quot;</span>,</span>
<span id="cb221-33"><a href="model-comparison-in-cognitive-science.html#cb221-33" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Data Usage&quot;</span></span>
<span id="cb221-34"><a href="model-comparison-in-cognitive-science.html#cb221-34" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb221-35"><a href="model-comparison-in-cognitive-science.html#cb221-35" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb221-36"><a href="model-comparison-in-cognitive-science.html#cb221-36" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb221-37"><a href="model-comparison-in-cognitive-science.html#cb221-37" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb221-38"><a href="model-comparison-in-cognitive-science.html#cb221-38" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb221-39"><a href="model-comparison-in-cognitive-science.html#cb221-39" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-24-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="leave-one-out-cross-validation-loo-cv" class="section level4 hasAnchor" number="8.3.2.2">
<h4><span class="header-section-number">8.3.2.2</span> Leave-One-Out Cross-Validation (LOO-CV)<a href="model-comparison-in-cognitive-science.html#leave-one-out-cross-validation-loo-cv" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Leave-one-out is a special case of k-fold cross-validation where k equals the number of data points. In each iteration, we:
1. Hold out a single observation for testing
2. Train on all other observations
3. Repeat for every observation
4. Average the performance metrics</p>
<p>This approach can be very computationally intensive for large datasets or complex models.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="model-comparison-in-cognitive-science.html#cb222-1" tabindex="-1"></a><span class="co"># Create visualization data for LOO CV</span></span>
<span id="cb222-2"><a href="model-comparison-in-cognitive-science.html#cb222-2" tabindex="-1"></a>loo_viz_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb222-3"><a href="model-comparison-in-cognitive-science.html#cb222-3" tabindex="-1"></a>  <span class="at">iteration =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_data, <span class="at">each =</span> n_data),</span>
<span id="cb222-4"><a href="model-comparison-in-cognitive-science.html#cb222-4" tabindex="-1"></a>  <span class="at">data_point =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_data, n_data),</span>
<span id="cb222-5"><a href="model-comparison-in-cognitive-science.html#cb222-5" tabindex="-1"></a>  <span class="at">role =</span> <span class="fu">ifelse</span>(iteration <span class="sc">==</span> data_point, <span class="st">&quot;test&quot;</span>, <span class="st">&quot;train&quot;</span>),</span>
<span id="cb222-6"><a href="model-comparison-in-cognitive-science.html#cb222-6" tabindex="-1"></a>  <span class="at">approach =</span> <span class="st">&quot;LOO CV&quot;</span></span>
<span id="cb222-7"><a href="model-comparison-in-cognitive-science.html#cb222-7" tabindex="-1"></a>)</span>
<span id="cb222-8"><a href="model-comparison-in-cognitive-science.html#cb222-8" tabindex="-1"></a></span>
<span id="cb222-9"><a href="model-comparison-in-cognitive-science.html#cb222-9" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb222-10"><a href="model-comparison-in-cognitive-science.html#cb222-10" tabindex="-1"></a><span class="fu">ggplot</span>(loo_viz_data, <span class="fu">aes</span>(<span class="at">x =</span> data_point, <span class="at">y =</span> iteration, <span class="at">fill =</span> role)) <span class="sc">+</span></span>
<span id="cb222-11"><a href="model-comparison-in-cognitive-science.html#cb222-11" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb222-12"><a href="model-comparison-in-cognitive-science.html#cb222-12" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> role_colors, <span class="at">name =</span> <span class="st">&quot;Data Role&quot;</span>) <span class="sc">+</span></span>
<span id="cb222-13"><a href="model-comparison-in-cognitive-science.html#cb222-13" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb222-14"><a href="model-comparison-in-cognitive-science.html#cb222-14" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Leave-One-Out Cross-Validation&quot;</span>,</span>
<span id="cb222-15"><a href="model-comparison-in-cognitive-science.html#cb222-15" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Each row shows one iteration, columns represent data points&quot;</span>,</span>
<span id="cb222-16"><a href="model-comparison-in-cognitive-science.html#cb222-16" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Data Point&quot;</span>,</span>
<span id="cb222-17"><a href="model-comparison-in-cognitive-science.html#cb222-17" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Iteration&quot;</span>,</span>
<span id="cb222-18"><a href="model-comparison-in-cognitive-science.html#cb222-18" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Data Usage&quot;</span></span>
<span id="cb222-19"><a href="model-comparison-in-cognitive-science.html#cb222-19" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb222-20"><a href="model-comparison-in-cognitive-science.html#cb222-20" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb222-21"><a href="model-comparison-in-cognitive-science.html#cb222-21" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb222-22"><a href="model-comparison-in-cognitive-science.html#cb222-22" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb222-23"><a href="model-comparison-in-cognitive-science.html#cb222-23" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb222-24"><a href="model-comparison-in-cognitive-science.html#cb222-24" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-25-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="cross-validation-in-bayesian-models" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Cross-Validation in Bayesian Models<a href="model-comparison-in-cognitive-science.html#cross-validation-in-bayesian-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cross-validation is especially important in Bayesian modeling for several reasons:</p>
<ol style="list-style-type: decimal">
<li>Bayesian models can be highly parameterized and prone to overfitting</li>
<li>Prior choices can significantly influence model performance</li>
<li>The complexity of hierarchical structures needs careful validation</li>
<li>We often need to compare competing theoretical accounts</li>
</ol>
<p>However, cross-validation for Bayesian models presents two key challenges:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Computational cost</strong>: Bayesian models fitted with MCMC can take hours or days to run, making it impractical to refit them k times for cross-validation</p></li>
<li><p><strong>Proper scoring</strong>: We need appropriate metrics for evaluating predictive performance in a Bayesian framework</p></li>
</ol>
<p>Next, weâ€™ll see how these challenges are addressed.</p>
</div>
<div id="expected-log-predictive-density-elpd" class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Expected Log Predictive Density (ELPD)<a href="model-comparison-in-cognitive-science.html#expected-log-predictive-density-elpd" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When comparing Bayesian models, we use the expected log predictive density (ELPD) as our metric. This measures how well the model predicts new data points on the log scale.</p>
<p>For a single observation, the log predictive density is:</p>
<p><span class="math display">\[\log p(y_i | y_{-i})\]</span></p>
<p>where <span class="math inline">\(y_i\)</span> is the observation weâ€™re trying to predict, and <span class="math inline">\(y_{-i}\)</span> represents all other observations that were used for training.</p>
<p>For the entire dataset, we sum across all observations:</p>
<p><span class="math display">\[\text{ELPD} = \sum_{i=1}^{n} \log p(y_i | y_{-i})\]</span></p>
<p>The ELPD has several desirable properties:</p>
<ol style="list-style-type: decimal">
<li>It accounts for the full predictive distribution, not just point estimates</li>
<li>It automatically penalizes overconfident models</li>
<li>Higher values indicate better predictive performance</li>
</ol>
<p>Computing the ELPD exactly requires fitting the model n times (for n data points), which brings us back to the computational challenge.</p>
</div>
</div>
<div id="psis-loo-an-efficient-approximation-to-loo-cv" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> PSIS-LOO: An Efficient Approximation to LOO-CV<a href="model-comparison-in-cognitive-science.html#psis-loo-an-efficient-approximation-to-loo-cv" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For complex Bayesian models, true leave-one-out cross-validation (LOO-CV) is often computationally infeasible. Pareto-smoothed importance sampling leave-one-out cross-validation (PSIS-LOO) provides an elegant solution by approximating LOO-CV using just a single model fit.</p>
<div id="how-importance-sampling-works" class="section level3 hasAnchor" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> How Importance Sampling Works<a href="model-comparison-in-cognitive-science.html#how-importance-sampling-works" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we fit a Bayesian model, we obtain samples from the posterior distribution <span class="math inline">\(p(\theta|y_1,...,y_n)\)</span> - the distribution of model parameters given all observations. For LOO-CV, we need <span class="math inline">\(p(\theta|y_1,...,y_{i-1},y_{i+1},...,y_n)\)</span> - the distribution without the i-th observation.</p>
<p>Importance sampling bridges this gap by reweighting the full posterior samples to approximate the LOO posterior. The importance weights for the i-th observation are:</p>
<p><span class="math display">\[w_i(\theta) = \frac{p(\theta|y_1,...,y_{i-1},y_{i+1},...,y_n)}{p(\theta|y_1,...,y_n)} \propto \frac{1}{p(y_i|\theta)}\]</span></p>
<p>By Bayesâ€™ theorem, this simplifies to:</p>
<p>w_i(Î¸) âˆ 1 / p(yáµ¢|Î¸)</p>
<p>These weights effectively â€œundoâ€ the influence of the i-th observation on the posterior.</p>
<p>However, standard importance sampling can be unstable when:
* The full posterior and LOO posterior differ substantially
* Some importance weights become extremely large
* The variance of the weights is high</p>
</div>
<div id="pareto-smoothing-for-stability" class="section level3 hasAnchor" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> Pareto Smoothing for Stability<a href="model-comparison-in-cognitive-science.html#pareto-smoothing-for-stability" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pareto smoothing improves the reliability of importance sampling:</p>
<ol style="list-style-type: decimal">
<li>Fit a generalized Pareto distribution to the largest importance weights</li>
<li>Replace the largest weights with values from this smoothed distribution</li>
<li>Use the modified weights for more stable LOO estimation</li>
</ol>
<p>The diagnostic parameter k from the Pareto fit helps assess reliability:
* k &lt; 0.5: Reliable estimation
* 0.5 &lt; k &lt; 0.7: Somewhat reliable, proceed with caution
* k &gt; 0.7: Unreliable, consider using other methods for this observation</p>
<p>These diagnostics help identify problematic observations that might require more attention or alternative methods.</p>
</div>
<div id="the-complete-psis-loo-process" class="section level3 hasAnchor" number="8.4.3">
<h3><span class="header-section-number">8.4.3</span> The Complete PSIS-LOO Process<a href="model-comparison-in-cognitive-science.html#the-complete-psis-loo-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The full PSIS-LOO method follows these steps:</p>
<p>Fit the Bayesian model once to all available data</p>
<p>For each observation i:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Calculate raw importance weights using the log-likelihood: w_i(Î¸) âˆ 1/p(yáµ¢|Î¸)</p></li>
<li><p>Apply Pareto smoothing to stabilize the largest weights</p></li>
<li><p>Normalize the smoothed weights</p></li>
<li><p>Use the weights to compute the expected log predictive density (ELPD)</p></li>
</ol>
<p>Sum the individual ELPD contributions to get the overall PSIS-LOO estimate</p>
<p>[I NEED TO FIND A BETTER WAY TO EXPLAIN AND VISUALIZE!]</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="model-comparison-in-cognitive-science.html#cb223-1" tabindex="-1"></a><span class="co"># Create improved visualizations of PSIS-LOO</span></span>
<span id="cb223-2"><a href="model-comparison-in-cognitive-science.html#cb223-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb223-3"><a href="model-comparison-in-cognitive-science.html#cb223-3" tabindex="-1"></a></span>
<span id="cb223-4"><a href="model-comparison-in-cognitive-science.html#cb223-4" tabindex="-1"></a><span class="co"># Generate some sample data</span></span>
<span id="cb223-5"><a href="model-comparison-in-cognitive-science.html#cb223-5" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb223-6"><a href="model-comparison-in-cognitive-science.html#cb223-6" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">length.out =</span> n)</span>
<span id="cb223-7"><a href="model-comparison-in-cognitive-science.html#cb223-7" tabindex="-1"></a>y_true <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb223-8"><a href="model-comparison-in-cognitive-science.html#cb223-8" tabindex="-1"></a>y <span class="ot">&lt;-</span> y_true <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb223-9"><a href="model-comparison-in-cognitive-science.html#cb223-9" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb223-10"><a href="model-comparison-in-cognitive-science.html#cb223-10" tabindex="-1"></a></span>
<span id="cb223-11"><a href="model-comparison-in-cognitive-science.html#cb223-11" tabindex="-1"></a><span class="co"># Fit a simple model to all data (this will be our &quot;Bayesian model&quot;)</span></span>
<span id="cb223-12"><a href="model-comparison-in-cognitive-science.html#cb223-12" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb223-13"><a href="model-comparison-in-cognitive-science.html#cb223-13" tabindex="-1"></a>full_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(full_model)</span>
<span id="cb223-14"><a href="model-comparison-in-cognitive-science.html#cb223-14" tabindex="-1"></a></span>
<span id="cb223-15"><a href="model-comparison-in-cognitive-science.html#cb223-15" tabindex="-1"></a><span class="co"># Generate posterior samples (simplified for illustration)</span></span>
<span id="cb223-16"><a href="model-comparison-in-cognitive-science.html#cb223-16" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb223-17"><a href="model-comparison-in-cognitive-science.html#cb223-17" tabindex="-1"></a>beta_samples <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_samples, </span>
<span id="cb223-18"><a href="model-comparison-in-cognitive-science.html#cb223-18" tabindex="-1"></a>                       <span class="fu">coef</span>(full_model), </span>
<span id="cb223-19"><a href="model-comparison-in-cognitive-science.html#cb223-19" tabindex="-1"></a>                       <span class="fu">vcov</span>(full_model))</span>
<span id="cb223-20"><a href="model-comparison-in-cognitive-science.html#cb223-20" tabindex="-1"></a>sigma_samples <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">sigma</span>(full_model), n_samples)</span>
<span id="cb223-21"><a href="model-comparison-in-cognitive-science.html#cb223-21" tabindex="-1"></a></span>
<span id="cb223-22"><a href="model-comparison-in-cognitive-science.html#cb223-22" tabindex="-1"></a><span class="co"># Function to compute log-likelihood for each observation given parameters</span></span>
<span id="cb223-23"><a href="model-comparison-in-cognitive-science.html#cb223-23" tabindex="-1"></a>log_lik <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, sigma, x, y) {</span>
<span id="cb223-24"><a href="model-comparison-in-cognitive-science.html#cb223-24" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> beta[<span class="dv">1</span>] <span class="sc">+</span> beta[<span class="dv">2</span>] <span class="sc">*</span> x <span class="sc">+</span> beta[<span class="dv">3</span>] <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb223-25"><a href="model-comparison-in-cognitive-science.html#cb223-25" tabindex="-1"></a>  <span class="fu">dnorm</span>(y, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb223-26"><a href="model-comparison-in-cognitive-science.html#cb223-26" tabindex="-1"></a>}</span>
<span id="cb223-27"><a href="model-comparison-in-cognitive-science.html#cb223-27" tabindex="-1"></a></span>
<span id="cb223-28"><a href="model-comparison-in-cognitive-science.html#cb223-28" tabindex="-1"></a><span class="co"># Compute log-likelihood matrix (n_samples Ã— n_observations)</span></span>
<span id="cb223-29"><a href="model-comparison-in-cognitive-science.html#cb223-29" tabindex="-1"></a>log_lik_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_samples, <span class="at">ncol =</span> n)</span>
<span id="cb223-30"><a href="model-comparison-in-cognitive-science.html#cb223-30" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_samples) {</span>
<span id="cb223-31"><a href="model-comparison-in-cognitive-science.html#cb223-31" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb223-32"><a href="model-comparison-in-cognitive-science.html#cb223-32" tabindex="-1"></a>    log_lik_matrix[i, j] <span class="ot">&lt;-</span> <span class="fu">log_lik</span>(beta_samples[i,], sigma_samples[i], x[j], y[j])</span>
<span id="cb223-33"><a href="model-comparison-in-cognitive-science.html#cb223-33" tabindex="-1"></a>  }</span>
<span id="cb223-34"><a href="model-comparison-in-cognitive-science.html#cb223-34" tabindex="-1"></a>}</span>
<span id="cb223-35"><a href="model-comparison-in-cognitive-science.html#cb223-35" tabindex="-1"></a></span>
<span id="cb223-36"><a href="model-comparison-in-cognitive-science.html#cb223-36" tabindex="-1"></a><span class="co"># Select a point for demonstration</span></span>
<span id="cb223-37"><a href="model-comparison-in-cognitive-science.html#cb223-37" tabindex="-1"></a>loo_idx <span class="ot">&lt;-</span> <span class="dv">25</span>  <span class="co"># This will be our &quot;left out&quot; point</span></span>
<span id="cb223-38"><a href="model-comparison-in-cognitive-science.html#cb223-38" tabindex="-1"></a></span>
<span id="cb223-39"><a href="model-comparison-in-cognitive-science.html#cb223-39" tabindex="-1"></a><span class="co"># Calculate raw importance weights for the selected point</span></span>
<span id="cb223-40"><a href="model-comparison-in-cognitive-science.html#cb223-40" tabindex="-1"></a>log_weights <span class="ot">&lt;-</span> <span class="sc">-</span>log_lik_matrix[, loo_idx]  <span class="co"># Negative log-likelihood</span></span>
<span id="cb223-41"><a href="model-comparison-in-cognitive-science.html#cb223-41" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_weights <span class="sc">-</span> <span class="fu">max</span>(log_weights))  <span class="co"># Stabilize by subtracting max</span></span>
<span id="cb223-42"><a href="model-comparison-in-cognitive-science.html#cb223-42" tabindex="-1"></a></span>
<span id="cb223-43"><a href="model-comparison-in-cognitive-science.html#cb223-43" tabindex="-1"></a><span class="co"># Function to simulate Pareto smoothing (simplified)</span></span>
<span id="cb223-44"><a href="model-comparison-in-cognitive-science.html#cb223-44" tabindex="-1"></a>pareto_smooth <span class="ot">&lt;-</span> <span class="cf">function</span>(weights) {</span>
<span id="cb223-45"><a href="model-comparison-in-cognitive-science.html#cb223-45" tabindex="-1"></a>  <span class="co"># Sort weights</span></span>
<span id="cb223-46"><a href="model-comparison-in-cognitive-science.html#cb223-46" tabindex="-1"></a>  sorted_weights <span class="ot">&lt;-</span> <span class="fu">sort</span>(weights, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb223-47"><a href="model-comparison-in-cognitive-science.html#cb223-47" tabindex="-1"></a>  n_tail <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">500</span>, <span class="fu">length</span>(weights) <span class="sc">/</span> <span class="dv">5</span>)  <span class="co"># Top 20% or 500, whichever is smaller</span></span>
<span id="cb223-48"><a href="model-comparison-in-cognitive-science.html#cb223-48" tabindex="-1"></a>  </span>
<span id="cb223-49"><a href="model-comparison-in-cognitive-science.html#cb223-49" tabindex="-1"></a>  <span class="co"># Fit generalized Pareto to the tail (simplified)</span></span>
<span id="cb223-50"><a href="model-comparison-in-cognitive-science.html#cb223-50" tabindex="-1"></a>  <span class="co"># In practice, actual fitting would be used</span></span>
<span id="cb223-51"><a href="model-comparison-in-cognitive-science.html#cb223-51" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fl">0.4</span>  <span class="co"># Simulated Pareto shape parameter</span></span>
<span id="cb223-52"><a href="model-comparison-in-cognitive-science.html#cb223-52" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> <span class="fu">mean</span>(sorted_weights[<span class="dv">1</span><span class="sc">:</span>n_tail]) <span class="sc">*</span> <span class="fl">0.8</span></span>
<span id="cb223-53"><a href="model-comparison-in-cognitive-science.html#cb223-53" tabindex="-1"></a>  </span>
<span id="cb223-54"><a href="model-comparison-in-cognitive-science.html#cb223-54" tabindex="-1"></a>  <span class="co"># Smooth the tail weights</span></span>
<span id="cb223-55"><a href="model-comparison-in-cognitive-science.html#cb223-55" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_tail) {</span>
<span id="cb223-56"><a href="model-comparison-in-cognitive-science.html#cb223-56" tabindex="-1"></a>    q <span class="ot">&lt;-</span> (i <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">/</span> n_tail</span>
<span id="cb223-57"><a href="model-comparison-in-cognitive-science.html#cb223-57" tabindex="-1"></a>    sorted_weights[i] <span class="ot">&lt;-</span> sigma<span class="sc">/</span>k <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> q)<span class="sc">^</span>(<span class="sc">-</span>k) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb223-58"><a href="model-comparison-in-cognitive-science.html#cb223-58" tabindex="-1"></a>  }</span>
<span id="cb223-59"><a href="model-comparison-in-cognitive-science.html#cb223-59" tabindex="-1"></a>  </span>
<span id="cb223-60"><a href="model-comparison-in-cognitive-science.html#cb223-60" tabindex="-1"></a>  <span class="co"># Rearrange to original order</span></span>
<span id="cb223-61"><a href="model-comparison-in-cognitive-science.html#cb223-61" tabindex="-1"></a>  smoothed_weights <span class="ot">&lt;-</span> weights</span>
<span id="cb223-62"><a href="model-comparison-in-cognitive-science.html#cb223-62" tabindex="-1"></a>  smoothed_weights[<span class="fu">order</span>(weights, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span>n_tail]] <span class="ot">&lt;-</span> sorted_weights[<span class="dv">1</span><span class="sc">:</span>n_tail]</span>
<span id="cb223-63"><a href="model-comparison-in-cognitive-science.html#cb223-63" tabindex="-1"></a>  </span>
<span id="cb223-64"><a href="model-comparison-in-cognitive-science.html#cb223-64" tabindex="-1"></a>  <span class="fu">return</span>(smoothed_weights)</span>
<span id="cb223-65"><a href="model-comparison-in-cognitive-science.html#cb223-65" tabindex="-1"></a>}</span>
<span id="cb223-66"><a href="model-comparison-in-cognitive-science.html#cb223-66" tabindex="-1"></a></span>
<span id="cb223-67"><a href="model-comparison-in-cognitive-science.html#cb223-67" tabindex="-1"></a><span class="co"># Apply simulated Pareto smoothing</span></span>
<span id="cb223-68"><a href="model-comparison-in-cognitive-science.html#cb223-68" tabindex="-1"></a>smoothed_weights <span class="ot">&lt;-</span> <span class="fu">pareto_smooth</span>(weights)</span>
<span id="cb223-69"><a href="model-comparison-in-cognitive-science.html#cb223-69" tabindex="-1"></a></span>
<span id="cb223-70"><a href="model-comparison-in-cognitive-science.html#cb223-70" tabindex="-1"></a><span class="co"># Normalize weights</span></span>
<span id="cb223-71"><a href="model-comparison-in-cognitive-science.html#cb223-71" tabindex="-1"></a>raw_norm_weights <span class="ot">&lt;-</span> weights <span class="sc">/</span> <span class="fu">sum</span>(weights)</span>
<span id="cb223-72"><a href="model-comparison-in-cognitive-science.html#cb223-72" tabindex="-1"></a>smoothed_norm_weights <span class="ot">&lt;-</span> smoothed_weights <span class="sc">/</span> <span class="fu">sum</span>(smoothed_weights)</span>
<span id="cb223-73"><a href="model-comparison-in-cognitive-science.html#cb223-73" tabindex="-1"></a></span>
<span id="cb223-74"><a href="model-comparison-in-cognitive-science.html#cb223-74" tabindex="-1"></a><span class="co"># Calculate true LOO prediction for comparison</span></span>
<span id="cb223-75"><a href="model-comparison-in-cognitive-science.html#cb223-75" tabindex="-1"></a>loo_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y[<span class="sc">-</span>loo_idx] <span class="sc">~</span> x[<span class="sc">-</span>loo_idx] <span class="sc">+</span> <span class="fu">I</span>(x[<span class="sc">-</span>loo_idx]<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb223-76"><a href="model-comparison-in-cognitive-science.html#cb223-76" tabindex="-1"></a>loo_prediction <span class="ot">&lt;-</span> <span class="fu">predict</span>(loo_model, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x[loo_idx]))</span>
<span id="cb223-77"><a href="model-comparison-in-cognitive-science.html#cb223-77" tabindex="-1"></a></span>
<span id="cb223-78"><a href="model-comparison-in-cognitive-science.html#cb223-78" tabindex="-1"></a><span class="co"># Calculate PSIS-LOO prediction for the point</span></span>
<span id="cb223-79"><a href="model-comparison-in-cognitive-science.html#cb223-79" tabindex="-1"></a>psis_prediction <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb223-80"><a href="model-comparison-in-cognitive-science.html#cb223-80" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_samples) {</span>
<span id="cb223-81"><a href="model-comparison-in-cognitive-science.html#cb223-81" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> beta_samples[i,]</span>
<span id="cb223-82"><a href="model-comparison-in-cognitive-science.html#cb223-82" tabindex="-1"></a>  psis_prediction <span class="ot">&lt;-</span> psis_prediction <span class="sc">+</span> smoothed_norm_weights[i] <span class="sc">*</span> </span>
<span id="cb223-83"><a href="model-comparison-in-cognitive-science.html#cb223-83" tabindex="-1"></a>    (beta[<span class="dv">1</span>] <span class="sc">+</span> beta[<span class="dv">2</span>] <span class="sc">*</span> x[loo_idx] <span class="sc">+</span> beta[<span class="dv">3</span>] <span class="sc">*</span> x[loo_idx]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb223-84"><a href="model-comparison-in-cognitive-science.html#cb223-84" tabindex="-1"></a>}</span>
<span id="cb223-85"><a href="model-comparison-in-cognitive-science.html#cb223-85" tabindex="-1"></a></span>
<span id="cb223-86"><a href="model-comparison-in-cognitive-science.html#cb223-86" tabindex="-1"></a><span class="co"># Create visualization data</span></span>
<span id="cb223-87"><a href="model-comparison-in-cognitive-science.html#cb223-87" tabindex="-1"></a>viz_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb223-88"><a href="model-comparison-in-cognitive-science.html#cb223-88" tabindex="-1"></a>  <span class="at">x =</span> x,</span>
<span id="cb223-89"><a href="model-comparison-in-cognitive-science.html#cb223-89" tabindex="-1"></a>  <span class="at">y =</span> y,</span>
<span id="cb223-90"><a href="model-comparison-in-cognitive-science.html#cb223-90" tabindex="-1"></a>  <span class="at">full_fit =</span> full_predictions,</span>
<span id="cb223-91"><a href="model-comparison-in-cognitive-science.html#cb223-91" tabindex="-1"></a>  <span class="at">highlighted =</span> <span class="fu">ifelse</span>(<span class="fu">seq_along</span>(x) <span class="sc">==</span> loo_idx, <span class="st">&quot;Point Left Out&quot;</span>, <span class="st">&quot;Other Points&quot;</span>)</span>
<span id="cb223-92"><a href="model-comparison-in-cognitive-science.html#cb223-92" tabindex="-1"></a>)</span>
<span id="cb223-93"><a href="model-comparison-in-cognitive-science.html#cb223-93" tabindex="-1"></a></span>
<span id="cb223-94"><a href="model-comparison-in-cognitive-science.html#cb223-94" tabindex="-1"></a><span class="co"># Sample subset for posterior draws</span></span>
<span id="cb223-95"><a href="model-comparison-in-cognitive-science.html#cb223-95" tabindex="-1"></a>sample_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n_samples, <span class="dv">50</span>)</span>
<span id="cb223-96"><a href="model-comparison-in-cognitive-science.html#cb223-96" tabindex="-1"></a>posterior_lines <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb223-97"><a href="model-comparison-in-cognitive-science.html#cb223-97" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(x, <span class="fu">length</span>(sample_indices)),</span>
<span id="cb223-98"><a href="model-comparison-in-cognitive-science.html#cb223-98" tabindex="-1"></a>  <span class="at">sample =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sample_indices), <span class="at">each =</span> n),</span>
<span id="cb223-99"><a href="model-comparison-in-cognitive-science.html#cb223-99" tabindex="-1"></a>  <span class="at">y_pred =</span> <span class="cn">NA</span></span>
<span id="cb223-100"><a href="model-comparison-in-cognitive-science.html#cb223-100" tabindex="-1"></a>)</span>
<span id="cb223-101"><a href="model-comparison-in-cognitive-science.html#cb223-101" tabindex="-1"></a></span>
<span id="cb223-102"><a href="model-comparison-in-cognitive-science.html#cb223-102" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sample_indices)) {</span>
<span id="cb223-103"><a href="model-comparison-in-cognitive-science.html#cb223-103" tabindex="-1"></a>  s <span class="ot">&lt;-</span> sample_indices[i]</span>
<span id="cb223-104"><a href="model-comparison-in-cognitive-science.html#cb223-104" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> beta_samples[s,]</span>
<span id="cb223-105"><a href="model-comparison-in-cognitive-science.html#cb223-105" tabindex="-1"></a>  posterior_lines<span class="sc">$</span>y_pred[posterior_lines<span class="sc">$</span>sample <span class="sc">==</span> i] <span class="ot">&lt;-</span> </span>
<span id="cb223-106"><a href="model-comparison-in-cognitive-science.html#cb223-106" tabindex="-1"></a>    beta[<span class="dv">1</span>] <span class="sc">+</span> beta[<span class="dv">2</span>] <span class="sc">*</span> x <span class="sc">+</span> beta[<span class="dv">3</span>] <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb223-107"><a href="model-comparison-in-cognitive-science.html#cb223-107" tabindex="-1"></a>}</span>
<span id="cb223-108"><a href="model-comparison-in-cognitive-science.html#cb223-108" tabindex="-1"></a></span>
<span id="cb223-109"><a href="model-comparison-in-cognitive-science.html#cb223-109" tabindex="-1"></a><span class="co"># Create data for weight visualization</span></span>
<span id="cb223-110"><a href="model-comparison-in-cognitive-science.html#cb223-110" tabindex="-1"></a>weight_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb223-111"><a href="model-comparison-in-cognitive-science.html#cb223-111" tabindex="-1"></a>  <span class="at">weight_idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,  <span class="co"># Show only first 100 weights for clarity</span></span>
<span id="cb223-112"><a href="model-comparison-in-cognitive-science.html#cb223-112" tabindex="-1"></a>  <span class="at">raw_weight =</span> raw_norm_weights[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>],</span>
<span id="cb223-113"><a href="model-comparison-in-cognitive-science.html#cb223-113" tabindex="-1"></a>  <span class="at">smoothed_weight =</span> smoothed_norm_weights[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]</span>
<span id="cb223-114"><a href="model-comparison-in-cognitive-science.html#cb223-114" tabindex="-1"></a>)</span>
<span id="cb223-115"><a href="model-comparison-in-cognitive-science.html#cb223-115" tabindex="-1"></a></span>
<span id="cb223-116"><a href="model-comparison-in-cognitive-science.html#cb223-116" tabindex="-1"></a><span class="co"># PLOT 1: Data and model fit</span></span>
<span id="cb223-117"><a href="model-comparison-in-cognitive-science.html#cb223-117" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(viz_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb223-118"><a href="model-comparison-in-cognitive-science.html#cb223-118" tabindex="-1"></a>  <span class="co"># Add posterior draws</span></span>
<span id="cb223-119"><a href="model-comparison-in-cognitive-science.html#cb223-119" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> posterior_lines, <span class="fu">aes</span>(<span class="at">y =</span> y_pred, <span class="at">group =</span> sample), </span>
<span id="cb223-120"><a href="model-comparison-in-cognitive-science.html#cb223-120" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-121"><a href="model-comparison-in-cognitive-science.html#cb223-121" tabindex="-1"></a>  </span>
<span id="cb223-122"><a href="model-comparison-in-cognitive-science.html#cb223-122" tabindex="-1"></a>  <span class="co"># Add full model fit</span></span>
<span id="cb223-123"><a href="model-comparison-in-cognitive-science.html#cb223-123" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> full_fit), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb223-124"><a href="model-comparison-in-cognitive-science.html#cb223-124" tabindex="-1"></a>  </span>
<span id="cb223-125"><a href="model-comparison-in-cognitive-science.html#cb223-125" tabindex="-1"></a>  <span class="co"># Add data points</span></span>
<span id="cb223-126"><a href="model-comparison-in-cognitive-science.html#cb223-126" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> highlighted, <span class="at">size =</span> highlighted), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb223-127"><a href="model-comparison-in-cognitive-science.html#cb223-127" tabindex="-1"></a>  </span>
<span id="cb223-128"><a href="model-comparison-in-cognitive-science.html#cb223-128" tabindex="-1"></a>  <span class="co"># Add predictions for the left-out point</span></span>
<span id="cb223-129"><a href="model-comparison-in-cognitive-science.html#cb223-129" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb223-130"><a href="model-comparison-in-cognitive-science.html#cb223-130" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x[loo_idx], <span class="at">y =</span> y[loo_idx], <span class="at">xend =</span> x[loo_idx], <span class="at">yend =</span> loo_prediction),</span>
<span id="cb223-131"><a href="model-comparison-in-cognitive-science.html#cb223-131" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">&quot;cm&quot;</span>)), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span></span>
<span id="cb223-132"><a href="model-comparison-in-cognitive-science.html#cb223-132" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb223-133"><a href="model-comparison-in-cognitive-science.html#cb223-133" tabindex="-1"></a>  <span class="co"># Add the true LOO prediction point</span></span>
<span id="cb223-134"><a href="model-comparison-in-cognitive-science.html#cb223-134" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb223-135"><a href="model-comparison-in-cognitive-science.html#cb223-135" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x[loo_idx], <span class="at">y =</span> loo_prediction),</span>
<span id="cb223-136"><a href="model-comparison-in-cognitive-science.html#cb223-136" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">18</span></span>
<span id="cb223-137"><a href="model-comparison-in-cognitive-science.html#cb223-137" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb223-138"><a href="model-comparison-in-cognitive-science.html#cb223-138" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb223-139"><a href="model-comparison-in-cognitive-science.html#cb223-139" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x[loo_idx] <span class="sc">+</span> <span class="fl">0.1</span>, <span class="at">y =</span> y[loo_idx], <span class="at">xend =</span> x[loo_idx] <span class="sc">+</span> <span class="fl">0.1</span>, <span class="at">yend =</span> psis_prediction),</span>
<span id="cb223-140"><a href="model-comparison-in-cognitive-science.html#cb223-140" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">&quot;cm&quot;</span>)), <span class="at">color =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span></span>
<span id="cb223-141"><a href="model-comparison-in-cognitive-science.html#cb223-141" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb223-142"><a href="model-comparison-in-cognitive-science.html#cb223-142" tabindex="-1"></a>  <span class="co"># Add the PSIS-LOO prediction point</span></span>
<span id="cb223-143"><a href="model-comparison-in-cognitive-science.html#cb223-143" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb223-144"><a href="model-comparison-in-cognitive-science.html#cb223-144" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x[loo_idx] <span class="sc">+</span> <span class="fl">0.1</span>, <span class="at">y =</span> psis_prediction),</span>
<span id="cb223-145"><a href="model-comparison-in-cognitive-science.html#cb223-145" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">18</span></span>
<span id="cb223-146"><a href="model-comparison-in-cognitive-science.html#cb223-146" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb223-147"><a href="model-comparison-in-cognitive-science.html#cb223-147" tabindex="-1"></a>  </span>
<span id="cb223-148"><a href="model-comparison-in-cognitive-science.html#cb223-148" tabindex="-1"></a>  <span class="co"># Add legend annotations</span></span>
<span id="cb223-149"><a href="model-comparison-in-cognitive-science.html#cb223-149" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> x[loo_idx] <span class="sc">-</span> <span class="fl">0.3</span>, <span class="at">y =</span> (y[loo_idx] <span class="sc">+</span> loo_prediction)<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb223-150"><a href="model-comparison-in-cognitive-science.html#cb223-150" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;True LOO&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb223-151"><a href="model-comparison-in-cognitive-science.html#cb223-151" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> x[loo_idx] <span class="sc">+</span> <span class="fl">0.4</span>, <span class="at">y =</span> (y[loo_idx] <span class="sc">+</span> psis_prediction)<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb223-152"><a href="model-comparison-in-cognitive-science.html#cb223-152" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;PSIS-LOO&quot;</span>, <span class="at">color =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb223-153"><a href="model-comparison-in-cognitive-science.html#cb223-153" tabindex="-1"></a>  </span>
<span id="cb223-154"><a href="model-comparison-in-cognitive-science.html#cb223-154" tabindex="-1"></a>  <span class="co"># Styling</span></span>
<span id="cb223-155"><a href="model-comparison-in-cognitive-science.html#cb223-155" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Other Points&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>, <span class="st">&quot;Point Left Out&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb223-156"><a href="model-comparison-in-cognitive-science.html#cb223-156" tabindex="-1"></a>  <span class="fu">scale_size_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Other Points&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;Point Left Out&quot;</span> <span class="ot">=</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb223-157"><a href="model-comparison-in-cognitive-science.html#cb223-157" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb223-158"><a href="model-comparison-in-cognitive-science.html#cb223-158" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;PSIS-LOO Approximation of Leave-One-Out Cross-Validation&quot;</span>,</span>
<span id="cb223-159"><a href="model-comparison-in-cognitive-science.html#cb223-159" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Comparing true LOO (red) vs. PSIS-LOO approximation (purple)&quot;</span>,</span>
<span id="cb223-160"><a href="model-comparison-in-cognitive-science.html#cb223-160" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb223-161"><a href="model-comparison-in-cognitive-science.html#cb223-161" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb223-162"><a href="model-comparison-in-cognitive-science.html#cb223-162" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb223-163"><a href="model-comparison-in-cognitive-science.html#cb223-163" tabindex="-1"></a>    <span class="at">size =</span> <span class="cn">NULL</span></span>
<span id="cb223-164"><a href="model-comparison-in-cognitive-science.html#cb223-164" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb223-165"><a href="model-comparison-in-cognitive-science.html#cb223-165" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb223-166"><a href="model-comparison-in-cognitive-science.html#cb223-166" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb223-167"><a href="model-comparison-in-cognitive-science.html#cb223-167" tabindex="-1"></a></span>
<span id="cb223-168"><a href="model-comparison-in-cognitive-science.html#cb223-168" tabindex="-1"></a><span class="co"># PLOT 2: Importance weights before and after Pareto smoothing</span></span>
<span id="cb223-169"><a href="model-comparison-in-cognitive-science.html#cb223-169" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(weight_data, <span class="fu">aes</span>(<span class="at">x =</span> weight_idx)) <span class="sc">+</span></span>
<span id="cb223-170"><a href="model-comparison-in-cognitive-science.html#cb223-170" tabindex="-1"></a>  <span class="co"># Raw weights</span></span>
<span id="cb223-171"><a href="model-comparison-in-cognitive-science.html#cb223-171" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> weight_idx, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> raw_weight), </span>
<span id="cb223-172"><a href="model-comparison-in-cognitive-science.html#cb223-172" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb223-173"><a href="model-comparison-in-cognitive-science.html#cb223-173" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> raw_weight), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb223-174"><a href="model-comparison-in-cognitive-science.html#cb223-174" tabindex="-1"></a>  </span>
<span id="cb223-175"><a href="model-comparison-in-cognitive-science.html#cb223-175" tabindex="-1"></a>  <span class="co"># Smoothed weights</span></span>
<span id="cb223-176"><a href="model-comparison-in-cognitive-science.html#cb223-176" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> weight_idx, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> smoothed_weight), </span>
<span id="cb223-177"><a href="model-comparison-in-cognitive-science.html#cb223-177" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb223-178"><a href="model-comparison-in-cognitive-science.html#cb223-178" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> smoothed_weight), <span class="at">color =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb223-179"><a href="model-comparison-in-cognitive-science.html#cb223-179" tabindex="-1"></a>  </span>
<span id="cb223-180"><a href="model-comparison-in-cognitive-science.html#cb223-180" tabindex="-1"></a>  <span class="co"># Connect raw and smoothed weights for visual clarity</span></span>
<span id="cb223-181"><a href="model-comparison-in-cognitive-science.html#cb223-181" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> weight_idx, <span class="at">y =</span> raw_weight, <span class="at">yend =</span> smoothed_weight),</span>
<span id="cb223-182"><a href="model-comparison-in-cognitive-science.html#cb223-182" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>)), </span>
<span id="cb223-183"><a href="model-comparison-in-cognitive-science.html#cb223-183" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb223-184"><a href="model-comparison-in-cognitive-science.html#cb223-184" tabindex="-1"></a>  </span>
<span id="cb223-185"><a href="model-comparison-in-cognitive-science.html#cb223-185" tabindex="-1"></a>  <span class="co"># Styling</span></span>
<span id="cb223-186"><a href="model-comparison-in-cognitive-science.html#cb223-186" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb223-187"><a href="model-comparison-in-cognitive-science.html#cb223-187" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Importance Sampling Weights for PSIS-LOO&quot;</span>,</span>
<span id="cb223-188"><a href="model-comparison-in-cognitive-science.html#cb223-188" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Pareto smoothing stabilizes extreme weights (arrows show the adjustment)&quot;</span>,</span>
<span id="cb223-189"><a href="model-comparison-in-cognitive-science.html#cb223-189" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Sample Index (ordered by weight)&quot;</span>,</span>
<span id="cb223-190"><a href="model-comparison-in-cognitive-science.html#cb223-190" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Normalized Weight&quot;</span></span>
<span id="cb223-191"><a href="model-comparison-in-cognitive-science.html#cb223-191" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb223-192"><a href="model-comparison-in-cognitive-science.html#cb223-192" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb223-193"><a href="model-comparison-in-cognitive-science.html#cb223-193" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb223-194"><a href="model-comparison-in-cognitive-science.html#cb223-194" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">20</span>, <span class="at">y =</span> <span class="fu">max</span>(weight_data<span class="sc">$</span>raw_weight) <span class="sc">*</span> <span class="fl">0.9</span>, </span>
<span id="cb223-195"><a href="model-comparison-in-cognitive-science.html#cb223-195" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;Before smoothing&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb223-196"><a href="model-comparison-in-cognitive-science.html#cb223-196" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">60</span>, <span class="at">y =</span> <span class="fu">max</span>(weight_data<span class="sc">$</span>smoothed_weight) <span class="sc">*</span> <span class="fl">0.9</span>, </span>
<span id="cb223-197"><a href="model-comparison-in-cognitive-science.html#cb223-197" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;After Pareto smoothing&quot;</span>, <span class="at">color =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb223-198"><a href="model-comparison-in-cognitive-science.html#cb223-198" tabindex="-1"></a></span>
<span id="cb223-199"><a href="model-comparison-in-cognitive-science.html#cb223-199" tabindex="-1"></a><span class="co"># PLOT 3: Conceptual diagram of PSIS-LOO process</span></span>
<span id="cb223-200"><a href="model-comparison-in-cognitive-science.html#cb223-200" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb223-201"><a href="model-comparison-in-cognitive-science.html#cb223-201" tabindex="-1"></a>  <span class="co"># Add process steps</span></span>
<span id="cb223-202"><a href="model-comparison-in-cognitive-science.html#cb223-202" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="at">xmin =</span> <span class="fl">0.5</span>, <span class="at">xmax =</span> <span class="fl">3.5</span>, <span class="at">ymin =</span> <span class="dv">4</span>, <span class="at">ymax =</span> <span class="dv">5</span>, </span>
<span id="cb223-203"><a href="model-comparison-in-cognitive-science.html#cb223-203" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-204"><a href="model-comparison-in-cognitive-science.html#cb223-204" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="fl">4.5</span>, </span>
<span id="cb223-205"><a href="model-comparison-in-cognitive-science.html#cb223-205" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;1. Fit Model to All Data</span><span class="sc">\n</span><span class="st">Obtain posterior samples p(Î¸|yâ‚,...,yâ‚™)&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-206"><a href="model-comparison-in-cognitive-science.html#cb223-206" tabindex="-1"></a>  </span>
<span id="cb223-207"><a href="model-comparison-in-cognitive-science.html#cb223-207" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="at">xmin =</span> <span class="fl">0.5</span>, <span class="at">xmax =</span> <span class="fl">3.5</span>, <span class="at">ymin =</span> <span class="fl">2.5</span>, <span class="at">ymax =</span> <span class="fl">3.5</span>, </span>
<span id="cb223-208"><a href="model-comparison-in-cognitive-science.html#cb223-208" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-209"><a href="model-comparison-in-cognitive-science.html#cb223-209" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">3</span>, </span>
<span id="cb223-210"><a href="model-comparison-in-cognitive-science.html#cb223-210" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;2. Calculate Log-Likelihood for Each Observation</span><span class="sc">\n</span><span class="st">â„“áµ¢(Î¸) = log p(yáµ¢|Î¸)&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-211"><a href="model-comparison-in-cognitive-science.html#cb223-211" tabindex="-1"></a>  </span>
<span id="cb223-212"><a href="model-comparison-in-cognitive-science.html#cb223-212" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="at">xmin =</span> <span class="fl">0.5</span>, <span class="at">xmax =</span> <span class="fl">3.5</span>, <span class="at">ymin =</span> <span class="dv">1</span>, <span class="at">ymax =</span> <span class="dv">2</span>, </span>
<span id="cb223-213"><a href="model-comparison-in-cognitive-science.html#cb223-213" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;lightyellow&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-214"><a href="model-comparison-in-cognitive-science.html#cb223-214" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="fl">1.5</span>, </span>
<span id="cb223-215"><a href="model-comparison-in-cognitive-science.html#cb223-215" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;3. Compute Importance Weights</span><span class="sc">\n</span><span class="st">wáµ¢(Î¸) âˆ 1/p(yáµ¢|Î¸)&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-216"><a href="model-comparison-in-cognitive-science.html#cb223-216" tabindex="-1"></a>  </span>
<span id="cb223-217"><a href="model-comparison-in-cognitive-science.html#cb223-217" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="at">xmin =</span> <span class="fl">0.5</span>, <span class="at">xmax =</span> <span class="fl">3.5</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">ymax =</span> <span class="fl">0.5</span>, </span>
<span id="cb223-218"><a href="model-comparison-in-cognitive-science.html#cb223-218" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;mistyrose&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-219"><a href="model-comparison-in-cognitive-science.html#cb223-219" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb223-220"><a href="model-comparison-in-cognitive-science.html#cb223-220" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;4. Apply Pareto Smoothing</span><span class="sc">\n</span><span class="st">Stabilize extreme weights&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-221"><a href="model-comparison-in-cognitive-science.html#cb223-221" tabindex="-1"></a>  </span>
<span id="cb223-222"><a href="model-comparison-in-cognitive-science.html#cb223-222" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="at">xmin =</span> <span class="fl">0.5</span>, <span class="at">xmax =</span> <span class="fl">3.5</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">ymax =</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb223-223"><a href="model-comparison-in-cognitive-science.html#cb223-223" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;lavender&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-224"><a href="model-comparison-in-cognitive-science.html#cb223-224" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">1.5</span>, </span>
<span id="cb223-225"><a href="model-comparison-in-cognitive-science.html#cb223-225" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;5. Compute ELPD Using Smoothed Weights</span><span class="sc">\n</span><span class="st">Approximate leave-one-out prediction&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-226"><a href="model-comparison-in-cognitive-science.html#cb223-226" tabindex="-1"></a>  </span>
<span id="cb223-227"><a href="model-comparison-in-cognitive-science.html#cb223-227" tabindex="-1"></a>  <span class="co"># Add arrows</span></span>
<span id="cb223-228"><a href="model-comparison-in-cognitive-science.html#cb223-228" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">4</span>, <span class="at">xend =</span> <span class="dv">2</span>, <span class="at">yend =</span> <span class="fl">3.5</span>, </span>
<span id="cb223-229"><a href="model-comparison-in-cognitive-science.html#cb223-229" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>))) <span class="sc">+</span></span>
<span id="cb223-230"><a href="model-comparison-in-cognitive-science.html#cb223-230" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="fl">2.5</span>, <span class="at">xend =</span> <span class="dv">2</span>, <span class="at">yend =</span> <span class="dv">2</span>, </span>
<span id="cb223-231"><a href="model-comparison-in-cognitive-science.html#cb223-231" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>))) <span class="sc">+</span></span>
<span id="cb223-232"><a href="model-comparison-in-cognitive-science.html#cb223-232" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">2</span>, <span class="at">yend =</span> <span class="fl">0.5</span>, </span>
<span id="cb223-233"><a href="model-comparison-in-cognitive-science.html#cb223-233" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>))) <span class="sc">+</span></span>
<span id="cb223-234"><a href="model-comparison-in-cognitive-science.html#cb223-234" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">xend =</span> <span class="dv">2</span>, <span class="at">yend =</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb223-235"><a href="model-comparison-in-cognitive-science.html#cb223-235" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>))) <span class="sc">+</span></span>
<span id="cb223-236"><a href="model-comparison-in-cognitive-science.html#cb223-236" tabindex="-1"></a>  </span>
<span id="cb223-237"><a href="model-comparison-in-cognitive-science.html#cb223-237" tabindex="-1"></a>  <span class="co"># Explain the advantage</span></span>
<span id="cb223-238"><a href="model-comparison-in-cognitive-science.html#cb223-238" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">2.7</span>, </span>
<span id="cb223-239"><a href="model-comparison-in-cognitive-science.html#cb223-239" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;PSIS-LOO provides accurate LOO approximation</span><span class="sc">\n</span><span class="st">from a single model fit&quot;</span>,</span>
<span id="cb223-240"><a href="model-comparison-in-cognitive-science.html#cb223-240" tabindex="-1"></a>           <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-241"><a href="model-comparison-in-cognitive-science.html#cb223-241" tabindex="-1"></a>  </span>
<span id="cb223-242"><a href="model-comparison-in-cognitive-science.html#cb223-242" tabindex="-1"></a>  <span class="co"># Add Pareto k value diagnostic information</span></span>
<span id="cb223-243"><a href="model-comparison-in-cognitive-science.html#cb223-243" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="at">xmin =</span> <span class="fl">3.7</span>, <span class="at">xmax =</span> <span class="fl">5.7</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">ymax =</span> <span class="fl">1.5</span>, </span>
<span id="cb223-244"><a href="model-comparison-in-cognitive-science.html#cb223-244" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-245"><a href="model-comparison-in-cognitive-science.html#cb223-245" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="fl">4.7</span>, <span class="at">y =</span> <span class="fl">1.2</span>, <span class="at">label =</span> <span class="st">&quot;Pareto k Diagnostics&quot;</span>, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-246"><a href="model-comparison-in-cognitive-science.html#cb223-246" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="fl">4.7</span>, <span class="at">y =</span> <span class="fl">0.8</span>, <span class="at">label =</span> <span class="st">&quot;k &lt; 0.5: Reliable&quot;</span>, <span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-247"><a href="model-comparison-in-cognitive-science.html#cb223-247" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="fl">4.7</span>, <span class="at">y =</span> <span class="fl">0.4</span>, <span class="at">label =</span> <span class="st">&quot;0.5 &lt; k &lt; 0.7: Use caution&quot;</span>, <span class="at">color =</span> <span class="st">&quot;darkorange&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-248"><a href="model-comparison-in-cognitive-science.html#cb223-248" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="fl">4.7</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">&quot;k &gt; 0.7: Unreliable&quot;</span>, <span class="at">color =</span> <span class="st">&quot;darkred&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-249"><a href="model-comparison-in-cognitive-science.html#cb223-249" tabindex="-1"></a>  </span>
<span id="cb223-250"><a href="model-comparison-in-cognitive-science.html#cb223-250" tabindex="-1"></a>  <span class="co"># Styling</span></span>
<span id="cb223-251"><a href="model-comparison-in-cognitive-science.html#cb223-251" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb223-252"><a href="model-comparison-in-cognitive-science.html#cb223-252" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PSIS-LOO Process Flow&quot;</span>)</span>
<span id="cb223-253"><a href="model-comparison-in-cognitive-science.html#cb223-253" tabindex="-1"></a></span>
<span id="cb223-254"><a href="model-comparison-in-cognitive-science.html#cb223-254" tabindex="-1"></a><span class="co"># Arrange the plots in a grid</span></span>
<span id="cb223-255"><a href="model-comparison-in-cognitive-science.html#cb223-255" tabindex="-1"></a>p1 <span class="sc">/</span> p2 </span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-26-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="model-comparison-in-cognitive-science.html#cb224-1" tabindex="-1"></a>p3</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-26-2.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The red circle represents our â€œleft-outâ€ data point, while the blue line shows the model fit using all data points (including that red circle). The red diamond shows the prediction we get when we actually refit the model without the red circle.</p>
<p>When we fit a model (the blue line), each data point â€œpullsâ€ the model fit toward itself to some degree. The red circle data point influenced the original model to bend slightly closer to it. This is why the red circle appears relatively close to the blue lineâ€”it helped shape that line!</p>
<p>When we perform true leave-one-out cross-validation, we remove that red circle point completely and refit the model using only the remaining data. Without the â€œpullâ€ from that point, the model (which we donâ€™t directly show) follows a slightly different path determined solely by the other points. The prediction from this new model (the red diamond) naturally lands in a different position.</p>
<p>This difference between the original model prediction and the leave-one-out prediction is exactly what makes cross-validation valuable:</p>
<ul>
<li><p>It reveals how much individual data points influence your model</p></li>
<li><p>It gives a more honest assessment of how your model will perform on truly unseen data</p></li>
<li><p>Large differences can help identify influential or outlier points</p></li>
</ul>
<p>The purple diamond (PSIS-LOO prediction) attempts to approximate where that red diamond would be without actually refitting the model, by mathematically down-weighting the influence of the left-out pointâ€”which is why itâ€™s positioned close to the red diamond if the approximation is working well.</p>
</div>
</div>
<div id="simulation-based-model-comparison" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Simulation-Based Model Comparison<a href="model-comparison-in-cognitive-science.html#simulation-based-model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that we understand the principles, letâ€™s apply these techniques to compare cognitive models using a simulation-based approach. This approach has two key advantages:</p>
<ol style="list-style-type: decimal">
<li>We know the â€œground truthâ€ (which model generated each dataset)</li>
<li>We can systematically test if our comparison methods work</li>
</ol>
<p>Weâ€™ll simulate data from two different model types:</p>
<ul>
<li>Biased agents: Make choices based on a fixed bias parameter</li>
<li>Memory agents: Make choices influenced by the history of their opponentâ€™s actions</li>
</ul>
<p>By fitting both models to data generated from each type of agent, we can evaluate whether our model comparison techniques correctly identify the true generating model.</p>
<div id="define-simulation-parameters" class="section level3 hasAnchor" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Define Simulation Parameters<a href="model-comparison-in-cognitive-science.html#define-simulation-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="model-comparison-in-cognitive-science.html#cb225-1" tabindex="-1"></a><span class="co"># Shared parameters</span></span>
<span id="cb225-2"><a href="model-comparison-in-cognitive-science.html#cb225-2" tabindex="-1"></a>agents <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># Number of agents to simulate</span></span>
<span id="cb225-3"><a href="model-comparison-in-cognitive-science.html#cb225-3" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="dv">120</span>  <span class="co"># Number of trials per agent</span></span>
<span id="cb225-4"><a href="model-comparison-in-cognitive-science.html#cb225-4" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="dv">0</span>     <span class="co"># Base noise level (probability of random choice)</span></span>
<span id="cb225-5"><a href="model-comparison-in-cognitive-science.html#cb225-5" tabindex="-1"></a></span>
<span id="cb225-6"><a href="model-comparison-in-cognitive-science.html#cb225-6" tabindex="-1"></a><span class="co"># Biased agents parameters (on log-odds scale)</span></span>
<span id="cb225-7"><a href="model-comparison-in-cognitive-science.html#cb225-7" tabindex="-1"></a>rateM <span class="ot">&lt;-</span> <span class="fl">1.386</span>  <span class="co"># Population mean of bias (~0.8 in probability space)</span></span>
<span id="cb225-8"><a href="model-comparison-in-cognitive-science.html#cb225-8" tabindex="-1"></a>rateSD <span class="ot">&lt;-</span> <span class="fl">0.65</span>  <span class="co"># Population SD of bias (~0.1 in probability space)</span></span>
<span id="cb225-9"><a href="model-comparison-in-cognitive-science.html#cb225-9" tabindex="-1"></a></span>
<span id="cb225-10"><a href="model-comparison-in-cognitive-science.html#cb225-10" tabindex="-1"></a><span class="co"># Memory agents parameters</span></span>
<span id="cb225-11"><a href="model-comparison-in-cognitive-science.html#cb225-11" tabindex="-1"></a>biasM <span class="ot">&lt;-</span> <span class="dv">0</span>      <span class="co"># Population mean of baseline bias</span></span>
<span id="cb225-12"><a href="model-comparison-in-cognitive-science.html#cb225-12" tabindex="-1"></a>biasSD <span class="ot">&lt;-</span> <span class="fl">0.1</span>   <span class="co"># Population SD of baseline bias</span></span>
<span id="cb225-13"><a href="model-comparison-in-cognitive-science.html#cb225-13" tabindex="-1"></a>betaM <span class="ot">&lt;-</span> <span class="fl">1.5</span>    <span class="co"># Population mean of memory sensitivity</span></span>
<span id="cb225-14"><a href="model-comparison-in-cognitive-science.html#cb225-14" tabindex="-1"></a>betaSD <span class="ot">&lt;-</span> <span class="fl">0.3</span>   <span class="co"># Population SD of memory sensitivity</span></span>
<span id="cb225-15"><a href="model-comparison-in-cognitive-science.html#cb225-15" tabindex="-1"></a></span>
<span id="cb225-16"><a href="model-comparison-in-cognitive-science.html#cb225-16" tabindex="-1"></a><span class="co"># Print the parameters in probability space for easier interpretation</span></span>
<span id="cb225-17"><a href="model-comparison-in-cognitive-science.html#cb225-17" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Biased agents have mean choice probability of:&quot;</span>, <span class="fu">round</span>(<span class="fu">plogis</span>(rateM), <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Biased agents have mean choice probability of: 0.8</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="model-comparison-in-cognitive-science.html#cb227-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Memory agents have mean baseline bias of:&quot;</span>, <span class="fu">round</span>(<span class="fu">plogis</span>(biasM), <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Memory agents have mean baseline bias of: 0.5</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="model-comparison-in-cognitive-science.html#cb229-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Memory agents have mean sensitivity to opponent&#39;s history of:&quot;</span>, betaM, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Memory agents have mean sensitivity to opponent&#39;s history of: 1.5</code></pre>
</div>
<div id="define-agent-functions" class="section level3 hasAnchor" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> Define Agent Functions<a href="model-comparison-in-cognitive-science.html#define-agent-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="model-comparison-in-cognitive-science.html#cb231-1" tabindex="-1"></a><span class="co"># Random agent function: makes choices based on bias parameter</span></span>
<span id="cb231-2"><a href="model-comparison-in-cognitive-science.html#cb231-2" tabindex="-1"></a>RandomAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(rate, noise) {</span>
<span id="cb231-3"><a href="model-comparison-in-cognitive-science.html#cb231-3" tabindex="-1"></a>  <span class="co"># Generate choice based on agent&#39;s bias parameter (on log-odds scale)</span></span>
<span id="cb231-4"><a href="model-comparison-in-cognitive-science.html#cb231-4" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">plogis</span>(rate))</span>
<span id="cb231-5"><a href="model-comparison-in-cognitive-science.html#cb231-5" tabindex="-1"></a>  </span>
<span id="cb231-6"><a href="model-comparison-in-cognitive-science.html#cb231-6" tabindex="-1"></a>  <span class="co"># With probability &#39;noise&#39;, override choice with random 50/50 selection</span></span>
<span id="cb231-7"><a href="model-comparison-in-cognitive-science.html#cb231-7" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb231-8"><a href="model-comparison-in-cognitive-science.html#cb231-8" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb231-9"><a href="model-comparison-in-cognitive-science.html#cb231-9" tabindex="-1"></a>  }</span>
<span id="cb231-10"><a href="model-comparison-in-cognitive-science.html#cb231-10" tabindex="-1"></a>  </span>
<span id="cb231-11"><a href="model-comparison-in-cognitive-science.html#cb231-11" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb231-12"><a href="model-comparison-in-cognitive-science.html#cb231-12" tabindex="-1"></a>}</span>
<span id="cb231-13"><a href="model-comparison-in-cognitive-science.html#cb231-13" tabindex="-1"></a></span>
<span id="cb231-14"><a href="model-comparison-in-cognitive-science.html#cb231-14" tabindex="-1"></a><span class="co"># Memory agent function: makes choices based on opponent&#39;s historical choices</span></span>
<span id="cb231-15"><a href="model-comparison-in-cognitive-science.html#cb231-15" tabindex="-1"></a>MemoryAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(bias, beta, otherRate, noise) {</span>
<span id="cb231-16"><a href="model-comparison-in-cognitive-science.html#cb231-16" tabindex="-1"></a>  <span class="co"># Calculate log-odds of choosing option 1, influenced by opponent&#39;s historical choice rate</span></span>
<span id="cb231-17"><a href="model-comparison-in-cognitive-science.html#cb231-17" tabindex="-1"></a>  log_odds <span class="ot">&lt;-</span> bias <span class="sc">+</span> beta <span class="sc">*</span> <span class="fu">qlogis</span>(otherRate)</span>
<span id="cb231-18"><a href="model-comparison-in-cognitive-science.html#cb231-18" tabindex="-1"></a>  </span>
<span id="cb231-19"><a href="model-comparison-in-cognitive-science.html#cb231-19" tabindex="-1"></a>  <span class="co"># Convert to probability and generate choice</span></span>
<span id="cb231-20"><a href="model-comparison-in-cognitive-science.html#cb231-20" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">plogis</span>(log_odds))</span>
<span id="cb231-21"><a href="model-comparison-in-cognitive-science.html#cb231-21" tabindex="-1"></a>  </span>
<span id="cb231-22"><a href="model-comparison-in-cognitive-science.html#cb231-22" tabindex="-1"></a>  <span class="co"># With probability &#39;noise&#39;, override choice with random 50/50 selection</span></span>
<span id="cb231-23"><a href="model-comparison-in-cognitive-science.html#cb231-23" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb231-24"><a href="model-comparison-in-cognitive-science.html#cb231-24" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb231-25"><a href="model-comparison-in-cognitive-science.html#cb231-25" tabindex="-1"></a>  }</span>
<span id="cb231-26"><a href="model-comparison-in-cognitive-science.html#cb231-26" tabindex="-1"></a>  </span>
<span id="cb231-27"><a href="model-comparison-in-cognitive-science.html#cb231-27" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb231-28"><a href="model-comparison-in-cognitive-science.html#cb231-28" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="generate-simulation-data" class="section level3 hasAnchor" number="8.5.3">
<h3><span class="header-section-number">8.5.3</span> Generate Simulation Data<a href="model-comparison-in-cognitive-science.html#generate-simulation-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="model-comparison-in-cognitive-science.html#cb232-1" tabindex="-1"></a><span class="co"># Function to simulate one run of agents playing against each other</span></span>
<span id="cb232-2"><a href="model-comparison-in-cognitive-science.html#cb232-2" tabindex="-1"></a>simulate_agents <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb232-3"><a href="model-comparison-in-cognitive-science.html#cb232-3" tabindex="-1"></a>  <span class="co"># Create empty dataframe to store results</span></span>
<span id="cb232-4"><a href="model-comparison-in-cognitive-science.html#cb232-4" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb232-5"><a href="model-comparison-in-cognitive-science.html#cb232-5" tabindex="-1"></a>  </span>
<span id="cb232-6"><a href="model-comparison-in-cognitive-science.html#cb232-6" tabindex="-1"></a>  <span class="co"># Loop through all agents</span></span>
<span id="cb232-7"><a href="model-comparison-in-cognitive-science.html#cb232-7" tabindex="-1"></a>  <span class="cf">for</span> (agent <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>agents) {</span>
<span id="cb232-8"><a href="model-comparison-in-cognitive-science.html#cb232-8" tabindex="-1"></a>    <span class="co"># Sample individual agent parameters from population distributions</span></span>
<span id="cb232-9"><a href="model-comparison-in-cognitive-science.html#cb232-9" tabindex="-1"></a>    rate <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, rateM, rateSD)         <span class="co"># Individual bias for random agent</span></span>
<span id="cb232-10"><a href="model-comparison-in-cognitive-science.html#cb232-10" tabindex="-1"></a>    bias <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, biasM, biasSD)         <span class="co"># Individual baseline bias for memory agent</span></span>
<span id="cb232-11"><a href="model-comparison-in-cognitive-science.html#cb232-11" tabindex="-1"></a>    beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, betaM, betaSD)         <span class="co"># Individual memory sensitivity</span></span>
<span id="cb232-12"><a href="model-comparison-in-cognitive-science.html#cb232-12" tabindex="-1"></a>    </span>
<span id="cb232-13"><a href="model-comparison-in-cognitive-science.html#cb232-13" tabindex="-1"></a>    <span class="co"># Initialize choice vectors</span></span>
<span id="cb232-14"><a href="model-comparison-in-cognitive-science.html#cb232-14" tabindex="-1"></a>    randomChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb232-15"><a href="model-comparison-in-cognitive-science.html#cb232-15" tabindex="-1"></a>    memoryChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb232-16"><a href="model-comparison-in-cognitive-science.html#cb232-16" tabindex="-1"></a>    memoryRate <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb232-17"><a href="model-comparison-in-cognitive-science.html#cb232-17" tabindex="-1"></a>    </span>
<span id="cb232-18"><a href="model-comparison-in-cognitive-science.html#cb232-18" tabindex="-1"></a>    <span class="co"># Generate choices for each trial</span></span>
<span id="cb232-19"><a href="model-comparison-in-cognitive-science.html#cb232-19" tabindex="-1"></a>    <span class="cf">for</span> (trial <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>trials) {</span>
<span id="cb232-20"><a href="model-comparison-in-cognitive-science.html#cb232-20" tabindex="-1"></a>      <span class="co"># Random (biased) agent makes choice</span></span>
<span id="cb232-21"><a href="model-comparison-in-cognitive-science.html#cb232-21" tabindex="-1"></a>      randomChoice[trial] <span class="ot">&lt;-</span> <span class="fu">RandomAgentNoise_f</span>(rate, noise)</span>
<span id="cb232-22"><a href="model-comparison-in-cognitive-science.html#cb232-22" tabindex="-1"></a>      </span>
<span id="cb232-23"><a href="model-comparison-in-cognitive-science.html#cb232-23" tabindex="-1"></a>      <span class="co"># Memory agent responds (with no history for first trial)</span></span>
<span id="cb232-24"><a href="model-comparison-in-cognitive-science.html#cb232-24" tabindex="-1"></a>      <span class="cf">if</span> (trial <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb232-25"><a href="model-comparison-in-cognitive-science.html#cb232-25" tabindex="-1"></a>        memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)  <span class="co"># First choice is random</span></span>
<span id="cb232-26"><a href="model-comparison-in-cognitive-science.html#cb232-26" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb232-27"><a href="model-comparison-in-cognitive-science.html#cb232-27" tabindex="-1"></a>        <span class="co"># Use mean of random agent&#39;s previous choices as &quot;memory&quot;</span></span>
<span id="cb232-28"><a href="model-comparison-in-cognitive-science.html#cb232-28" tabindex="-1"></a>        memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">MemoryAgentNoise_f</span>(</span>
<span id="cb232-29"><a href="model-comparison-in-cognitive-science.html#cb232-29" tabindex="-1"></a>          bias, beta, <span class="fu">mean</span>(randomChoice[<span class="dv">1</span><span class="sc">:</span>(trial <span class="sc">-</span> <span class="dv">1</span>)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), noise</span>
<span id="cb232-30"><a href="model-comparison-in-cognitive-science.html#cb232-30" tabindex="-1"></a>        )</span>
<span id="cb232-31"><a href="model-comparison-in-cognitive-science.html#cb232-31" tabindex="-1"></a>      }</span>
<span id="cb232-32"><a href="model-comparison-in-cognitive-science.html#cb232-32" tabindex="-1"></a>    }</span>
<span id="cb232-33"><a href="model-comparison-in-cognitive-science.html#cb232-33" tabindex="-1"></a>    </span>
<span id="cb232-34"><a href="model-comparison-in-cognitive-science.html#cb232-34" tabindex="-1"></a>    <span class="co"># Create data frame for this agent</span></span>
<span id="cb232-35"><a href="model-comparison-in-cognitive-science.html#cb232-35" tabindex="-1"></a>    temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb232-36"><a href="model-comparison-in-cognitive-science.html#cb232-36" tabindex="-1"></a>      <span class="at">agent =</span> agent,</span>
<span id="cb232-37"><a href="model-comparison-in-cognitive-science.html#cb232-37" tabindex="-1"></a>      <span class="at">trial =</span> <span class="fu">seq</span>(trials),</span>
<span id="cb232-38"><a href="model-comparison-in-cognitive-science.html#cb232-38" tabindex="-1"></a>      <span class="at">randomChoice =</span> randomChoice,</span>
<span id="cb232-39"><a href="model-comparison-in-cognitive-science.html#cb232-39" tabindex="-1"></a>      <span class="at">randomRate =</span> rate,</span>
<span id="cb232-40"><a href="model-comparison-in-cognitive-science.html#cb232-40" tabindex="-1"></a>      <span class="at">memoryChoice =</span> memoryChoice,</span>
<span id="cb232-41"><a href="model-comparison-in-cognitive-science.html#cb232-41" tabindex="-1"></a>      <span class="at">noise =</span> noise,</span>
<span id="cb232-42"><a href="model-comparison-in-cognitive-science.html#cb232-42" tabindex="-1"></a>      <span class="at">rateM =</span> rateM,</span>
<span id="cb232-43"><a href="model-comparison-in-cognitive-science.html#cb232-43" tabindex="-1"></a>      <span class="at">rateSD =</span> rateSD,</span>
<span id="cb232-44"><a href="model-comparison-in-cognitive-science.html#cb232-44" tabindex="-1"></a>      <span class="at">bias =</span> bias,</span>
<span id="cb232-45"><a href="model-comparison-in-cognitive-science.html#cb232-45" tabindex="-1"></a>      <span class="at">beta =</span> beta,</span>
<span id="cb232-46"><a href="model-comparison-in-cognitive-science.html#cb232-46" tabindex="-1"></a>      <span class="at">biasM =</span> biasM,</span>
<span id="cb232-47"><a href="model-comparison-in-cognitive-science.html#cb232-47" tabindex="-1"></a>      <span class="at">biasSD =</span> biasSD,</span>
<span id="cb232-48"><a href="model-comparison-in-cognitive-science.html#cb232-48" tabindex="-1"></a>      <span class="at">betaM =</span> betaM,</span>
<span id="cb232-49"><a href="model-comparison-in-cognitive-science.html#cb232-49" tabindex="-1"></a>      <span class="at">betaSD =</span> betaSD</span>
<span id="cb232-50"><a href="model-comparison-in-cognitive-science.html#cb232-50" tabindex="-1"></a>    )</span>
<span id="cb232-51"><a href="model-comparison-in-cognitive-science.html#cb232-51" tabindex="-1"></a>    </span>
<span id="cb232-52"><a href="model-comparison-in-cognitive-science.html#cb232-52" tabindex="-1"></a>    <span class="co"># Append to main dataframe</span></span>
<span id="cb232-53"><a href="model-comparison-in-cognitive-science.html#cb232-53" tabindex="-1"></a>    <span class="cf">if</span> (agent <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb232-54"><a href="model-comparison-in-cognitive-science.html#cb232-54" tabindex="-1"></a>      d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d, temp)</span>
<span id="cb232-55"><a href="model-comparison-in-cognitive-science.html#cb232-55" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb232-56"><a href="model-comparison-in-cognitive-science.html#cb232-56" tabindex="-1"></a>      d <span class="ot">&lt;-</span> temp</span>
<span id="cb232-57"><a href="model-comparison-in-cognitive-science.html#cb232-57" tabindex="-1"></a>    }</span>
<span id="cb232-58"><a href="model-comparison-in-cognitive-science.html#cb232-58" tabindex="-1"></a>  }</span>
<span id="cb232-59"><a href="model-comparison-in-cognitive-science.html#cb232-59" tabindex="-1"></a>  </span>
<span id="cb232-60"><a href="model-comparison-in-cognitive-science.html#cb232-60" tabindex="-1"></a>  <span class="co"># Calculate cumulative choice rates</span></span>
<span id="cb232-61"><a href="model-comparison-in-cognitive-science.html#cb232-61" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(agent) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb232-62"><a href="model-comparison-in-cognitive-science.html#cb232-62" tabindex="-1"></a>    <span class="at">randomRate_cumulative =</span> <span class="fu">cumsum</span>(randomChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(randomChoice),</span>
<span id="cb232-63"><a href="model-comparison-in-cognitive-science.html#cb232-63" tabindex="-1"></a>    <span class="at">memoryRate_cumulative =</span> <span class="fu">cumsum</span>(memoryChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(memoryChoice)</span>
<span id="cb232-64"><a href="model-comparison-in-cognitive-science.html#cb232-64" tabindex="-1"></a>  )</span>
<span id="cb232-65"><a href="model-comparison-in-cognitive-science.html#cb232-65" tabindex="-1"></a>  </span>
<span id="cb232-66"><a href="model-comparison-in-cognitive-science.html#cb232-66" tabindex="-1"></a>  <span class="fu">return</span>(d)</span>
<span id="cb232-67"><a href="model-comparison-in-cognitive-science.html#cb232-67" tabindex="-1"></a>}</span>
<span id="cb232-68"><a href="model-comparison-in-cognitive-science.html#cb232-68" tabindex="-1"></a></span>
<span id="cb232-69"><a href="model-comparison-in-cognitive-science.html#cb232-69" tabindex="-1"></a><span class="co"># Generate the data</span></span>
<span id="cb232-70"><a href="model-comparison-in-cognitive-science.html#cb232-70" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">simulate_agents</span>()</span>
<span id="cb232-71"><a href="model-comparison-in-cognitive-science.html#cb232-71" tabindex="-1"></a></span>
<span id="cb232-72"><a href="model-comparison-in-cognitive-science.html#cb232-72" tabindex="-1"></a><span class="co"># Show a quick summary of the generated data</span></span>
<span id="cb232-73"><a href="model-comparison-in-cognitive-science.html#cb232-73" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb232-74"><a href="model-comparison-in-cognitive-science.html#cb232-74" tabindex="-1"></a>  <span class="fu">filter</span>(trial <span class="sc">==</span> trials) <span class="sc">%&gt;%</span>  <span class="co"># Get final trial stats</span></span>
<span id="cb232-75"><a href="model-comparison-in-cognitive-science.html#cb232-75" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb232-76"><a href="model-comparison-in-cognitive-science.html#cb232-76" tabindex="-1"></a>    <span class="at">mean_random_rate =</span> <span class="fu">mean</span>(randomRate_cumulative),</span>
<span id="cb232-77"><a href="model-comparison-in-cognitive-science.html#cb232-77" tabindex="-1"></a>    <span class="at">mean_memory_rate =</span> <span class="fu">mean</span>(memoryRate_cumulative)</span>
<span id="cb232-78"><a href="model-comparison-in-cognitive-science.html#cb232-78" tabindex="-1"></a>  )</span>
<span id="cb232-79"><a href="model-comparison-in-cognitive-science.html#cb232-79" tabindex="-1"></a></span>
<span id="cb232-80"><a href="model-comparison-in-cognitive-science.html#cb232-80" tabindex="-1"></a><span class="fu">print</span>(summary_stats)</span></code></pre></div>
<pre><code>## # A tibble: 100 Ã— 3
##    agent mean_random_rate mean_memory_rate
##    &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1     1            0.892            0.833
##  2     2            0.775            0.883
##  3     3            0.917            0.958
##  4     4            0.883            0.992
##  5     5            0.783            0.692
##  6     6            0.825            0.867
##  7     7            0.875            0.983
##  8     8            0.842            0.925
##  9     9            0.608            0.608
## 10    10            0.875            0.975
## # â„¹ 90 more rows</code></pre>
</div>
<div id="visualize-the-simulation-data" class="section level3 hasAnchor" number="8.5.4">
<h3><span class="header-section-number">8.5.4</span> Visualize the Simulation Data<a href="model-comparison-in-cognitive-science.html#visualize-the-simulation-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="model-comparison-in-cognitive-science.html#cb234-1" tabindex="-1"></a><span class="co"># Select a random sample of agents to visualize</span></span>
<span id="cb234-2"><a href="model-comparison-in-cognitive-science.html#cb234-2" tabindex="-1"></a>sample_agents <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">unique</span>(d<span class="sc">$</span>agent), <span class="dv">6</span>)</span>
<span id="cb234-3"><a href="model-comparison-in-cognitive-science.html#cb234-3" tabindex="-1"></a></span>
<span id="cb234-4"><a href="model-comparison-in-cognitive-science.html#cb234-4" tabindex="-1"></a><span class="co"># Filter data for these agents</span></span>
<span id="cb234-5"><a href="model-comparison-in-cognitive-science.html#cb234-5" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(agent <span class="sc">%in%</span> sample_agents)</span>
<span id="cb234-6"><a href="model-comparison-in-cognitive-science.html#cb234-6" tabindex="-1"></a></span>
<span id="cb234-7"><a href="model-comparison-in-cognitive-science.html#cb234-7" tabindex="-1"></a><span class="co"># Create plot showing choice patterns</span></span>
<span id="cb234-8"><a href="model-comparison-in-cognitive-science.html#cb234-8" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sample_data, <span class="fu">aes</span>(<span class="at">x =</span> trial)) <span class="sc">+</span></span>
<span id="cb234-9"><a href="model-comparison-in-cognitive-science.html#cb234-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> randomRate_cumulative, <span class="at">color =</span> <span class="st">&quot;Biased Agent&quot;</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb234-10"><a href="model-comparison-in-cognitive-science.html#cb234-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> memoryRate_cumulative, <span class="at">color =</span> <span class="st">&quot;Memory Agent&quot;</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb234-11"><a href="model-comparison-in-cognitive-science.html#cb234-11" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>) <span class="sc">+</span></span>
<span id="cb234-12"><a href="model-comparison-in-cognitive-science.html#cb234-12" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>agent, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb234-13"><a href="model-comparison-in-cognitive-science.html#cb234-13" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb234-14"><a href="model-comparison-in-cognitive-science.html#cb234-14" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb234-15"><a href="model-comparison-in-cognitive-science.html#cb234-15" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Choice Patterns of Biased vs. Memory Agents&quot;</span>,</span>
<span id="cb234-16"><a href="model-comparison-in-cognitive-science.html#cb234-16" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Lines show cumulative proportion of &#39;right&#39; choices&quot;</span>,</span>
<span id="cb234-17"><a href="model-comparison-in-cognitive-science.html#cb234-17" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Trial&quot;</span>,</span>
<span id="cb234-18"><a href="model-comparison-in-cognitive-science.html#cb234-18" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Cumulative Proportion Right Choices&quot;</span>,</span>
<span id="cb234-19"><a href="model-comparison-in-cognitive-science.html#cb234-19" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Agent Type&quot;</span></span>
<span id="cb234-20"><a href="model-comparison-in-cognitive-science.html#cb234-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb234-21"><a href="model-comparison-in-cognitive-science.html#cb234-21" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb234-22"><a href="model-comparison-in-cognitive-science.html#cb234-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb234-23"><a href="model-comparison-in-cognitive-science.html#cb234-23" tabindex="-1"></a></span>
<span id="cb234-24"><a href="model-comparison-in-cognitive-science.html#cb234-24" tabindex="-1"></a><span class="co"># Create density plot of final choice rates</span></span>
<span id="cb234-25"><a href="model-comparison-in-cognitive-science.html#cb234-25" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb234-26"><a href="model-comparison-in-cognitive-science.html#cb234-26" tabindex="-1"></a>  <span class="fu">filter</span>(trial <span class="sc">==</span> trials) <span class="sc">%&gt;%</span></span>
<span id="cb234-27"><a href="model-comparison-in-cognitive-science.html#cb234-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(agent, randomRate_cumulative, memoryRate_cumulative) <span class="sc">%&gt;%</span></span>
<span id="cb234-28"><a href="model-comparison-in-cognitive-science.html#cb234-28" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(randomRate_cumulative, memoryRate_cumulative),</span>
<span id="cb234-29"><a href="model-comparison-in-cognitive-science.html#cb234-29" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;agent_type&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;rate&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb234-30"><a href="model-comparison-in-cognitive-science.html#cb234-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agent_type =</span> <span class="fu">ifelse</span>(agent_type <span class="sc">==</span> <span class="st">&quot;randomRate_cumulative&quot;</span>, </span>
<span id="cb234-31"><a href="model-comparison-in-cognitive-science.html#cb234-31" tabindex="-1"></a>                            <span class="st">&quot;Biased Agent&quot;</span>, <span class="st">&quot;Memory Agent&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb234-32"><a href="model-comparison-in-cognitive-science.html#cb234-32" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rate, <span class="at">fill =</span> agent_type)) <span class="sc">+</span></span>
<span id="cb234-33"><a href="model-comparison-in-cognitive-science.html#cb234-33" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb234-34"><a href="model-comparison-in-cognitive-science.html#cb234-34" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb234-35"><a href="model-comparison-in-cognitive-science.html#cb234-35" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb234-36"><a href="model-comparison-in-cognitive-science.html#cb234-36" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Distribution of Final Choice Rates&quot;</span>,</span>
<span id="cb234-37"><a href="model-comparison-in-cognitive-science.html#cb234-37" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;After 120 trials&quot;</span>,</span>
<span id="cb234-38"><a href="model-comparison-in-cognitive-science.html#cb234-38" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Proportion of Right Choices&quot;</span>,</span>
<span id="cb234-39"><a href="model-comparison-in-cognitive-science.html#cb234-39" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>,</span>
<span id="cb234-40"><a href="model-comparison-in-cognitive-science.html#cb234-40" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Agent Type&quot;</span></span>
<span id="cb234-41"><a href="model-comparison-in-cognitive-science.html#cb234-41" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb234-42"><a href="model-comparison-in-cognitive-science.html#cb234-42" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb234-43"><a href="model-comparison-in-cognitive-science.html#cb234-43" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb234-44"><a href="model-comparison-in-cognitive-science.html#cb234-44" tabindex="-1"></a></span>
<span id="cb234-45"><a href="model-comparison-in-cognitive-science.html#cb234-45" tabindex="-1"></a><span class="co"># Combine the plots</span></span>
<span id="cb234-46"><a href="model-comparison-in-cognitive-science.html#cb234-46" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-30-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="prepare-data-for-stan-models" class="section level3 hasAnchor" number="8.5.5">
<h3><span class="header-section-number">8.5.5</span> Prepare Data for Stan Models<a href="model-comparison-in-cognitive-science.html#prepare-data-for-stan-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="model-comparison-in-cognitive-science.html#cb235-1" tabindex="-1"></a><span class="co"># Prepare the data for the biased agent model</span></span>
<span id="cb235-2"><a href="model-comparison-in-cognitive-science.html#cb235-2" tabindex="-1"></a>d_random <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb235-3"><a href="model-comparison-in-cognitive-science.html#cb235-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(agent, randomChoice) <span class="sc">%&gt;%</span> </span>
<span id="cb235-4"><a href="model-comparison-in-cognitive-science.html#cb235-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb235-5"><a href="model-comparison-in-cognitive-science.html#cb235-5" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb235-6"><a href="model-comparison-in-cognitive-science.html#cb235-6" tabindex="-1"></a></span>
<span id="cb235-7"><a href="model-comparison-in-cognitive-science.html#cb235-7" tabindex="-1"></a>d_memory <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb235-8"><a href="model-comparison-in-cognitive-science.html#cb235-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(agent, memoryChoice) <span class="sc">%&gt;%</span> </span>
<span id="cb235-9"><a href="model-comparison-in-cognitive-science.html#cb235-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb235-10"><a href="model-comparison-in-cognitive-science.html#cb235-10" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb235-11"><a href="model-comparison-in-cognitive-science.html#cb235-11" tabindex="-1"></a></span>
<span id="cb235-12"><a href="model-comparison-in-cognitive-science.html#cb235-12" tabindex="-1"></a><span class="co"># Create data lists for Stan</span></span>
<span id="cb235-13"><a href="model-comparison-in-cognitive-science.html#cb235-13" tabindex="-1"></a>data_biased <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb235-14"><a href="model-comparison-in-cognitive-science.html#cb235-14" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb235-15"><a href="model-comparison-in-cognitive-science.html#cb235-15" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb235-16"><a href="model-comparison-in-cognitive-science.html#cb235-16" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d_random[, <span class="dv">2</span><span class="sc">:</span>(agents <span class="sc">+</span> <span class="dv">1</span>)]),  <span class="co"># Matrix where columns are agents, rows are trials</span></span>
<span id="cb235-17"><a href="model-comparison-in-cognitive-science.html#cb235-17" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d_memory[, <span class="dv">2</span><span class="sc">:</span>(agents <span class="sc">+</span> <span class="dv">1</span>)])  <span class="co"># Other agent&#39;s choices (for memory model)</span></span>
<span id="cb235-18"><a href="model-comparison-in-cognitive-science.html#cb235-18" tabindex="-1"></a>)</span>
<span id="cb235-19"><a href="model-comparison-in-cognitive-science.html#cb235-19" tabindex="-1"></a></span>
<span id="cb235-20"><a href="model-comparison-in-cognitive-science.html#cb235-20" tabindex="-1"></a>data_memory <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb235-21"><a href="model-comparison-in-cognitive-science.html#cb235-21" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb235-22"><a href="model-comparison-in-cognitive-science.html#cb235-22" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb235-23"><a href="model-comparison-in-cognitive-science.html#cb235-23" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d_memory[, <span class="dv">2</span><span class="sc">:</span>(agents <span class="sc">+</span> <span class="dv">1</span>)]),  <span class="co"># For memory agent model, we&#39;ll predict memory choices</span></span>
<span id="cb235-24"><a href="model-comparison-in-cognitive-science.html#cb235-24" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d_random[, <span class="dv">2</span><span class="sc">:</span>(agents <span class="sc">+</span> <span class="dv">1</span>)])  <span class="co"># And use random agent choices as input</span></span>
<span id="cb235-25"><a href="model-comparison-in-cognitive-science.html#cb235-25" tabindex="-1"></a>)</span>
<span id="cb235-26"><a href="model-comparison-in-cognitive-science.html#cb235-26" tabindex="-1"></a></span>
<span id="cb235-27"><a href="model-comparison-in-cognitive-science.html#cb235-27" tabindex="-1"></a><span class="co"># Show dimensions of the data matrices</span></span>
<span id="cb235-28"><a href="model-comparison-in-cognitive-science.html#cb235-28" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Dimensions of data matrices for biased agent model:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Dimensions of data matrices for biased agent model:</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="model-comparison-in-cognitive-science.html#cb237-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;h matrix:&quot;</span>, <span class="fu">dim</span>(data_biased<span class="sc">$</span>h), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## h matrix: 120 100</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="model-comparison-in-cognitive-science.html#cb239-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;other matrix:&quot;</span>, <span class="fu">dim</span>(data_biased<span class="sc">$</span>other), <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## other matrix: 120 100</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="model-comparison-in-cognitive-science.html#cb241-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Dimensions of data matrices for memory agent model:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Dimensions of data matrices for memory agent model:</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="model-comparison-in-cognitive-science.html#cb243-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;h matrix:&quot;</span>, <span class="fu">dim</span>(data_memory<span class="sc">$</span>h), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## h matrix: 120 100</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="model-comparison-in-cognitive-science.html#cb245-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;other matrix:&quot;</span>, <span class="fu">dim</span>(data_memory<span class="sc">$</span>other), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## other matrix: 120 100</code></pre>
</div>
</div>
<div id="implementing-models-for-comparison" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> Implementing Models for Comparison<a href="model-comparison-in-cognitive-science.html#implementing-models-for-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now we need to implement our two competing models in Stan. Both will be multilevel (hierarchical) to account for individual differences among agents. The key feature for model comparison is that weâ€™ll include a <code>log_lik</code> calculation in the <code>generated quantities</code> block of each model.</p>
<div id="understanding-log-likelihood-in-model-comparison" class="section level3 hasAnchor" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> Understanding Log-Likelihood in Model Comparison<a href="model-comparison-in-cognitive-science.html#understanding-log-likelihood-in-model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When comparing models, we need a way to quantify how well each model explains the observed data. The log-likelihood represents the logarithm of the probability that a model would generate the observed data given specific parameter values.</p>
<p>Given certain values for our parameters (letâ€™s say a bias of 0 and beta for memory of 1) and for our variables (letâ€™s say the vector of memory values estimated by the agent on a trial by trial basis), the model will predict a certain distribution of outcomes, that is, a certain distribution of choices (n times right, m times left hand). Comparing this to the actual data, we can identify how likely the model is to produce it. In other words, the probability that the model will actually generate the data we observed out of all its possible outcomes. Remember that we are doing Bayesian statistics, so this probability needs to be combined with the probability of the parameter values given the priors on those parameters. This would give us a <em>posterior likelihood</em> of the modelâ€™s parameter values given the data. The last step is that we need to work on a log scale. Working on a log scale is very useful because it avoids low probabilities (close to 0) being rounded down to exactly 0. By log-transforming the posterior likelihood, we now have the <em>log-posterior likelihood</em>.</p>
<p>Now, remember that our agentâ€™s memory varies on a trial by trial level. In other words, for each data point, for each agent we can calculate separate values of log-posterior likelihood for each of the possible values of the parameters. That is, we can have a distribution of log-posterior likelihood for each data point.</p>
<p>Telling Stan to calculate these distributions is straightforward: we add to the <code>generated quantities</code> block the same log probability statements used in the model block, but save them to variables instead of adding them to the target.</p>
<p>N.B. Some of you might be wandering: if Stan is already using the log-posterior probability in the sampling process, why do we need to tell it to calculate and save it? Fair enough point. But Stan does not save by default (to avoid clogging your computer with endless data) and we need the log posterior likelihood saved as â€œlog_likâ€ in order to be able to use more automated functions later on.</p>
</div>
<div id="multilevel-biased-agent-model" class="section level3 hasAnchor" number="8.6.2">
<h3><span class="header-section-number">8.6.2</span> Multilevel Biased Agent Model<a href="model-comparison-in-cognitive-science.html#multilevel-biased-agent-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hereâ€™s the Stan model for the biased agent (remember that we will add the log_lik part in the generated quantities block!).</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="model-comparison-in-cognitive-science.html#cb247-1" tabindex="-1"></a><span class="co"># Stan model for multilevel biased agent</span></span>
<span id="cb247-2"><a href="model-comparison-in-cognitive-science.html#cb247-2" tabindex="-1"></a>stan_biased_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb247-3"><a href="model-comparison-in-cognitive-science.html#cb247-3" tabindex="-1"></a><span class="st">// Multilevel Biased Agent Model</span></span>
<span id="cb247-4"><a href="model-comparison-in-cognitive-science.html#cb247-4" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb247-5"><a href="model-comparison-in-cognitive-science.html#cb247-5" tabindex="-1"></a><span class="st">// This model assumes each agent has a fixed bias (theta) that determines</span></span>
<span id="cb247-6"><a href="model-comparison-in-cognitive-science.html#cb247-6" tabindex="-1"></a><span class="st">// their probability of choosing option 1 (&#39;right&#39;)</span></span>
<span id="cb247-7"><a href="model-comparison-in-cognitive-science.html#cb247-7" tabindex="-1"></a></span>
<span id="cb247-8"><a href="model-comparison-in-cognitive-science.html#cb247-8" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb247-9"><a href="model-comparison-in-cognitive-science.html#cb247-9" tabindex="-1"></a><span class="st">  // Helper function for generating truncated normal random numbers</span></span>
<span id="cb247-10"><a href="model-comparison-in-cognitive-science.html#cb247-10" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { </span></span>
<span id="cb247-11"><a href="model-comparison-in-cognitive-science.html#cb247-11" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // CDF for bounds</span></span>
<span id="cb247-12"><a href="model-comparison-in-cognitive-science.html#cb247-12" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb247-13"><a href="model-comparison-in-cognitive-science.html#cb247-13" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // Inverse CDF for value</span></span>
<span id="cb247-14"><a href="model-comparison-in-cognitive-science.html#cb247-14" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb247-15"><a href="model-comparison-in-cognitive-science.html#cb247-15" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb247-16"><a href="model-comparison-in-cognitive-science.html#cb247-16" tabindex="-1"></a></span>
<span id="cb247-17"><a href="model-comparison-in-cognitive-science.html#cb247-17" tabindex="-1"></a><span class="st">// Input data</span></span>
<span id="cb247-18"><a href="model-comparison-in-cognitive-science.html#cb247-18" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb247-19"><a href="model-comparison-in-cognitive-science.html#cb247-19" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;         // Number of trials per agent</span></span>
<span id="cb247-20"><a href="model-comparison-in-cognitive-science.html#cb247-20" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;         // Number of agents</span></span>
<span id="cb247-21"><a href="model-comparison-in-cognitive-science.html#cb247-21" tabindex="-1"></a><span class="st"> array[trials, agents] int h;   // Choice data (0/1 for each trial and agent)</span></span>
<span id="cb247-22"><a href="model-comparison-in-cognitive-science.html#cb247-22" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb247-23"><a href="model-comparison-in-cognitive-science.html#cb247-23" tabindex="-1"></a></span>
<span id="cb247-24"><a href="model-comparison-in-cognitive-science.html#cb247-24" tabindex="-1"></a><span class="st">// Parameters to be estimated</span></span>
<span id="cb247-25"><a href="model-comparison-in-cognitive-science.html#cb247-25" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb247-26"><a href="model-comparison-in-cognitive-science.html#cb247-26" tabindex="-1"></a><span class="st">  real thetaM;                  // Population mean of bias (log-odds scale)</span></span>
<span id="cb247-27"><a href="model-comparison-in-cognitive-science.html#cb247-27" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;      // Population SD of bias</span></span>
<span id="cb247-28"><a href="model-comparison-in-cognitive-science.html#cb247-28" tabindex="-1"></a><span class="st">  array[agents] real theta;     // Individual agent biases (log-odds scale)</span></span>
<span id="cb247-29"><a href="model-comparison-in-cognitive-science.html#cb247-29" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb247-30"><a href="model-comparison-in-cognitive-science.html#cb247-30" tabindex="-1"></a></span>
<span id="cb247-31"><a href="model-comparison-in-cognitive-science.html#cb247-31" tabindex="-1"></a><span class="st">// Model definition</span></span>
<span id="cb247-32"><a href="model-comparison-in-cognitive-science.html#cb247-32" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb247-33"><a href="model-comparison-in-cognitive-science.html#cb247-33" tabindex="-1"></a><span class="st">  // Population-level priors</span></span>
<span id="cb247-34"><a href="model-comparison-in-cognitive-science.html#cb247-34" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb247-35"><a href="model-comparison-in-cognitive-science.html#cb247-35" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb247-36"><a href="model-comparison-in-cognitive-science.html#cb247-36" tabindex="-1"></a><span class="st">  // Prior for SD with lower bound at zero (half-normal)</span></span>
<span id="cb247-37"><a href="model-comparison-in-cognitive-science.html#cb247-37" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3) - normal_lccdf(0 | 0, .3);</span></span>
<span id="cb247-38"><a href="model-comparison-in-cognitive-science.html#cb247-38" tabindex="-1"></a></span>
<span id="cb247-39"><a href="model-comparison-in-cognitive-science.html#cb247-39" tabindex="-1"></a><span class="st">  // Individual-level parameters drawn from population distribution</span></span>
<span id="cb247-40"><a href="model-comparison-in-cognitive-science.html#cb247-40" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb247-41"><a href="model-comparison-in-cognitive-science.html#cb247-41" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb247-42"><a href="model-comparison-in-cognitive-science.html#cb247-42" tabindex="-1"></a><span class="st">  // Likelihood: predict each agent&#39;s choices</span></span>
<span id="cb247-43"><a href="model-comparison-in-cognitive-science.html#cb247-43" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb247-44"><a href="model-comparison-in-cognitive-science.html#cb247-44" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb247-45"><a href="model-comparison-in-cognitive-science.html#cb247-45" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb247-46"><a href="model-comparison-in-cognitive-science.html#cb247-46" tabindex="-1"></a></span>
<span id="cb247-47"><a href="model-comparison-in-cognitive-science.html#cb247-47" tabindex="-1"></a><span class="st">// Additional quantities to calculate</span></span>
<span id="cb247-48"><a href="model-comparison-in-cognitive-science.html#cb247-48" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb247-49"><a href="model-comparison-in-cognitive-science.html#cb247-49" tabindex="-1"></a><span class="st">   // Prior predictive samples</span></span>
<span id="cb247-50"><a href="model-comparison-in-cognitive-science.html#cb247-50" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb247-51"><a href="model-comparison-in-cognitive-science.html#cb247-51" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb247-52"><a href="model-comparison-in-cognitive-science.html#cb247-52" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb247-53"><a href="model-comparison-in-cognitive-science.html#cb247-53" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb247-54"><a href="model-comparison-in-cognitive-science.html#cb247-54" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb247-55"><a href="model-comparison-in-cognitive-science.html#cb247-55" tabindex="-1"></a><span class="st">   // Posterior predictive samples</span></span>
<span id="cb247-56"><a href="model-comparison-in-cognitive-science.html#cb247-56" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb247-57"><a href="model-comparison-in-cognitive-science.html#cb247-57" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb247-58"><a href="model-comparison-in-cognitive-science.html#cb247-58" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb247-59"><a href="model-comparison-in-cognitive-science.html#cb247-59" tabindex="-1"></a><span class="st">   // Log-likelihood for each observation (crucial for model comparison)</span></span>
<span id="cb247-60"><a href="model-comparison-in-cognitive-science.html#cb247-60" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb247-61"><a href="model-comparison-in-cognitive-science.html#cb247-61" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb247-62"><a href="model-comparison-in-cognitive-science.html#cb247-62" tabindex="-1"></a><span class="st">   // Generate prior samples</span></span>
<span id="cb247-63"><a href="model-comparison-in-cognitive-science.html#cb247-63" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0, 1);</span></span>
<span id="cb247-64"><a href="model-comparison-in-cognitive-science.html#cb247-64" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0, 0.3, 0);</span></span>
<span id="cb247-65"><a href="model-comparison-in-cognitive-science.html#cb247-65" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb247-66"><a href="model-comparison-in-cognitive-science.html#cb247-66" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb247-67"><a href="model-comparison-in-cognitive-science.html#cb247-67" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb247-68"><a href="model-comparison-in-cognitive-science.html#cb247-68" tabindex="-1"></a><span class="st">   // Generate predictions from prior and posterior</span></span>
<span id="cb247-69"><a href="model-comparison-in-cognitive-science.html#cb247-69" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb247-70"><a href="model-comparison-in-cognitive-science.html#cb247-70" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb247-71"><a href="model-comparison-in-cognitive-science.html#cb247-71" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb247-72"><a href="model-comparison-in-cognitive-science.html#cb247-72" tabindex="-1"></a><span class="st">   // Calculate log-likelihood for each observation</span></span>
<span id="cb247-73"><a href="model-comparison-in-cognitive-science.html#cb247-73" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb247-74"><a href="model-comparison-in-cognitive-science.html#cb247-74" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb247-75"><a href="model-comparison-in-cognitive-science.html#cb247-75" tabindex="-1"></a><span class="st">      log_lik[t, i] = bernoulli_logit_lpmf(h[t, i] | theta[i]);</span></span>
<span id="cb247-76"><a href="model-comparison-in-cognitive-science.html#cb247-76" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb247-77"><a href="model-comparison-in-cognitive-science.html#cb247-77" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb247-78"><a href="model-comparison-in-cognitive-science.html#cb247-78" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb247-79"><a href="model-comparison-in-cognitive-science.html#cb247-79" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb247-80"><a href="model-comparison-in-cognitive-science.html#cb247-80" tabindex="-1"></a></span>
<span id="cb247-81"><a href="model-comparison-in-cognitive-science.html#cb247-81" tabindex="-1"></a><span class="co"># Write the Stan model to a file</span></span>
<span id="cb247-82"><a href="model-comparison-in-cognitive-science.html#cb247-82" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb247-83"><a href="model-comparison-in-cognitive-science.html#cb247-83" tabindex="-1"></a>  stan_biased_model,</span>
<span id="cb247-84"><a href="model-comparison-in-cognitive-science.html#cb247-84" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb247-85"><a href="model-comparison-in-cognitive-science.html#cb247-85" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W7_MultilevelBias.stan&quot;</span></span>
<span id="cb247-86"><a href="model-comparison-in-cognitive-science.html#cb247-86" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W7_MultilevelBias.stan&quot;</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="model-comparison-in-cognitive-science.html#cb249-1" tabindex="-1"></a><span class="co"># Compile the model</span></span>
<span id="cb249-2"><a href="model-comparison-in-cognitive-science.html#cb249-2" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W7_MultilevelBias.stan&quot;</span>)</span>
<span id="cb249-3"><a href="model-comparison-in-cognitive-science.html#cb249-3" tabindex="-1"></a>mod_biased <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(</span>
<span id="cb249-4"><a href="model-comparison-in-cognitive-science.html#cb249-4" tabindex="-1"></a>  file, </span>
<span id="cb249-5"><a href="model-comparison-in-cognitive-science.html#cb249-5" tabindex="-1"></a>  <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb249-6"><a href="model-comparison-in-cognitive-science.html#cb249-6" tabindex="-1"></a>  <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>)</span>
<span id="cb249-7"><a href="model-comparison-in-cognitive-science.html#cb249-7" tabindex="-1"></a>)</span></code></pre></div>
<p>Letâ€™s break down this Stan model:</p>
<p>Data Block: Defines the input data - number of trials, number of agents, and the choice data matrix.
Parameters Block: Specifies the parameters we want to estimate:</p>
<ul>
<li><p>thetaM: The population mean bias</p></li>
<li><p>thetaSD: The population standard deviation of bias</p></li>
<li><p>theta: Individual bias parameters for each agent</p></li>
</ul>
<p>Model Block: Defines the prior distributions and likelihood function:</p>
<ul>
<li><p>Priors for population parameters</p></li>
<li><p>Individual parameters drawn from the population distribution</p></li>
<li><p>Likelihood of observing the choice data given the parameters</p></li>
</ul>
<p>Generated Quantities Block: Calculates additional quantities of interest:</p>
<ul>
<li><p>Prior and posterior predictive samples</p></li>
<li><p>Log-likelihood for each observation - this is crucial for model comparison</p></li>
</ul>
<p>The most important part for model comparison is the log_lik calculation in the generated quantities block. This computes the log probability of each observation given the model and its parameters, which weâ€™ll use for comparing models.</p>
</div>
<div id="multilevel-memory-agent-model-1" class="section level3 hasAnchor" number="8.6.3">
<h3><span class="header-section-number">8.6.3</span> Multilevel Memory Agent Model<a href="model-comparison-in-cognitive-science.html#multilevel-memory-agent-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now letâ€™s implement our second model - the memory agent model:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="model-comparison-in-cognitive-science.html#cb250-1" tabindex="-1"></a><span class="co"># Stan model for multilevel memory agent</span></span>
<span id="cb250-2"><a href="model-comparison-in-cognitive-science.html#cb250-2" tabindex="-1"></a>stan_memory_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb250-3"><a href="model-comparison-in-cognitive-science.html#cb250-3" tabindex="-1"></a><span class="st">// Multilevel Memory Agent Model</span></span>
<span id="cb250-4"><a href="model-comparison-in-cognitive-science.html#cb250-4" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb250-5"><a href="model-comparison-in-cognitive-science.html#cb250-5" tabindex="-1"></a><span class="st">// This model assumes agents make choices based on their memory of</span></span>
<span id="cb250-6"><a href="model-comparison-in-cognitive-science.html#cb250-6" tabindex="-1"></a><span class="st">// the opponent&#39;s previous choices.</span></span>
<span id="cb250-7"><a href="model-comparison-in-cognitive-science.html#cb250-7" tabindex="-1"></a></span>
<span id="cb250-8"><a href="model-comparison-in-cognitive-science.html#cb250-8" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb250-9"><a href="model-comparison-in-cognitive-science.html#cb250-9" tabindex="-1"></a><span class="st">  // Helper function for generating truncated normal random numbers</span></span>
<span id="cb250-10"><a href="model-comparison-in-cognitive-science.html#cb250-10" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb250-11"><a href="model-comparison-in-cognitive-science.html#cb250-11" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // CDF for bounds</span></span>
<span id="cb250-12"><a href="model-comparison-in-cognitive-science.html#cb250-12" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb250-13"><a href="model-comparison-in-cognitive-science.html#cb250-13" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // Inverse CDF for value</span></span>
<span id="cb250-14"><a href="model-comparison-in-cognitive-science.html#cb250-14" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb250-15"><a href="model-comparison-in-cognitive-science.html#cb250-15" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb250-16"><a href="model-comparison-in-cognitive-science.html#cb250-16" tabindex="-1"></a></span>
<span id="cb250-17"><a href="model-comparison-in-cognitive-science.html#cb250-17" tabindex="-1"></a><span class="st">// Input data</span></span>
<span id="cb250-18"><a href="model-comparison-in-cognitive-science.html#cb250-18" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb250-19"><a href="model-comparison-in-cognitive-science.html#cb250-19" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;         // Number of trials per agent</span></span>
<span id="cb250-20"><a href="model-comparison-in-cognitive-science.html#cb250-20" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;         // Number of agents</span></span>
<span id="cb250-21"><a href="model-comparison-in-cognitive-science.html#cb250-21" tabindex="-1"></a><span class="st"> array[trials, agents] int h;   // Choice data (0/1 for each trial and agent)</span></span>
<span id="cb250-22"><a href="model-comparison-in-cognitive-science.html#cb250-22" tabindex="-1"></a><span class="st"> array[trials, agents] int other;// Opponent&#39;s choices (input to memory)</span></span>
<span id="cb250-23"><a href="model-comparison-in-cognitive-science.html#cb250-23" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb250-24"><a href="model-comparison-in-cognitive-science.html#cb250-24" tabindex="-1"></a></span>
<span id="cb250-25"><a href="model-comparison-in-cognitive-science.html#cb250-25" tabindex="-1"></a><span class="st">// Parameters to be estimated</span></span>
<span id="cb250-26"><a href="model-comparison-in-cognitive-science.html#cb250-26" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb250-27"><a href="model-comparison-in-cognitive-science.html#cb250-27" tabindex="-1"></a><span class="st">  real biasM;                   // Population mean baseline bias</span></span>
<span id="cb250-28"><a href="model-comparison-in-cognitive-science.html#cb250-28" tabindex="-1"></a><span class="st">  real betaM;                   // Population mean memory sensitivity</span></span>
<span id="cb250-29"><a href="model-comparison-in-cognitive-science.html#cb250-29" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;     // Population SDs for bias and beta</span></span>
<span id="cb250-30"><a href="model-comparison-in-cognitive-science.html#cb250-30" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;      // Standardized individual parameters (non-centered)</span></span>
<span id="cb250-31"><a href="model-comparison-in-cognitive-science.html#cb250-31" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;  // Cholesky factor of correlation matrix</span></span>
<span id="cb250-32"><a href="model-comparison-in-cognitive-science.html#cb250-32" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb250-33"><a href="model-comparison-in-cognitive-science.html#cb250-33" tabindex="-1"></a></span>
<span id="cb250-34"><a href="model-comparison-in-cognitive-science.html#cb250-34" tabindex="-1"></a><span class="st">// Transformed parameters (derived quantities)</span></span>
<span id="cb250-35"><a href="model-comparison-in-cognitive-science.html#cb250-35" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb250-36"><a href="model-comparison-in-cognitive-science.html#cb250-36" tabindex="-1"></a><span class="st">  // Memory state for each agent and trial</span></span>
<span id="cb250-37"><a href="model-comparison-in-cognitive-science.html#cb250-37" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb250-38"><a href="model-comparison-in-cognitive-science.html#cb250-38" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb250-39"><a href="model-comparison-in-cognitive-science.html#cb250-39" tabindex="-1"></a><span class="st">  // Individual parameters (bias and beta for each agent)</span></span>
<span id="cb250-40"><a href="model-comparison-in-cognitive-science.html#cb250-40" tabindex="-1"></a><span class="st">  matrix[agents, 2] IDs;</span></span>
<span id="cb250-41"><a href="model-comparison-in-cognitive-science.html#cb250-41" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb250-42"><a href="model-comparison-in-cognitive-science.html#cb250-42" tabindex="-1"></a><span class="st">  // Transform standardized parameters to actual parameters (non-centered parameterization)</span></span>
<span id="cb250-43"><a href="model-comparison-in-cognitive-science.html#cb250-43" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb250-44"><a href="model-comparison-in-cognitive-science.html#cb250-44" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb250-45"><a href="model-comparison-in-cognitive-science.html#cb250-45" tabindex="-1"></a><span class="st">  // Calculate memory states based on opponent&#39;s choices</span></span>
<span id="cb250-46"><a href="model-comparison-in-cognitive-science.html#cb250-46" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb250-47"><a href="model-comparison-in-cognitive-science.html#cb250-47" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb250-48"><a href="model-comparison-in-cognitive-science.html#cb250-48" tabindex="-1"></a><span class="st">      // Initialize first trial with neutral memory</span></span>
<span id="cb250-49"><a href="model-comparison-in-cognitive-science.html#cb250-49" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb250-50"><a href="model-comparison-in-cognitive-science.html#cb250-50" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb250-51"><a href="model-comparison-in-cognitive-science.html#cb250-51" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb250-52"><a href="model-comparison-in-cognitive-science.html#cb250-52" tabindex="-1"></a><span class="st">      // Update memory based on opponent&#39;s choices</span></span>
<span id="cb250-53"><a href="model-comparison-in-cognitive-science.html#cb250-53" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb250-54"><a href="model-comparison-in-cognitive-science.html#cb250-54" tabindex="-1"></a><span class="st">        // Simple averaging memory update</span></span>
<span id="cb250-55"><a href="model-comparison-in-cognitive-science.html#cb250-55" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + </span></span>
<span id="cb250-56"><a href="model-comparison-in-cognitive-science.html#cb250-56" tabindex="-1"></a><span class="st">                                ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb250-57"><a href="model-comparison-in-cognitive-science.html#cb250-57" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb250-58"><a href="model-comparison-in-cognitive-science.html#cb250-58" tabindex="-1"></a><span class="st">        // Handle edge cases to avoid numerical issues</span></span>
<span id="cb250-59"><a href="model-comparison-in-cognitive-science.html#cb250-59" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb250-60"><a href="model-comparison-in-cognitive-science.html#cb250-60" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb250-61"><a href="model-comparison-in-cognitive-science.html#cb250-61" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb250-62"><a href="model-comparison-in-cognitive-science.html#cb250-62" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb250-63"><a href="model-comparison-in-cognitive-science.html#cb250-63" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb250-64"><a href="model-comparison-in-cognitive-science.html#cb250-64" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb250-65"><a href="model-comparison-in-cognitive-science.html#cb250-65" tabindex="-1"></a></span>
<span id="cb250-66"><a href="model-comparison-in-cognitive-science.html#cb250-66" tabindex="-1"></a><span class="st">// Model definition</span></span>
<span id="cb250-67"><a href="model-comparison-in-cognitive-science.html#cb250-67" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb250-68"><a href="model-comparison-in-cognitive-science.html#cb250-68" tabindex="-1"></a><span class="st">  // Population-level priors</span></span>
<span id="cb250-69"><a href="model-comparison-in-cognitive-science.html#cb250-69" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb250-70"><a href="model-comparison-in-cognitive-science.html#cb250-70" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3) - normal_lccdf(0 | 0, .3);  // Half-normal for SD</span></span>
<span id="cb250-71"><a href="model-comparison-in-cognitive-science.html#cb250-71" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb250-72"><a href="model-comparison-in-cognitive-science.html#cb250-72" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3) - normal_lccdf(0 | 0, .3);  // Half-normal for SD</span></span>
<span id="cb250-73"><a href="model-comparison-in-cognitive-science.html#cb250-73" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb250-74"><a href="model-comparison-in-cognitive-science.html#cb250-74" tabindex="-1"></a><span class="st">  // Prior for correlation matrix</span></span>
<span id="cb250-75"><a href="model-comparison-in-cognitive-science.html#cb250-75" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb250-76"><a href="model-comparison-in-cognitive-science.html#cb250-76" tabindex="-1"></a></span>
<span id="cb250-77"><a href="model-comparison-in-cognitive-science.html#cb250-77" tabindex="-1"></a><span class="st">  // Standardized individual parameters have standard normal prior</span></span>
<span id="cb250-78"><a href="model-comparison-in-cognitive-science.html#cb250-78" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb250-79"><a href="model-comparison-in-cognitive-science.html#cb250-79" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb250-80"><a href="model-comparison-in-cognitive-science.html#cb250-80" tabindex="-1"></a><span class="st">  // Likelihood: predict each agent&#39;s choices</span></span>
<span id="cb250-81"><a href="model-comparison-in-cognitive-science.html#cb250-81" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb250-82"><a href="model-comparison-in-cognitive-science.html#cb250-82" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb250-83"><a href="model-comparison-in-cognitive-science.html#cb250-83" tabindex="-1"></a><span class="st">      // choice ~ bias + memory_effect*beta</span></span>
<span id="cb250-84"><a href="model-comparison-in-cognitive-science.html#cb250-84" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | </span></span>
<span id="cb250-85"><a href="model-comparison-in-cognitive-science.html#cb250-85" tabindex="-1"></a><span class="st">                biasM + IDs[agent, 1] + memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb250-86"><a href="model-comparison-in-cognitive-science.html#cb250-86" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb250-87"><a href="model-comparison-in-cognitive-science.html#cb250-87" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb250-88"><a href="model-comparison-in-cognitive-science.html#cb250-88" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb250-89"><a href="model-comparison-in-cognitive-science.html#cb250-89" tabindex="-1"></a></span>
<span id="cb250-90"><a href="model-comparison-in-cognitive-science.html#cb250-90" tabindex="-1"></a><span class="st">// Additional quantities to calculate</span></span>
<span id="cb250-91"><a href="model-comparison-in-cognitive-science.html#cb250-91" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb250-92"><a href="model-comparison-in-cognitive-science.html#cb250-92" tabindex="-1"></a><span class="st">   // Prior predictive samples</span></span>
<span id="cb250-93"><a href="model-comparison-in-cognitive-science.html#cb250-93" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb250-94"><a href="model-comparison-in-cognitive-science.html#cb250-94" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb250-95"><a href="model-comparison-in-cognitive-science.html#cb250-95" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb250-96"><a href="model-comparison-in-cognitive-science.html#cb250-96" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb250-97"><a href="model-comparison-in-cognitive-science.html#cb250-97" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb250-98"><a href="model-comparison-in-cognitive-science.html#cb250-98" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb250-99"><a href="model-comparison-in-cognitive-science.html#cb250-99" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb250-100"><a href="model-comparison-in-cognitive-science.html#cb250-100" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb250-101"><a href="model-comparison-in-cognitive-science.html#cb250-101" tabindex="-1"></a><span class="st">   // Posterior predictive samples for different memory conditions</span></span>
<span id="cb250-102"><a href="model-comparison-in-cognitive-science.html#cb250-102" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb250-103"><a href="model-comparison-in-cognitive-science.html#cb250-103" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb250-104"><a href="model-comparison-in-cognitive-science.html#cb250-104" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb250-105"><a href="model-comparison-in-cognitive-science.html#cb250-105" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb250-106"><a href="model-comparison-in-cognitive-science.html#cb250-106" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb250-107"><a href="model-comparison-in-cognitive-science.html#cb250-107" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb250-108"><a href="model-comparison-in-cognitive-science.html#cb250-108" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb250-109"><a href="model-comparison-in-cognitive-science.html#cb250-109" tabindex="-1"></a><span class="st">   // Log-likelihood for each observation (crucial for model comparison)</span></span>
<span id="cb250-110"><a href="model-comparison-in-cognitive-science.html#cb250-110" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb250-111"><a href="model-comparison-in-cognitive-science.html#cb250-111" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb250-112"><a href="model-comparison-in-cognitive-science.html#cb250-112" tabindex="-1"></a><span class="st">   // Generate prior samples</span></span>
<span id="cb250-113"><a href="model-comparison-in-cognitive-science.html#cb250-113" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb250-114"><a href="model-comparison-in-cognitive-science.html#cb250-114" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb250-115"><a href="model-comparison-in-cognitive-science.html#cb250-115" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb250-116"><a href="model-comparison-in-cognitive-science.html#cb250-116" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb250-117"><a href="model-comparison-in-cognitive-science.html#cb250-117" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb250-118"><a href="model-comparison-in-cognitive-science.html#cb250-118" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb250-119"><a href="model-comparison-in-cognitive-science.html#cb250-119" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb250-120"><a href="model-comparison-in-cognitive-science.html#cb250-120" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb250-121"><a href="model-comparison-in-cognitive-science.html#cb250-121" tabindex="-1"></a><span class="st">   // Generate predictions for different memory conditions</span></span>
<span id="cb250-122"><a href="model-comparison-in-cognitive-science.html#cb250-122" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb250-123"><a href="model-comparison-in-cognitive-science.html#cb250-123" tabindex="-1"></a><span class="st">      // Prior predictions for low, medium, high memory</span></span>
<span id="cb250-124"><a href="model-comparison-in-cognitive-science.html#cb250-124" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb250-125"><a href="model-comparison-in-cognitive-science.html#cb250-125" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb250-126"><a href="model-comparison-in-cognitive-science.html#cb250-126" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb250-127"><a href="model-comparison-in-cognitive-science.html#cb250-127" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb250-128"><a href="model-comparison-in-cognitive-science.html#cb250-128" tabindex="-1"></a><span class="st">      // Posterior predictions for low, medium, high memory</span></span>
<span id="cb250-129"><a href="model-comparison-in-cognitive-science.html#cb250-129" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, </span></span>
<span id="cb250-130"><a href="model-comparison-in-cognitive-science.html#cb250-130" tabindex="-1"></a><span class="st">                           inv_logit(biasM + IDs[i,1] + 0 * (betaM + IDs[i,2])));</span></span>
<span id="cb250-131"><a href="model-comparison-in-cognitive-science.html#cb250-131" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, </span></span>
<span id="cb250-132"><a href="model-comparison-in-cognitive-science.html#cb250-132" tabindex="-1"></a><span class="st">                           inv_logit(biasM + IDs[i,1] + 1 * (betaM + IDs[i,2])));</span></span>
<span id="cb250-133"><a href="model-comparison-in-cognitive-science.html#cb250-133" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, </span></span>
<span id="cb250-134"><a href="model-comparison-in-cognitive-science.html#cb250-134" tabindex="-1"></a><span class="st">                           inv_logit(biasM + IDs[i,1] + 2 * (betaM + IDs[i,2])));</span></span>
<span id="cb250-135"><a href="model-comparison-in-cognitive-science.html#cb250-135" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb250-136"><a href="model-comparison-in-cognitive-science.html#cb250-136" tabindex="-1"></a><span class="st">      // Calculate log-likelihood for each observation</span></span>
<span id="cb250-137"><a href="model-comparison-in-cognitive-science.html#cb250-137" tabindex="-1"></a><span class="st">      for (t in 1:trials){</span></span>
<span id="cb250-138"><a href="model-comparison-in-cognitive-science.html#cb250-138" tabindex="-1"></a><span class="st">        log_lik[t,i] = bernoulli_logit_lpmf(h[t, i] | </span></span>
<span id="cb250-139"><a href="model-comparison-in-cognitive-science.html#cb250-139" tabindex="-1"></a><span class="st">                      biasM + IDs[i, 1] + memory[t, i] * (betaM + IDs[i, 2]));</span></span>
<span id="cb250-140"><a href="model-comparison-in-cognitive-science.html#cb250-140" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb250-141"><a href="model-comparison-in-cognitive-science.html#cb250-141" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb250-142"><a href="model-comparison-in-cognitive-science.html#cb250-142" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb250-143"><a href="model-comparison-in-cognitive-science.html#cb250-143" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb250-144"><a href="model-comparison-in-cognitive-science.html#cb250-144" tabindex="-1"></a></span>
<span id="cb250-145"><a href="model-comparison-in-cognitive-science.html#cb250-145" tabindex="-1"></a><span class="co"># Write the Stan model to a file</span></span>
<span id="cb250-146"><a href="model-comparison-in-cognitive-science.html#cb250-146" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb250-147"><a href="model-comparison-in-cognitive-science.html#cb250-147" tabindex="-1"></a>  stan_memory_model,</span>
<span id="cb250-148"><a href="model-comparison-in-cognitive-science.html#cb250-148" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb250-149"><a href="model-comparison-in-cognitive-science.html#cb250-149" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W7_MultilevelMemory.stan&quot;</span></span>
<span id="cb250-150"><a href="model-comparison-in-cognitive-science.html#cb250-150" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W7_MultilevelMemory.stan&quot;</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="model-comparison-in-cognitive-science.html#cb252-1" tabindex="-1"></a><span class="co"># Compile the model</span></span>
<span id="cb252-2"><a href="model-comparison-in-cognitive-science.html#cb252-2" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W7_MultilevelMemory.stan&quot;</span>)</span>
<span id="cb252-3"><a href="model-comparison-in-cognitive-science.html#cb252-3" tabindex="-1"></a>mod_memory <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(</span>
<span id="cb252-4"><a href="model-comparison-in-cognitive-science.html#cb252-4" tabindex="-1"></a>  file, </span>
<span id="cb252-5"><a href="model-comparison-in-cognitive-science.html#cb252-5" tabindex="-1"></a>  <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb252-6"><a href="model-comparison-in-cognitive-science.html#cb252-6" tabindex="-1"></a>  <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>)</span>
<span id="cb252-7"><a href="model-comparison-in-cognitive-science.html#cb252-7" tabindex="-1"></a>)</span></code></pre></div>
<p>The memory agent model is more complex, but follows a similar structure:</p>
<p>Data Block: Includes the same data as the biased model, plus the opponentâ€™s choices.</p>
<p>Parameters Block: Includes parameters for the memory model:</p>
<ul>
<li><p>biasM: Population mean baseline bias</p></li>
<li><p>betaM: Population mean memory sensitivity</p></li>
<li><p>tau: Population standard deviations</p></li>
<li><p>z_IDs: Standardized individual parameters</p></li>
<li><p>L_u: Cholesky factor of correlation matrix</p></li>
</ul>
<p>Transformed Parameters Block: Calculates derived quantities:</p>
<ul>
<li><p>memory: The memory state for each agent and trial</p></li>
<li><p>IDs: Individual parameters for each agent</p></li>
</ul>
<p>Model Block: Defines priors and likelihood:</p>
<ul>
<li><p>Priors for population parameters</p></li>
<li><p>Memory-based choice likelihood</p></li>
</ul>
<p>Generated Quantities Block: Calculates additional quantities:</p>
<ul>
<li><p>Prior and posterior predictive samples</p></li>
<li><p>Log-likelihood for each observation</p></li>
</ul>
<p>The use of a non-centered parameterization for the individual parameters (through z_IDs and transformation) is a technique to improve sampling efficiency in hierarchical models. This is important when estimating multilevel models with potentially correlated parameters.</p>
</div>
</div>
<div id="fitting-models-and-calculating-expected-log-predictive-density" class="section level2 hasAnchor" number="8.7">
<h2><span class="header-section-number">8.7</span> Fitting Models and Calculating Expected Log Predictive Density<a href="model-comparison-in-cognitive-science.html#fitting-models-and-calculating-expected-log-predictive-density" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that weâ€™ve defined our models, weâ€™ll fit them to our simulated data and perform model comparison. Weâ€™ll fit both models to both types of data:</p>
<ul>
<li><p>Biased agent model fitted to biased agent data</p></li>
<li><p>Biased agent model fitted to memory agent data</p></li>
<li><p>Memory agent model fitted to biased agent data</p></li>
<li><p>Memory agent model fitted to memory agent data</p></li>
</ul>
</div>
<div id="fitting-the-models-to-the-data" class="section level2 hasAnchor" number="8.8">
<h2><span class="header-section-number">8.8</span> Fitting the models to the data<a href="model-comparison-in-cognitive-science.html#fitting-the-models-to-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="model-comparison-in-cognitive-science.html#cb253-1" tabindex="-1"></a><span class="co"># File path for saved model</span></span>
<span id="cb253-2"><a href="model-comparison-in-cognitive-science.html#cb253-2" tabindex="-1"></a>model_file <span class="ot">&lt;-</span> <span class="st">&quot;simmodels/W7_fit_biased2biased.RDS&quot;</span></span>
<span id="cb253-3"><a href="model-comparison-in-cognitive-science.html#cb253-3" tabindex="-1"></a></span>
<span id="cb253-4"><a href="model-comparison-in-cognitive-science.html#cb253-4" tabindex="-1"></a><span class="co"># Check if we need to rerun the simulation or we can load a pre-run one (for computational efficiency)</span></span>
<span id="cb253-5"><a href="model-comparison-in-cognitive-science.html#cb253-5" tabindex="-1"></a><span class="cf">if</span> (regenerate_simulations <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(model_file)) {</span>
<span id="cb253-6"><a href="model-comparison-in-cognitive-science.html#cb253-6" tabindex="-1"></a></span>
<span id="cb253-7"><a href="model-comparison-in-cognitive-science.html#cb253-7" tabindex="-1"></a><span class="co"># Fitting biased agent model to biased agent data</span></span>
<span id="cb253-8"><a href="model-comparison-in-cognitive-science.html#cb253-8" tabindex="-1"></a>fit_biased2biased <span class="ot">&lt;-</span> mod_biased<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb253-9"><a href="model-comparison-in-cognitive-science.html#cb253-9" tabindex="-1"></a>  <span class="at">data =</span> data_biased,</span>
<span id="cb253-10"><a href="model-comparison-in-cognitive-science.html#cb253-10" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb253-11"><a href="model-comparison-in-cognitive-science.html#cb253-11" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb253-12"><a href="model-comparison-in-cognitive-science.html#cb253-12" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb253-13"><a href="model-comparison-in-cognitive-science.html#cb253-13" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">1</span>,</span>
<span id="cb253-14"><a href="model-comparison-in-cognitive-science.html#cb253-14" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb253-15"><a href="model-comparison-in-cognitive-science.html#cb253-15" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb253-16"><a href="model-comparison-in-cognitive-science.html#cb253-16" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb253-17"><a href="model-comparison-in-cognitive-science.html#cb253-17" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb253-18"><a href="model-comparison-in-cognitive-science.html#cb253-18" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb253-19"><a href="model-comparison-in-cognitive-science.html#cb253-19" tabindex="-1"></a>)</span>
<span id="cb253-20"><a href="model-comparison-in-cognitive-science.html#cb253-20" tabindex="-1"></a></span>
<span id="cb253-21"><a href="model-comparison-in-cognitive-science.html#cb253-21" tabindex="-1"></a>  samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> model_file)</span>
<span id="cb253-22"><a href="model-comparison-in-cognitive-science.html#cb253-22" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Generated new model fit and saved to&quot;</span>, model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb253-23"><a href="model-comparison-in-cognitive-science.html#cb253-23" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb253-24"><a href="model-comparison-in-cognitive-science.html#cb253-24" tabindex="-1"></a>  <span class="co"># Load existing results</span></span>
<span id="cb253-25"><a href="model-comparison-in-cognitive-science.html#cb253-25" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(model_file)</span>
<span id="cb253-26"><a href="model-comparison-in-cognitive-science.html#cb253-26" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Loaded existing model fit from&quot;</span>, model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb253-27"><a href="model-comparison-in-cognitive-science.html#cb253-27" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Running MCMC with 1 chain, with 1 thread(s) per chain...</code></pre>
<pre><code>## Chain 1 finished in 26.7 seconds.
## Generated new model fit and saved to simmodels/W7_fit_biased2biased.RDS</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="model-comparison-in-cognitive-science.html#cb256-1" tabindex="-1"></a><span class="co"># File path for saved model</span></span>
<span id="cb256-2"><a href="model-comparison-in-cognitive-science.html#cb256-2" tabindex="-1"></a>model_file <span class="ot">&lt;-</span> <span class="st">&quot;simmodels/W7_fit_biased2memory.RDS&quot;</span></span>
<span id="cb256-3"><a href="model-comparison-in-cognitive-science.html#cb256-3" tabindex="-1"></a></span>
<span id="cb256-4"><a href="model-comparison-in-cognitive-science.html#cb256-4" tabindex="-1"></a><span class="co"># Check if we need to rerun the simulation</span></span>
<span id="cb256-5"><a href="model-comparison-in-cognitive-science.html#cb256-5" tabindex="-1"></a><span class="cf">if</span> (regenerate_simulations <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(model_file)) {</span>
<span id="cb256-6"><a href="model-comparison-in-cognitive-science.html#cb256-6" tabindex="-1"></a><span class="co"># Fitting biased agent model to memory agent data</span></span>
<span id="cb256-7"><a href="model-comparison-in-cognitive-science.html#cb256-7" tabindex="-1"></a>fit_biased2memory <span class="ot">&lt;-</span> mod_biased<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb256-8"><a href="model-comparison-in-cognitive-science.html#cb256-8" tabindex="-1"></a>  <span class="at">data =</span> data_memory,</span>
<span id="cb256-9"><a href="model-comparison-in-cognitive-science.html#cb256-9" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb256-10"><a href="model-comparison-in-cognitive-science.html#cb256-10" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb256-11"><a href="model-comparison-in-cognitive-science.html#cb256-11" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb256-12"><a href="model-comparison-in-cognitive-science.html#cb256-12" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">1</span>,</span>
<span id="cb256-13"><a href="model-comparison-in-cognitive-science.html#cb256-13" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb256-14"><a href="model-comparison-in-cognitive-science.html#cb256-14" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb256-15"><a href="model-comparison-in-cognitive-science.html#cb256-15" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb256-16"><a href="model-comparison-in-cognitive-science.html#cb256-16" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb256-17"><a href="model-comparison-in-cognitive-science.html#cb256-17" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb256-18"><a href="model-comparison-in-cognitive-science.html#cb256-18" tabindex="-1"></a>)</span>
<span id="cb256-19"><a href="model-comparison-in-cognitive-science.html#cb256-19" tabindex="-1"></a></span>
<span id="cb256-20"><a href="model-comparison-in-cognitive-science.html#cb256-20" tabindex="-1"></a></span>
<span id="cb256-21"><a href="model-comparison-in-cognitive-science.html#cb256-21" tabindex="-1"></a>  samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> model_file)</span>
<span id="cb256-22"><a href="model-comparison-in-cognitive-science.html#cb256-22" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Generated new model fit and saved to&quot;</span>, model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb256-23"><a href="model-comparison-in-cognitive-science.html#cb256-23" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb256-24"><a href="model-comparison-in-cognitive-science.html#cb256-24" tabindex="-1"></a>  <span class="co"># Load existing results</span></span>
<span id="cb256-25"><a href="model-comparison-in-cognitive-science.html#cb256-25" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(model_file)</span>
<span id="cb256-26"><a href="model-comparison-in-cognitive-science.html#cb256-26" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Loaded existing model fit from&quot;</span>, model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb256-27"><a href="model-comparison-in-cognitive-science.html#cb256-27" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Running MCMC with 1 chain, with 1 thread(s) per chain...</code></pre>
<pre><code>## Chain 1 finished in 26.3 seconds.
## Generated new model fit and saved to simmodels/W7_fit_biased2memory.RDS</code></pre>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="model-comparison-in-cognitive-science.html#cb259-1" tabindex="-1"></a><span class="co"># File path for saved model</span></span>
<span id="cb259-2"><a href="model-comparison-in-cognitive-science.html#cb259-2" tabindex="-1"></a>model_file <span class="ot">&lt;-</span> <span class="st">&quot;simmodels/W7_fit_memory2biased.RDS&quot;</span></span>
<span id="cb259-3"><a href="model-comparison-in-cognitive-science.html#cb259-3" tabindex="-1"></a></span>
<span id="cb259-4"><a href="model-comparison-in-cognitive-science.html#cb259-4" tabindex="-1"></a><span class="co"># Check if we need to rerun the simulation</span></span>
<span id="cb259-5"><a href="model-comparison-in-cognitive-science.html#cb259-5" tabindex="-1"></a><span class="cf">if</span> (regenerate_simulations <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(model_file)) {</span>
<span id="cb259-6"><a href="model-comparison-in-cognitive-science.html#cb259-6" tabindex="-1"></a><span class="co"># Fitting memory agent model to biased agent data</span></span>
<span id="cb259-7"><a href="model-comparison-in-cognitive-science.html#cb259-7" tabindex="-1"></a>fit_memory2biased <span class="ot">&lt;-</span> mod_memory<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb259-8"><a href="model-comparison-in-cognitive-science.html#cb259-8" tabindex="-1"></a>  <span class="at">data =</span> data_biased,</span>
<span id="cb259-9"><a href="model-comparison-in-cognitive-science.html#cb259-9" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb259-10"><a href="model-comparison-in-cognitive-science.html#cb259-10" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb259-11"><a href="model-comparison-in-cognitive-science.html#cb259-11" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb259-12"><a href="model-comparison-in-cognitive-science.html#cb259-12" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb259-13"><a href="model-comparison-in-cognitive-science.html#cb259-13" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb259-14"><a href="model-comparison-in-cognitive-science.html#cb259-14" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb259-15"><a href="model-comparison-in-cognitive-science.html#cb259-15" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb259-16"><a href="model-comparison-in-cognitive-science.html#cb259-16" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb259-17"><a href="model-comparison-in-cognitive-science.html#cb259-17" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb259-18"><a href="model-comparison-in-cognitive-science.html#cb259-18" tabindex="-1"></a>)</span>
<span id="cb259-19"><a href="model-comparison-in-cognitive-science.html#cb259-19" tabindex="-1"></a></span>
<span id="cb259-20"><a href="model-comparison-in-cognitive-science.html#cb259-20" tabindex="-1"></a>  samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> model_file)</span>
<span id="cb259-21"><a href="model-comparison-in-cognitive-science.html#cb259-21" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Generated new model fit and saved to&quot;</span>, model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb259-22"><a href="model-comparison-in-cognitive-science.html#cb259-22" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb259-23"><a href="model-comparison-in-cognitive-science.html#cb259-23" tabindex="-1"></a>  <span class="co"># Load existing results</span></span>
<span id="cb259-24"><a href="model-comparison-in-cognitive-science.html#cb259-24" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(model_file)</span>
<span id="cb259-25"><a href="model-comparison-in-cognitive-science.html#cb259-25" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Loaded existing model fit from&quot;</span>, model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb259-26"><a href="model-comparison-in-cognitive-science.html#cb259-26" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Running MCMC with 1 chain, with 4 thread(s) per chain...</code></pre>
<pre><code>## Chain 1 finished in 1233.3 seconds.
## Generated new model fit and saved to simmodels/W7_fit_memory2biased.RDS</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="model-comparison-in-cognitive-science.html#cb262-1" tabindex="-1"></a><span class="co"># File path for saved model</span></span>
<span id="cb262-2"><a href="model-comparison-in-cognitive-science.html#cb262-2" tabindex="-1"></a>model_file <span class="ot">&lt;-</span> <span class="st">&quot;simmodels/W7_fit_memory2memory.RDS&quot;</span></span>
<span id="cb262-3"><a href="model-comparison-in-cognitive-science.html#cb262-3" tabindex="-1"></a></span>
<span id="cb262-4"><a href="model-comparison-in-cognitive-science.html#cb262-4" tabindex="-1"></a><span class="co"># Check if we need to rerun the simulation</span></span>
<span id="cb262-5"><a href="model-comparison-in-cognitive-science.html#cb262-5" tabindex="-1"></a><span class="cf">if</span> (regenerate_simulations <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(model_file)) {<span class="co"># Fitting memory agent model to memory agent data</span></span>
<span id="cb262-6"><a href="model-comparison-in-cognitive-science.html#cb262-6" tabindex="-1"></a>fit_memory2memory <span class="ot">&lt;-</span> mod_memory<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb262-7"><a href="model-comparison-in-cognitive-science.html#cb262-7" tabindex="-1"></a>  <span class="at">data =</span> data_memory,</span>
<span id="cb262-8"><a href="model-comparison-in-cognitive-science.html#cb262-8" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb262-9"><a href="model-comparison-in-cognitive-science.html#cb262-9" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb262-10"><a href="model-comparison-in-cognitive-science.html#cb262-10" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb262-11"><a href="model-comparison-in-cognitive-science.html#cb262-11" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb262-12"><a href="model-comparison-in-cognitive-science.html#cb262-12" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb262-13"><a href="model-comparison-in-cognitive-science.html#cb262-13" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb262-14"><a href="model-comparison-in-cognitive-science.html#cb262-14" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb262-15"><a href="model-comparison-in-cognitive-science.html#cb262-15" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb262-16"><a href="model-comparison-in-cognitive-science.html#cb262-16" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb262-17"><a href="model-comparison-in-cognitive-science.html#cb262-17" tabindex="-1"></a>)</span>
<span id="cb262-18"><a href="model-comparison-in-cognitive-science.html#cb262-18" tabindex="-1"></a></span>
<span id="cb262-19"><a href="model-comparison-in-cognitive-science.html#cb262-19" tabindex="-1"></a>  samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> model_file)</span>
<span id="cb262-20"><a href="model-comparison-in-cognitive-science.html#cb262-20" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Generated new model fit and saved to&quot;</span>, model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb262-21"><a href="model-comparison-in-cognitive-science.html#cb262-21" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb262-22"><a href="model-comparison-in-cognitive-science.html#cb262-22" tabindex="-1"></a>  <span class="co"># Load existing results</span></span>
<span id="cb262-23"><a href="model-comparison-in-cognitive-science.html#cb262-23" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(model_file)</span>
<span id="cb262-24"><a href="model-comparison-in-cognitive-science.html#cb262-24" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Loaded existing model fit from&quot;</span>, model_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb262-25"><a href="model-comparison-in-cognitive-science.html#cb262-25" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Running MCMC with 1 chain, with 4 thread(s) per chain...</code></pre>
<pre><code>## Chain 1 finished in 1670.9 seconds.
## Generated new model fit and saved to simmodels/W7_fit_memory2memory.RDS</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="model-comparison-in-cognitive-science.html#cb265-1" tabindex="-1"></a><span class="co"># Display basic summary of the models</span></span>
<span id="cb265-2"><a href="model-comparison-in-cognitive-science.html#cb265-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Biased model fitted to biased data:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Biased model fitted to biased data:</code></pre>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="model-comparison-in-cognitive-science.html#cb267-1" tabindex="-1"></a><span class="fu">print</span>(fit_biased2biased<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;thetaM&quot;</span>, <span class="st">&quot;thetaSD&quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 2 Ã— 10
##   variable  mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 thetaM   1.35   1.35  0.0698 0.0696 1.23  1.46   1.00    3523.    1409.
## 2 thetaSD  0.638  0.636 0.0502 0.0475 0.560 0.725  1.00    3393.    1650.</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="model-comparison-in-cognitive-science.html#cb269-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Biased model fitted to memory data:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Biased model fitted to memory data:</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="model-comparison-in-cognitive-science.html#cb271-1" tabindex="-1"></a><span class="fu">print</span>(fit_biased2memory<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;thetaM&quot;</span>, <span class="st">&quot;thetaSD&quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 2 Ã— 10
##   variable  mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 thetaM    1.92   1.92 0.107  0.110  1.75   2.10  1.00    1831.    1463.
## 2 thetaSD   1.05   1.05 0.0775 0.0739 0.934  1.19  1.00    1510.    1246.</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="model-comparison-in-cognitive-science.html#cb273-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Memory model fitted to biased data:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Memory model fitted to biased data:</code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="model-comparison-in-cognitive-science.html#cb275-1" tabindex="-1"></a><span class="fu">print</span>(fit_memory2biased<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;biasM&quot;</span>, <span class="st">&quot;betaM&quot;</span>, <span class="st">&quot;tau[1]&quot;</span>, <span class="st">&quot;tau[2]&quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 4 Ã— 10
##   variable  mean median     sd    mad      q5   q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 biasM    1.14   1.13  0.169  0.172   0.865  1.42   1.00     777.    1330.
## 2 betaM    0.261  0.264 0.189  0.186  -0.0544 0.563  1.00    1119.    1464.
## 3 tau[1]   0.594  0.594 0.0787 0.0762  0.466  0.722  1.00     722.    1029.
## 4 tau[2]   0.165  0.145 0.122  0.126   0.0134 0.394  1.01     133.     257.</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="model-comparison-in-cognitive-science.html#cb277-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Memory model fitted to memory data:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Memory model fitted to memory data:</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="model-comparison-in-cognitive-science.html#cb279-1" tabindex="-1"></a><span class="fu">print</span>(fit_memory2memory<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;biasM&quot;</span>, <span class="st">&quot;betaM&quot;</span>, <span class="st">&quot;tau[1]&quot;</span>, <span class="st">&quot;tau[2]&quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 4 Ã— 10
##   variable   mean median    sd   mad      q5    q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 biasM    -0.878 -0.883 0.207 0.202 -1.21   -0.539  1.00    714.     1354.
## 2 betaM     3.56   3.56  0.226 0.220  3.18    3.91   1.00   1368.     1441.
## 3 tau[1]    0.650  0.655 0.155 0.142  0.382   0.902  1.00    982.      957.
## 4 tau[2]    0.514  0.499 0.293 0.315  0.0654  1.04   1.01     81.3     332.</code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="model-comparison-in-cognitive-science.html#cb281-1" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Let&#39;s visualize some key parameters to better understand what the models have learned:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Let&#39;s visualize some key parameters to better understand what the models have learned:&quot;</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="model-comparison-in-cognitive-science.html#cb283-1" tabindex="-1"></a><span class="co"># Extract posterior samples for key parameters</span></span>
<span id="cb283-2"><a href="model-comparison-in-cognitive-science.html#cb283-2" tabindex="-1"></a>draws_biased2biased <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit_biased2biased<span class="sc">$</span><span class="fu">draws</span>())</span>
<span id="cb283-3"><a href="model-comparison-in-cognitive-science.html#cb283-3" tabindex="-1"></a>draws_biased2memory <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit_biased2memory<span class="sc">$</span><span class="fu">draws</span>())</span>
<span id="cb283-4"><a href="model-comparison-in-cognitive-science.html#cb283-4" tabindex="-1"></a>draws_memory2biased <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit_memory2biased<span class="sc">$</span><span class="fu">draws</span>())</span>
<span id="cb283-5"><a href="model-comparison-in-cognitive-science.html#cb283-5" tabindex="-1"></a>draws_memory2memory <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit_memory2memory<span class="sc">$</span><span class="fu">draws</span>())</span>
<span id="cb283-6"><a href="model-comparison-in-cognitive-science.html#cb283-6" tabindex="-1"></a></span>
<span id="cb283-7"><a href="model-comparison-in-cognitive-science.html#cb283-7" tabindex="-1"></a><span class="co"># Prepare data for plotting</span></span>
<span id="cb283-8"><a href="model-comparison-in-cognitive-science.html#cb283-8" tabindex="-1"></a>param_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb283-9"><a href="model-comparison-in-cognitive-science.html#cb283-9" tabindex="-1"></a>  <span class="co"># Biased model parameters</span></span>
<span id="cb283-10"><a href="model-comparison-in-cognitive-science.html#cb283-10" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb283-11"><a href="model-comparison-in-cognitive-science.html#cb283-11" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="st">&quot;Bias (Î¸)&quot;</span>,</span>
<span id="cb283-12"><a href="model-comparison-in-cognitive-science.html#cb283-12" tabindex="-1"></a>    <span class="at">value =</span> draws_biased2biased<span class="sc">$</span>thetaM,</span>
<span id="cb283-13"><a href="model-comparison-in-cognitive-science.html#cb283-13" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;Biased Model&quot;</span>,</span>
<span id="cb283-14"><a href="model-comparison-in-cognitive-science.html#cb283-14" tabindex="-1"></a>    <span class="at">data =</span> <span class="st">&quot;Biased Data&quot;</span></span>
<span id="cb283-15"><a href="model-comparison-in-cognitive-science.html#cb283-15" tabindex="-1"></a>  ),</span>
<span id="cb283-16"><a href="model-comparison-in-cognitive-science.html#cb283-16" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb283-17"><a href="model-comparison-in-cognitive-science.html#cb283-17" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="st">&quot;Bias (Î¸)&quot;</span>,</span>
<span id="cb283-18"><a href="model-comparison-in-cognitive-science.html#cb283-18" tabindex="-1"></a>    <span class="at">value =</span> draws_biased2memory<span class="sc">$</span>thetaM,</span>
<span id="cb283-19"><a href="model-comparison-in-cognitive-science.html#cb283-19" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;Biased Model&quot;</span>,</span>
<span id="cb283-20"><a href="model-comparison-in-cognitive-science.html#cb283-20" tabindex="-1"></a>    <span class="at">data =</span> <span class="st">&quot;Memory Data&quot;</span></span>
<span id="cb283-21"><a href="model-comparison-in-cognitive-science.html#cb283-21" tabindex="-1"></a>  ),</span>
<span id="cb283-22"><a href="model-comparison-in-cognitive-science.html#cb283-22" tabindex="-1"></a>  <span class="co"># Memory model parameters - converting to probability scale for bias</span></span>
<span id="cb283-23"><a href="model-comparison-in-cognitive-science.html#cb283-23" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb283-24"><a href="model-comparison-in-cognitive-science.html#cb283-24" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="st">&quot;Bias (Î¸)&quot;</span>,</span>
<span id="cb283-25"><a href="model-comparison-in-cognitive-science.html#cb283-25" tabindex="-1"></a>    <span class="at">value =</span> draws_memory2biased<span class="sc">$</span>biasM,</span>
<span id="cb283-26"><a href="model-comparison-in-cognitive-science.html#cb283-26" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;Memory Model&quot;</span>,</span>
<span id="cb283-27"><a href="model-comparison-in-cognitive-science.html#cb283-27" tabindex="-1"></a>    <span class="at">data =</span> <span class="st">&quot;Biased Data&quot;</span></span>
<span id="cb283-28"><a href="model-comparison-in-cognitive-science.html#cb283-28" tabindex="-1"></a>  ),</span>
<span id="cb283-29"><a href="model-comparison-in-cognitive-science.html#cb283-29" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb283-30"><a href="model-comparison-in-cognitive-science.html#cb283-30" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="st">&quot;Bias (Î¸)&quot;</span>,</span>
<span id="cb283-31"><a href="model-comparison-in-cognitive-science.html#cb283-31" tabindex="-1"></a>    <span class="at">value =</span> draws_memory2memory<span class="sc">$</span>biasM,</span>
<span id="cb283-32"><a href="model-comparison-in-cognitive-science.html#cb283-32" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;Memory Model&quot;</span>,</span>
<span id="cb283-33"><a href="model-comparison-in-cognitive-science.html#cb283-33" tabindex="-1"></a>    <span class="at">data =</span> <span class="st">&quot;Memory Data&quot;</span></span>
<span id="cb283-34"><a href="model-comparison-in-cognitive-science.html#cb283-34" tabindex="-1"></a>  ),</span>
<span id="cb283-35"><a href="model-comparison-in-cognitive-science.html#cb283-35" tabindex="-1"></a>  <span class="co"># Memory sensitivity parameter</span></span>
<span id="cb283-36"><a href="model-comparison-in-cognitive-science.html#cb283-36" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb283-37"><a href="model-comparison-in-cognitive-science.html#cb283-37" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="st">&quot;Memory Sensitivity (Î²)&quot;</span>,</span>
<span id="cb283-38"><a href="model-comparison-in-cognitive-science.html#cb283-38" tabindex="-1"></a>    <span class="at">value =</span> draws_memory2biased<span class="sc">$</span>betaM,</span>
<span id="cb283-39"><a href="model-comparison-in-cognitive-science.html#cb283-39" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;Memory Model&quot;</span>,</span>
<span id="cb283-40"><a href="model-comparison-in-cognitive-science.html#cb283-40" tabindex="-1"></a>    <span class="at">data =</span> <span class="st">&quot;Biased Data&quot;</span></span>
<span id="cb283-41"><a href="model-comparison-in-cognitive-science.html#cb283-41" tabindex="-1"></a>  ),</span>
<span id="cb283-42"><a href="model-comparison-in-cognitive-science.html#cb283-42" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb283-43"><a href="model-comparison-in-cognitive-science.html#cb283-43" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="st">&quot;Memory Sensitivity (Î²)&quot;</span>,</span>
<span id="cb283-44"><a href="model-comparison-in-cognitive-science.html#cb283-44" tabindex="-1"></a>    <span class="at">value =</span> draws_memory2memory<span class="sc">$</span>betaM,</span>
<span id="cb283-45"><a href="model-comparison-in-cognitive-science.html#cb283-45" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;Memory Model&quot;</span>,</span>
<span id="cb283-46"><a href="model-comparison-in-cognitive-science.html#cb283-46" tabindex="-1"></a>    <span class="at">data =</span> <span class="st">&quot;Memory Data&quot;</span></span>
<span id="cb283-47"><a href="model-comparison-in-cognitive-science.html#cb283-47" tabindex="-1"></a>  )</span>
<span id="cb283-48"><a href="model-comparison-in-cognitive-science.html#cb283-48" tabindex="-1"></a>)</span>
<span id="cb283-49"><a href="model-comparison-in-cognitive-science.html#cb283-49" tabindex="-1"></a></span>
<span id="cb283-50"><a href="model-comparison-in-cognitive-science.html#cb283-50" tabindex="-1"></a><span class="co"># Create reference lines data frame for the true parameter values</span></span>
<span id="cb283-51"><a href="model-comparison-in-cognitive-science.html#cb283-51" tabindex="-1"></a>true_param_lines <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb283-52"><a href="model-comparison-in-cognitive-science.html#cb283-52" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">parameter =</span> <span class="st">&quot;Bias (Î¸)&quot;</span>, <span class="at">model =</span> <span class="st">&quot;Biased Model&quot;</span>, <span class="at">true_value =</span> rateM),</span>
<span id="cb283-53"><a href="model-comparison-in-cognitive-science.html#cb283-53" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">parameter =</span> <span class="st">&quot;Bias (Î¸)&quot;</span>, <span class="at">model =</span> <span class="st">&quot;Memory Model&quot;</span>, <span class="at">true_value =</span> biasM),</span>
<span id="cb283-54"><a href="model-comparison-in-cognitive-science.html#cb283-54" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">parameter =</span> <span class="st">&quot;Memory Sensitivity (Î²)&quot;</span>, <span class="at">model =</span> <span class="st">&quot;Memory Model&quot;</span>, <span class="at">true_value =</span> betaM)</span>
<span id="cb283-55"><a href="model-comparison-in-cognitive-science.html#cb283-55" tabindex="-1"></a>)</span>
<span id="cb283-56"><a href="model-comparison-in-cognitive-science.html#cb283-56" tabindex="-1"></a></span>
<span id="cb283-57"><a href="model-comparison-in-cognitive-science.html#cb283-57" tabindex="-1"></a><span class="co"># Create visualization of posterior distributions</span></span>
<span id="cb283-58"><a href="model-comparison-in-cognitive-science.html#cb283-58" tabindex="-1"></a><span class="fu">ggplot</span>(param_data, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> data)) <span class="sc">+</span></span>
<span id="cb283-59"><a href="model-comparison-in-cognitive-science.html#cb283-59" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb283-60"><a href="model-comparison-in-cognitive-science.html#cb283-60" tabindex="-1"></a>  <span class="co"># Add reference lines only to relevant panels</span></span>
<span id="cb283-61"><a href="model-comparison-in-cognitive-science.html#cb283-61" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> true_param_lines, </span>
<span id="cb283-62"><a href="model-comparison-in-cognitive-science.html#cb283-62" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> true_value), </span>
<span id="cb283-63"><a href="model-comparison-in-cognitive-science.html#cb283-63" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, </span>
<span id="cb283-64"><a href="model-comparison-in-cognitive-science.html#cb283-64" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb283-65"><a href="model-comparison-in-cognitive-science.html#cb283-65" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model <span class="sc">~</span> parameter, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb283-66"><a href="model-comparison-in-cognitive-science.html#cb283-66" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb283-67"><a href="model-comparison-in-cognitive-science.html#cb283-67" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb283-68"><a href="model-comparison-in-cognitive-science.html#cb283-68" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Posterior Distributions of Key Parameters&quot;</span>,</span>
<span id="cb283-69"><a href="model-comparison-in-cognitive-science.html#cb283-69" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Comparing model fits to different data types&quot;</span>,</span>
<span id="cb283-70"><a href="model-comparison-in-cognitive-science.html#cb283-70" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Parameter Value&quot;</span>,</span>
<span id="cb283-71"><a href="model-comparison-in-cognitive-science.html#cb283-71" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>,</span>
<span id="cb283-72"><a href="model-comparison-in-cognitive-science.html#cb283-72" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Data Type&quot;</span></span>
<span id="cb283-73"><a href="model-comparison-in-cognitive-science.html#cb283-73" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb283-74"><a href="model-comparison-in-cognitive-science.html#cb283-74" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb283-75"><a href="model-comparison-in-cognitive-science.html#cb283-75" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/06%20fitting%20models-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="cross-validation-for-model-comparison" class="section level2 hasAnchor" number="8.9">
<h2><span class="header-section-number">8.9</span> Cross-Validation for Model Comparison<a href="model-comparison-in-cognitive-science.html#cross-validation-for-model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that weâ€™ve fit our models, we can use cross-validation techniques to compare them. Weâ€™ll start with PSIS-LOO since itâ€™s computationally efficient, and then validate with true k-fold cross-validation.</p>
<div id="psis-loo-comparison" class="section level3 hasAnchor" number="8.9.1">
<h3><span class="header-section-number">8.9.1</span> PSIS-LOO Comparison<a href="model-comparison-in-cognitive-science.html#psis-loo-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="model-comparison-in-cognitive-science.html#cb284-1" tabindex="-1"></a><span class="co"># Calculate ELPD using loo</span></span>
<span id="cb284-2"><a href="model-comparison-in-cognitive-science.html#cb284-2" tabindex="-1"></a>Loo_biased2biased <span class="ot">&lt;-</span> fit_biased2biased<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb284-3"><a href="model-comparison-in-cognitive-science.html#cb284-3" tabindex="-1"></a>Loo_biased2memory <span class="ot">&lt;-</span> fit_biased2memory<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb284-4"><a href="model-comparison-in-cognitive-science.html#cb284-4" tabindex="-1"></a>Loo_memory2biased <span class="ot">&lt;-</span> fit_memory2biased<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb284-5"><a href="model-comparison-in-cognitive-science.html#cb284-5" tabindex="-1"></a>Loo_memory2memory <span class="ot">&lt;-</span> fit_memory2memory<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb284-6"><a href="model-comparison-in-cognitive-science.html#cb284-6" tabindex="-1"></a></span>
<span id="cb284-7"><a href="model-comparison-in-cognitive-science.html#cb284-7" tabindex="-1"></a><span class="co"># Diagnostic check for LOO reliability</span></span>
<span id="cb284-8"><a href="model-comparison-in-cognitive-science.html#cb284-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Diagnostics for biased model on biased data:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Diagnostics for biased model on biased data:</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="model-comparison-in-cognitive-science.html#cb286-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>(Loo_biased2biased<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k <span class="sc">&gt;</span> <span class="fl">0.7</span>))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="model-comparison-in-cognitive-science.html#cb288-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Diagnostics for biased model on memory data:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Diagnostics for biased model on memory data:</code></pre>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="model-comparison-in-cognitive-science.html#cb290-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>(Loo_biased2memory<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k <span class="sc">&gt;</span> <span class="fl">0.7</span>))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="model-comparison-in-cognitive-science.html#cb292-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Diagnostics for memory model on biased data:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Diagnostics for memory model on biased data:</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="model-comparison-in-cognitive-science.html#cb294-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>(Loo_memory2biased<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k <span class="sc">&gt;</span> <span class="fl">0.7</span>))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="model-comparison-in-cognitive-science.html#cb296-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Diagnostics for memory model on memory data:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Diagnostics for memory model on memory data:</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="model-comparison-in-cognitive-science.html#cb298-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>(Loo_memory2memory<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k <span class="sc">&gt;</span> <span class="fl">0.7</span>))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="model-comparison-in-cognitive-science.html#cb300-1" tabindex="-1"></a><span class="co"># Extract ELPD values</span></span>
<span id="cb300-2"><a href="model-comparison-in-cognitive-science.html#cb300-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">ELPD for each model-data combination:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## ELPD for each model-data combination:</code></pre>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="model-comparison-in-cognitive-science.html#cb302-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Biased model on biased data:&quot;</span>, <span class="fu">round</span>(Loo_biased2biased<span class="sc">$</span>estimates[<span class="st">&quot;elpd_loo&quot;</span>, <span class="st">&quot;Estimate&quot;</span>], <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Biased model on biased data: -6015.11</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="model-comparison-in-cognitive-science.html#cb304-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Biased model on memory data:&quot;</span>, <span class="fu">round</span>(Loo_biased2memory<span class="sc">$</span>estimates[<span class="st">&quot;elpd_loo&quot;</span>, <span class="st">&quot;Estimate&quot;</span>], <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Biased model on memory data: -4696.54</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="model-comparison-in-cognitive-science.html#cb306-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Memory model on biased data:&quot;</span>, <span class="fu">round</span>(Loo_memory2biased<span class="sc">$</span>estimates[<span class="st">&quot;elpd_loo&quot;</span>, <span class="st">&quot;Estimate&quot;</span>], <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Memory model on biased data: -6019.19</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="model-comparison-in-cognitive-science.html#cb308-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Memory model on memory data:&quot;</span>, <span class="fu">round</span>(Loo_memory2memory<span class="sc">$</span>estimates[<span class="st">&quot;elpd_loo&quot;</span>, <span class="st">&quot;Estimate&quot;</span>], <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Memory model on memory data: -4526.47</code></pre>
</div>
<div id="visualizing-loo-cv-results" class="section level3 hasAnchor" number="8.9.2">
<h3><span class="header-section-number">8.9.2</span> Visualizing LOO-CV Results<a href="model-comparison-in-cognitive-science.html#visualizing-loo-cv-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To better understand how our models perform, letâ€™s visualize the pointwise differences in ELPD:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="model-comparison-in-cognitive-science.html#cb310-1" tabindex="-1"></a><span class="co"># Create dataframe of pointwise ELPD differences</span></span>
<span id="cb310-2"><a href="model-comparison-in-cognitive-science.html#cb310-2" tabindex="-1"></a>elpd_diff <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb310-3"><a href="model-comparison-in-cognitive-science.html#cb310-3" tabindex="-1"></a>  <span class="at">observation =</span> <span class="fu">seq</span>(<span class="fu">length</span>(Loo_biased2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>])),</span>
<span id="cb310-4"><a href="model-comparison-in-cognitive-science.html#cb310-4" tabindex="-1"></a>  <span class="at">biased_data_diff =</span> Loo_biased2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>] <span class="sc">-</span> </span>
<span id="cb310-5"><a href="model-comparison-in-cognitive-science.html#cb310-5" tabindex="-1"></a>                     Loo_memory2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>],</span>
<span id="cb310-6"><a href="model-comparison-in-cognitive-science.html#cb310-6" tabindex="-1"></a>  <span class="at">memory_data_diff =</span> Loo_memory2memory<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>] <span class="sc">-</span> </span>
<span id="cb310-7"><a href="model-comparison-in-cognitive-science.html#cb310-7" tabindex="-1"></a>                     Loo_biased2memory<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>]</span>
<span id="cb310-8"><a href="model-comparison-in-cognitive-science.html#cb310-8" tabindex="-1"></a>)</span>
<span id="cb310-9"><a href="model-comparison-in-cognitive-science.html#cb310-9" tabindex="-1"></a></span>
<span id="cb310-10"><a href="model-comparison-in-cognitive-science.html#cb310-10" tabindex="-1"></a><span class="co"># Create long format for easier plotting</span></span>
<span id="cb310-11"><a href="model-comparison-in-cognitive-science.html#cb310-11" tabindex="-1"></a>elpd_long <span class="ot">&lt;-</span> elpd_diff <span class="sc">%&gt;%</span></span>
<span id="cb310-12"><a href="model-comparison-in-cognitive-science.html#cb310-12" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb310-13"><a href="model-comparison-in-cognitive-science.html#cb310-13" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(biased_data_diff, memory_data_diff),</span>
<span id="cb310-14"><a href="model-comparison-in-cognitive-science.html#cb310-14" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;comparison&quot;</span>,</span>
<span id="cb310-15"><a href="model-comparison-in-cognitive-science.html#cb310-15" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;elpd_diff&quot;</span></span>
<span id="cb310-16"><a href="model-comparison-in-cognitive-science.html#cb310-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb310-17"><a href="model-comparison-in-cognitive-science.html#cb310-17" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb310-18"><a href="model-comparison-in-cognitive-science.html#cb310-18" tabindex="-1"></a>    <span class="at">comparison =</span> <span class="fu">case_when</span>(</span>
<span id="cb310-19"><a href="model-comparison-in-cognitive-science.html#cb310-19" tabindex="-1"></a>      comparison <span class="sc">==</span> <span class="st">&quot;biased_data_diff&quot;</span> <span class="sc">~</span> <span class="st">&quot;Biased Model vs Memory Model</span><span class="sc">\n</span><span class="st">on Biased Data&quot;</span>,</span>
<span id="cb310-20"><a href="model-comparison-in-cognitive-science.html#cb310-20" tabindex="-1"></a>      comparison <span class="sc">==</span> <span class="st">&quot;memory_data_diff&quot;</span> <span class="sc">~</span> <span class="st">&quot;Memory Model vs Biased Model</span><span class="sc">\n</span><span class="st">on Memory Data&quot;</span></span>
<span id="cb310-21"><a href="model-comparison-in-cognitive-science.html#cb310-21" tabindex="-1"></a>    ),</span>
<span id="cb310-22"><a href="model-comparison-in-cognitive-science.html#cb310-22" tabindex="-1"></a>    <span class="at">favors_true_model =</span> <span class="fu">case_when</span>(</span>
<span id="cb310-23"><a href="model-comparison-in-cognitive-science.html#cb310-23" tabindex="-1"></a>      comparison <span class="sc">==</span> <span class="st">&quot;Biased Model vs Memory Model</span><span class="sc">\n</span><span class="st">on Biased Data&quot;</span> <span class="sc">&amp;</span> elpd_diff <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb310-24"><a href="model-comparison-in-cognitive-science.html#cb310-24" tabindex="-1"></a>      comparison <span class="sc">==</span> <span class="st">&quot;Memory Model vs Biased Model</span><span class="sc">\n</span><span class="st">on Memory Data&quot;</span> <span class="sc">&amp;</span> elpd_diff <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb310-25"><a href="model-comparison-in-cognitive-science.html#cb310-25" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">FALSE</span></span>
<span id="cb310-26"><a href="model-comparison-in-cognitive-science.html#cb310-26" tabindex="-1"></a>    )</span>
<span id="cb310-27"><a href="model-comparison-in-cognitive-science.html#cb310-27" tabindex="-1"></a>  )</span>
<span id="cb310-28"><a href="model-comparison-in-cognitive-science.html#cb310-28" tabindex="-1"></a></span>
<span id="cb310-29"><a href="model-comparison-in-cognitive-science.html#cb310-29" tabindex="-1"></a><span class="co"># Create visualization of ELPD differences</span></span>
<span id="cb310-30"><a href="model-comparison-in-cognitive-science.html#cb310-30" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elpd_long, <span class="fu">aes</span>(<span class="at">x =</span> observation, <span class="at">y =</span> elpd_diff, <span class="at">color =</span> favors_true_model)) <span class="sc">+</span></span>
<span id="cb310-31"><a href="model-comparison-in-cognitive-science.html#cb310-31" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb310-32"><a href="model-comparison-in-cognitive-science.html#cb310-32" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb310-33"><a href="model-comparison-in-cognitive-science.html#cb310-33" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>comparison) <span class="sc">+</span></span>
<span id="cb310-34"><a href="model-comparison-in-cognitive-science.html#cb310-34" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;TRUE&quot;</span> <span class="ot">=</span> <span class="st">&quot;green4&quot;</span>, <span class="st">&quot;FALSE&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb310-35"><a href="model-comparison-in-cognitive-science.html#cb310-35" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb310-36"><a href="model-comparison-in-cognitive-science.html#cb310-36" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Pointwise ELPD Differences Between Models&quot;</span>,</span>
<span id="cb310-37"><a href="model-comparison-in-cognitive-science.html#cb310-37" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Positive values (represented in green) favor the true model (first model in comparison)&quot;</span>,</span>
<span id="cb310-38"><a href="model-comparison-in-cognitive-science.html#cb310-38" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Observation&quot;</span>,</span>
<span id="cb310-39"><a href="model-comparison-in-cognitive-science.html#cb310-39" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;ELPD Difference&quot;</span></span>
<span id="cb310-40"><a href="model-comparison-in-cognitive-science.html#cb310-40" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb310-41"><a href="model-comparison-in-cognitive-science.html#cb310-41" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb310-42"><a href="model-comparison-in-cognitive-science.html#cb310-42" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb310-43"><a href="model-comparison-in-cognitive-science.html#cb310-43" tabindex="-1"></a></span>
<span id="cb310-44"><a href="model-comparison-in-cognitive-science.html#cb310-44" tabindex="-1"></a><span class="co"># Create density plots of ELPD differences</span></span>
<span id="cb310-45"><a href="model-comparison-in-cognitive-science.html#cb310-45" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elpd_long, <span class="fu">aes</span>(<span class="at">x =</span> elpd_diff, <span class="at">fill =</span> comparison)) <span class="sc">+</span></span>
<span id="cb310-46"><a href="model-comparison-in-cognitive-science.html#cb310-46" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb310-47"><a href="model-comparison-in-cognitive-science.html#cb310-47" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb310-48"><a href="model-comparison-in-cognitive-science.html#cb310-48" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb310-49"><a href="model-comparison-in-cognitive-science.html#cb310-49" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb310-50"><a href="model-comparison-in-cognitive-science.html#cb310-50" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Distribution of ELPD Differences&quot;</span>,</span>
<span id="cb310-51"><a href="model-comparison-in-cognitive-science.html#cb310-51" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;How consistently does the true model outperform the alternative?&quot;</span>,</span>
<span id="cb310-52"><a href="model-comparison-in-cognitive-science.html#cb310-52" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;ELPD Difference&quot;</span>,</span>
<span id="cb310-53"><a href="model-comparison-in-cognitive-science.html#cb310-53" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>,</span>
<span id="cb310-54"><a href="model-comparison-in-cognitive-science.html#cb310-54" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Comparison&quot;</span></span>
<span id="cb310-55"><a href="model-comparison-in-cognitive-science.html#cb310-55" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb310-56"><a href="model-comparison-in-cognitive-science.html#cb310-56" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb310-57"><a href="model-comparison-in-cognitive-science.html#cb310-57" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb310-58"><a href="model-comparison-in-cognitive-science.html#cb310-58" tabindex="-1"></a></span>
<span id="cb310-59"><a href="model-comparison-in-cognitive-science.html#cb310-59" tabindex="-1"></a><span class="co"># Combine plots</span></span>
<span id="cb310-60"><a href="model-comparison-in-cognitive-science.html#cb310-60" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-32-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Itâ€™s quite clear that the bulk of the data a equally well explained by the models. And the differences for the biased data are tricky to see in the plot. Yet, we can see that in memory data there are a non trivial amount of data points better explained by the memory model (the true underlying data-generating mechanism).</p>
</div>
</div>
<div id="formal-model-comparison" class="section level2 hasAnchor" number="8.10">
<h2><span class="header-section-number">8.10</span> Formal Model Comparison<a href="model-comparison-in-cognitive-science.html#formal-model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now letâ€™s perform formal model comparison using the loo_compare function, which computes the difference in ELPD between models and the standard error of this difference:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="model-comparison-in-cognitive-science.html#cb311-1" tabindex="-1"></a><span class="co"># Compare models fitted to biased data</span></span>
<span id="cb311-2"><a href="model-comparison-in-cognitive-science.html#cb311-2" tabindex="-1"></a>comparison_biased <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(Loo_biased2biased, Loo_memory2biased)</span>
<span id="cb311-3"><a href="model-comparison-in-cognitive-science.html#cb311-3" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Model comparison for biased data:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Model comparison for biased data:&quot;</code></pre>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="model-comparison-in-cognitive-science.html#cb313-1" tabindex="-1"></a><span class="fu">print</span>(comparison_biased)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1  0.0       0.0   
## model2 -4.1       1.1</code></pre>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="model-comparison-in-cognitive-science.html#cb315-1" tabindex="-1"></a><span class="co"># Compare models fitted to memory data</span></span>
<span id="cb315-2"><a href="model-comparison-in-cognitive-science.html#cb315-2" tabindex="-1"></a>comparison_memory <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(Loo_memory2memory, Loo_biased2memory)</span>
<span id="cb315-3"><a href="model-comparison-in-cognitive-science.html#cb315-3" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Model comparison for memory data:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;\nModel comparison for memory data:&quot;</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="model-comparison-in-cognitive-science.html#cb317-1" tabindex="-1"></a><span class="fu">print</span>(comparison_memory)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1    0.0       0.0 
## model2 -170.1      13.0</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="model-comparison-in-cognitive-science.html#cb319-1" tabindex="-1"></a><span class="co"># Calculate model weights</span></span>
<span id="cb319-2"><a href="model-comparison-in-cognitive-science.html#cb319-2" tabindex="-1"></a>weights_biased <span class="ot">&lt;-</span> <span class="fu">loo_model_weights</span>(<span class="fu">list</span>(</span>
<span id="cb319-3"><a href="model-comparison-in-cognitive-science.html#cb319-3" tabindex="-1"></a>  <span class="st">&quot;Biased Model&quot;</span> <span class="ot">=</span> Loo_biased2biased, </span>
<span id="cb319-4"><a href="model-comparison-in-cognitive-science.html#cb319-4" tabindex="-1"></a>  <span class="st">&quot;Memory Model&quot;</span> <span class="ot">=</span> Loo_memory2biased</span>
<span id="cb319-5"><a href="model-comparison-in-cognitive-science.html#cb319-5" tabindex="-1"></a>))</span>
<span id="cb319-6"><a href="model-comparison-in-cognitive-science.html#cb319-6" tabindex="-1"></a></span>
<span id="cb319-7"><a href="model-comparison-in-cognitive-science.html#cb319-7" tabindex="-1"></a>weights_memory <span class="ot">&lt;-</span> <span class="fu">loo_model_weights</span>(<span class="fu">list</span>(</span>
<span id="cb319-8"><a href="model-comparison-in-cognitive-science.html#cb319-8" tabindex="-1"></a>  <span class="st">&quot;Memory Model&quot;</span> <span class="ot">=</span> Loo_memory2memory, </span>
<span id="cb319-9"><a href="model-comparison-in-cognitive-science.html#cb319-9" tabindex="-1"></a>  <span class="st">&quot;Biased Model&quot;</span> <span class="ot">=</span> Loo_biased2memory</span>
<span id="cb319-10"><a href="model-comparison-in-cognitive-science.html#cb319-10" tabindex="-1"></a>))</span>
<span id="cb319-11"><a href="model-comparison-in-cognitive-science.html#cb319-11" tabindex="-1"></a></span>
<span id="cb319-12"><a href="model-comparison-in-cognitive-science.html#cb319-12" tabindex="-1"></a><span class="co"># Create data for model weights visualization</span></span>
<span id="cb319-13"><a href="model-comparison-in-cognitive-science.html#cb319-13" tabindex="-1"></a>weights_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb319-14"><a href="model-comparison-in-cognitive-science.html#cb319-14" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">c</span>(<span class="st">&quot;Biased Model&quot;</span>, <span class="st">&quot;Memory Model&quot;</span>, <span class="st">&quot;Memory Model&quot;</span>, <span class="st">&quot;Biased Model&quot;</span>),</span>
<span id="cb319-15"><a href="model-comparison-in-cognitive-science.html#cb319-15" tabindex="-1"></a>  <span class="at">data_type =</span> <span class="fu">c</span>(<span class="st">&quot;Biased Data&quot;</span>, <span class="st">&quot;Biased Data&quot;</span>, <span class="st">&quot;Memory Data&quot;</span>, <span class="st">&quot;Memory Data&quot;</span>),</span>
<span id="cb319-16"><a href="model-comparison-in-cognitive-science.html#cb319-16" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">c</span>(weights_biased[<span class="dv">1</span>], weights_biased[<span class="dv">2</span>], weights_memory[<span class="dv">1</span>], weights_memory[<span class="dv">2</span>])</span>
<span id="cb319-17"><a href="model-comparison-in-cognitive-science.html#cb319-17" tabindex="-1"></a>)</span>
<span id="cb319-18"><a href="model-comparison-in-cognitive-science.html#cb319-18" tabindex="-1"></a></span>
<span id="cb319-19"><a href="model-comparison-in-cognitive-science.html#cb319-19" tabindex="-1"></a><span class="co"># Visualize model weights</span></span>
<span id="cb319-20"><a href="model-comparison-in-cognitive-science.html#cb319-20" tabindex="-1"></a><span class="fu">ggplot</span>(weights_data, <span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> weight, <span class="at">fill =</span> model)) <span class="sc">+</span></span>
<span id="cb319-21"><a href="model-comparison-in-cognitive-science.html#cb319-21" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb319-22"><a href="model-comparison-in-cognitive-science.html#cb319-22" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> data_type) <span class="sc">+</span></span>
<span id="cb319-23"><a href="model-comparison-in-cognitive-science.html#cb319-23" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb319-24"><a href="model-comparison-in-cognitive-science.html#cb319-24" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb319-25"><a href="model-comparison-in-cognitive-science.html#cb319-25" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Model Comparison via Stacking Weights&quot;</span>,</span>
<span id="cb319-26"><a href="model-comparison-in-cognitive-science.html#cb319-26" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Higher weights indicate better predictive performance&quot;</span>,</span>
<span id="cb319-27"><a href="model-comparison-in-cognitive-science.html#cb319-27" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb319-28"><a href="model-comparison-in-cognitive-science.html#cb319-28" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Model Weight&quot;</span>,</span>
<span id="cb319-29"><a href="model-comparison-in-cognitive-science.html#cb319-29" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Model Type&quot;</span></span>
<span id="cb319-30"><a href="model-comparison-in-cognitive-science.html#cb319-30" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb319-31"><a href="model-comparison-in-cognitive-science.html#cb319-31" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb319-32"><a href="model-comparison-in-cognitive-science.html#cb319-32" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb319-33"><a href="model-comparison-in-cognitive-science.html#cb319-33" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb319-34"><a href="model-comparison-in-cognitive-science.html#cb319-34" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb319-35"><a href="model-comparison-in-cognitive-science.html#cb319-35" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb319-36"><a href="model-comparison-in-cognitive-science.html#cb319-36" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(weight, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-33-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Here it is clear that formal model comparison can clearly pick the right model. Hurrah!</p>
<div id="k-fold-cross-validation-for-validation" class="section level3 hasAnchor" number="8.10.1">
<h3><span class="header-section-number">8.10.1</span> K-Fold Cross-Validation for Validation<a href="model-comparison-in-cognitive-science.html#k-fold-cross-validation-for-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While PSIS-LOO is efficient, we need to check how it relates with true cross-validation.</p>
<p>First we create new stan models, which separates data into training and test data and include the ability to calculate log-likelihood for test data. This is crucial for cross-validation, as we need to evaluate the modelâ€™s performance on unseen data.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="model-comparison-in-cognitive-science.html#cb320-1" tabindex="-1"></a><span class="co"># Stan model for biased agent with cross-validation capabilities</span></span>
<span id="cb320-2"><a href="model-comparison-in-cognitive-science.html#cb320-2" tabindex="-1"></a>stan_biased_cv_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb320-3"><a href="model-comparison-in-cognitive-science.html#cb320-3" tabindex="-1"></a><span class="st">// Multilevel Biased Agent Model with CV support</span></span>
<span id="cb320-4"><a href="model-comparison-in-cognitive-science.html#cb320-4" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb320-5"><a href="model-comparison-in-cognitive-science.html#cb320-5" tabindex="-1"></a><span class="st">// This model has additional structures to handle test data for cross-validation</span></span>
<span id="cb320-6"><a href="model-comparison-in-cognitive-science.html#cb320-6" tabindex="-1"></a></span>
<span id="cb320-7"><a href="model-comparison-in-cognitive-science.html#cb320-7" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb320-8"><a href="model-comparison-in-cognitive-science.html#cb320-8" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { </span></span>
<span id="cb320-9"><a href="model-comparison-in-cognitive-science.html#cb320-9" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // CDF for bounds</span></span>
<span id="cb320-10"><a href="model-comparison-in-cognitive-science.html#cb320-10" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb320-11"><a href="model-comparison-in-cognitive-science.html#cb320-11" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // Inverse CDF for value</span></span>
<span id="cb320-12"><a href="model-comparison-in-cognitive-science.html#cb320-12" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb320-13"><a href="model-comparison-in-cognitive-science.html#cb320-13" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb320-14"><a href="model-comparison-in-cognitive-science.html#cb320-14" tabindex="-1"></a></span>
<span id="cb320-15"><a href="model-comparison-in-cognitive-science.html#cb320-15" tabindex="-1"></a><span class="st">// Input data - now includes both training and test data</span></span>
<span id="cb320-16"><a href="model-comparison-in-cognitive-science.html#cb320-16" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb320-17"><a href="model-comparison-in-cognitive-science.html#cb320-17" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;              // Number of trials per agent</span></span>
<span id="cb320-18"><a href="model-comparison-in-cognitive-science.html#cb320-18" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;              // Number of training agents</span></span>
<span id="cb320-19"><a href="model-comparison-in-cognitive-science.html#cb320-19" tabindex="-1"></a><span class="st"> array[trials, agents] int h;        // Training choice data</span></span>
<span id="cb320-20"><a href="model-comparison-in-cognitive-science.html#cb320-20" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb320-21"><a href="model-comparison-in-cognitive-science.html#cb320-21" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents_test;         // Number of test agents</span></span>
<span id="cb320-22"><a href="model-comparison-in-cognitive-science.html#cb320-22" tabindex="-1"></a><span class="st"> array[trials, agents_test] int h_test;  // Test choice data</span></span>
<span id="cb320-23"><a href="model-comparison-in-cognitive-science.html#cb320-23" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb320-24"><a href="model-comparison-in-cognitive-science.html#cb320-24" tabindex="-1"></a></span>
<span id="cb320-25"><a href="model-comparison-in-cognitive-science.html#cb320-25" tabindex="-1"></a><span class="st">// Parameters to be estimated</span></span>
<span id="cb320-26"><a href="model-comparison-in-cognitive-science.html#cb320-26" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb320-27"><a href="model-comparison-in-cognitive-science.html#cb320-27" tabindex="-1"></a><span class="st">  real thetaM;                       // Population mean of bias</span></span>
<span id="cb320-28"><a href="model-comparison-in-cognitive-science.html#cb320-28" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;           // Population SD of bias</span></span>
<span id="cb320-29"><a href="model-comparison-in-cognitive-science.html#cb320-29" tabindex="-1"></a><span class="st">  array[agents] real theta;          // Individual agent biases</span></span>
<span id="cb320-30"><a href="model-comparison-in-cognitive-science.html#cb320-30" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb320-31"><a href="model-comparison-in-cognitive-science.html#cb320-31" tabindex="-1"></a></span>
<span id="cb320-32"><a href="model-comparison-in-cognitive-science.html#cb320-32" tabindex="-1"></a><span class="st">// Model definition - trained only on training data</span></span>
<span id="cb320-33"><a href="model-comparison-in-cognitive-science.html#cb320-33" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb320-34"><a href="model-comparison-in-cognitive-science.html#cb320-34" tabindex="-1"></a><span class="st">  // Population-level priors</span></span>
<span id="cb320-35"><a href="model-comparison-in-cognitive-science.html#cb320-35" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb320-36"><a href="model-comparison-in-cognitive-science.html#cb320-36" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3) - normal_lccdf(0 | 0, .3);</span></span>
<span id="cb320-37"><a href="model-comparison-in-cognitive-science.html#cb320-37" tabindex="-1"></a></span>
<span id="cb320-38"><a href="model-comparison-in-cognitive-science.html#cb320-38" tabindex="-1"></a><span class="st">  // Individual-level parameters</span></span>
<span id="cb320-39"><a href="model-comparison-in-cognitive-science.html#cb320-39" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb320-40"><a href="model-comparison-in-cognitive-science.html#cb320-40" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb320-41"><a href="model-comparison-in-cognitive-science.html#cb320-41" tabindex="-1"></a><span class="st">  // Likelihood for training data only</span></span>
<span id="cb320-42"><a href="model-comparison-in-cognitive-science.html#cb320-42" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb320-43"><a href="model-comparison-in-cognitive-science.html#cb320-43" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb320-44"><a href="model-comparison-in-cognitive-science.html#cb320-44" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb320-45"><a href="model-comparison-in-cognitive-science.html#cb320-45" tabindex="-1"></a></span>
<span id="cb320-46"><a href="model-comparison-in-cognitive-science.html#cb320-46" tabindex="-1"></a><span class="st">// Calculate log-likelihood for both training and test data</span></span>
<span id="cb320-47"><a href="model-comparison-in-cognitive-science.html#cb320-47" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb320-48"><a href="model-comparison-in-cognitive-science.html#cb320-48" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb320-49"><a href="model-comparison-in-cognitive-science.html#cb320-49" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb320-50"><a href="model-comparison-in-cognitive-science.html#cb320-50" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb320-51"><a href="model-comparison-in-cognitive-science.html#cb320-51" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb320-52"><a href="model-comparison-in-cognitive-science.html#cb320-52" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb320-53"><a href="model-comparison-in-cognitive-science.html#cb320-53" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb320-54"><a href="model-comparison-in-cognitive-science.html#cb320-54" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb320-55"><a href="model-comparison-in-cognitive-science.html#cb320-55" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb320-56"><a href="model-comparison-in-cognitive-science.html#cb320-56" tabindex="-1"></a><span class="st">   // Log-likelihood for training data</span></span>
<span id="cb320-57"><a href="model-comparison-in-cognitive-science.html#cb320-57" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb320-58"><a href="model-comparison-in-cognitive-science.html#cb320-58" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb320-59"><a href="model-comparison-in-cognitive-science.html#cb320-59" tabindex="-1"></a><span class="st">   // Log-likelihood for test data - crucial for cross-validation</span></span>
<span id="cb320-60"><a href="model-comparison-in-cognitive-science.html#cb320-60" tabindex="-1"></a><span class="st">   array[trials, agents_test] real log_lik_test;</span></span>
<span id="cb320-61"><a href="model-comparison-in-cognitive-science.html#cb320-61" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb320-62"><a href="model-comparison-in-cognitive-science.html#cb320-62" tabindex="-1"></a><span class="st">   // Generate prior and posterior samples</span></span>
<span id="cb320-63"><a href="model-comparison-in-cognitive-science.html#cb320-63" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb320-64"><a href="model-comparison-in-cognitive-science.html#cb320-64" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb320-65"><a href="model-comparison-in-cognitive-science.html#cb320-65" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb320-66"><a href="model-comparison-in-cognitive-science.html#cb320-66" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb320-67"><a href="model-comparison-in-cognitive-science.html#cb320-67" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb320-68"><a href="model-comparison-in-cognitive-science.html#cb320-68" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb320-69"><a href="model-comparison-in-cognitive-science.html#cb320-69" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb320-70"><a href="model-comparison-in-cognitive-science.html#cb320-70" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb320-71"><a href="model-comparison-in-cognitive-science.html#cb320-71" tabindex="-1"></a><span class="st">   // Calculate log-likelihood for training data</span></span>
<span id="cb320-72"><a href="model-comparison-in-cognitive-science.html#cb320-72" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb320-73"><a href="model-comparison-in-cognitive-science.html#cb320-73" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb320-74"><a href="model-comparison-in-cognitive-science.html#cb320-74" tabindex="-1"></a><span class="st">      log_lik[t,i] = bernoulli_logit_lpmf(h[t,i] | theta[i]);</span></span>
<span id="cb320-75"><a href="model-comparison-in-cognitive-science.html#cb320-75" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb320-76"><a href="model-comparison-in-cognitive-science.html#cb320-76" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb320-77"><a href="model-comparison-in-cognitive-science.html#cb320-77" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb320-78"><a href="model-comparison-in-cognitive-science.html#cb320-78" tabindex="-1"></a><span class="st">   // Calculate log-likelihood for test data</span></span>
<span id="cb320-79"><a href="model-comparison-in-cognitive-science.html#cb320-79" tabindex="-1"></a><span class="st">   // Note: We use population-level estimates for prediction</span></span>
<span id="cb320-80"><a href="model-comparison-in-cognitive-science.html#cb320-80" tabindex="-1"></a><span class="st">   for (i in 1:agents_test){</span></span>
<span id="cb320-81"><a href="model-comparison-in-cognitive-science.html#cb320-81" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb320-82"><a href="model-comparison-in-cognitive-science.html#cb320-82" tabindex="-1"></a><span class="st">      log_lik_test[t,i] = bernoulli_logit_lpmf(h_test[t,i] | thetaM);</span></span>
<span id="cb320-83"><a href="model-comparison-in-cognitive-science.html#cb320-83" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb320-84"><a href="model-comparison-in-cognitive-science.html#cb320-84" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb320-85"><a href="model-comparison-in-cognitive-science.html#cb320-85" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb320-86"><a href="model-comparison-in-cognitive-science.html#cb320-86" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb320-87"><a href="model-comparison-in-cognitive-science.html#cb320-87" tabindex="-1"></a></span>
<span id="cb320-88"><a href="model-comparison-in-cognitive-science.html#cb320-88" tabindex="-1"></a><span class="co"># Write the model to a file</span></span>
<span id="cb320-89"><a href="model-comparison-in-cognitive-science.html#cb320-89" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb320-90"><a href="model-comparison-in-cognitive-science.html#cb320-90" tabindex="-1"></a>  stan_biased_cv_model,</span>
<span id="cb320-91"><a href="model-comparison-in-cognitive-science.html#cb320-91" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb320-92"><a href="model-comparison-in-cognitive-science.html#cb320-92" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W7_MultilevelBias_cv.stan&quot;</span></span>
<span id="cb320-93"><a href="model-comparison-in-cognitive-science.html#cb320-93" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W7_MultilevelBias_cv.stan&quot;</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="model-comparison-in-cognitive-science.html#cb322-1" tabindex="-1"></a><span class="co"># Compile the model</span></span>
<span id="cb322-2"><a href="model-comparison-in-cognitive-science.html#cb322-2" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W7_MultilevelBias_cv.stan&quot;</span>)</span>
<span id="cb322-3"><a href="model-comparison-in-cognitive-science.html#cb322-3" tabindex="-1"></a>mod_biased_cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(</span>
<span id="cb322-4"><a href="model-comparison-in-cognitive-science.html#cb322-4" tabindex="-1"></a>  file, </span>
<span id="cb322-5"><a href="model-comparison-in-cognitive-science.html#cb322-5" tabindex="-1"></a>  <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb322-6"><a href="model-comparison-in-cognitive-science.html#cb322-6" tabindex="-1"></a>  <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>)</span>
<span id="cb322-7"><a href="model-comparison-in-cognitive-science.html#cb322-7" tabindex="-1"></a>)</span>
<span id="cb322-8"><a href="model-comparison-in-cognitive-science.html#cb322-8" tabindex="-1"></a></span>
<span id="cb322-9"><a href="model-comparison-in-cognitive-science.html#cb322-9" tabindex="-1"></a><span class="co"># Similarly, define the memory agent model with CV support</span></span>
<span id="cb322-10"><a href="model-comparison-in-cognitive-science.html#cb322-10" tabindex="-1"></a>stan_memory_cv_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb322-11"><a href="model-comparison-in-cognitive-science.html#cb322-11" tabindex="-1"></a><span class="st">// Multilevel Memory Agent Model with CV support</span></span>
<span id="cb322-12"><a href="model-comparison-in-cognitive-science.html#cb322-12" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb322-13"><a href="model-comparison-in-cognitive-science.html#cb322-13" tabindex="-1"></a><span class="st">// This model has additional structures to handle test data for cross-validation</span></span>
<span id="cb322-14"><a href="model-comparison-in-cognitive-science.html#cb322-14" tabindex="-1"></a></span>
<span id="cb322-15"><a href="model-comparison-in-cognitive-science.html#cb322-15" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb322-16"><a href="model-comparison-in-cognitive-science.html#cb322-16" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb322-17"><a href="model-comparison-in-cognitive-science.html#cb322-17" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // CDF for bounds</span></span>
<span id="cb322-18"><a href="model-comparison-in-cognitive-science.html#cb322-18" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb322-19"><a href="model-comparison-in-cognitive-science.html#cb322-19" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // Inverse CDF for value</span></span>
<span id="cb322-20"><a href="model-comparison-in-cognitive-science.html#cb322-20" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb322-21"><a href="model-comparison-in-cognitive-science.html#cb322-21" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb322-22"><a href="model-comparison-in-cognitive-science.html#cb322-22" tabindex="-1"></a></span>
<span id="cb322-23"><a href="model-comparison-in-cognitive-science.html#cb322-23" tabindex="-1"></a><span class="st">// Input data - includes both training and test data</span></span>
<span id="cb322-24"><a href="model-comparison-in-cognitive-science.html#cb322-24" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb322-25"><a href="model-comparison-in-cognitive-science.html#cb322-25" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;              // Number of trials per agent</span></span>
<span id="cb322-26"><a href="model-comparison-in-cognitive-science.html#cb322-26" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;              // Number of training agents</span></span>
<span id="cb322-27"><a href="model-comparison-in-cognitive-science.html#cb322-27" tabindex="-1"></a><span class="st"> array[trials, agents] int h;        // Training choice data</span></span>
<span id="cb322-28"><a href="model-comparison-in-cognitive-science.html#cb322-28" tabindex="-1"></a><span class="st"> array[trials, agents] int other;    // Opponent&#39;s choices for training agents</span></span>
<span id="cb322-29"><a href="model-comparison-in-cognitive-science.html#cb322-29" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb322-30"><a href="model-comparison-in-cognitive-science.html#cb322-30" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents_test;         // Number of test agents</span></span>
<span id="cb322-31"><a href="model-comparison-in-cognitive-science.html#cb322-31" tabindex="-1"></a><span class="st"> array[trials, agents_test] int h_test;    // Test choice data</span></span>
<span id="cb322-32"><a href="model-comparison-in-cognitive-science.html#cb322-32" tabindex="-1"></a><span class="st"> array[trials, agents_test] int other_test; // Opponent&#39;s choices for test agents</span></span>
<span id="cb322-33"><a href="model-comparison-in-cognitive-science.html#cb322-33" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb322-34"><a href="model-comparison-in-cognitive-science.html#cb322-34" tabindex="-1"></a></span>
<span id="cb322-35"><a href="model-comparison-in-cognitive-science.html#cb322-35" tabindex="-1"></a><span class="st">// Parameters to be estimated</span></span>
<span id="cb322-36"><a href="model-comparison-in-cognitive-science.html#cb322-36" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb322-37"><a href="model-comparison-in-cognitive-science.html#cb322-37" tabindex="-1"></a><span class="st">  real biasM;                        // Population mean baseline bias</span></span>
<span id="cb322-38"><a href="model-comparison-in-cognitive-science.html#cb322-38" tabindex="-1"></a><span class="st">  real betaM;                        // Population mean memory sensitivity</span></span>
<span id="cb322-39"><a href="model-comparison-in-cognitive-science.html#cb322-39" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;          // Population SDs</span></span>
<span id="cb322-40"><a href="model-comparison-in-cognitive-science.html#cb322-40" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;           // Standardized individual parameters</span></span>
<span id="cb322-41"><a href="model-comparison-in-cognitive-science.html#cb322-41" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;       // Cholesky factor of correlation matrix</span></span>
<span id="cb322-42"><a href="model-comparison-in-cognitive-science.html#cb322-42" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb322-43"><a href="model-comparison-in-cognitive-science.html#cb322-43" tabindex="-1"></a></span>
<span id="cb322-44"><a href="model-comparison-in-cognitive-science.html#cb322-44" tabindex="-1"></a><span class="st">// Transformed parameters</span></span>
<span id="cb322-45"><a href="model-comparison-in-cognitive-science.html#cb322-45" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb322-46"><a href="model-comparison-in-cognitive-science.html#cb322-46" tabindex="-1"></a><span class="st">  // Memory states for training data</span></span>
<span id="cb322-47"><a href="model-comparison-in-cognitive-science.html#cb322-47" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb322-48"><a href="model-comparison-in-cognitive-science.html#cb322-48" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb322-49"><a href="model-comparison-in-cognitive-science.html#cb322-49" tabindex="-1"></a><span class="st">  // Memory states for test data</span></span>
<span id="cb322-50"><a href="model-comparison-in-cognitive-science.html#cb322-50" tabindex="-1"></a><span class="st">  array[trials, agents_test] real memory_test;</span></span>
<span id="cb322-51"><a href="model-comparison-in-cognitive-science.html#cb322-51" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb322-52"><a href="model-comparison-in-cognitive-science.html#cb322-52" tabindex="-1"></a><span class="st">  // Individual parameters</span></span>
<span id="cb322-53"><a href="model-comparison-in-cognitive-science.html#cb322-53" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb322-54"><a href="model-comparison-in-cognitive-science.html#cb322-54" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb322-55"><a href="model-comparison-in-cognitive-science.html#cb322-55" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb322-56"><a href="model-comparison-in-cognitive-science.html#cb322-56" tabindex="-1"></a><span class="st">  // Calculate memory states for training data</span></span>
<span id="cb322-57"><a href="model-comparison-in-cognitive-science.html#cb322-57" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb322-58"><a href="model-comparison-in-cognitive-science.html#cb322-58" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb322-59"><a href="model-comparison-in-cognitive-science.html#cb322-59" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb322-60"><a href="model-comparison-in-cognitive-science.html#cb322-60" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb322-61"><a href="model-comparison-in-cognitive-science.html#cb322-61" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb322-62"><a href="model-comparison-in-cognitive-science.html#cb322-62" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb322-63"><a href="model-comparison-in-cognitive-science.html#cb322-63" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + </span></span>
<span id="cb322-64"><a href="model-comparison-in-cognitive-science.html#cb322-64" tabindex="-1"></a><span class="st">                                  ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb322-65"><a href="model-comparison-in-cognitive-science.html#cb322-65" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb322-66"><a href="model-comparison-in-cognitive-science.html#cb322-66" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb322-67"><a href="model-comparison-in-cognitive-science.html#cb322-67" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb322-68"><a href="model-comparison-in-cognitive-science.html#cb322-68" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb322-69"><a href="model-comparison-in-cognitive-science.html#cb322-69" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb322-70"><a href="model-comparison-in-cognitive-science.html#cb322-70" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb322-71"><a href="model-comparison-in-cognitive-science.html#cb322-71" tabindex="-1"></a><span class="st">  // Calculate memory states for test data</span></span>
<span id="cb322-72"><a href="model-comparison-in-cognitive-science.html#cb322-72" tabindex="-1"></a><span class="st">  for (agent in 1:agents_test){</span></span>
<span id="cb322-73"><a href="model-comparison-in-cognitive-science.html#cb322-73" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb322-74"><a href="model-comparison-in-cognitive-science.html#cb322-74" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb322-75"><a href="model-comparison-in-cognitive-science.html#cb322-75" tabindex="-1"></a><span class="st">        memory_test[trial, agent] = 0.5;</span></span>
<span id="cb322-76"><a href="model-comparison-in-cognitive-science.html#cb322-76" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb322-77"><a href="model-comparison-in-cognitive-science.html#cb322-77" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb322-78"><a href="model-comparison-in-cognitive-science.html#cb322-78" tabindex="-1"></a><span class="st">        memory_test[trial + 1, agent] = memory_test[trial, agent] + </span></span>
<span id="cb322-79"><a href="model-comparison-in-cognitive-science.html#cb322-79" tabindex="-1"></a><span class="st">                                      ((other_test[trial, agent] - memory_test[trial, agent]) / trial);</span></span>
<span id="cb322-80"><a href="model-comparison-in-cognitive-science.html#cb322-80" tabindex="-1"></a><span class="st">        if (memory_test[trial + 1, agent] == 0){memory_test[trial + 1, agent] = 0.01;}</span></span>
<span id="cb322-81"><a href="model-comparison-in-cognitive-science.html#cb322-81" tabindex="-1"></a><span class="st">        if (memory_test[trial + 1, agent] == 1){memory_test[trial + 1, agent] = 0.99;}</span></span>
<span id="cb322-82"><a href="model-comparison-in-cognitive-science.html#cb322-82" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb322-83"><a href="model-comparison-in-cognitive-science.html#cb322-83" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb322-84"><a href="model-comparison-in-cognitive-science.html#cb322-84" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb322-85"><a href="model-comparison-in-cognitive-science.html#cb322-85" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb322-86"><a href="model-comparison-in-cognitive-science.html#cb322-86" tabindex="-1"></a></span>
<span id="cb322-87"><a href="model-comparison-in-cognitive-science.html#cb322-87" tabindex="-1"></a><span class="st">// Model definition - trained only on training data</span></span>
<span id="cb322-88"><a href="model-comparison-in-cognitive-science.html#cb322-88" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb322-89"><a href="model-comparison-in-cognitive-science.html#cb322-89" tabindex="-1"></a><span class="st">  // Population-level priors</span></span>
<span id="cb322-90"><a href="model-comparison-in-cognitive-science.html#cb322-90" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb322-91"><a href="model-comparison-in-cognitive-science.html#cb322-91" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3) - normal_lccdf(0 | 0, .3);</span></span>
<span id="cb322-92"><a href="model-comparison-in-cognitive-science.html#cb322-92" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb322-93"><a href="model-comparison-in-cognitive-science.html#cb322-93" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3) - normal_lccdf(0 | 0, .3);</span></span>
<span id="cb322-94"><a href="model-comparison-in-cognitive-science.html#cb322-94" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb322-95"><a href="model-comparison-in-cognitive-science.html#cb322-95" tabindex="-1"></a></span>
<span id="cb322-96"><a href="model-comparison-in-cognitive-science.html#cb322-96" tabindex="-1"></a><span class="st">  // Standardized individual parameters</span></span>
<span id="cb322-97"><a href="model-comparison-in-cognitive-science.html#cb322-97" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb322-98"><a href="model-comparison-in-cognitive-science.html#cb322-98" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb322-99"><a href="model-comparison-in-cognitive-science.html#cb322-99" tabindex="-1"></a><span class="st">  // Likelihood for training data only</span></span>
<span id="cb322-100"><a href="model-comparison-in-cognitive-science.html#cb322-100" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb322-101"><a href="model-comparison-in-cognitive-science.html#cb322-101" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb322-102"><a href="model-comparison-in-cognitive-science.html#cb322-102" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | </span></span>
<span id="cb322-103"><a href="model-comparison-in-cognitive-science.html#cb322-103" tabindex="-1"></a><span class="st">                biasM + IDs[agent, 1] + memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb322-104"><a href="model-comparison-in-cognitive-science.html#cb322-104" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb322-105"><a href="model-comparison-in-cognitive-science.html#cb322-105" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb322-106"><a href="model-comparison-in-cognitive-science.html#cb322-106" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb322-107"><a href="model-comparison-in-cognitive-science.html#cb322-107" tabindex="-1"></a></span>
<span id="cb322-108"><a href="model-comparison-in-cognitive-science.html#cb322-108" tabindex="-1"></a><span class="st">// Calculate log-likelihood for both training and test data</span></span>
<span id="cb322-109"><a href="model-comparison-in-cognitive-science.html#cb322-109" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb322-110"><a href="model-comparison-in-cognitive-science.html#cb322-110" tabindex="-1"></a><span class="st">   // Prior samples</span></span>
<span id="cb322-111"><a href="model-comparison-in-cognitive-science.html#cb322-111" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb322-112"><a href="model-comparison-in-cognitive-science.html#cb322-112" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb322-113"><a href="model-comparison-in-cognitive-science.html#cb322-113" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb322-114"><a href="model-comparison-in-cognitive-science.html#cb322-114" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb322-115"><a href="model-comparison-in-cognitive-science.html#cb322-115" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb322-116"><a href="model-comparison-in-cognitive-science.html#cb322-116" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb322-117"><a href="model-comparison-in-cognitive-science.html#cb322-117" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb322-118"><a href="model-comparison-in-cognitive-science.html#cb322-118" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb322-119"><a href="model-comparison-in-cognitive-science.html#cb322-119" tabindex="-1"></a><span class="st">   // Posterior predictive samples</span></span>
<span id="cb322-120"><a href="model-comparison-in-cognitive-science.html#cb322-120" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb322-121"><a href="model-comparison-in-cognitive-science.html#cb322-121" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb322-122"><a href="model-comparison-in-cognitive-science.html#cb322-122" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb322-123"><a href="model-comparison-in-cognitive-science.html#cb322-123" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb322-124"><a href="model-comparison-in-cognitive-science.html#cb322-124" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb322-125"><a href="model-comparison-in-cognitive-science.html#cb322-125" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb322-126"><a href="model-comparison-in-cognitive-science.html#cb322-126" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb322-127"><a href="model-comparison-in-cognitive-science.html#cb322-127" tabindex="-1"></a><span class="st">   // Log-likelihood for training data</span></span>
<span id="cb322-128"><a href="model-comparison-in-cognitive-science.html#cb322-128" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb322-129"><a href="model-comparison-in-cognitive-science.html#cb322-129" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb322-130"><a href="model-comparison-in-cognitive-science.html#cb322-130" tabindex="-1"></a><span class="st">   // Log-likelihood for test data - crucial for cross-validation</span></span>
<span id="cb322-131"><a href="model-comparison-in-cognitive-science.html#cb322-131" tabindex="-1"></a><span class="st">   array[trials, agents_test] real log_lik_test;</span></span>
<span id="cb322-132"><a href="model-comparison-in-cognitive-science.html#cb322-132" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb322-133"><a href="model-comparison-in-cognitive-science.html#cb322-133" tabindex="-1"></a><span class="st">   // Generate prior samples</span></span>
<span id="cb322-134"><a href="model-comparison-in-cognitive-science.html#cb322-134" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb322-135"><a href="model-comparison-in-cognitive-science.html#cb322-135" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb322-136"><a href="model-comparison-in-cognitive-science.html#cb322-136" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb322-137"><a href="model-comparison-in-cognitive-science.html#cb322-137" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb322-138"><a href="model-comparison-in-cognitive-science.html#cb322-138" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb322-139"><a href="model-comparison-in-cognitive-science.html#cb322-139" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb322-140"><a href="model-comparison-in-cognitive-science.html#cb322-140" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb322-141"><a href="model-comparison-in-cognitive-science.html#cb322-141" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb322-142"><a href="model-comparison-in-cognitive-science.html#cb322-142" tabindex="-1"></a><span class="st">   // Generate predictions for different memory conditions</span></span>
<span id="cb322-143"><a href="model-comparison-in-cognitive-science.html#cb322-143" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb322-144"><a href="model-comparison-in-cognitive-science.html#cb322-144" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb322-145"><a href="model-comparison-in-cognitive-science.html#cb322-145" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb322-146"><a href="model-comparison-in-cognitive-science.html#cb322-146" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb322-147"><a href="model-comparison-in-cognitive-science.html#cb322-147" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, </span></span>
<span id="cb322-148"><a href="model-comparison-in-cognitive-science.html#cb322-148" tabindex="-1"></a><span class="st">                           inv_logit(biasM + IDs[i,1] + 0 * (betaM + IDs[i,2])));</span></span>
<span id="cb322-149"><a href="model-comparison-in-cognitive-science.html#cb322-149" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, </span></span>
<span id="cb322-150"><a href="model-comparison-in-cognitive-science.html#cb322-150" tabindex="-1"></a><span class="st">                           inv_logit(biasM + IDs[i,1] + 1 * (betaM + IDs[i,2])));</span></span>
<span id="cb322-151"><a href="model-comparison-in-cognitive-science.html#cb322-151" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, </span></span>
<span id="cb322-152"><a href="model-comparison-in-cognitive-science.html#cb322-152" tabindex="-1"></a><span class="st">                           inv_logit(biasM + IDs[i,1] + 2 * (betaM + IDs[i,2])));</span></span>
<span id="cb322-153"><a href="model-comparison-in-cognitive-science.html#cb322-153" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb322-154"><a href="model-comparison-in-cognitive-science.html#cb322-154" tabindex="-1"></a><span class="st">      // Calculate log-likelihood for training data</span></span>
<span id="cb322-155"><a href="model-comparison-in-cognitive-science.html#cb322-155" tabindex="-1"></a><span class="st">      for (t in 1:trials){</span></span>
<span id="cb322-156"><a href="model-comparison-in-cognitive-science.html#cb322-156" tabindex="-1"></a><span class="st">        log_lik[t,i] = bernoulli_logit_lpmf(h[t, i] | </span></span>
<span id="cb322-157"><a href="model-comparison-in-cognitive-science.html#cb322-157" tabindex="-1"></a><span class="st">                      biasM + IDs[i, 1] + memory[t, i] * (betaM + IDs[i, 2]));</span></span>
<span id="cb322-158"><a href="model-comparison-in-cognitive-science.html#cb322-158" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb322-159"><a href="model-comparison-in-cognitive-science.html#cb322-159" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb322-160"><a href="model-comparison-in-cognitive-science.html#cb322-160" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb322-161"><a href="model-comparison-in-cognitive-science.html#cb322-161" tabindex="-1"></a><span class="st">   // Calculate log-likelihood for test data</span></span>
<span id="cb322-162"><a href="model-comparison-in-cognitive-science.html#cb322-162" tabindex="-1"></a><span class="st">   // Note: We use population-level estimates for prediction</span></span>
<span id="cb322-163"><a href="model-comparison-in-cognitive-science.html#cb322-163" tabindex="-1"></a><span class="st">   for (i in 1:agents_test){</span></span>
<span id="cb322-164"><a href="model-comparison-in-cognitive-science.html#cb322-164" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb322-165"><a href="model-comparison-in-cognitive-science.html#cb322-165" tabindex="-1"></a><span class="st">      log_lik_test[t,i] = bernoulli_logit_lpmf(h_test[t,i] | </span></span>
<span id="cb322-166"><a href="model-comparison-in-cognitive-science.html#cb322-166" tabindex="-1"></a><span class="st">                         biasM + memory_test[t, i] * betaM);</span></span>
<span id="cb322-167"><a href="model-comparison-in-cognitive-science.html#cb322-167" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb322-168"><a href="model-comparison-in-cognitive-science.html#cb322-168" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb322-169"><a href="model-comparison-in-cognitive-science.html#cb322-169" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb322-170"><a href="model-comparison-in-cognitive-science.html#cb322-170" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb322-171"><a href="model-comparison-in-cognitive-science.html#cb322-171" tabindex="-1"></a></span>
<span id="cb322-172"><a href="model-comparison-in-cognitive-science.html#cb322-172" tabindex="-1"></a><span class="co"># Write the model to a file</span></span>
<span id="cb322-173"><a href="model-comparison-in-cognitive-science.html#cb322-173" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb322-174"><a href="model-comparison-in-cognitive-science.html#cb322-174" tabindex="-1"></a>  stan_memory_cv_model,</span>
<span id="cb322-175"><a href="model-comparison-in-cognitive-science.html#cb322-175" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb322-176"><a href="model-comparison-in-cognitive-science.html#cb322-176" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W7_MultilevelMemory_cv.stan&quot;</span></span>
<span id="cb322-177"><a href="model-comparison-in-cognitive-science.html#cb322-177" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W7_MultilevelMemory_cv.stan&quot;</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="model-comparison-in-cognitive-science.html#cb324-1" tabindex="-1"></a><span class="co"># Compile the model</span></span>
<span id="cb324-2"><a href="model-comparison-in-cognitive-science.html#cb324-2" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W7_MultilevelMemory_cv.stan&quot;</span>)</span>
<span id="cb324-3"><a href="model-comparison-in-cognitive-science.html#cb324-3" tabindex="-1"></a>mod_memory_cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(</span>
<span id="cb324-4"><a href="model-comparison-in-cognitive-science.html#cb324-4" tabindex="-1"></a>  file, </span>
<span id="cb324-5"><a href="model-comparison-in-cognitive-science.html#cb324-5" tabindex="-1"></a>  <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb324-6"><a href="model-comparison-in-cognitive-science.html#cb324-6" tabindex="-1"></a>  <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>)</span>
<span id="cb324-7"><a href="model-comparison-in-cognitive-science.html#cb324-7" tabindex="-1"></a>)</span></code></pre></div>
<p>These CV-ready models extend our original models with additional structures to handle test data and compute separate log-likelihoods for training and test observations.</p>
<p>Now, letâ€™s demonstrate how to implement k-fold cross-validation using these models (N.b. we only fit both models to the memory data, I still need to implement the full comparison against biased data as well)</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="model-comparison-in-cognitive-science.html#cb325-1" tabindex="-1"></a><span class="co"># Define file path for saved CV results</span></span>
<span id="cb325-2"><a href="model-comparison-in-cognitive-science.html#cb325-2" tabindex="-1"></a>cv_results_file <span class="ot">&lt;-</span> <span class="st">&quot;simmodels/W7_CV_Biased&amp;Memory.RData&quot;</span></span>
<span id="cb325-3"><a href="model-comparison-in-cognitive-science.html#cb325-3" tabindex="-1"></a></span>
<span id="cb325-4"><a href="model-comparison-in-cognitive-science.html#cb325-4" tabindex="-1"></a><span class="co"># Check if we need to run the CV analysis</span></span>
<span id="cb325-5"><a href="model-comparison-in-cognitive-science.html#cb325-5" tabindex="-1"></a><span class="cf">if</span> (regenerate_simulations <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(cv_results_file)) {</span>
<span id="cb325-6"><a href="model-comparison-in-cognitive-science.html#cb325-6" tabindex="-1"></a>  <span class="co"># Load necessary packages for parallelization</span></span>
<span id="cb325-7"><a href="model-comparison-in-cognitive-science.html#cb325-7" tabindex="-1"></a>  pacman<span class="sc">::</span><span class="fu">p_load</span>(future, furrr)</span>
<span id="cb325-8"><a href="model-comparison-in-cognitive-science.html#cb325-8" tabindex="-1"></a>  </span>
<span id="cb325-9"><a href="model-comparison-in-cognitive-science.html#cb325-9" tabindex="-1"></a>  <span class="co"># Set up parallel processing (adjust workers based on your system)</span></span>
<span id="cb325-10"><a href="model-comparison-in-cognitive-science.html#cb325-10" tabindex="-1"></a>  <span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">8</span>)</span>
<span id="cb325-11"><a href="model-comparison-in-cognitive-science.html#cb325-11" tabindex="-1"></a>  </span>
<span id="cb325-12"><a href="model-comparison-in-cognitive-science.html#cb325-12" tabindex="-1"></a>  <span class="co"># Split the data into folds (10 folds, grouped by agent)</span></span>
<span id="cb325-13"><a href="model-comparison-in-cognitive-science.html#cb325-13" tabindex="-1"></a>  d<span class="sc">$</span>fold <span class="ot">&lt;-</span> <span class="fu">kfold_split_grouped</span>(<span class="at">K =</span> <span class="dv">10</span>, <span class="at">x =</span> d<span class="sc">$</span>agent)</span>
<span id="cb325-14"><a href="model-comparison-in-cognitive-science.html#cb325-14" tabindex="-1"></a>  unique_folds <span class="ot">&lt;-</span> <span class="fu">unique</span>(d<span class="sc">$</span>fold)</span>
<span id="cb325-15"><a href="model-comparison-in-cognitive-science.html#cb325-15" tabindex="-1"></a>  </span>
<span id="cb325-16"><a href="model-comparison-in-cognitive-science.html#cb325-16" tabindex="-1"></a>  <span class="co"># Initialize matrices to store log predictive densities</span></span>
<span id="cb325-17"><a href="model-comparison-in-cognitive-science.html#cb325-17" tabindex="-1"></a>  <span class="co"># We&#39;ll fill these after parallel processing</span></span>
<span id="cb325-18"><a href="model-comparison-in-cognitive-science.html#cb325-18" tabindex="-1"></a>  log_pd_biased_kfold <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1000</span>, <span class="at">ncol =</span> <span class="fu">nrow</span>(d))</span>
<span id="cb325-19"><a href="model-comparison-in-cognitive-science.html#cb325-19" tabindex="-1"></a>  log_pd_memory_kfold <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1000</span>, <span class="at">ncol =</span> <span class="fu">nrow</span>(d))</span>
<span id="cb325-20"><a href="model-comparison-in-cognitive-science.html#cb325-20" tabindex="-1"></a>  </span>
<span id="cb325-21"><a href="model-comparison-in-cognitive-science.html#cb325-21" tabindex="-1"></a>  <span class="co"># Define function to process a single fold</span></span>
<span id="cb325-22"><a href="model-comparison-in-cognitive-science.html#cb325-22" tabindex="-1"></a>  process_fold <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb325-23"><a href="model-comparison-in-cognitive-science.html#cb325-23" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Starting processing of fold&quot;</span>, k, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb325-24"><a href="model-comparison-in-cognitive-science.html#cb325-24" tabindex="-1"></a>    </span>
<span id="cb325-25"><a href="model-comparison-in-cognitive-science.html#cb325-25" tabindex="-1"></a>    <span class="co"># Create training set (all data except fold k)</span></span>
<span id="cb325-26"><a href="model-comparison-in-cognitive-science.html#cb325-26" tabindex="-1"></a>    d_train <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fold <span class="sc">!=</span> k)  </span>
<span id="cb325-27"><a href="model-comparison-in-cognitive-science.html#cb325-27" tabindex="-1"></a>    </span>
<span id="cb325-28"><a href="model-comparison-in-cognitive-science.html#cb325-28" tabindex="-1"></a>    <span class="co"># Prepare training data for Stan</span></span>
<span id="cb325-29"><a href="model-comparison-in-cognitive-science.html#cb325-29" tabindex="-1"></a>    d_memory1_train <span class="ot">&lt;-</span> d_train <span class="sc">%&gt;%</span> </span>
<span id="cb325-30"><a href="model-comparison-in-cognitive-science.html#cb325-30" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(agent, memoryChoice) <span class="sc">%&gt;%</span> </span>
<span id="cb325-31"><a href="model-comparison-in-cognitive-science.html#cb325-31" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb325-32"><a href="model-comparison-in-cognitive-science.html#cb325-32" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb325-33"><a href="model-comparison-in-cognitive-science.html#cb325-33" tabindex="-1"></a>    </span>
<span id="cb325-34"><a href="model-comparison-in-cognitive-science.html#cb325-34" tabindex="-1"></a>    d_memory2_train <span class="ot">&lt;-</span> d_train <span class="sc">%&gt;%</span> </span>
<span id="cb325-35"><a href="model-comparison-in-cognitive-science.html#cb325-35" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(agent, randomChoice) <span class="sc">%&gt;%</span> </span>
<span id="cb325-36"><a href="model-comparison-in-cognitive-science.html#cb325-36" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb325-37"><a href="model-comparison-in-cognitive-science.html#cb325-37" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb325-38"><a href="model-comparison-in-cognitive-science.html#cb325-38" tabindex="-1"></a>    </span>
<span id="cb325-39"><a href="model-comparison-in-cognitive-science.html#cb325-39" tabindex="-1"></a>    agents_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d_train<span class="sc">$</span>agent))</span>
<span id="cb325-40"><a href="model-comparison-in-cognitive-science.html#cb325-40" tabindex="-1"></a>    </span>
<span id="cb325-41"><a href="model-comparison-in-cognitive-science.html#cb325-41" tabindex="-1"></a>    <span class="co"># Create test set (only fold k)</span></span>
<span id="cb325-42"><a href="model-comparison-in-cognitive-science.html#cb325-42" tabindex="-1"></a>    d_test <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fold <span class="sc">==</span> k) </span>
<span id="cb325-43"><a href="model-comparison-in-cognitive-science.html#cb325-43" tabindex="-1"></a>    </span>
<span id="cb325-44"><a href="model-comparison-in-cognitive-science.html#cb325-44" tabindex="-1"></a>    d_memory1_test <span class="ot">&lt;-</span> d_test <span class="sc">%&gt;%</span> </span>
<span id="cb325-45"><a href="model-comparison-in-cognitive-science.html#cb325-45" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(agent, memoryChoice) <span class="sc">%&gt;%</span> </span>
<span id="cb325-46"><a href="model-comparison-in-cognitive-science.html#cb325-46" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb325-47"><a href="model-comparison-in-cognitive-science.html#cb325-47" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb325-48"><a href="model-comparison-in-cognitive-science.html#cb325-48" tabindex="-1"></a>    </span>
<span id="cb325-49"><a href="model-comparison-in-cognitive-science.html#cb325-49" tabindex="-1"></a>    d_memory2_test <span class="ot">&lt;-</span> d_test <span class="sc">%&gt;%</span> </span>
<span id="cb325-50"><a href="model-comparison-in-cognitive-science.html#cb325-50" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(agent, randomChoice) <span class="sc">%&gt;%</span> </span>
<span id="cb325-51"><a href="model-comparison-in-cognitive-science.html#cb325-51" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb325-52"><a href="model-comparison-in-cognitive-science.html#cb325-52" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb325-53"><a href="model-comparison-in-cognitive-science.html#cb325-53" tabindex="-1"></a>    </span>
<span id="cb325-54"><a href="model-comparison-in-cognitive-science.html#cb325-54" tabindex="-1"></a>    agents_test_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d_test<span class="sc">$</span>agent))</span>
<span id="cb325-55"><a href="model-comparison-in-cognitive-science.html#cb325-55" tabindex="-1"></a>    </span>
<span id="cb325-56"><a href="model-comparison-in-cognitive-science.html#cb325-56" tabindex="-1"></a>    <span class="co"># Prepare data for Stan model</span></span>
<span id="cb325-57"><a href="model-comparison-in-cognitive-science.html#cb325-57" tabindex="-1"></a>    data_memory <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb325-58"><a href="model-comparison-in-cognitive-science.html#cb325-58" tabindex="-1"></a>      <span class="at">trials =</span> trials,</span>
<span id="cb325-59"><a href="model-comparison-in-cognitive-science.html#cb325-59" tabindex="-1"></a>      <span class="at">agents =</span> agents_n,</span>
<span id="cb325-60"><a href="model-comparison-in-cognitive-science.html#cb325-60" tabindex="-1"></a>      <span class="at">agents_test =</span> agents_test_n,</span>
<span id="cb325-61"><a href="model-comparison-in-cognitive-science.html#cb325-61" tabindex="-1"></a>      <span class="at">h =</span> <span class="fu">as.matrix</span>(d_memory1_train[, <span class="dv">2</span><span class="sc">:</span>(agents_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb325-62"><a href="model-comparison-in-cognitive-science.html#cb325-62" tabindex="-1"></a>      <span class="at">other =</span> <span class="fu">as.matrix</span>(d_memory2_train[, <span class="dv">2</span><span class="sc">:</span>(agents_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb325-63"><a href="model-comparison-in-cognitive-science.html#cb325-63" tabindex="-1"></a>      <span class="at">h_test =</span> <span class="fu">as.matrix</span>(d_memory1_test[, <span class="dv">2</span><span class="sc">:</span>(agents_test_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb325-64"><a href="model-comparison-in-cognitive-science.html#cb325-64" tabindex="-1"></a>      <span class="at">other_test =</span> <span class="fu">as.matrix</span>(d_memory2_test[, <span class="dv">2</span><span class="sc">:</span>(agents_test_n <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="cb325-65"><a href="model-comparison-in-cognitive-science.html#cb325-65" tabindex="-1"></a>    )</span>
<span id="cb325-66"><a href="model-comparison-in-cognitive-science.html#cb325-66" tabindex="-1"></a>    </span>
<span id="cb325-67"><a href="model-comparison-in-cognitive-science.html#cb325-67" tabindex="-1"></a>    <span class="co"># Fit models on training data and evaluate on test data</span></span>
<span id="cb325-68"><a href="model-comparison-in-cognitive-science.html#cb325-68" tabindex="-1"></a>    <span class="co"># Note: removed threads_per_chain parameter</span></span>
<span id="cb325-69"><a href="model-comparison-in-cognitive-science.html#cb325-69" tabindex="-1"></a>    fit_biased <span class="ot">&lt;-</span> mod_biased_cv<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb325-70"><a href="model-comparison-in-cognitive-science.html#cb325-70" tabindex="-1"></a>      <span class="at">data =</span> data_memory,</span>
<span id="cb325-71"><a href="model-comparison-in-cognitive-science.html#cb325-71" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">123</span> <span class="sc">+</span> k,  <span class="co"># Unique seed per fold</span></span>
<span id="cb325-72"><a href="model-comparison-in-cognitive-science.html#cb325-72" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb325-73"><a href="model-comparison-in-cognitive-science.html#cb325-73" tabindex="-1"></a>      <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb325-74"><a href="model-comparison-in-cognitive-science.html#cb325-74" tabindex="-1"></a>      <span class="at">threads_per_chain =</span> <span class="dv">1</span>,</span>
<span id="cb325-75"><a href="model-comparison-in-cognitive-science.html#cb325-75" tabindex="-1"></a>      <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb325-76"><a href="model-comparison-in-cognitive-science.html#cb325-76" tabindex="-1"></a>      <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb325-77"><a href="model-comparison-in-cognitive-science.html#cb325-77" tabindex="-1"></a>      <span class="at">refresh =</span> <span class="dv">0</span>,  <span class="co"># Suppress progress output in parallel runs</span></span>
<span id="cb325-78"><a href="model-comparison-in-cognitive-science.html#cb325-78" tabindex="-1"></a>      <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb325-79"><a href="model-comparison-in-cognitive-science.html#cb325-79" tabindex="-1"></a>      <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb325-80"><a href="model-comparison-in-cognitive-science.html#cb325-80" tabindex="-1"></a>    )</span>
<span id="cb325-81"><a href="model-comparison-in-cognitive-science.html#cb325-81" tabindex="-1"></a>    </span>
<span id="cb325-82"><a href="model-comparison-in-cognitive-science.html#cb325-82" tabindex="-1"></a>    fit_memory <span class="ot">&lt;-</span> mod_memory_cv<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb325-83"><a href="model-comparison-in-cognitive-science.html#cb325-83" tabindex="-1"></a>      <span class="at">data =</span> data_memory,</span>
<span id="cb325-84"><a href="model-comparison-in-cognitive-science.html#cb325-84" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">456</span> <span class="sc">+</span> k,  <span class="co"># Unique seed per fold</span></span>
<span id="cb325-85"><a href="model-comparison-in-cognitive-science.html#cb325-85" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb325-86"><a href="model-comparison-in-cognitive-science.html#cb325-86" tabindex="-1"></a>      <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb325-87"><a href="model-comparison-in-cognitive-science.html#cb325-87" tabindex="-1"></a>      <span class="at">threads_per_chain =</span> <span class="dv">1</span>,</span>
<span id="cb325-88"><a href="model-comparison-in-cognitive-science.html#cb325-88" tabindex="-1"></a>      <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb325-89"><a href="model-comparison-in-cognitive-science.html#cb325-89" tabindex="-1"></a>      <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb325-90"><a href="model-comparison-in-cognitive-science.html#cb325-90" tabindex="-1"></a>      <span class="at">refresh =</span> <span class="dv">0</span>,  <span class="co"># Suppress progress output in parallel runs</span></span>
<span id="cb325-91"><a href="model-comparison-in-cognitive-science.html#cb325-91" tabindex="-1"></a>      <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb325-92"><a href="model-comparison-in-cognitive-science.html#cb325-92" tabindex="-1"></a>      <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb325-93"><a href="model-comparison-in-cognitive-science.html#cb325-93" tabindex="-1"></a>    )</span>
<span id="cb325-94"><a href="model-comparison-in-cognitive-science.html#cb325-94" tabindex="-1"></a>    </span>
<span id="cb325-95"><a href="model-comparison-in-cognitive-science.html#cb325-95" tabindex="-1"></a>    <span class="co"># Extract log likelihood for test data points</span></span>
<span id="cb325-96"><a href="model-comparison-in-cognitive-science.html#cb325-96" tabindex="-1"></a>    biased_log_lik <span class="ot">&lt;-</span> fit_biased<span class="sc">$</span><span class="fu">draws</span>(<span class="st">&quot;log_lik_test&quot;</span>, <span class="at">format =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb325-97"><a href="model-comparison-in-cognitive-science.html#cb325-97" tabindex="-1"></a>    memory_log_lik <span class="ot">&lt;-</span> fit_memory<span class="sc">$</span><span class="fu">draws</span>(<span class="st">&quot;log_lik_test&quot;</span>, <span class="at">format =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb325-98"><a href="model-comparison-in-cognitive-science.html#cb325-98" tabindex="-1"></a>    </span>
<span id="cb325-99"><a href="model-comparison-in-cognitive-science.html#cb325-99" tabindex="-1"></a>    <span class="co"># Create indices to keep track of which positions in the full matrix these values belong to</span></span>
<span id="cb325-100"><a href="model-comparison-in-cognitive-science.html#cb325-100" tabindex="-1"></a>    test_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(d<span class="sc">$</span>fold <span class="sc">==</span> k)</span>
<span id="cb325-101"><a href="model-comparison-in-cognitive-science.html#cb325-101" tabindex="-1"></a>    </span>
<span id="cb325-102"><a href="model-comparison-in-cognitive-science.html#cb325-102" tabindex="-1"></a>    <span class="co"># Return results for this fold</span></span>
<span id="cb325-103"><a href="model-comparison-in-cognitive-science.html#cb325-103" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb325-104"><a href="model-comparison-in-cognitive-science.html#cb325-104" tabindex="-1"></a>      <span class="at">fold =</span> k,</span>
<span id="cb325-105"><a href="model-comparison-in-cognitive-science.html#cb325-105" tabindex="-1"></a>      <span class="at">test_indices =</span> test_indices,</span>
<span id="cb325-106"><a href="model-comparison-in-cognitive-science.html#cb325-106" tabindex="-1"></a>      <span class="at">biased_log_lik =</span> biased_log_lik,</span>
<span id="cb325-107"><a href="model-comparison-in-cognitive-science.html#cb325-107" tabindex="-1"></a>      <span class="at">memory_log_lik =</span> memory_log_lik</span>
<span id="cb325-108"><a href="model-comparison-in-cognitive-science.html#cb325-108" tabindex="-1"></a>    )</span>
<span id="cb325-109"><a href="model-comparison-in-cognitive-science.html#cb325-109" tabindex="-1"></a>    </span>
<span id="cb325-110"><a href="model-comparison-in-cognitive-science.html#cb325-110" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Completed processing of fold&quot;</span>, k, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb325-111"><a href="model-comparison-in-cognitive-science.html#cb325-111" tabindex="-1"></a>    <span class="fu">return</span>(result)</span>
<span id="cb325-112"><a href="model-comparison-in-cognitive-science.html#cb325-112" tabindex="-1"></a>  }</span>
<span id="cb325-113"><a href="model-comparison-in-cognitive-science.html#cb325-113" tabindex="-1"></a>  </span>
<span id="cb325-114"><a href="model-comparison-in-cognitive-science.html#cb325-114" tabindex="-1"></a>  <span class="co"># Process all folds in parallel using furrr</span></span>
<span id="cb325-115"><a href="model-comparison-in-cognitive-science.html#cb325-115" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Starting parallel processing of all folds</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb325-116"><a href="model-comparison-in-cognitive-science.html#cb325-116" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">future_map</span>(unique_folds, process_fold, <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb325-117"><a href="model-comparison-in-cognitive-science.html#cb325-117" tabindex="-1"></a>  </span>
<span id="cb325-118"><a href="model-comparison-in-cognitive-science.html#cb325-118" tabindex="-1"></a>  <span class="co"># Now populate the full matrices with results from each fold</span></span>
<span id="cb325-119"><a href="model-comparison-in-cognitive-science.html#cb325-119" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(results)) {</span>
<span id="cb325-120"><a href="model-comparison-in-cognitive-science.html#cb325-120" tabindex="-1"></a>    fold_result <span class="ot">&lt;-</span> results[[i]]</span>
<span id="cb325-121"><a href="model-comparison-in-cognitive-science.html#cb325-121" tabindex="-1"></a>    test_indices <span class="ot">&lt;-</span> fold_result<span class="sc">$</span>test_indices</span>
<span id="cb325-122"><a href="model-comparison-in-cognitive-science.html#cb325-122" tabindex="-1"></a>    </span>
<span id="cb325-123"><a href="model-comparison-in-cognitive-science.html#cb325-123" tabindex="-1"></a>    <span class="co"># For each test index, populate the corresponding column in the full matrices</span></span>
<span id="cb325-124"><a href="model-comparison-in-cognitive-science.html#cb325-124" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(test_indices)) {</span>
<span id="cb325-125"><a href="model-comparison-in-cognitive-science.html#cb325-125" tabindex="-1"></a>      idx <span class="ot">&lt;-</span> test_indices[j]</span>
<span id="cb325-126"><a href="model-comparison-in-cognitive-science.html#cb325-126" tabindex="-1"></a>      log_pd_biased_kfold[, idx] <span class="ot">&lt;-</span> fold_result<span class="sc">$</span>biased_log_lik[, j]</span>
<span id="cb325-127"><a href="model-comparison-in-cognitive-science.html#cb325-127" tabindex="-1"></a>      log_pd_memory_kfold[, idx] <span class="ot">&lt;-</span> fold_result<span class="sc">$</span>memory_log_lik[, j]</span>
<span id="cb325-128"><a href="model-comparison-in-cognitive-science.html#cb325-128" tabindex="-1"></a>    }</span>
<span id="cb325-129"><a href="model-comparison-in-cognitive-science.html#cb325-129" tabindex="-1"></a>  }</span>
<span id="cb325-130"><a href="model-comparison-in-cognitive-science.html#cb325-130" tabindex="-1"></a>  </span>
<span id="cb325-131"><a href="model-comparison-in-cognitive-science.html#cb325-131" tabindex="-1"></a>  <span class="co"># Save results</span></span>
<span id="cb325-132"><a href="model-comparison-in-cognitive-science.html#cb325-132" tabindex="-1"></a>  <span class="fu">save</span>(log_pd_biased_kfold, log_pd_memory_kfold, <span class="at">file =</span> cv_results_file)</span>
<span id="cb325-133"><a href="model-comparison-in-cognitive-science.html#cb325-133" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Generated new cross-validation results and saved to&quot;</span>, cv_results_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb325-134"><a href="model-comparison-in-cognitive-science.html#cb325-134" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb325-135"><a href="model-comparison-in-cognitive-science.html#cb325-135" tabindex="-1"></a>  <span class="co"># Load existing results</span></span>
<span id="cb325-136"><a href="model-comparison-in-cognitive-science.html#cb325-136" tabindex="-1"></a>  <span class="fu">load</span>(cv_results_file)</span>
<span id="cb325-137"><a href="model-comparison-in-cognitive-science.html#cb325-137" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Loaded existing cross-validation results from&quot;</span>, cv_results_file, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb325-138"><a href="model-comparison-in-cognitive-science.html#cb325-138" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Starting parallel processing of all folds
## Starting processing of fold 7 
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 13.8 seconds.
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 1253.8 seconds.
## Completed processing of fold 7 
## Starting processing of fold 10 
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 12.8 seconds.
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 2854.1 seconds.
## Completed processing of fold 10</code></pre>
<pre><code>## Starting processing of fold 8 
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 13.1 seconds.
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 1117.8 seconds.
## Completed processing of fold 8</code></pre>
<pre><code>## Starting processing of fold 5 
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 14.4 seconds.
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 774.3 seconds.
## Completed processing of fold 5</code></pre>
<pre><code>## Starting processing of fold 4 
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 13.5 seconds.
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 987.3 seconds.
## Completed processing of fold 4</code></pre>
<pre><code>## Starting processing of fold 9 
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 13.8 seconds.
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 1352.2 seconds.
## Completed processing of fold 9 
## Starting processing of fold 2 
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 13.9 seconds.
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 724.8 seconds.
## Completed processing of fold 2</code></pre>
<pre><code>## Starting processing of fold 1 
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 13.5 seconds.
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 938.2 seconds.
## Completed processing of fold 1</code></pre>
<pre><code>## Starting processing of fold 6 
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 13.6 seconds.
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 756.7 seconds.
## Completed processing of fold 6 
## Starting processing of fold 3 
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 13.5 seconds.
## Running MCMC with 1 chain, with 1 thread(s) per chain...
## 
## Chain 1 finished in 3045.9 seconds.
## Completed processing of fold 3</code></pre>
<pre><code>## Generated new cross-validation results and saved to simmodels/W7_CV_Biased&amp;Memory.RData</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="model-comparison-in-cognitive-science.html#cb334-1" tabindex="-1"></a><span class="co"># Load cross-validation results</span></span>
<span id="cb334-2"><a href="model-comparison-in-cognitive-science.html#cb334-2" tabindex="-1"></a>cv_results_file <span class="ot">&lt;-</span> <span class="st">&quot;simmodels/W7_CV_Biased&amp;Memory.RData&quot;</span></span>
<span id="cb334-3"><a href="model-comparison-in-cognitive-science.html#cb334-3" tabindex="-1"></a><span class="fu">load</span>(cv_results_file)</span>
<span id="cb334-4"><a href="model-comparison-in-cognitive-science.html#cb334-4" tabindex="-1"></a></span>
<span id="cb334-5"><a href="model-comparison-in-cognitive-science.html#cb334-5" tabindex="-1"></a><span class="co"># Calculate ELPD values from cross-validation results</span></span>
<span id="cb334-6"><a href="model-comparison-in-cognitive-science.html#cb334-6" tabindex="-1"></a>elpd_biased_kfold <span class="ot">&lt;-</span> <span class="fu">elpd</span>(log_pd_biased_kfold)</span>
<span id="cb334-7"><a href="model-comparison-in-cognitive-science.html#cb334-7" tabindex="-1"></a>elpd_memory_kfold <span class="ot">&lt;-</span> <span class="fu">elpd</span>(log_pd_memory_kfold)</span>
<span id="cb334-8"><a href="model-comparison-in-cognitive-science.html#cb334-8" tabindex="-1"></a></span>
<span id="cb334-9"><a href="model-comparison-in-cognitive-science.html#cb334-9" tabindex="-1"></a><span class="co"># Extract ELPD values and standard errors</span></span>
<span id="cb334-10"><a href="model-comparison-in-cognitive-science.html#cb334-10" tabindex="-1"></a>biased_elpd_value <span class="ot">&lt;-</span> elpd_biased_kfold<span class="sc">$</span>estimates[<span class="st">&quot;elpd&quot;</span>, <span class="st">&quot;Estimate&quot;</span>]</span>
<span id="cb334-11"><a href="model-comparison-in-cognitive-science.html#cb334-11" tabindex="-1"></a>memory_elpd_value <span class="ot">&lt;-</span> elpd_memory_kfold<span class="sc">$</span>estimates[<span class="st">&quot;elpd&quot;</span>, <span class="st">&quot;Estimate&quot;</span>]</span>
<span id="cb334-12"><a href="model-comparison-in-cognitive-science.html#cb334-12" tabindex="-1"></a>biased_se <span class="ot">&lt;-</span> elpd_biased_kfold<span class="sc">$</span>estimates[<span class="st">&quot;elpd&quot;</span>, <span class="st">&quot;SE&quot;</span>]</span>
<span id="cb334-13"><a href="model-comparison-in-cognitive-science.html#cb334-13" tabindex="-1"></a>memory_se <span class="ot">&lt;-</span> elpd_memory_kfold<span class="sc">$</span>estimates[<span class="st">&quot;elpd&quot;</span>, <span class="st">&quot;SE&quot;</span>]</span>
<span id="cb334-14"><a href="model-comparison-in-cognitive-science.html#cb334-14" tabindex="-1"></a></span>
<span id="cb334-15"><a href="model-comparison-in-cognitive-science.html#cb334-15" tabindex="-1"></a><span class="co"># Print values for comparison</span></span>
<span id="cb334-16"><a href="model-comparison-in-cognitive-science.html#cb334-16" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;K-fold CV results:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## K-fold CV results:</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="model-comparison-in-cognitive-science.html#cb336-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Biased model ELPD:&quot;</span>, biased_elpd_value, <span class="st">&quot;Â±&quot;</span>, biased_se, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Biased model ELPD: -5543.23 Â± 78.8173</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="model-comparison-in-cognitive-science.html#cb338-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Memory model ELPD:&quot;</span>, memory_elpd_value, <span class="st">&quot;Â±&quot;</span>, memory_se, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Memory model ELPD: -4860.888 Â± 66.89472</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="model-comparison-in-cognitive-science.html#cb340-1" tabindex="-1"></a><span class="co"># Create a results table</span></span>
<span id="cb340-2"><a href="model-comparison-in-cognitive-science.html#cb340-2" tabindex="-1"></a>kfold_results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb340-3"><a href="model-comparison-in-cognitive-science.html#cb340-3" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">c</span>(<span class="st">&quot;Biased Agent Model&quot;</span>, <span class="st">&quot;Memory Agent Model&quot;</span>),</span>
<span id="cb340-4"><a href="model-comparison-in-cognitive-science.html#cb340-4" tabindex="-1"></a>  <span class="at">elpd =</span> <span class="fu">c</span>(biased_elpd_value, memory_elpd_value),</span>
<span id="cb340-5"><a href="model-comparison-in-cognitive-science.html#cb340-5" tabindex="-1"></a>  <span class="at">se =</span> <span class="fu">c</span>(biased_se, memory_se)</span>
<span id="cb340-6"><a href="model-comparison-in-cognitive-science.html#cb340-6" tabindex="-1"></a>)</span>
<span id="cb340-7"><a href="model-comparison-in-cognitive-science.html#cb340-7" tabindex="-1"></a></span>
<span id="cb340-8"><a href="model-comparison-in-cognitive-science.html#cb340-8" tabindex="-1"></a><span class="co"># Calculate model weights from ELPD values</span></span>
<span id="cb340-9"><a href="model-comparison-in-cognitive-science.html#cb340-9" tabindex="-1"></a>max_elpd <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">c</span>(biased_elpd_value, memory_elpd_value))</span>
<span id="cb340-10"><a href="model-comparison-in-cognitive-science.html#cb340-10" tabindex="-1"></a>relative_elpd <span class="ot">&lt;-</span> <span class="fu">c</span>(biased_elpd_value, memory_elpd_value) <span class="sc">-</span> max_elpd</span>
<span id="cb340-11"><a href="model-comparison-in-cognitive-science.html#cb340-11" tabindex="-1"></a>model_weights <span class="ot">&lt;-</span> <span class="fu">exp</span>(relative_elpd) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">exp</span>(relative_elpd))</span>
<span id="cb340-12"><a href="model-comparison-in-cognitive-science.html#cb340-12" tabindex="-1"></a></span>
<span id="cb340-13"><a href="model-comparison-in-cognitive-science.html#cb340-13" tabindex="-1"></a><span class="co"># Add weights to results</span></span>
<span id="cb340-14"><a href="model-comparison-in-cognitive-science.html#cb340-14" tabindex="-1"></a>kfold_results<span class="sc">$</span>weight <span class="ot">&lt;-</span> model_weights</span>
<span id="cb340-15"><a href="model-comparison-in-cognitive-science.html#cb340-15" tabindex="-1"></a></span>
<span id="cb340-16"><a href="model-comparison-in-cognitive-science.html#cb340-16" tabindex="-1"></a><span class="co"># Display the results table</span></span>
<span id="cb340-17"><a href="model-comparison-in-cognitive-science.html#cb340-17" tabindex="-1"></a>kfold_results</span></code></pre></div>
<pre><code>## # A tibble: 2 Ã— 4
##   model                elpd    se    weight
##   &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 Biased Agent Model -5543.  78.8 4.60e-297
## 2 Memory Agent Model -4861.  66.9 1   e+  0</code></pre>
</div>
<div id="comparing-loo-and-k-fold-results" class="section level3 hasAnchor" number="8.10.2">
<h3><span class="header-section-number">8.10.2</span> Comparing LOO and K-Fold Results<a href="model-comparison-in-cognitive-science.html#comparing-loo-and-k-fold-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="model-comparison-in-cognitive-science.html#cb342-1" tabindex="-1"></a><span class="co"># Create comparison table of PSIS-LOO vs K-fold CV</span></span>
<span id="cb342-2"><a href="model-comparison-in-cognitive-science.html#cb342-2" tabindex="-1"></a>loo_results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb342-3"><a href="model-comparison-in-cognitive-science.html#cb342-3" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">c</span>(<span class="st">&quot;Biased Agent Model&quot;</span>, <span class="st">&quot;Memory Agent Model&quot;</span>),</span>
<span id="cb342-4"><a href="model-comparison-in-cognitive-science.html#cb342-4" tabindex="-1"></a>  <span class="at">loo_elpd =</span> <span class="fu">c</span>(Loo_biased2biased<span class="sc">$</span>estimates[<span class="st">&quot;elpd_loo&quot;</span>, <span class="st">&quot;Estimate&quot;</span>],</span>
<span id="cb342-5"><a href="model-comparison-in-cognitive-science.html#cb342-5" tabindex="-1"></a>              Loo_memory2biased<span class="sc">$</span>estimates[<span class="st">&quot;elpd_loo&quot;</span>, <span class="st">&quot;Estimate&quot;</span>]),</span>
<span id="cb342-6"><a href="model-comparison-in-cognitive-science.html#cb342-6" tabindex="-1"></a>  <span class="at">loo_se =</span> <span class="fu">c</span>(Loo_biased2biased<span class="sc">$</span>estimates[<span class="st">&quot;elpd_loo&quot;</span>, <span class="st">&quot;SE&quot;</span>],</span>
<span id="cb342-7"><a href="model-comparison-in-cognitive-science.html#cb342-7" tabindex="-1"></a>            Loo_memory2biased<span class="sc">$</span>estimates[<span class="st">&quot;elpd_loo&quot;</span>, <span class="st">&quot;SE&quot;</span>]),</span>
<span id="cb342-8"><a href="model-comparison-in-cognitive-science.html#cb342-8" tabindex="-1"></a>  <span class="at">loo_weight =</span> <span class="fu">c</span>(weights_biased[<span class="dv">1</span>], weights_biased[<span class="dv">2</span>])</span>
<span id="cb342-9"><a href="model-comparison-in-cognitive-science.html#cb342-9" tabindex="-1"></a>)</span>
<span id="cb342-10"><a href="model-comparison-in-cognitive-science.html#cb342-10" tabindex="-1"></a></span>
<span id="cb342-11"><a href="model-comparison-in-cognitive-science.html#cb342-11" tabindex="-1"></a><span class="co"># Combine with k-fold results</span></span>
<span id="cb342-12"><a href="model-comparison-in-cognitive-science.html#cb342-12" tabindex="-1"></a>comparison_results <span class="ot">&lt;-</span> <span class="fu">left_join</span>(loo_results, kfold_results, <span class="at">by =</span> <span class="st">&quot;model&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb342-13"><a href="model-comparison-in-cognitive-science.html#cb342-13" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kfold_elpd =</span> elpd, <span class="at">kfold_se =</span> se, <span class="at">kfold_weight =</span> weight)</span>
<span id="cb342-14"><a href="model-comparison-in-cognitive-science.html#cb342-14" tabindex="-1"></a></span>
<span id="cb342-15"><a href="model-comparison-in-cognitive-science.html#cb342-15" tabindex="-1"></a><span class="co"># Display comparison</span></span>
<span id="cb342-16"><a href="model-comparison-in-cognitive-science.html#cb342-16" tabindex="-1"></a>comparison_results <span class="sc">%&gt;%</span></span>
<span id="cb342-17"><a href="model-comparison-in-cognitive-science.html#cb342-17" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb342-18"><a href="model-comparison-in-cognitive-science.html#cb342-18" tabindex="-1"></a>    <span class="at">loo_elpd =</span> <span class="fu">round</span>(loo_elpd, <span class="dv">1</span>),</span>
<span id="cb342-19"><a href="model-comparison-in-cognitive-science.html#cb342-19" tabindex="-1"></a>    <span class="at">loo_se =</span> <span class="fu">round</span>(loo_se, <span class="dv">2</span>),</span>
<span id="cb342-20"><a href="model-comparison-in-cognitive-science.html#cb342-20" tabindex="-1"></a>    <span class="at">loo_weight =</span> <span class="fu">round</span>(loo_weight, <span class="dv">3</span>),</span>
<span id="cb342-21"><a href="model-comparison-in-cognitive-science.html#cb342-21" tabindex="-1"></a>    <span class="at">kfold_elpd =</span> <span class="fu">round</span>(kfold_elpd, <span class="dv">1</span>),</span>
<span id="cb342-22"><a href="model-comparison-in-cognitive-science.html#cb342-22" tabindex="-1"></a>    <span class="at">kfold_se =</span> <span class="fu">round</span>(kfold_se, <span class="dv">2</span>),</span>
<span id="cb342-23"><a href="model-comparison-in-cognitive-science.html#cb342-23" tabindex="-1"></a>    <span class="at">kfold_weight =</span> <span class="fu">round</span>(kfold_weight, <span class="dv">3</span>)</span>
<span id="cb342-24"><a href="model-comparison-in-cognitive-science.html#cb342-24" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb342-25"><a href="model-comparison-in-cognitive-science.html#cb342-25" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb342-26"><a href="model-comparison-in-cognitive-science.html#cb342-26" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparison of PSIS-LOO and K-fold Cross-Validation Results&quot;</span>,</span>
<span id="cb342-27"><a href="model-comparison-in-cognitive-science.html#cb342-27" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Model&quot;</span>, <span class="st">&quot;LOO ELPD&quot;</span>, <span class="st">&quot;LOO SE&quot;</span>, <span class="st">&quot;LOO Weight&quot;</span>, </span>
<span id="cb342-28"><a href="model-comparison-in-cognitive-science.html#cb342-28" tabindex="-1"></a>                  <span class="st">&quot;K-fold ELPD&quot;</span>, <span class="st">&quot;K-fold SE&quot;</span>, <span class="st">&quot;K-fold Weight&quot;</span>)</span>
<span id="cb342-29"><a href="model-comparison-in-cognitive-science.html#cb342-29" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-37">Table 8.1: </span>Comparison of PSIS-LOO and K-fold Cross-Validation Results</caption>
<colgroup>
<col width="23%" />
<col width="10%" />
<col width="8%" />
<col width="13%" />
<col width="14%" />
<col width="12%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Model</th>
<th align="right">LOO ELPD</th>
<th align="right">LOO SE</th>
<th align="right">LOO Weight</th>
<th align="right">K-fold ELPD</th>
<th align="right">K-fold SE</th>
<th align="right">K-fold Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Biased Agent Model</td>
<td align="right">-6015.1</td>
<td align="right">58.82</td>
<td align="right">1</td>
<td align="right">-5543.2</td>
<td align="right">78.82</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Memory Agent Model</td>
<td align="right">-6019.2</td>
<td align="right">58.83</td>
<td align="right">0</td>
<td align="right">-4860.9</td>
<td align="right">66.89</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Funnily enough cross-validation indicates the wrong model.</p>
</div>
</div>
<div id="limitations-of-model-comparison-approaches" class="section level2 hasAnchor" number="8.11">
<h2><span class="header-section-number">8.11</span> Limitations of Model Comparison Approaches<a href="model-comparison-in-cognitive-science.html#limitations-of-model-comparison-approaches" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While cross-validation and ELPD provide powerful tools for model comparison, itâ€™s important to understand their limitations:</p>
<ol style="list-style-type: decimal">
<li><p>Training vs.Â Transfer Generalization
Cross-validation only assesses a modelâ€™s ability to generalize to new data from the same distribution (training generalization). It doesnâ€™t evaluate how well models transfer to different contexts or populations (transfer generalization).</p></li>
<li><p>Model Misspecification
All models are wrong, but some are useful. Cross-validation helps identify which wrong model is most useful for prediction, but doesnâ€™t guarantee weâ€™ve captured the true generating process.</p></li>
<li><p>Limited Data
With limited data, cross-validation estimates can have high variance, especially for complex models. K-fold CV with small k can help mitigate this issue.</p></li>
<li><p>Computational Cost
True cross-validation requires refitting models multiple times, which can be prohibitively expensive for complex Bayesian models. PSIS-LOO offers an efficient approximation but may not always be reliable.</p></li>
<li><p>Parameter vs.Â Predictive Focus
Model comparison based on predictive performance might select different models than if we were focused on accurate parameter estimation. The â€œbestâ€ model depends on your goals.</p></li>
</ol>
</div>
<div id="exercises" class="section level2 hasAnchor" number="8.12">
<h2><span class="header-section-number">8.12</span> Exercises<a href="model-comparison-in-cognitive-science.html#exercises" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Compare the models on different subsets of the data (e.g., early vs.Â late trials). Does the preferred model change depending on which portion of the data you use?</p></li>
<li><p>Experiment with different priors for the models. How sensitive are the model comparison results to prior choices?</p></li>
<li><p>Implement a different model (e.g., win-stay-lose-shift) and compare it to the biased and memory models. Which performs best?</p></li>
<li><p>Explore how the amount of data affects model comparison. How many trials do you need to reliably identify the true model?</p></li>
<li><p>Investigate the relationship between model complexity and predictive performance in this context. Are there systematic patterns in when simpler models are preferred?</p></li>
</ol>
<hr />
<div id="rant-on-internal-vs-external-validity" class="section level3 hasAnchor" number="8.12.1">
<h3><span class="header-section-number">8.12.1</span> Rant on internal vs external validity<a href="model-comparison-in-cognitive-science.html#rant-on-internal-vs-external-validity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>However, we need to think carefully about what we mean by â€œout of sample.â€ There are actually two distinct types of test sets we might consider: internal and external.
Internal test sets come from the same data collection effort as our training data - for example, we might randomly set aside 20% of our matching pennies games to test on. While this approach helps us detect overfitting to specific participants or trials, it cannot tell us how well our model generalizes to truly new contexts. Our test set participants were recruited from the same population, played the game under the same conditions, and were influenced by the same experimental setup as our training participants.
External test sets, in contrast, come from genuinely different contexts. For our matching pennies model, this might mean testing on games played:</p>
<ul>
<li>In different cultures or age groups</li>
<li>Under time pressure versus relaxed conditions</li>
<li>For real money versus just for fun</li>
<li>Against human opponents versus computer agents</li>
<li>In laboratory versus online settings</li>
</ul>
<p>The distinction matters because cognitive models often capture not just universal mental processes, but also specific strategies that people adopt in particular contexts. A model that perfectly predicts behavior in laboratory matching pennies games might fail entirely when applied to high-stakes poker games, even though both involve similar strategic thinking.
This raises deeper questions about what kind of generalization we want our models to achieve. Are we trying to build models that capture universal cognitive processes, or are we content with models that work well within specific contexts? The answer affects not just how we evaluate our models, but how we design them in the first place.
In practice, truly external test sets are rare in cognitive science - they require additional data collection under different conditions, which is often impractical. This means we must be humble about our claims of generalization. When we talk about a modelâ€™s predictive accuracy, we should be clear that weâ€™re usually measuring its ability to generalize within a specific experimental context, not its ability to capture human cognition in all its diversity.
This limitation of internal test sets is one reason why cognitive scientists often complement predictive accuracy metrics with other forms of model evaluation, such as testing theoretical predictions on new tasks or examining whether model parameters correlate sensibly with individual differences. These approaches help us build confidence that our models capture meaningful cognitive processes rather than just statistical patterns specific to our experimental setup.
***</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mixture-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/07-ModelComparison.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
