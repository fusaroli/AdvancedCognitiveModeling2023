<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Model Comparison in Cognitive Science | 07-MixtureModels</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2025" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Model Comparison in Cognitive Science | 07-MixtureModels" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2025" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Model Comparison in Cognitive Science | 07-MixtureModels" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2025" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2023-03-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="individual-differences-in-cognitive-strategies-multilevel-modeling.html"/>
<link rel="next" href="mixture-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-philosophy-and-approach"><i class="fa fa-check"></i><b>1.1</b> Course Philosophy and Approach</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#course-structure-and-learning-path"><i class="fa fa-check"></i><b>1.2</b> Course Structure and Learning Path</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#prerequisites-and-preparation"><i class="fa fa-check"></i><b>1.3</b> Prerequisites and Preparation</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#course-resources"><i class="fa fa-check"></i><b>1.4</b> Course Resources</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#about-these-notes"><i class="fa fa-check"></i><b>1.5</b> About These Notes</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="foundations.html"><a href="foundations.html"><i class="fa fa-check"></i><b>2</b> Foundations</a>
<ul>
<li class="chapter" data-level="2.1" data-path="foundations.html"><a href="foundations.html#from-pizza-to-cognitive-models-an-introduction"><i class="fa fa-check"></i><b>2.1</b> From Pizza to Cognitive Models: An Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="foundations.html"><a href="foundations.html#why-start-with-pizza"><i class="fa fa-check"></i><b>2.2</b> Why Start with Pizza?</a></li>
<li class="chapter" data-level="2.3" data-path="foundations.html"><a href="foundations.html#learning-objectives"><i class="fa fa-check"></i><b>2.3</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.4" data-path="foundations.html"><a href="foundations.html#part-1-exploring-the-pizza-stone-temperature-data"><i class="fa fa-check"></i><b>2.4</b> Part 1: Exploring the Pizza Stone Temperature Data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="foundations.html"><a href="foundations.html#initial-data-visualization"><i class="fa fa-check"></i><b>2.4.1</b> Initial Data Visualization</a></li>
<li class="chapter" data-level="2.4.2" data-path="foundations.html"><a href="foundations.html#key-observations"><i class="fa fa-check"></i><b>2.4.2</b> Key Observations</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="foundations.html"><a href="foundations.html#part-2-initial-statistical-modeling"><i class="fa fa-check"></i><b>2.5</b> Part 2: Initial Statistical Modeling</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="foundations.html"><a href="foundations.html#model-setup-and-priors"><i class="fa fa-check"></i><b>2.5.1</b> Model Setup and Priors</a></li>
<li class="chapter" data-level="2.5.2" data-path="foundations.html"><a href="foundations.html#linear-mixed-effects-model"><i class="fa fa-check"></i><b>2.5.2</b> Linear Mixed-Effects Model</a></li>
<li class="chapter" data-level="2.5.3" data-path="foundations.html"><a href="foundations.html#lognormal-mixed-effects-model"><i class="fa fa-check"></i><b>2.5.3</b> Lognormal Mixed-Effects Model</a></li>
<li class="chapter" data-level="2.5.4" data-path="foundations.html"><a href="foundations.html#model-comparison-and-visualization"><i class="fa fa-check"></i><b>2.5.4</b> Model Comparison and Visualization</a></li>
<li class="chapter" data-level="2.5.5" data-path="foundations.html"><a href="foundations.html#model-assessment"><i class="fa fa-check"></i><b>2.5.5</b> Model Assessment</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="foundations.html"><a href="foundations.html#part-3-understanding-the-physics-model"><i class="fa fa-check"></i><b>2.6</b> Part 3: Understanding the Physics Model</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="foundations.html"><a href="foundations.html#the-basic-temperature-evolution-equation"><i class="fa fa-check"></i><b>2.6.1</b> The Basic Temperature Evolution Equation</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="foundations.html"><a href="foundations.html#part-4-implementing-the-physics-based-model"><i class="fa fa-check"></i><b>2.7</b> Part 4: Implementing the Physics-Based Model</a></li>
<li class="chapter" data-level="2.8" data-path="foundations.html"><a href="foundations.html#part-5-model-analysis-and-practical-applications"><i class="fa fa-check"></i><b>2.8</b> Part 5: Model Analysis and Practical Applications</a></li>
<li class="chapter" data-level="2.9" data-path="foundations.html"><a href="foundations.html#conclusion-from-pizza-to-principles"><i class="fa fa-check"></i><b>2.9</b> Conclusion: From Pizza to Principles</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html"><i class="fa fa-check"></i><b>3</b> Building Models of Strategic Decision-Making</a>
<ul>
<li class="chapter" data-level="3.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#learning-goals"><i class="fa fa-check"></i><b>3.1</b> Learning goals</a></li>
<li class="chapter" data-level="3.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#introduction"><i class="fa fa-check"></i><b>3.2</b> Introduction</a></li>
<li class="chapter" data-level="3.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#the-matching-pennies-game"><i class="fa fa-check"></i><b>3.3</b> The Matching Pennies Game</a></li>
<li class="chapter" data-level="3.4" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#game-structure"><i class="fa fa-check"></i><b>3.4</b> Game Structure</a></li>
<li class="chapter" data-level="3.5" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#empirical-investigation"><i class="fa fa-check"></i><b>3.5</b> Empirical Investigation</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#data-collection-protocol"><i class="fa fa-check"></i><b>3.5.1</b> Data Collection Protocol</a></li>
<li class="chapter" data-level="3.5.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#initial-observations"><i class="fa fa-check"></i><b>3.5.2</b> Initial Observations</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#empirical-explorations"><i class="fa fa-check"></i><b>3.6</b> Empirical explorations</a></li>
<li class="chapter" data-level="3.7" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#notes-from-previous-years"><i class="fa fa-check"></i><b>3.7</b> Notes from previous years</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#from-observation-to-theory"><i class="fa fa-check"></i><b>3.7.1</b> From Observation to Theory</a></li>
<li class="chapter" data-level="3.7.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#core-modeling-considerations"><i class="fa fa-check"></i><b>3.7.2</b> Core Modeling Considerations</a></li>
<li class="chapter" data-level="3.7.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>3.7.3</b> The distinction between participant and researcher perspectives</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#building-formal-models"><i class="fa fa-check"></i><b>3.8</b> Building Formal Models</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#random-choice-model"><i class="fa fa-check"></i><b>3.8.1</b> Random Choice Model</a></li>
<li class="chapter" data-level="3.8.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#immediate-reaction-win-stay-lose-shift"><i class="fa fa-check"></i><b>3.8.2</b> Immediate reaction (Win-Stay-Lose-Shift)</a></li>
<li class="chapter" data-level="3.8.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>3.8.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="3.8.4" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>3.8.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="3.8.5" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#reinforcement-learning"><i class="fa fa-check"></i><b>3.8.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="3.8.6" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#k-tom"><i class="fa fa-check"></i><b>3.8.6</b> k-ToM</a></li>
<li class="chapter" data-level="3.8.7" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#other-possible-strategies"><i class="fa fa-check"></i><b>3.8.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#cognitive-constraints"><i class="fa fa-check"></i><b>3.9</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#memory"><i class="fa fa-check"></i><b>3.9.1</b> Memory</a></li>
<li class="chapter" data-level="3.9.2" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#perseveration"><i class="fa fa-check"></i><b>3.9.2</b> Perseveration</a></li>
<li class="chapter" data-level="3.9.3" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#errors"><i class="fa fa-check"></i><b>3.9.3</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#continuity-between-models"><i class="fa fa-check"></i><b>3.10</b> Continuity between models</a></li>
<li class="chapter" data-level="3.11" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#mixture-of-strategies"><i class="fa fa-check"></i><b>3.11</b> Mixture of strategies</a></li>
<li class="chapter" data-level="3.12" data-path="building-models-of-strategic-decision-making.html"><a href="building-models-of-strategic-decision-making.html#differences-from-more-traditional-general-linear-model-based-approaches"><i class="fa fa-check"></i><b>3.12</b> Differences from more traditional (general linear model-based) approaches</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html"><i class="fa fa-check"></i><b>4</b> From verbal descriptions to formal models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#learning-goals-1"><i class="fa fa-check"></i><b>4.1</b> Learning Goals</a></li>
<li class="chapter" data-level="4.2" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#the-value-of-formalization"><i class="fa fa-check"></i><b>4.2</b> The Value of Formalization</a></li>
<li class="chapter" data-level="4.3" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>4.3</b> Defining general conditions</a></li>
<li class="chapter" data-level="4.4" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>4.4</b> Implementing a random agent</a></li>
<li class="chapter" data-level="4.5" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>4.5</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="4.6" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>4.6</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>4.6.1</b> And we visualize it</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="from-verbal-descriptions-to-formal-models.html"><a href="from-verbal-descriptions-to-formal-models.html#conclusion"><i class="fa fa-check"></i><b>4.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html"><i class="fa fa-check"></i><b>5</b> From simulation to model fitting</a>
<ul>
<li class="chapter" data-level="5.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#learning-goals-2"><i class="fa fa-check"></i><b>5.1</b> Learning Goals</a></li>
<li class="chapter" data-level="5.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#the-challenge-of-model-fitting"><i class="fa fa-check"></i><b>5.2</b> The Challenge of Model Fitting</a></li>
<li class="chapter" data-level="5.3" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#simulating-data"><i class="fa fa-check"></i><b>5.3</b> Simulating data</a></li>
<li class="chapter" data-level="5.4" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#building-our-basic-model-in-stan"><i class="fa fa-check"></i><b>5.4</b> Building our basic model in Stan</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#data"><i class="fa fa-check"></i><b>5.4.1</b> Data</a></li>
<li class="chapter" data-level="5.4.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#model"><i class="fa fa-check"></i><b>5.4.2</b> Model</a></li>
<li class="chapter" data-level="5.4.3" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#compiling-and-fitting-the-model"><i class="fa fa-check"></i><b>5.4.3</b> Compiling and fitting the model</a></li>
<li class="chapter" data-level="5.4.4" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#summarizing-the-model"><i class="fa fa-check"></i><b>5.4.4</b> Summarizing the model</a></li>
<li class="chapter" data-level="5.4.5" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#assessing-model-quality"><i class="fa fa-check"></i><b>5.4.5</b> Assessing model quality</a></li>
<li class="chapter" data-level="5.4.6" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#summarizing-the-results"><i class="fa fa-check"></i><b>5.4.6</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#parameter-recovery"><i class="fa fa-check"></i><b>5.5</b> Parameter recovery</a></li>
<li class="chapter" data-level="5.6" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#the-memory-model-conditioning-theta"><i class="fa fa-check"></i><b>5.6</b> The memory model: conditioning theta</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#summarizing-the-results-1"><i class="fa fa-check"></i><b>5.6.1</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#memory-agent-with-internal-parameter"><i class="fa fa-check"></i><b>5.7</b> Memory agent with internal parameter</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#trying-out-a-more-complex-memory-model-with-a-rate-of-forgetting-that-exponentially-discounts-the-past"><i class="fa fa-check"></i><b>5.7.1</b> Trying out a more complex memory model, with a rate of forgetting that exponentially discounts the past</a></li>
<li class="chapter" data-level="5.7.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#connection-to-kalman-filters"><i class="fa fa-check"></i><b>5.7.2</b> Connection to Kalman Filters</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#relationship-to-rescorla-wagner"><i class="fa fa-check"></i><b>5.8</b> Relationship to Rescorla-Wagner</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#connection-to-hierarchical-gaussian-filter-hgf"><i class="fa fa-check"></i><b>5.8.1</b> Connection to Hierarchical Gaussian Filter (HGF)</a></li>
<li class="chapter" data-level="5.8.2" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#implications-for-model-development"><i class="fa fa-check"></i><b>5.8.2</b> Implications for Model Development</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#bayesian-memory-agent"><i class="fa fa-check"></i><b>5.9</b> Bayesian memory agent</a></li>
<li class="chapter" data-level="5.10" data-path="from-simulation-to-model-fitting.html"><a href="from-simulation-to-model-fitting.html#conclusion-from-simple-models-to-complex-cognitive-processes"><i class="fa fa-check"></i><b>5.10</b> Conclusion: From Simple Models to Complex Cognitive Processes</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html"><i class="fa fa-check"></i><b>6</b> Model Quality Assessment</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#introduction-1"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#generating-and-plotting-additional-variables"><i class="fa fa-check"></i><b>6.2</b> Generating and plotting additional variables</a></li>
<li class="chapter" data-level="6.3" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#assessing-priors"><i class="fa fa-check"></i><b>6.3</b> Assessing priors</a></li>
<li class="chapter" data-level="6.4" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#prior-predictive-checks"><i class="fa fa-check"></i><b>6.4</b> Prior Predictive Checks</a></li>
<li class="chapter" data-level="6.5" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>6.5</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="6.6" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>6.6</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="6.7" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#the-memory-model"><i class="fa fa-check"></i><b>6.7</b> The memory model</a></li>
<li class="chapter" data-level="6.8" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#prior-sensitivity-check-for-the-memory-model"><i class="fa fa-check"></i><b>6.8</b> Prior sensitivity check for the memory model</a></li>
<li class="chapter" data-level="6.9" data-path="model-quality-assessment.html"><a href="model-quality-assessment.html#conclusion-1"><i class="fa fa-check"></i><b>6.9</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><i class="fa fa-check"></i><b>7</b> Individual Differences in Cognitive Strategies (Multilevel modeling)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#learning-objectives-1"><i class="fa fa-check"></i><b>7.2</b> Learning Objectives</a></li>
<li class="chapter" data-level="7.3" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#the-value-of-multilevel-modeling"><i class="fa fa-check"></i><b>7.3</b> The Value of Multilevel Modeling</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#complete-pooling"><i class="fa fa-check"></i><b>7.3.1</b> Complete Pooling</a></li>
<li class="chapter" data-level="7.3.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#no-pooling"><i class="fa fa-check"></i><b>7.3.2</b> No Pooling</a></li>
<li class="chapter" data-level="7.3.3" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#partial-pooling-multilevel-modeling"><i class="fa fa-check"></i><b>7.3.3</b> Partial Pooling (Multilevel Modeling)</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#graphical-model-visualization"><i class="fa fa-check"></i><b>7.4</b> Graphical Model Visualization</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#biased-agent-model"><i class="fa fa-check"></i><b>7.4.1</b> Biased Agent Model</a></li>
<li class="chapter" data-level="7.4.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#memory-agent-model"><i class="fa fa-check"></i><b>7.4.2</b> Memory Agent Model</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#generating-the-agents"><i class="fa fa-check"></i><b>7.5</b> Generating the agents</a></li>
<li class="chapter" data-level="7.6" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#plotting-the-agents"><i class="fa fa-check"></i><b>7.6</b> Plotting the agents</a></li>
<li class="chapter" data-level="7.7" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#coding-the-multilevel-agents"><i class="fa fa-check"></i><b>7.7</b> Coding the multilevel agents</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-random"><i class="fa fa-check"></i><b>7.7.1</b> Multilevel random</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-random-agent-model"><i class="fa fa-check"></i><b>7.8</b> Multilevel Random Agent Model</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-random-agents"><i class="fa fa-check"></i><b>7.8.1</b> Assessing multilevel random agents</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#lets-look-at-individuals"><i class="fa fa-check"></i><b>7.9</b> Let’s look at individuals</a></li>
<li class="chapter" data-level="7.10" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#prior-sensitivity-checks"><i class="fa fa-check"></i><b>7.10</b> Prior sensitivity checks</a></li>
<li class="chapter" data-level="7.11" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#parameter-recovery-1"><i class="fa fa-check"></i><b>7.11</b> Parameter recovery</a></li>
<li class="chapter" data-level="7.12" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-memory-agent-model"><i class="fa fa-check"></i><b>7.12</b> Multilevel Memory Agent Model</a>
<ul>
<li class="chapter" data-level="7.12.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-memory"><i class="fa fa-check"></i><b>7.12.1</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="7.12.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#diagnosing-the-issue-with-bias-and-beta"><i class="fa fa-check"></i><b>7.12.2</b> Diagnosing the issue with bias and beta</a></li>
<li class="chapter" data-level="7.12.3" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization"><i class="fa fa-check"></i><b>7.12.3</b> Multilevel memory with non centered parameterization</a></li>
<li class="chapter" data-level="7.12.4" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-memory-1"><i class="fa fa-check"></i><b>7.12.4</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="7.12.5" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters"><i class="fa fa-check"></i><b>7.12.5</b> Multilevel memory with correlation between parameters</a></li>
<li class="chapter" data-level="7.12.6" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#assessing-multilevel-memory-2"><i class="fa fa-check"></i><b>7.12.6</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="7.12.7" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#section"><i class="fa fa-check"></i><b>7.12.7</b> </a></li>
</ul></li>
<li class="chapter" data-level="7.13" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#comparing-pooling-approaches"><i class="fa fa-check"></i><b>7.13</b> Comparing Pooling Approaches</a></li>
<li class="chapter" data-level="7.14" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#comparing-pooling-approaches-1"><i class="fa fa-check"></i><b>7.14</b> Comparing Pooling Approaches</a></li>
<li class="chapter" data-level="7.15" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#multilevel-modeling-cheatsheet"><i class="fa fa-check"></i><b>7.15</b> Multilevel Modeling Cheatsheet</a>
<ul>
<li class="chapter" data-level="7.15.1" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#when-to-use-each-pooling-approach"><i class="fa fa-check"></i><b>7.15.1</b> When to Use Each Pooling Approach:</a></li>
<li class="chapter" data-level="7.15.2" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#parameter-recovery-rules-of-thumb"><i class="fa fa-check"></i><b>7.15.2</b> Parameter Recovery Rules of Thumb:</a></li>
</ul></li>
<li class="chapter" data-level="7.16" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#conclusion-the-power-and-challenges-of-multilevel-modeling"><i class="fa fa-check"></i><b>7.16</b> Conclusion: The Power and Challenges of Multilevel Modeling</a></li>
<li class="chapter" data-level="7.17" data-path="individual-differences-in-cognitive-strategies-multilevel-modeling.html"><a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html#exercises-just-some-ideas"><i class="fa fa-check"></i><b>7.17</b> Exercises (just some ideas)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html"><i class="fa fa-check"></i><b>8</b> Model Comparison in Cognitive Science</a>
<ul>
<li class="chapter" data-level="8.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#learning-objectives-2"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#why-compare-models"><i class="fa fa-check"></i><b>8.2</b> Why Compare Models?</a></li>
<li class="chapter" data-level="8.3" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#define-parameters"><i class="fa fa-check"></i><b>8.3</b> Define parameters</a></li>
<li class="chapter" data-level="8.4" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#define-biased-and-memory-agents"><i class="fa fa-check"></i><b>8.4</b> Define biased and memory agents</a></li>
<li class="chapter" data-level="8.5" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#generating-the-agents-1"><i class="fa fa-check"></i><b>8.5</b> Generating the agents</a></li>
<li class="chapter" data-level="8.6" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#prep-the-data"><i class="fa fa-check"></i><b>8.6</b> Prep the data</a></li>
<li class="chapter" data-level="8.7" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#log-posterior-likelihood"><i class="fa fa-check"></i><b>8.7</b> Log posterior likelihood</a></li>
<li class="chapter" data-level="8.8" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#create-the-models-multilevel-biased-agents"><i class="fa fa-check"></i><b>8.8</b> Create the models: multilevel biased agents</a></li>
<li class="chapter" data-level="8.9" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#multilevel-memory-model"><i class="fa fa-check"></i><b>8.9</b> Multilevel memory model</a></li>
<li class="chapter" data-level="8.10" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#fitting-the-models-to-the-data"><i class="fa fa-check"></i><b>8.10</b> Fitting the models to the data</a></li>
<li class="chapter" data-level="8.11" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#calculating-the-expected-log-predictive-density-of-a-model"><i class="fa fa-check"></i><b>8.11</b> Calculating the expected log predictive density of a model</a>
<ul>
<li class="chapter" data-level="8.11.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#rant-on-internal-vs-external-validity"><i class="fa fa-check"></i><b>8.11.1</b> Rant on internal vs external validity</a></li>
</ul></li>
<li class="chapter" data-level="8.12" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#implementing-cross-validation"><i class="fa fa-check"></i><b>8.12</b> Implementing Cross-Validation</a>
<ul>
<li class="chapter" data-level="8.12.1" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#create-cross-validation-ready-stan-model-for-biased-agents"><i class="fa fa-check"></i><b>8.12.1</b> Create cross-validation ready stan model for biased agents</a></li>
<li class="chapter" data-level="8.12.2" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#create-cross-validation-ready-stan-model-for-memory-agents"><i class="fa fa-check"></i><b>8.12.2</b> Create cross-validation ready stan model for memory agents</a></li>
</ul></li>
<li class="chapter" data-level="8.13" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#calculating-elpd-and-comparing"><i class="fa fa-check"></i><b>8.13</b> Calculating elpd and comparing</a></li>
<li class="chapter" data-level="8.14" data-path="model-comparison-in-cognitive-science.html"><a href="model-comparison-in-cognitive-science.html#limitations-of-model-comparison-techniques"><i class="fa fa-check"></i><b>8.14</b> Limitations of model comparison techniques</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>9</b> Mixture models</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="mixture-models.html"><a href="mixture-models.html#load-the-dataset"><i class="fa fa-check"></i><b>9.0.1</b> Load the dataset</a></li>
<li class="chapter" data-level="9.1" data-path="mixture-models.html"><a href="mixture-models.html#stan-model-mixing-biased-and-noise"><i class="fa fa-check"></i><b>9.1</b> Stan model mixing biased and noise</a></li>
<li class="chapter" data-level="9.2" data-path="mixture-models.html"><a href="mixture-models.html#fitting-and-assessing-the-model"><i class="fa fa-check"></i><b>9.2</b> Fitting and assessing the model</a></li>
<li class="chapter" data-level="9.3" data-path="mixture-models.html"><a href="mixture-models.html#basic-evaluation"><i class="fa fa-check"></i><b>9.3</b> Basic evaluation</a></li>
<li class="chapter" data-level="9.4" data-path="mixture-models.html"><a href="mixture-models.html#multilevel-mixture-model"><i class="fa fa-check"></i><b>9.4</b> Multilevel mixture model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">07-MixtureModels</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-comparison-in-cognitive-science" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Model Comparison in Cognitive Science<a href="model-comparison-in-cognitive-science.html#model-comparison-in-cognitive-science" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Understanding human cognition often involves choosing between competing theoretical explanations. When faced with behavioral data - whether from matching pennies games, learning tasks, or decision-making scenarios - we can implement different theories of the underlying cognitive processes, or switch on and off specific cognitive components. Model comparison is the set of procedure that allows allows us to determine which cognitive model best explains the observed patterns. But remember, model comparison is not a fail-safe procedure to determine which model embodies the truth, as always we need to be careful, tentative and open about the probabilistic and fallible nature of our inference.</p>
<div id="learning-objectives-2" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Learning Objectives<a href="model-comparison-in-cognitive-science.html#learning-objectives-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After completing this chapter, you will be able to:</p>
<ul>
<li>Implement cross-validation techniques for comparing cognitive models using Stan</li>
<li>Calculate and interpret expected log predictive density (ELPD) scores</li>
<li>Assess model predictions through posterior and prior predictive checks</li>
<li>Understand the strengths and limitations of different model comparison approaches</li>
<li>Apply these techniques to compare competing cognitive models using real data</li>
</ul>
</div>
<div id="why-compare-models" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Why Compare Models?<a href="model-comparison-in-cognitive-science.html#why-compare-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Model comparison serves multiple purposes in cognitive science. Some examples:</p>
<ol style="list-style-type: decimal">
<li><p>Theory Testing: Different models often represent competing theoretical accounts of cognitive processes. Comparing their fit to data helps evaluate these theories.</p></li>
<li><p>Parsimony: When multiple models can explain the data, one of the reason to prefer more complex models is if they are justified by better predictive performance.</p></li>
<li><p>Generalization: By assessing how well different models predict new data, we can evaluate their ability to capture general patterns rather than just fitting to specific samples.</p></li>
<li><p>Individual Differences: Model comparison can reveal whether different individuals or groups are better described by different cognitive strategies.</p></li>
</ol>
<p>This chapter demonstrates these principles using our matching pennies models as concrete examples. We’ll compare simple random choice models against more sophisticated memory-based approaches, showing how to rigorously evaluate which better explains observed behavior.</p>
<p>Imagine having several models of what might be going on and want to know which is the best explanation of the data. E.g. Are people more likely to use a memory strategy, or a win stay lose shift strategy? Or are we justified in assuming that people react differently to losses than to wins (e.g. by being more likely to shift when losing, than to stay when winning)? Or would we be justified in assuming that capuchin monkeys and cognitive science students use the same model?</p>
<p>Model comparison defines a broad range of practices aimed at identifying among a set of models the best model for a given data set. What “best” means is, however, a non-trivial question. Ideally, “best” would mean the model describing the mechanism that actually generated the data. However, as we will see that is a tricky proposition and we analysts tend to rely on proxies. There are many of such proxies in the literature. For instance, Nicenboim et al (2023) suggests employing either Bayes Factors or cross-validation (<a href="https://vasishth.github.io/bayescogsci/book/ch-comparison.html" class="uri">https://vasishth.github.io/bayescogsci/book/ch-comparison.html</a>). In this course, we rely on cross-validation based predictive performance (this chapter) and mixture models (next chapter).</p>
<p>In other words, this chapter will assess models in terms of their (estimated) ability to predict new (test) data. Remember that predictive performance is a very useful tool, but not a magical solution. It allows us to combat overfitting to the training sample (your model snuggling to your data so much that it fits both signal and noise), but it has key limitations, which we will discuss at the end of the chapter.</p>
<p>To learn how to make model comparison, in this chapter, we rely on our usual simulation based approach to ensure that the method is doing what we want. We simulate the behavior of biased agents playing against the memory agents. This provides us with data generated according to two different mechanisms: biased agents and memory agents. We can fit both models separately on each of the two sets of agents, so we can compare the relative performance of the two models: can we identify the true model generating the data (in a setup where truth is known)? This is what is usually called “model recovery” and complements nicely “parameter recovery”. In model recovery we assess whether we can identify the correct model, in parameter recovery we assess whether - once we know the correct model - we can identify the correct parameter values.</p>
<p>Let’s get going.</p>
</div>
<div id="define-parameters" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Define parameters<a href="model-comparison-in-cognitive-science.html#define-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="model-comparison-in-cognitive-science.html#cb236-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,</span>
<span id="cb236-2"><a href="model-comparison-in-cognitive-science.html#cb236-2" tabindex="-1"></a>               here,</span>
<span id="cb236-3"><a href="model-comparison-in-cognitive-science.html#cb236-3" tabindex="-1"></a>               posterior,</span>
<span id="cb236-4"><a href="model-comparison-in-cognitive-science.html#cb236-4" tabindex="-1"></a>               cmdstanr,</span>
<span id="cb236-5"><a href="model-comparison-in-cognitive-science.html#cb236-5" tabindex="-1"></a>               brms, </span>
<span id="cb236-6"><a href="model-comparison-in-cognitive-science.html#cb236-6" tabindex="-1"></a>               tidybayes, </span>
<span id="cb236-7"><a href="model-comparison-in-cognitive-science.html#cb236-7" tabindex="-1"></a>               loo, job)</span>
<span id="cb236-8"><a href="model-comparison-in-cognitive-science.html#cb236-8" tabindex="-1"></a></span>
<span id="cb236-9"><a href="model-comparison-in-cognitive-science.html#cb236-9" tabindex="-1"></a><span class="co"># Shared parameters</span></span>
<span id="cb236-10"><a href="model-comparison-in-cognitive-science.html#cb236-10" tabindex="-1"></a>agents <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb236-11"><a href="model-comparison-in-cognitive-science.html#cb236-11" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb236-12"><a href="model-comparison-in-cognitive-science.html#cb236-12" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb236-13"><a href="model-comparison-in-cognitive-science.html#cb236-13" tabindex="-1"></a></span>
<span id="cb236-14"><a href="model-comparison-in-cognitive-science.html#cb236-14" tabindex="-1"></a><span class="co"># Biased agents parameters</span></span>
<span id="cb236-15"><a href="model-comparison-in-cognitive-science.html#cb236-15" tabindex="-1"></a>rateM <span class="ot">&lt;-</span> <span class="fl">1.386</span> <span class="co"># roughly 0.8 once inv_logit scaled</span></span>
<span id="cb236-16"><a href="model-comparison-in-cognitive-science.html#cb236-16" tabindex="-1"></a>rateSD <span class="ot">&lt;-</span> <span class="fl">0.65</span> <span class="co"># roughly giving a sd of 0.1 in prob scale</span></span>
<span id="cb236-17"><a href="model-comparison-in-cognitive-science.html#cb236-17" tabindex="-1"></a></span>
<span id="cb236-18"><a href="model-comparison-in-cognitive-science.html#cb236-18" tabindex="-1"></a><span class="co"># Memory agents parameters</span></span>
<span id="cb236-19"><a href="model-comparison-in-cognitive-science.html#cb236-19" tabindex="-1"></a>biasM <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb236-20"><a href="model-comparison-in-cognitive-science.html#cb236-20" tabindex="-1"></a>biasSD <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb236-21"><a href="model-comparison-in-cognitive-science.html#cb236-21" tabindex="-1"></a>betaM <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb236-22"><a href="model-comparison-in-cognitive-science.html#cb236-22" tabindex="-1"></a>betaSD <span class="ot">&lt;-</span> <span class="fl">0.3</span></span></code></pre></div>
</div>
<div id="define-biased-and-memory-agents" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Define biased and memory agents<a href="model-comparison-in-cognitive-science.html#define-biased-and-memory-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="model-comparison-in-cognitive-science.html#cb237-1" tabindex="-1"></a><span class="co"># Functions of the agents</span></span>
<span id="cb237-2"><a href="model-comparison-in-cognitive-science.html#cb237-2" tabindex="-1"></a>RandomAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(rate, noise) {</span>
<span id="cb237-3"><a href="model-comparison-in-cognitive-science.html#cb237-3" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">inv_logit_scaled</span>(rate))</span>
<span id="cb237-4"><a href="model-comparison-in-cognitive-science.html#cb237-4" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb237-5"><a href="model-comparison-in-cognitive-science.html#cb237-5" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb237-6"><a href="model-comparison-in-cognitive-science.html#cb237-6" tabindex="-1"></a>  }</span>
<span id="cb237-7"><a href="model-comparison-in-cognitive-science.html#cb237-7" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb237-8"><a href="model-comparison-in-cognitive-science.html#cb237-8" tabindex="-1"></a>}</span>
<span id="cb237-9"><a href="model-comparison-in-cognitive-science.html#cb237-9" tabindex="-1"></a></span>
<span id="cb237-10"><a href="model-comparison-in-cognitive-science.html#cb237-10" tabindex="-1"></a>MemoryAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(bias, beta, otherRate, noise) {</span>
<span id="cb237-11"><a href="model-comparison-in-cognitive-science.html#cb237-11" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">inv_logit_scaled</span>(bias <span class="sc">+</span> beta <span class="sc">*</span> <span class="fu">logit_scaled</span>(otherRate))</span>
<span id="cb237-12"><a href="model-comparison-in-cognitive-science.html#cb237-12" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, rate)</span>
<span id="cb237-13"><a href="model-comparison-in-cognitive-science.html#cb237-13" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb237-14"><a href="model-comparison-in-cognitive-science.html#cb237-14" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb237-15"><a href="model-comparison-in-cognitive-science.html#cb237-15" tabindex="-1"></a>  }</span>
<span id="cb237-16"><a href="model-comparison-in-cognitive-science.html#cb237-16" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb237-17"><a href="model-comparison-in-cognitive-science.html#cb237-17" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="generating-the-agents-1" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Generating the agents<a href="model-comparison-in-cognitive-science.html#generating-the-agents-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: PARALLELIZE]</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="model-comparison-in-cognitive-science.html#cb238-1" tabindex="-1"></a><span class="co"># Looping through all the agents to generate the data.</span></span>
<span id="cb238-2"><a href="model-comparison-in-cognitive-science.html#cb238-2" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb238-3"><a href="model-comparison-in-cognitive-science.html#cb238-3" tabindex="-1"></a></span>
<span id="cb238-4"><a href="model-comparison-in-cognitive-science.html#cb238-4" tabindex="-1"></a><span class="cf">for</span> (agent <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>agents) {</span>
<span id="cb238-5"><a href="model-comparison-in-cognitive-science.html#cb238-5" tabindex="-1"></a>  </span>
<span id="cb238-6"><a href="model-comparison-in-cognitive-science.html#cb238-6" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, rateM, rateSD)</span>
<span id="cb238-7"><a href="model-comparison-in-cognitive-science.html#cb238-7" tabindex="-1"></a>  bias <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, biasM, biasSD)</span>
<span id="cb238-8"><a href="model-comparison-in-cognitive-science.html#cb238-8" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, betaM, betaSD)</span>
<span id="cb238-9"><a href="model-comparison-in-cognitive-science.html#cb238-9" tabindex="-1"></a>  </span>
<span id="cb238-10"><a href="model-comparison-in-cognitive-science.html#cb238-10" tabindex="-1"></a>  randomChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb238-11"><a href="model-comparison-in-cognitive-science.html#cb238-11" tabindex="-1"></a>  memoryChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb238-12"><a href="model-comparison-in-cognitive-science.html#cb238-12" tabindex="-1"></a>  memoryRate <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb238-13"><a href="model-comparison-in-cognitive-science.html#cb238-13" tabindex="-1"></a>  </span>
<span id="cb238-14"><a href="model-comparison-in-cognitive-science.html#cb238-14" tabindex="-1"></a>  <span class="cf">for</span> (trial <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>trials) {</span>
<span id="cb238-15"><a href="model-comparison-in-cognitive-science.html#cb238-15" tabindex="-1"></a>    </span>
<span id="cb238-16"><a href="model-comparison-in-cognitive-science.html#cb238-16" tabindex="-1"></a>    randomChoice[trial] <span class="ot">&lt;-</span> <span class="fu">RandomAgentNoise_f</span>(rate, noise)</span>
<span id="cb238-17"><a href="model-comparison-in-cognitive-science.html#cb238-17" tabindex="-1"></a>    <span class="cf">if</span> (trial <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb238-18"><a href="model-comparison-in-cognitive-science.html#cb238-18" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)</span>
<span id="cb238-19"><a href="model-comparison-in-cognitive-science.html#cb238-19" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb238-20"><a href="model-comparison-in-cognitive-science.html#cb238-20" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">MemoryAgentNoise_f</span>(bias, beta, <span class="fu">mean</span>(randomChoice[<span class="dv">1</span><span class="sc">:</span>trial], <span class="at">na.rm =</span> T), noise)</span>
<span id="cb238-21"><a href="model-comparison-in-cognitive-science.html#cb238-21" tabindex="-1"></a>    }</span>
<span id="cb238-22"><a href="model-comparison-in-cognitive-science.html#cb238-22" tabindex="-1"></a>  }</span>
<span id="cb238-23"><a href="model-comparison-in-cognitive-science.html#cb238-23" tabindex="-1"></a>  </span>
<span id="cb238-24"><a href="model-comparison-in-cognitive-science.html#cb238-24" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(agent, <span class="at">trial =</span> <span class="fu">seq</span>(trials), randomChoice, <span class="at">randomRate =</span> rate, memoryChoice, memoryRate, noise, rateM, rateSD, bias, beta, biasM, biasSD, betaM, betaSD)</span>
<span id="cb238-25"><a href="model-comparison-in-cognitive-science.html#cb238-25" tabindex="-1"></a>  </span>
<span id="cb238-26"><a href="model-comparison-in-cognitive-science.html#cb238-26" tabindex="-1"></a>  <span class="cf">if</span> (agent <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb238-27"><a href="model-comparison-in-cognitive-science.html#cb238-27" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d, temp)</span>
<span id="cb238-28"><a href="model-comparison-in-cognitive-science.html#cb238-28" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb238-29"><a href="model-comparison-in-cognitive-science.html#cb238-29" tabindex="-1"></a>    d <span class="ot">&lt;-</span> temp</span>
<span id="cb238-30"><a href="model-comparison-in-cognitive-science.html#cb238-30" tabindex="-1"></a>  }</span>
<span id="cb238-31"><a href="model-comparison-in-cognitive-science.html#cb238-31" tabindex="-1"></a>  </span>
<span id="cb238-32"><a href="model-comparison-in-cognitive-science.html#cb238-32" tabindex="-1"></a>}</span>
<span id="cb238-33"><a href="model-comparison-in-cognitive-science.html#cb238-33" tabindex="-1"></a></span>
<span id="cb238-34"><a href="model-comparison-in-cognitive-science.html#cb238-34" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(agent) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb238-35"><a href="model-comparison-in-cognitive-science.html#cb238-35" tabindex="-1"></a>  <span class="at">randomRate =</span> <span class="fu">cumsum</span>(randomChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(randomChoice),</span>
<span id="cb238-36"><a href="model-comparison-in-cognitive-science.html#cb238-36" tabindex="-1"></a>  <span class="at">memoryRate =</span> <span class="fu">cumsum</span>(memoryChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(memoryChoice)</span>
<span id="cb238-37"><a href="model-comparison-in-cognitive-science.html#cb238-37" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="prep-the-data" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> Prep the data<a href="model-comparison-in-cognitive-science.html#prep-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="model-comparison-in-cognitive-science.html#cb239-1" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb239-2"><a href="model-comparison-in-cognitive-science.html#cb239-2" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb239-3"><a href="model-comparison-in-cognitive-science.html#cb239-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb239-4"><a href="model-comparison-in-cognitive-science.html#cb239-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb239-5"><a href="model-comparison-in-cognitive-science.html#cb239-5" tabindex="-1"></a></span>
<span id="cb239-6"><a href="model-comparison-in-cognitive-science.html#cb239-6" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb239-7"><a href="model-comparison-in-cognitive-science.html#cb239-7" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb239-8"><a href="model-comparison-in-cognitive-science.html#cb239-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb239-9"><a href="model-comparison-in-cognitive-science.html#cb239-9" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb239-10"><a href="model-comparison-in-cognitive-science.html#cb239-10" tabindex="-1"></a></span>
<span id="cb239-11"><a href="model-comparison-in-cognitive-science.html#cb239-11" tabindex="-1"></a><span class="do">## Create the data</span></span>
<span id="cb239-12"><a href="model-comparison-in-cognitive-science.html#cb239-12" tabindex="-1"></a>data_biased <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb239-13"><a href="model-comparison-in-cognitive-science.html#cb239-13" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb239-14"><a href="model-comparison-in-cognitive-science.html#cb239-14" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb239-15"><a href="model-comparison-in-cognitive-science.html#cb239-15" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb239-16"><a href="model-comparison-in-cognitive-science.html#cb239-16" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb239-17"><a href="model-comparison-in-cognitive-science.html#cb239-17" tabindex="-1"></a>)</span>
<span id="cb239-18"><a href="model-comparison-in-cognitive-science.html#cb239-18" tabindex="-1"></a></span>
<span id="cb239-19"><a href="model-comparison-in-cognitive-science.html#cb239-19" tabindex="-1"></a>data_memory <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb239-20"><a href="model-comparison-in-cognitive-science.html#cb239-20" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb239-21"><a href="model-comparison-in-cognitive-science.html#cb239-21" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb239-22"><a href="model-comparison-in-cognitive-science.html#cb239-22" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb239-23"><a href="model-comparison-in-cognitive-science.html#cb239-23" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb239-24"><a href="model-comparison-in-cognitive-science.html#cb239-24" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="log-posterior-likelihood" class="section level2 hasAnchor" number="8.7">
<h2><span class="header-section-number">8.7</span> Log posterior likelihood<a href="model-comparison-in-cognitive-science.html#log-posterior-likelihood" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While the previous sections did not present any new materials (and therefore weren’t much commented), as we create our Stan models to fit to the data, we need to (re)introduce the notion of log-likelihood, or even better, log posterior likelihood.</p>
<p>Given certain values for our parameters (let’s say a bias of 0 and beta for memory of 1) and for our variables (let’s say the vector of memory values estimated by the agent on a trial by trial basis), the model will predict a certain distribution of outcomes, that is, a certain distribution of choices (n times right, m times left hand). Comparing this to the actual data, we can identify how likely the model is to produce it. In other words, the probability that the model will actually generate the data we observed out of all its possible outcomes. Remember that we are doing Bayesian statistics, so this probability needs to be combined with the probability of the parameter values given the priors on those parameters. This would give us a <em>posterior likelihood</em> of the model’s parameter values given the data. The last step is that we need to work on a log scale. Working on a log scale is very useful because it avoids low probabilities (close to 0) being rounded down to exactly 0. [MISSING A LINK TO A LENGTHIER EXPLANATION]. By log-transforming the posterior likelihood, we now have the <em>log-posterior likelihood</em>.</p>
<p>Now, remember that our agent’s memory varies on a trial by trial level. In other words, for each data point, for each agent we can calculate separate values of log-posterior likelihood for each of the possible values of the parameters. That is, we can have a distribution of log-posterior likelihood for each data point.</p>
<p>Luckily for us telling Stan to calculate and such distributions is extremely easy: we just need to add to the generated quantities block the same log probability density/mass statement that we use in the model block, but here we specify it should be saved (replacing target += with an actual variable to be filled).</p>
<p>N.B. Some of you might be wandering: if Stan is already using the log-posterior probability in the sampling process, why do we need to tell it to calculate and save it? Fair enough point. But Stan does not save by default (to avoid clogging your computer with endless data) and we need the log posterior likelihood saved as “log_lik” in order to be able to use more automated functions later on.</p>
</div>
<div id="create-the-models-multilevel-biased-agents" class="section level2 hasAnchor" number="8.8">
<h2><span class="header-section-number">8.8</span> Create the models: multilevel biased agents<a href="model-comparison-in-cognitive-science.html#create-the-models-multilevel-biased-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Remember to add the log_lik part in the generated quantities block!</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="model-comparison-in-cognitive-science.html#cb240-1" tabindex="-1"></a>stan_biased_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb240-2"><a href="model-comparison-in-cognitive-science.html#cb240-2" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb240-3"><a href="model-comparison-in-cognitive-science.html#cb240-3" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { // normal distribution with a lower bound</span></span>
<span id="cb240-4"><a href="model-comparison-in-cognitive-science.html#cb240-4" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb240-5"><a href="model-comparison-in-cognitive-science.html#cb240-5" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb240-6"><a href="model-comparison-in-cognitive-science.html#cb240-6" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb240-7"><a href="model-comparison-in-cognitive-science.html#cb240-7" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb240-8"><a href="model-comparison-in-cognitive-science.html#cb240-8" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb240-9"><a href="model-comparison-in-cognitive-science.html#cb240-9" tabindex="-1"></a></span>
<span id="cb240-10"><a href="model-comparison-in-cognitive-science.html#cb240-10" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of hands</span></span>
<span id="cb240-11"><a href="model-comparison-in-cognitive-science.html#cb240-11" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb240-12"><a href="model-comparison-in-cognitive-science.html#cb240-12" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb240-13"><a href="model-comparison-in-cognitive-science.html#cb240-13" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb240-14"><a href="model-comparison-in-cognitive-science.html#cb240-14" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb240-15"><a href="model-comparison-in-cognitive-science.html#cb240-15" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb240-16"><a href="model-comparison-in-cognitive-science.html#cb240-16" tabindex="-1"></a></span>
<span id="cb240-17"><a href="model-comparison-in-cognitive-science.html#cb240-17" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb240-18"><a href="model-comparison-in-cognitive-science.html#cb240-18" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb240-19"><a href="model-comparison-in-cognitive-science.html#cb240-19" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb240-20"><a href="model-comparison-in-cognitive-science.html#cb240-20" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;</span></span>
<span id="cb240-21"><a href="model-comparison-in-cognitive-science.html#cb240-21" tabindex="-1"></a><span class="st">  array[agents] real theta;</span></span>
<span id="cb240-22"><a href="model-comparison-in-cognitive-science.html#cb240-22" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb240-23"><a href="model-comparison-in-cognitive-science.html#cb240-23" tabindex="-1"></a></span>
<span id="cb240-24"><a href="model-comparison-in-cognitive-science.html#cb240-24" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb240-25"><a href="model-comparison-in-cognitive-science.html#cb240-25" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb240-26"><a href="model-comparison-in-cognitive-science.html#cb240-26" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb240-27"><a href="model-comparison-in-cognitive-science.html#cb240-27" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3)  -</span></span>
<span id="cb240-28"><a href="model-comparison-in-cognitive-science.html#cb240-28" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb240-29"><a href="model-comparison-in-cognitive-science.html#cb240-29" tabindex="-1"></a></span>
<span id="cb240-30"><a href="model-comparison-in-cognitive-science.html#cb240-30" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb240-31"><a href="model-comparison-in-cognitive-science.html#cb240-31" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb240-32"><a href="model-comparison-in-cognitive-science.html#cb240-32" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb240-33"><a href="model-comparison-in-cognitive-science.html#cb240-33" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb240-34"><a href="model-comparison-in-cognitive-science.html#cb240-34" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb240-35"><a href="model-comparison-in-cognitive-science.html#cb240-35" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb240-36"><a href="model-comparison-in-cognitive-science.html#cb240-36" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb240-37"><a href="model-comparison-in-cognitive-science.html#cb240-37" tabindex="-1"></a></span>
<span id="cb240-38"><a href="model-comparison-in-cognitive-science.html#cb240-38" tabindex="-1"></a></span>
<span id="cb240-39"><a href="model-comparison-in-cognitive-science.html#cb240-39" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb240-40"><a href="model-comparison-in-cognitive-science.html#cb240-40" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb240-41"><a href="model-comparison-in-cognitive-science.html#cb240-41" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb240-42"><a href="model-comparison-in-cognitive-science.html#cb240-42" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb240-43"><a href="model-comparison-in-cognitive-science.html#cb240-43" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb240-44"><a href="model-comparison-in-cognitive-science.html#cb240-44" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb240-45"><a href="model-comparison-in-cognitive-science.html#cb240-45" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb240-46"><a href="model-comparison-in-cognitive-science.html#cb240-46" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb240-47"><a href="model-comparison-in-cognitive-science.html#cb240-47" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb240-48"><a href="model-comparison-in-cognitive-science.html#cb240-48" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb240-49"><a href="model-comparison-in-cognitive-science.html#cb240-49" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb240-50"><a href="model-comparison-in-cognitive-science.html#cb240-50" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb240-51"><a href="model-comparison-in-cognitive-science.html#cb240-51" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb240-52"><a href="model-comparison-in-cognitive-science.html#cb240-52" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb240-53"><a href="model-comparison-in-cognitive-science.html#cb240-53" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb240-54"><a href="model-comparison-in-cognitive-science.html#cb240-54" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb240-55"><a href="model-comparison-in-cognitive-science.html#cb240-55" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb240-56"><a href="model-comparison-in-cognitive-science.html#cb240-56" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb240-57"><a href="model-comparison-in-cognitive-science.html#cb240-57" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb240-58"><a href="model-comparison-in-cognitive-science.html#cb240-58" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb240-59"><a href="model-comparison-in-cognitive-science.html#cb240-59" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb240-60"><a href="model-comparison-in-cognitive-science.html#cb240-60" tabindex="-1"></a><span class="st">      log_lik[t,i] = bernoulli_logit_lpmf(h[t,i] | theta[i]);</span></span>
<span id="cb240-61"><a href="model-comparison-in-cognitive-science.html#cb240-61" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb240-62"><a href="model-comparison-in-cognitive-science.html#cb240-62" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb240-63"><a href="model-comparison-in-cognitive-science.html#cb240-63" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb240-64"><a href="model-comparison-in-cognitive-science.html#cb240-64" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb240-65"><a href="model-comparison-in-cognitive-science.html#cb240-65" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb240-66"><a href="model-comparison-in-cognitive-science.html#cb240-66" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb240-67"><a href="model-comparison-in-cognitive-science.html#cb240-67" tabindex="-1"></a>  stan_biased_model,</span>
<span id="cb240-68"><a href="model-comparison-in-cognitive-science.html#cb240-68" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb240-69"><a href="model-comparison-in-cognitive-science.html#cb240-69" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelBias.stan&quot;</span>)</span>
<span id="cb240-70"><a href="model-comparison-in-cognitive-science.html#cb240-70" tabindex="-1"></a></span>
<span id="cb240-71"><a href="model-comparison-in-cognitive-science.html#cb240-71" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelBias.stan&quot;</span>)</span>
<span id="cb240-72"><a href="model-comparison-in-cognitive-science.html#cb240-72" tabindex="-1"></a>mod_biased <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb240-73"><a href="model-comparison-in-cognitive-science.html#cb240-73" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb240-74"><a href="model-comparison-in-cognitive-science.html#cb240-74" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
</div>
<div id="multilevel-memory-model" class="section level2 hasAnchor" number="8.9">
<h2><span class="header-section-number">8.9</span> Multilevel memory model<a href="model-comparison-in-cognitive-science.html#multilevel-memory-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="model-comparison-in-cognitive-science.html#cb241-1" tabindex="-1"></a>stan_memory_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb241-2"><a href="model-comparison-in-cognitive-science.html#cb241-2" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb241-3"><a href="model-comparison-in-cognitive-science.html#cb241-3" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb241-4"><a href="model-comparison-in-cognitive-science.html#cb241-4" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb241-5"><a href="model-comparison-in-cognitive-science.html#cb241-5" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb241-6"><a href="model-comparison-in-cognitive-science.html#cb241-6" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb241-7"><a href="model-comparison-in-cognitive-science.html#cb241-7" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb241-8"><a href="model-comparison-in-cognitive-science.html#cb241-8" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb241-9"><a href="model-comparison-in-cognitive-science.html#cb241-9" tabindex="-1"></a></span>
<span id="cb241-10"><a href="model-comparison-in-cognitive-science.html#cb241-10" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb241-11"><a href="model-comparison-in-cognitive-science.html#cb241-11" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb241-12"><a href="model-comparison-in-cognitive-science.html#cb241-12" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb241-13"><a href="model-comparison-in-cognitive-science.html#cb241-13" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb241-14"><a href="model-comparison-in-cognitive-science.html#cb241-14" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb241-15"><a href="model-comparison-in-cognitive-science.html#cb241-15" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb241-16"><a href="model-comparison-in-cognitive-science.html#cb241-16" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb241-17"><a href="model-comparison-in-cognitive-science.html#cb241-17" tabindex="-1"></a></span>
<span id="cb241-18"><a href="model-comparison-in-cognitive-science.html#cb241-18" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb241-19"><a href="model-comparison-in-cognitive-science.html#cb241-19" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb241-20"><a href="model-comparison-in-cognitive-science.html#cb241-20" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb241-21"><a href="model-comparison-in-cognitive-science.html#cb241-21" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb241-22"><a href="model-comparison-in-cognitive-science.html#cb241-22" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb241-23"><a href="model-comparison-in-cognitive-science.html#cb241-23" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb241-24"><a href="model-comparison-in-cognitive-science.html#cb241-24" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb241-25"><a href="model-comparison-in-cognitive-science.html#cb241-25" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb241-26"><a href="model-comparison-in-cognitive-science.html#cb241-26" tabindex="-1"></a></span>
<span id="cb241-27"><a href="model-comparison-in-cognitive-science.html#cb241-27" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb241-28"><a href="model-comparison-in-cognitive-science.html#cb241-28" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb241-29"><a href="model-comparison-in-cognitive-science.html#cb241-29" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb241-30"><a href="model-comparison-in-cognitive-science.html#cb241-30" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb241-31"><a href="model-comparison-in-cognitive-science.html#cb241-31" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb241-32"><a href="model-comparison-in-cognitive-science.html#cb241-32" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb241-33"><a href="model-comparison-in-cognitive-science.html#cb241-33" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb241-34"><a href="model-comparison-in-cognitive-science.html#cb241-34" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb241-35"><a href="model-comparison-in-cognitive-science.html#cb241-35" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb241-36"><a href="model-comparison-in-cognitive-science.html#cb241-36" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb241-37"><a href="model-comparison-in-cognitive-science.html#cb241-37" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb241-38"><a href="model-comparison-in-cognitive-science.html#cb241-38" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb241-39"><a href="model-comparison-in-cognitive-science.html#cb241-39" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb241-40"><a href="model-comparison-in-cognitive-science.html#cb241-40" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb241-41"><a href="model-comparison-in-cognitive-science.html#cb241-41" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb241-42"><a href="model-comparison-in-cognitive-science.html#cb241-42" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb241-43"><a href="model-comparison-in-cognitive-science.html#cb241-43" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb241-44"><a href="model-comparison-in-cognitive-science.html#cb241-44" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb241-45"><a href="model-comparison-in-cognitive-science.html#cb241-45" tabindex="-1"></a></span>
<span id="cb241-46"><a href="model-comparison-in-cognitive-science.html#cb241-46" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb241-47"><a href="model-comparison-in-cognitive-science.html#cb241-47" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb241-48"><a href="model-comparison-in-cognitive-science.html#cb241-48" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb241-49"><a href="model-comparison-in-cognitive-science.html#cb241-49" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb241-50"><a href="model-comparison-in-cognitive-science.html#cb241-50" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb241-51"><a href="model-comparison-in-cognitive-science.html#cb241-51" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb241-52"><a href="model-comparison-in-cognitive-science.html#cb241-52" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb241-53"><a href="model-comparison-in-cognitive-science.html#cb241-53" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb241-54"><a href="model-comparison-in-cognitive-science.html#cb241-54" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb241-55"><a href="model-comparison-in-cognitive-science.html#cb241-55" tabindex="-1"></a></span>
<span id="cb241-56"><a href="model-comparison-in-cognitive-science.html#cb241-56" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb241-57"><a href="model-comparison-in-cognitive-science.html#cb241-57" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb241-58"><a href="model-comparison-in-cognitive-science.html#cb241-58" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb241-59"><a href="model-comparison-in-cognitive-science.html#cb241-59" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | biasM + IDs[agent, 1] +  memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb241-60"><a href="model-comparison-in-cognitive-science.html#cb241-60" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb241-61"><a href="model-comparison-in-cognitive-science.html#cb241-61" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb241-62"><a href="model-comparison-in-cognitive-science.html#cb241-62" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb241-63"><a href="model-comparison-in-cognitive-science.html#cb241-63" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb241-64"><a href="model-comparison-in-cognitive-science.html#cb241-64" tabindex="-1"></a></span>
<span id="cb241-65"><a href="model-comparison-in-cognitive-science.html#cb241-65" tabindex="-1"></a></span>
<span id="cb241-66"><a href="model-comparison-in-cognitive-science.html#cb241-66" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb241-67"><a href="model-comparison-in-cognitive-science.html#cb241-67" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb241-68"><a href="model-comparison-in-cognitive-science.html#cb241-68" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb241-69"><a href="model-comparison-in-cognitive-science.html#cb241-69" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb241-70"><a href="model-comparison-in-cognitive-science.html#cb241-70" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb241-71"><a href="model-comparison-in-cognitive-science.html#cb241-71" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb241-72"><a href="model-comparison-in-cognitive-science.html#cb241-72" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb241-73"><a href="model-comparison-in-cognitive-science.html#cb241-73" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb241-74"><a href="model-comparison-in-cognitive-science.html#cb241-74" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb241-75"><a href="model-comparison-in-cognitive-science.html#cb241-75" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb241-76"><a href="model-comparison-in-cognitive-science.html#cb241-76" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb241-77"><a href="model-comparison-in-cognitive-science.html#cb241-77" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb241-78"><a href="model-comparison-in-cognitive-science.html#cb241-78" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb241-79"><a href="model-comparison-in-cognitive-science.html#cb241-79" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb241-80"><a href="model-comparison-in-cognitive-science.html#cb241-80" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb241-81"><a href="model-comparison-in-cognitive-science.html#cb241-81" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb241-82"><a href="model-comparison-in-cognitive-science.html#cb241-82" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb241-83"><a href="model-comparison-in-cognitive-science.html#cb241-83" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb241-84"><a href="model-comparison-in-cognitive-science.html#cb241-84" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb241-85"><a href="model-comparison-in-cognitive-science.html#cb241-85" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb241-86"><a href="model-comparison-in-cognitive-science.html#cb241-86" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb241-87"><a href="model-comparison-in-cognitive-science.html#cb241-87" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb241-88"><a href="model-comparison-in-cognitive-science.html#cb241-88" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb241-89"><a href="model-comparison-in-cognitive-science.html#cb241-89" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb241-90"><a href="model-comparison-in-cognitive-science.html#cb241-90" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb241-91"><a href="model-comparison-in-cognitive-science.html#cb241-91" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb241-92"><a href="model-comparison-in-cognitive-science.html#cb241-92" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb241-93"><a href="model-comparison-in-cognitive-science.html#cb241-93" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb241-94"><a href="model-comparison-in-cognitive-science.html#cb241-94" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb241-95"><a href="model-comparison-in-cognitive-science.html#cb241-95" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb241-96"><a href="model-comparison-in-cognitive-science.html#cb241-96" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  0 * (betaM + IDs[i,2])));</span></span>
<span id="cb241-97"><a href="model-comparison-in-cognitive-science.html#cb241-97" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  1 * (betaM + IDs[i,2])));</span></span>
<span id="cb241-98"><a href="model-comparison-in-cognitive-science.html#cb241-98" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  2 * (betaM + IDs[i,2])));</span></span>
<span id="cb241-99"><a href="model-comparison-in-cognitive-science.html#cb241-99" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb241-100"><a href="model-comparison-in-cognitive-science.html#cb241-100" tabindex="-1"></a><span class="st">      for (t in 1:trials){</span></span>
<span id="cb241-101"><a href="model-comparison-in-cognitive-science.html#cb241-101" tabindex="-1"></a><span class="st">        log_lik[t,i] = bernoulli_logit_lpmf(h[t, i] | biasM + IDs[i, 1] +  memory[t, i] * (betaM + IDs[i, 2]));</span></span>
<span id="cb241-102"><a href="model-comparison-in-cognitive-science.html#cb241-102" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb241-103"><a href="model-comparison-in-cognitive-science.html#cb241-103" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb241-104"><a href="model-comparison-in-cognitive-science.html#cb241-104" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb241-105"><a href="model-comparison-in-cognitive-science.html#cb241-105" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb241-106"><a href="model-comparison-in-cognitive-science.html#cb241-106" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb241-107"><a href="model-comparison-in-cognitive-science.html#cb241-107" tabindex="-1"></a></span>
<span id="cb241-108"><a href="model-comparison-in-cognitive-science.html#cb241-108" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb241-109"><a href="model-comparison-in-cognitive-science.html#cb241-109" tabindex="-1"></a>  stan_memory_model,</span>
<span id="cb241-110"><a href="model-comparison-in-cognitive-science.html#cb241-110" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb241-111"><a href="model-comparison-in-cognitive-science.html#cb241-111" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelMemory.stan&quot;</span>)</span>
<span id="cb241-112"><a href="model-comparison-in-cognitive-science.html#cb241-112" tabindex="-1"></a></span>
<span id="cb241-113"><a href="model-comparison-in-cognitive-science.html#cb241-113" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelMemory.stan&quot;</span>)</span>
<span id="cb241-114"><a href="model-comparison-in-cognitive-science.html#cb241-114" tabindex="-1"></a>mod_memory <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb241-115"><a href="model-comparison-in-cognitive-science.html#cb241-115" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
</div>
<div id="fitting-the-models-to-the-data" class="section level2 hasAnchor" number="8.10">
<h2><span class="header-section-number">8.10</span> Fitting the models to the data<a href="model-comparison-in-cognitive-science.html#fitting-the-models-to-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="model-comparison-in-cognitive-science.html#cb242-1" tabindex="-1"></a><span class="co"># # Fitting biased agent model to biased agent data</span></span>
<span id="cb242-2"><a href="model-comparison-in-cognitive-science.html#cb242-2" tabindex="-1"></a><span class="co"># fit_biased2biased &lt;- mod_biased$sample(</span></span>
<span id="cb242-3"><a href="model-comparison-in-cognitive-science.html#cb242-3" tabindex="-1"></a><span class="co">#   data = data_biased,</span></span>
<span id="cb242-4"><a href="model-comparison-in-cognitive-science.html#cb242-4" tabindex="-1"></a><span class="co">#   seed = 123,</span></span>
<span id="cb242-5"><a href="model-comparison-in-cognitive-science.html#cb242-5" tabindex="-1"></a><span class="co">#   chains = 1,</span></span>
<span id="cb242-6"><a href="model-comparison-in-cognitive-science.html#cb242-6" tabindex="-1"></a><span class="co">#   parallel_chains = 1,</span></span>
<span id="cb242-7"><a href="model-comparison-in-cognitive-science.html#cb242-7" tabindex="-1"></a><span class="co">#   threads_per_chain = 1,</span></span>
<span id="cb242-8"><a href="model-comparison-in-cognitive-science.html#cb242-8" tabindex="-1"></a><span class="co">#   iter_warmup = 2000,</span></span>
<span id="cb242-9"><a href="model-comparison-in-cognitive-science.html#cb242-9" tabindex="-1"></a><span class="co">#   iter_sampling = 2000,</span></span>
<span id="cb242-10"><a href="model-comparison-in-cognitive-science.html#cb242-10" tabindex="-1"></a><span class="co">#   refresh = 0,</span></span>
<span id="cb242-11"><a href="model-comparison-in-cognitive-science.html#cb242-11" tabindex="-1"></a><span class="co">#   output_dir = &quot;simmodels&quot;,</span></span>
<span id="cb242-12"><a href="model-comparison-in-cognitive-science.html#cb242-12" tabindex="-1"></a><span class="co">#   max_treedepth = 20,</span></span>
<span id="cb242-13"><a href="model-comparison-in-cognitive-science.html#cb242-13" tabindex="-1"></a><span class="co">#   adapt_delta = 0.99</span></span>
<span id="cb242-14"><a href="model-comparison-in-cognitive-science.html#cb242-14" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb242-15"><a href="model-comparison-in-cognitive-science.html#cb242-15" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-16"><a href="model-comparison-in-cognitive-science.html#cb242-16" tabindex="-1"></a><span class="co"># fit_biased2biased$save_object(file = &quot;simmodels/W6_fit_biased2biased.RDS&quot;)</span></span>
<span id="cb242-17"><a href="model-comparison-in-cognitive-science.html#cb242-17" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-18"><a href="model-comparison-in-cognitive-science.html#cb242-18" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-19"><a href="model-comparison-in-cognitive-science.html#cb242-19" tabindex="-1"></a><span class="co"># # Fitting biased agent model to memory agent data</span></span>
<span id="cb242-20"><a href="model-comparison-in-cognitive-science.html#cb242-20" tabindex="-1"></a><span class="co"># fit_biased2memory &lt;- mod_biased$sample(</span></span>
<span id="cb242-21"><a href="model-comparison-in-cognitive-science.html#cb242-21" tabindex="-1"></a><span class="co">#   data = data_memory,</span></span>
<span id="cb242-22"><a href="model-comparison-in-cognitive-science.html#cb242-22" tabindex="-1"></a><span class="co">#   seed = 123,</span></span>
<span id="cb242-23"><a href="model-comparison-in-cognitive-science.html#cb242-23" tabindex="-1"></a><span class="co">#   chains = 1,</span></span>
<span id="cb242-24"><a href="model-comparison-in-cognitive-science.html#cb242-24" tabindex="-1"></a><span class="co">#   parallel_chains = 1,</span></span>
<span id="cb242-25"><a href="model-comparison-in-cognitive-science.html#cb242-25" tabindex="-1"></a><span class="co">#   threads_per_chain = 1,</span></span>
<span id="cb242-26"><a href="model-comparison-in-cognitive-science.html#cb242-26" tabindex="-1"></a><span class="co">#   iter_warmup = 2000,</span></span>
<span id="cb242-27"><a href="model-comparison-in-cognitive-science.html#cb242-27" tabindex="-1"></a><span class="co">#   iter_sampling = 2000,</span></span>
<span id="cb242-28"><a href="model-comparison-in-cognitive-science.html#cb242-28" tabindex="-1"></a><span class="co">#   refresh = 0,</span></span>
<span id="cb242-29"><a href="model-comparison-in-cognitive-science.html#cb242-29" tabindex="-1"></a><span class="co">#   output_dir = &quot;simmodels&quot;,</span></span>
<span id="cb242-30"><a href="model-comparison-in-cognitive-science.html#cb242-30" tabindex="-1"></a><span class="co">#   max_treedepth = 20,</span></span>
<span id="cb242-31"><a href="model-comparison-in-cognitive-science.html#cb242-31" tabindex="-1"></a><span class="co">#   adapt_delta = 0.99</span></span>
<span id="cb242-32"><a href="model-comparison-in-cognitive-science.html#cb242-32" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb242-33"><a href="model-comparison-in-cognitive-science.html#cb242-33" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-34"><a href="model-comparison-in-cognitive-science.html#cb242-34" tabindex="-1"></a><span class="co"># fit_biased2memory$save_object(file = &quot;simmodels/W6_fit_biased2memory.RDS&quot;)</span></span>
<span id="cb242-35"><a href="model-comparison-in-cognitive-science.html#cb242-35" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-36"><a href="model-comparison-in-cognitive-science.html#cb242-36" tabindex="-1"></a><span class="co"># fit_memory2biased &lt;- mod_memory$sample(</span></span>
<span id="cb242-37"><a href="model-comparison-in-cognitive-science.html#cb242-37" tabindex="-1"></a><span class="co">#   data = data_biased,</span></span>
<span id="cb242-38"><a href="model-comparison-in-cognitive-science.html#cb242-38" tabindex="-1"></a><span class="co">#   seed = 123,</span></span>
<span id="cb242-39"><a href="model-comparison-in-cognitive-science.html#cb242-39" tabindex="-1"></a><span class="co">#   chains = 1,</span></span>
<span id="cb242-40"><a href="model-comparison-in-cognitive-science.html#cb242-40" tabindex="-1"></a><span class="co">#   parallel_chains = 1,</span></span>
<span id="cb242-41"><a href="model-comparison-in-cognitive-science.html#cb242-41" tabindex="-1"></a><span class="co">#   threads_per_chain = 4,</span></span>
<span id="cb242-42"><a href="model-comparison-in-cognitive-science.html#cb242-42" tabindex="-1"></a><span class="co">#   iter_warmup = 2000,</span></span>
<span id="cb242-43"><a href="model-comparison-in-cognitive-science.html#cb242-43" tabindex="-1"></a><span class="co">#   iter_sampling = 2000,</span></span>
<span id="cb242-44"><a href="model-comparison-in-cognitive-science.html#cb242-44" tabindex="-1"></a><span class="co">#   refresh = 0,</span></span>
<span id="cb242-45"><a href="model-comparison-in-cognitive-science.html#cb242-45" tabindex="-1"></a><span class="co">#   output_dir = &quot;simmodels&quot;,</span></span>
<span id="cb242-46"><a href="model-comparison-in-cognitive-science.html#cb242-46" tabindex="-1"></a><span class="co">#   max_treedepth = 20,</span></span>
<span id="cb242-47"><a href="model-comparison-in-cognitive-science.html#cb242-47" tabindex="-1"></a><span class="co">#   adapt_delta = 0.99</span></span>
<span id="cb242-48"><a href="model-comparison-in-cognitive-science.html#cb242-48" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb242-49"><a href="model-comparison-in-cognitive-science.html#cb242-49" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-50"><a href="model-comparison-in-cognitive-science.html#cb242-50" tabindex="-1"></a><span class="co"># fit_memory2biased$save_object(file = &quot;simmodels/W6_fit_memory2biased.RDS&quot;)</span></span>
<span id="cb242-51"><a href="model-comparison-in-cognitive-science.html#cb242-51" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-52"><a href="model-comparison-in-cognitive-science.html#cb242-52" tabindex="-1"></a><span class="co"># fit_memory2memory &lt;- mod_memory$sample(</span></span>
<span id="cb242-53"><a href="model-comparison-in-cognitive-science.html#cb242-53" tabindex="-1"></a><span class="co">#   data = data_memory,</span></span>
<span id="cb242-54"><a href="model-comparison-in-cognitive-science.html#cb242-54" tabindex="-1"></a><span class="co">#   seed = 123,</span></span>
<span id="cb242-55"><a href="model-comparison-in-cognitive-science.html#cb242-55" tabindex="-1"></a><span class="co">#   chains = 1,</span></span>
<span id="cb242-56"><a href="model-comparison-in-cognitive-science.html#cb242-56" tabindex="-1"></a><span class="co">#   parallel_chains = 1,</span></span>
<span id="cb242-57"><a href="model-comparison-in-cognitive-science.html#cb242-57" tabindex="-1"></a><span class="co">#   threads_per_chain = 4,</span></span>
<span id="cb242-58"><a href="model-comparison-in-cognitive-science.html#cb242-58" tabindex="-1"></a><span class="co">#   iter_warmup = 2000,</span></span>
<span id="cb242-59"><a href="model-comparison-in-cognitive-science.html#cb242-59" tabindex="-1"></a><span class="co">#   iter_sampling = 2000,</span></span>
<span id="cb242-60"><a href="model-comparison-in-cognitive-science.html#cb242-60" tabindex="-1"></a><span class="co">#   refresh = 0,</span></span>
<span id="cb242-61"><a href="model-comparison-in-cognitive-science.html#cb242-61" tabindex="-1"></a><span class="co">#   output_dir = &quot;simmodels&quot;,</span></span>
<span id="cb242-62"><a href="model-comparison-in-cognitive-science.html#cb242-62" tabindex="-1"></a><span class="co">#   max_treedepth = 20,</span></span>
<span id="cb242-63"><a href="model-comparison-in-cognitive-science.html#cb242-63" tabindex="-1"></a><span class="co">#   adapt_delta = 0.99</span></span>
<span id="cb242-64"><a href="model-comparison-in-cognitive-science.html#cb242-64" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb242-65"><a href="model-comparison-in-cognitive-science.html#cb242-65" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-66"><a href="model-comparison-in-cognitive-science.html#cb242-66" tabindex="-1"></a><span class="co"># fit_memory2memory$save_object(file = &quot;simmodels/W6_fit_memory2memory.RDS&quot;)</span></span></code></pre></div>
</div>
<div id="calculating-the-expected-log-predictive-density-of-a-model" class="section level2 hasAnchor" number="8.11">
<h2><span class="header-section-number">8.11</span> Calculating the expected log predictive density of a model<a href="model-comparison-in-cognitive-science.html#calculating-the-expected-log-predictive-density-of-a-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous section, we fitted each model (biased and memory) to each dataset (biased and memory), and calculated and saved the log-posterior likelihood distributions for each data point. However, as we know from previous courses, calculating the goodness of fit of a model on the actual data it has been trained/fitted on is a bad idea. Models - expecially complex models - tend to overfit to the data. The multilevel implementation we have used is a bit skeptical of the data (it pools information across agents and combines it with the data from any given agent, thus de facto regularizing the estimates). Still overfitting is a serious risk.</p>
<p>Machine learning has made common practices of validation, that is, of keeping parts of the dataset out of the training/fitting process, in order to then see how well the trained model can predict those untouched data, and get an out of sample error.</p>
<hr />
<div id="rant-on-internal-vs-external-validity" class="section level3 hasAnchor" number="8.11.1">
<h3><span class="header-section-number">8.11.1</span> Rant on internal vs external validity<a href="model-comparison-in-cognitive-science.html#rant-on-internal-vs-external-validity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>However, we need to think carefully about what we mean by “out of sample.” There are actually two distinct types of test sets we might consider: internal and external.
Internal test sets come from the same data collection effort as our training data - for example, we might randomly set aside 20% of our matching pennies games to test on. While this approach helps us detect overfitting to specific participants or trials, it cannot tell us how well our model generalizes to truly new contexts. Our test set participants were recruited from the same population, played the game under the same conditions, and were influenced by the same experimental setup as our training participants.
External test sets, in contrast, come from genuinely different contexts. For our matching pennies model, this might mean testing on games played:</p>
<ul>
<li>In different cultures or age groups</li>
<li>Under time pressure versus relaxed conditions</li>
<li>For real money versus just for fun</li>
<li>Against human opponents versus computer agents</li>
<li>In laboratory versus online settings</li>
</ul>
<p>The distinction matters because cognitive models often capture not just universal mental processes, but also specific strategies that people adopt in particular contexts. A model that perfectly predicts behavior in laboratory matching pennies games might fail entirely when applied to high-stakes poker games, even though both involve similar strategic thinking.
This raises deeper questions about what kind of generalization we want our models to achieve. Are we trying to build models that capture universal cognitive processes, or are we content with models that work well within specific contexts? The answer affects not just how we evaluate our models, but how we design them in the first place.
In practice, truly external test sets are rare in cognitive science - they require additional data collection under different conditions, which is often impractical. This means we must be humble about our claims of generalization. When we talk about a model’s predictive accuracy, we should be clear that we’re usually measuring its ability to generalize within a specific experimental context, not its ability to capture human cognition in all its diversity.
This limitation of internal test sets is one reason why cognitive scientists often complement predictive accuracy metrics with other forms of model evaluation, such as testing theoretical predictions on new tasks or examining whether model parameters correlate sensibly with individual differences. These approaches help us build confidence that our models capture meaningful cognitive processes rather than just statistical patterns specific to our experimental setup.
***</p>
<p>When the datasets are small, as it is often the case in cognitive science, keeping a substantial portion of the data out - substantial enough to be representative of a more general population - is problematic as it risks starving the model of data: there might not be enough data for reliable estimation of the parameter values. This is where the notion of cross-validation comes in: we can split the dataset in k folds, let’s say k = 10. Then each fold is in turn kept aside as validation set, the model is fitted on the other folds, and its predictive performance tested on the validation set. Repeat this operation of each of the folds. This operation ensures that all the data can be used for training as well as for validation, and is in its own terms quite genial. However, this does not mean it is free of shortcomings. First, small validation folds might not be representative of the diversity of true out-of-sample populations - and there is a tendency to set k equal to the number of datapoints (leave-one-out cross validation). Second, there are many ways in which information could leak or contaminate across folds if the pipeline is not very careful (e.g. via data preprocessing scaling the full dataset, or hyper-parameter estimation). Third, and crucial for our case here, cross validation implies refitting the model k times, which for Bayesian models might be very cumbersome (I once had a model that took 6 weeks to run).</p>
<p>The elpd (expected log predictive density) is an attempt at estimating the out-of-sample error without actually re-running the model. To understand elpd we need to decompose it in several steps.</p>
<ul>
<li><p>Log pointwise predictive density (lppd) is the sum of the logarithm of the average log posterior likelihood of each observation ( Pr(yi) )</p></li>
<li><p>A penalty is given according to the sum of the variance in log posterior likelihood per each observation. The more unstable (varying) the higher the penalty.</p></li>
<li><p>This is all still fully based on the training sample. Elpd moves it one step forward by weighting the lppd according to the frequency of the observation in the dataset excluding that observation. The more frequent, the more it matters. N.B. elpd only keeps one datapoint out, meaning that dependencies within larger clusters (e.g. repeated measures by participants) confound the measure.</p></li>
</ul>
<p>Let’s calculate this, and then we will implement a more properly cross-validated version.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="model-comparison-in-cognitive-science.html#cb243-1" tabindex="-1"></a>fit_biased2biased <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W6_fit_memory2memory.RDS&quot;</span>)</span>
<span id="cb243-2"><a href="model-comparison-in-cognitive-science.html#cb243-2" tabindex="-1"></a></span>
<span id="cb243-3"><a href="model-comparison-in-cognitive-science.html#cb243-3" tabindex="-1"></a>Loo_biased2biased <span class="ot">&lt;-</span> fit_biased2biased<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb243-4"><a href="model-comparison-in-cognitive-science.html#cb243-4" tabindex="-1"></a></span>
<span id="cb243-5"><a href="model-comparison-in-cognitive-science.html#cb243-5" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(Loo_biased2biased)</span></code></pre></div>
<p><img src="series_files/figure-html/06%20assess%20predictive%20performance-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="model-comparison-in-cognitive-science.html#cb244-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> p1 <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">0.4</span>)</span>
<span id="cb244-2"><a href="model-comparison-in-cognitive-science.html#cb244-2" tabindex="-1"></a></span>
<span id="cb244-3"><a href="model-comparison-in-cognitive-science.html#cb244-3" tabindex="-1"></a>fit_biased2memory <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W6_fit_biased2memory.RDS&quot;</span>)</span>
<span id="cb244-4"><a href="model-comparison-in-cognitive-science.html#cb244-4" tabindex="-1"></a>Loo_biased2memory <span class="ot">&lt;-</span> fit_biased2memory<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb244-5"><a href="model-comparison-in-cognitive-science.html#cb244-5" tabindex="-1"></a><span class="fu">plot</span>(Loo_biased2memory)</span></code></pre></div>
<p><img src="series_files/figure-html/06%20assess%20predictive%20performance-2.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="model-comparison-in-cognitive-science.html#cb245-1" tabindex="-1"></a>fit_memory2biased <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W6_fit_memory2biased.RDS&quot;</span>)</span>
<span id="cb245-2"><a href="model-comparison-in-cognitive-science.html#cb245-2" tabindex="-1"></a>Loo_memory2biased <span class="ot">&lt;-</span> fit_memory2biased<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb245-3"><a href="model-comparison-in-cognitive-science.html#cb245-3" tabindex="-1"></a><span class="fu">plot</span>(Loo_memory2biased)</span></code></pre></div>
<p><img src="series_files/figure-html/06%20assess%20predictive%20performance-3.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="model-comparison-in-cognitive-science.html#cb246-1" tabindex="-1"></a>fit_memory2memory <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W6_fit_memory2memory.RDS&quot;</span>)</span>
<span id="cb246-2"><a href="model-comparison-in-cognitive-science.html#cb246-2" tabindex="-1"></a>Loo_memory2memory <span class="ot">&lt;-</span> fit_memory2memory<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb246-3"><a href="model-comparison-in-cognitive-science.html#cb246-3" tabindex="-1"></a><span class="fu">plot</span>(Loo_memory2memory)</span></code></pre></div>
<p><img src="series_files/figure-html/06%20assess%20predictive%20performance-4.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="model-comparison-in-cognitive-science.html#cb247-1" tabindex="-1"></a>elpd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb247-2"><a href="model-comparison-in-cognitive-science.html#cb247-2" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">seq</span>(<span class="dv">12000</span>),</span>
<span id="cb247-3"><a href="model-comparison-in-cognitive-science.html#cb247-3" tabindex="-1"></a>  <span class="at">biased_diff_elpd =</span> </span>
<span id="cb247-4"><a href="model-comparison-in-cognitive-science.html#cb247-4" tabindex="-1"></a>  Loo_biased2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>] <span class="sc">-</span> </span>
<span id="cb247-5"><a href="model-comparison-in-cognitive-science.html#cb247-5" tabindex="-1"></a>  Loo_memory2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>],</span>
<span id="cb247-6"><a href="model-comparison-in-cognitive-science.html#cb247-6" tabindex="-1"></a>  <span class="at">memory_diff_elpd =</span> </span>
<span id="cb247-7"><a href="model-comparison-in-cognitive-science.html#cb247-7" tabindex="-1"></a>  Loo_memory2memory<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>] <span class="sc">-</span></span>
<span id="cb247-8"><a href="model-comparison-in-cognitive-science.html#cb247-8" tabindex="-1"></a>  Loo_biased2memory<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>])</span>
<span id="cb247-9"><a href="model-comparison-in-cognitive-science.html#cb247-9" tabindex="-1"></a></span>
<span id="cb247-10"><a href="model-comparison-in-cognitive-science.html#cb247-10" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elpd, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> biased_diff_elpd)) <span class="sc">+</span></span>
<span id="cb247-11"><a href="model-comparison-in-cognitive-science.html#cb247-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb247-12"><a href="model-comparison-in-cognitive-science.html#cb247-12" tabindex="-1"></a>  <span class="co">#xlim(.5,1.01) +</span></span>
<span id="cb247-13"><a href="model-comparison-in-cognitive-science.html#cb247-13" tabindex="-1"></a>  <span class="co">#ylim(-1.5,1.5) +</span></span>
<span id="cb247-14"><a href="model-comparison-in-cognitive-science.html#cb247-14" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb247-15"><a href="model-comparison-in-cognitive-science.html#cb247-15" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb247-16"><a href="model-comparison-in-cognitive-science.html#cb247-16" tabindex="-1"></a></span>
<span id="cb247-17"><a href="model-comparison-in-cognitive-science.html#cb247-17" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elpd, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> memory_diff_elpd)) <span class="sc">+</span></span>
<span id="cb247-18"><a href="model-comparison-in-cognitive-science.html#cb247-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb247-19"><a href="model-comparison-in-cognitive-science.html#cb247-19" tabindex="-1"></a>  <span class="co">#xlim(.5,1.01) +</span></span>
<span id="cb247-20"><a href="model-comparison-in-cognitive-science.html#cb247-20" tabindex="-1"></a>  <span class="co">#ylim(-1.5,1.5) +</span></span>
<span id="cb247-21"><a href="model-comparison-in-cognitive-science.html#cb247-21" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb247-22"><a href="model-comparison-in-cognitive-science.html#cb247-22" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb247-23"><a href="model-comparison-in-cognitive-science.html#cb247-23" tabindex="-1"></a></span>
<span id="cb247-24"><a href="model-comparison-in-cognitive-science.html#cb247-24" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb247-25"><a href="model-comparison-in-cognitive-science.html#cb247-25" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="series_files/figure-html/06%20assess%20predictive%20performance-5.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="model-comparison-in-cognitive-science.html#cb248-1" tabindex="-1"></a><span class="fu">loo_compare</span>(Loo_biased2biased, Loo_memory2biased)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1     0.0       0.0
## model2 -1414.1      83.1</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="model-comparison-in-cognitive-science.html#cb250-1" tabindex="-1"></a><span class="fu">loo_compare</span>(Loo_biased2memory, Loo_memory2memory)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model2   0.0       0.0  
## model1 -95.8      91.3</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="model-comparison-in-cognitive-science.html#cb252-1" tabindex="-1"></a><span class="fu">loo_model_weights</span>(<span class="fu">list</span>(Loo_biased2biased, Loo_memory2biased))</span></code></pre></div>
<pre><code>## Method: stacking
## ------
##        weight
## model1 0.768 
## model2 0.232</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="model-comparison-in-cognitive-science.html#cb254-1" tabindex="-1"></a><span class="fu">loo_model_weights</span>(<span class="fu">list</span>(Loo_biased2memory, Loo_memory2memory))</span></code></pre></div>
<pre><code>## Method: stacking
## ------
##        weight
## model1 0.488 
## model2 0.512</code></pre>
</div>
</div>
<div id="implementing-cross-validation" class="section level2 hasAnchor" number="8.12">
<h2><span class="header-section-number">8.12</span> Implementing Cross-Validation<a href="model-comparison-in-cognitive-science.html#implementing-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As we mentioned, elpd per se is only an approximation of the cross-validated performance and it only leaves one datapoint out at a time.
[MISSING: VERSION W TRANSFORMED DATA]</p>
<div id="create-cross-validation-ready-stan-model-for-biased-agents" class="section level3 hasAnchor" number="8.12.1">
<h3><span class="header-section-number">8.12.1</span> Create cross-validation ready stan model for biased agents<a href="model-comparison-in-cognitive-science.html#create-cross-validation-ready-stan-model-for-biased-agents" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>N.B. compared to before we also need to include specifics for test data</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="model-comparison-in-cognitive-science.html#cb256-1" tabindex="-1"></a>stan_biased_cv_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb256-2"><a href="model-comparison-in-cognitive-science.html#cb256-2" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb256-3"><a href="model-comparison-in-cognitive-science.html#cb256-3" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (right and left). Now multilevel</span></span>
<span id="cb256-4"><a href="model-comparison-in-cognitive-science.html#cb256-4" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb256-5"><a href="model-comparison-in-cognitive-science.html#cb256-5" tabindex="-1"></a></span>
<span id="cb256-6"><a href="model-comparison-in-cognitive-science.html#cb256-6" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb256-7"><a href="model-comparison-in-cognitive-science.html#cb256-7" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { // normal distribution with a lower bound</span></span>
<span id="cb256-8"><a href="model-comparison-in-cognitive-science.html#cb256-8" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb256-9"><a href="model-comparison-in-cognitive-science.html#cb256-9" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb256-10"><a href="model-comparison-in-cognitive-science.html#cb256-10" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb256-11"><a href="model-comparison-in-cognitive-science.html#cb256-11" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb256-12"><a href="model-comparison-in-cognitive-science.html#cb256-12" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb256-13"><a href="model-comparison-in-cognitive-science.html#cb256-13" tabindex="-1"></a></span>
<span id="cb256-14"><a href="model-comparison-in-cognitive-science.html#cb256-14" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of hands</span></span>
<span id="cb256-15"><a href="model-comparison-in-cognitive-science.html#cb256-15" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb256-16"><a href="model-comparison-in-cognitive-science.html#cb256-16" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb256-17"><a href="model-comparison-in-cognitive-science.html#cb256-17" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb256-18"><a href="model-comparison-in-cognitive-science.html#cb256-18" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb256-19"><a href="model-comparison-in-cognitive-science.html#cb256-19" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb256-20"><a href="model-comparison-in-cognitive-science.html#cb256-20" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents_test;</span></span>
<span id="cb256-21"><a href="model-comparison-in-cognitive-science.html#cb256-21" tabindex="-1"></a><span class="st"> array[trials, agents_test] int h_test;</span></span>
<span id="cb256-22"><a href="model-comparison-in-cognitive-science.html#cb256-22" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb256-23"><a href="model-comparison-in-cognitive-science.html#cb256-23" tabindex="-1"></a></span>
<span id="cb256-24"><a href="model-comparison-in-cognitive-science.html#cb256-24" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb256-25"><a href="model-comparison-in-cognitive-science.html#cb256-25" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb256-26"><a href="model-comparison-in-cognitive-science.html#cb256-26" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb256-27"><a href="model-comparison-in-cognitive-science.html#cb256-27" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;</span></span>
<span id="cb256-28"><a href="model-comparison-in-cognitive-science.html#cb256-28" tabindex="-1"></a><span class="st">  array[agents] real theta;</span></span>
<span id="cb256-29"><a href="model-comparison-in-cognitive-science.html#cb256-29" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb256-30"><a href="model-comparison-in-cognitive-science.html#cb256-30" tabindex="-1"></a></span>
<span id="cb256-31"><a href="model-comparison-in-cognitive-science.html#cb256-31" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb256-32"><a href="model-comparison-in-cognitive-science.html#cb256-32" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb256-33"><a href="model-comparison-in-cognitive-science.html#cb256-33" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb256-34"><a href="model-comparison-in-cognitive-science.html#cb256-34" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3)  -</span></span>
<span id="cb256-35"><a href="model-comparison-in-cognitive-science.html#cb256-35" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb256-36"><a href="model-comparison-in-cognitive-science.html#cb256-36" tabindex="-1"></a></span>
<span id="cb256-37"><a href="model-comparison-in-cognitive-science.html#cb256-37" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb256-38"><a href="model-comparison-in-cognitive-science.html#cb256-38" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb256-39"><a href="model-comparison-in-cognitive-science.html#cb256-39" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb256-40"><a href="model-comparison-in-cognitive-science.html#cb256-40" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb256-41"><a href="model-comparison-in-cognitive-science.html#cb256-41" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb256-42"><a href="model-comparison-in-cognitive-science.html#cb256-42" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb256-43"><a href="model-comparison-in-cognitive-science.html#cb256-43" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb256-44"><a href="model-comparison-in-cognitive-science.html#cb256-44" tabindex="-1"></a></span>
<span id="cb256-45"><a href="model-comparison-in-cognitive-science.html#cb256-45" tabindex="-1"></a></span>
<span id="cb256-46"><a href="model-comparison-in-cognitive-science.html#cb256-46" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb256-47"><a href="model-comparison-in-cognitive-science.html#cb256-47" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb256-48"><a href="model-comparison-in-cognitive-science.html#cb256-48" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb256-49"><a href="model-comparison-in-cognitive-science.html#cb256-49" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb256-50"><a href="model-comparison-in-cognitive-science.html#cb256-50" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb256-51"><a href="model-comparison-in-cognitive-science.html#cb256-51" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb256-52"><a href="model-comparison-in-cognitive-science.html#cb256-52" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb256-53"><a href="model-comparison-in-cognitive-science.html#cb256-53" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb256-54"><a href="model-comparison-in-cognitive-science.html#cb256-54" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb256-55"><a href="model-comparison-in-cognitive-science.html#cb256-55" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb256-56"><a href="model-comparison-in-cognitive-science.html#cb256-56" tabindex="-1"></a><span class="st">   array[trials, agents_test] real log_lik_test;</span></span>
<span id="cb256-57"><a href="model-comparison-in-cognitive-science.html#cb256-57" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb256-58"><a href="model-comparison-in-cognitive-science.html#cb256-58" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb256-59"><a href="model-comparison-in-cognitive-science.html#cb256-59" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb256-60"><a href="model-comparison-in-cognitive-science.html#cb256-60" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb256-61"><a href="model-comparison-in-cognitive-science.html#cb256-61" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb256-62"><a href="model-comparison-in-cognitive-science.html#cb256-62" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb256-63"><a href="model-comparison-in-cognitive-science.html#cb256-63" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb256-64"><a href="model-comparison-in-cognitive-science.html#cb256-64" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb256-65"><a href="model-comparison-in-cognitive-science.html#cb256-65" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb256-66"><a href="model-comparison-in-cognitive-science.html#cb256-66" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb256-67"><a href="model-comparison-in-cognitive-science.html#cb256-67" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb256-68"><a href="model-comparison-in-cognitive-science.html#cb256-68" tabindex="-1"></a><span class="st">      log_lik[t,i] = bernoulli_logit_lpmf(h[t,i] | theta[i]);</span></span>
<span id="cb256-69"><a href="model-comparison-in-cognitive-science.html#cb256-69" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb256-70"><a href="model-comparison-in-cognitive-science.html#cb256-70" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb256-71"><a href="model-comparison-in-cognitive-science.html#cb256-71" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb256-72"><a href="model-comparison-in-cognitive-science.html#cb256-72" tabindex="-1"></a><span class="st">   for (i in 1:agents_test){</span></span>
<span id="cb256-73"><a href="model-comparison-in-cognitive-science.html#cb256-73" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb256-74"><a href="model-comparison-in-cognitive-science.html#cb256-74" tabindex="-1"></a><span class="st">      log_lik_test[t,i] = bernoulli_lpmf(h_test[t,i] | theta_posterior);</span></span>
<span id="cb256-75"><a href="model-comparison-in-cognitive-science.html#cb256-75" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb256-76"><a href="model-comparison-in-cognitive-science.html#cb256-76" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb256-77"><a href="model-comparison-in-cognitive-science.html#cb256-77" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb256-78"><a href="model-comparison-in-cognitive-science.html#cb256-78" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb256-79"><a href="model-comparison-in-cognitive-science.html#cb256-79" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb256-80"><a href="model-comparison-in-cognitive-science.html#cb256-80" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb256-81"><a href="model-comparison-in-cognitive-science.html#cb256-81" tabindex="-1"></a>  stan_biased_cv_model,</span>
<span id="cb256-82"><a href="model-comparison-in-cognitive-science.html#cb256-82" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb256-83"><a href="model-comparison-in-cognitive-science.html#cb256-83" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelBias_cv.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelBias_cv.stan&quot;</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="model-comparison-in-cognitive-science.html#cb258-1" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelBias_cv.stan&quot;</span>)</span>
<span id="cb258-2"><a href="model-comparison-in-cognitive-science.html#cb258-2" tabindex="-1"></a>mod_biased_cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb258-3"><a href="model-comparison-in-cognitive-science.html#cb258-3" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb258-4"><a href="model-comparison-in-cognitive-science.html#cb258-4" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
</div>
<div id="create-cross-validation-ready-stan-model-for-memory-agents" class="section level3 hasAnchor" number="8.12.2">
<h3><span class="header-section-number">8.12.2</span> Create cross-validation ready stan model for memory agents<a href="model-comparison-in-cognitive-science.html#create-cross-validation-ready-stan-model-for-memory-agents" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="model-comparison-in-cognitive-science.html#cb259-1" tabindex="-1"></a>stan_memory_cv_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb259-2"><a href="model-comparison-in-cognitive-science.html#cb259-2" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb259-3"><a href="model-comparison-in-cognitive-science.html#cb259-3" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (heads and tails)</span></span>
<span id="cb259-4"><a href="model-comparison-in-cognitive-science.html#cb259-4" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb259-5"><a href="model-comparison-in-cognitive-science.html#cb259-5" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb259-6"><a href="model-comparison-in-cognitive-science.html#cb259-6" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb259-7"><a href="model-comparison-in-cognitive-science.html#cb259-7" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb259-8"><a href="model-comparison-in-cognitive-science.html#cb259-8" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb259-9"><a href="model-comparison-in-cognitive-science.html#cb259-9" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb259-10"><a href="model-comparison-in-cognitive-science.html#cb259-10" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb259-11"><a href="model-comparison-in-cognitive-science.html#cb259-11" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb259-12"><a href="model-comparison-in-cognitive-science.html#cb259-12" tabindex="-1"></a></span>
<span id="cb259-13"><a href="model-comparison-in-cognitive-science.html#cb259-13" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb259-14"><a href="model-comparison-in-cognitive-science.html#cb259-14" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb259-15"><a href="model-comparison-in-cognitive-science.html#cb259-15" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb259-16"><a href="model-comparison-in-cognitive-science.html#cb259-16" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb259-17"><a href="model-comparison-in-cognitive-science.html#cb259-17" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb259-18"><a href="model-comparison-in-cognitive-science.html#cb259-18" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb259-19"><a href="model-comparison-in-cognitive-science.html#cb259-19" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb259-20"><a href="model-comparison-in-cognitive-science.html#cb259-20" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents_test;</span></span>
<span id="cb259-21"><a href="model-comparison-in-cognitive-science.html#cb259-21" tabindex="-1"></a><span class="st"> array[trials, agents_test] int h_test;</span></span>
<span id="cb259-22"><a href="model-comparison-in-cognitive-science.html#cb259-22" tabindex="-1"></a><span class="st"> array[trials, agents_test] int other_test;</span></span>
<span id="cb259-23"><a href="model-comparison-in-cognitive-science.html#cb259-23" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb259-24"><a href="model-comparison-in-cognitive-science.html#cb259-24" tabindex="-1"></a></span>
<span id="cb259-25"><a href="model-comparison-in-cognitive-science.html#cb259-25" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb259-26"><a href="model-comparison-in-cognitive-science.html#cb259-26" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb259-27"><a href="model-comparison-in-cognitive-science.html#cb259-27" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb259-28"><a href="model-comparison-in-cognitive-science.html#cb259-28" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb259-29"><a href="model-comparison-in-cognitive-science.html#cb259-29" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb259-30"><a href="model-comparison-in-cognitive-science.html#cb259-30" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb259-31"><a href="model-comparison-in-cognitive-science.html#cb259-31" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb259-32"><a href="model-comparison-in-cognitive-science.html#cb259-32" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb259-33"><a href="model-comparison-in-cognitive-science.html#cb259-33" tabindex="-1"></a></span>
<span id="cb259-34"><a href="model-comparison-in-cognitive-science.html#cb259-34" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb259-35"><a href="model-comparison-in-cognitive-science.html#cb259-35" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb259-36"><a href="model-comparison-in-cognitive-science.html#cb259-36" tabindex="-1"></a><span class="st">  array[trials, agents_test] real memory_test;</span></span>
<span id="cb259-37"><a href="model-comparison-in-cognitive-science.html#cb259-37" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb259-38"><a href="model-comparison-in-cognitive-science.html#cb259-38" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb259-39"><a href="model-comparison-in-cognitive-science.html#cb259-39" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb259-40"><a href="model-comparison-in-cognitive-science.html#cb259-40" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb259-41"><a href="model-comparison-in-cognitive-science.html#cb259-41" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb259-42"><a href="model-comparison-in-cognitive-science.html#cb259-42" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb259-43"><a href="model-comparison-in-cognitive-science.html#cb259-43" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb259-44"><a href="model-comparison-in-cognitive-science.html#cb259-44" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb259-45"><a href="model-comparison-in-cognitive-science.html#cb259-45" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb259-46"><a href="model-comparison-in-cognitive-science.html#cb259-46" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb259-47"><a href="model-comparison-in-cognitive-science.html#cb259-47" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb259-48"><a href="model-comparison-in-cognitive-science.html#cb259-48" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb259-49"><a href="model-comparison-in-cognitive-science.html#cb259-49" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb259-50"><a href="model-comparison-in-cognitive-science.html#cb259-50" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb259-51"><a href="model-comparison-in-cognitive-science.html#cb259-51" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb259-52"><a href="model-comparison-in-cognitive-science.html#cb259-52" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb259-53"><a href="model-comparison-in-cognitive-science.html#cb259-53" tabindex="-1"></a><span class="st">  for (agent in 1:agents_test){</span></span>
<span id="cb259-54"><a href="model-comparison-in-cognitive-science.html#cb259-54" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb259-55"><a href="model-comparison-in-cognitive-science.html#cb259-55" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb259-56"><a href="model-comparison-in-cognitive-science.html#cb259-56" tabindex="-1"></a><span class="st">        memory_test[trial, agent] = 0.5;</span></span>
<span id="cb259-57"><a href="model-comparison-in-cognitive-science.html#cb259-57" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb259-58"><a href="model-comparison-in-cognitive-science.html#cb259-58" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb259-59"><a href="model-comparison-in-cognitive-science.html#cb259-59" tabindex="-1"></a><span class="st">        memory_test[trial + 1, agent] = memory_test[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb259-60"><a href="model-comparison-in-cognitive-science.html#cb259-60" tabindex="-1"></a><span class="st">        if (memory_test[trial + 1, agent] == 0){memory_test[trial + 1, agent] = 0.01;}</span></span>
<span id="cb259-61"><a href="model-comparison-in-cognitive-science.html#cb259-61" tabindex="-1"></a><span class="st">        if (memory_test[trial + 1, agent] == 1){memory_test[trial + 1, agent] = 0.99;}</span></span>
<span id="cb259-62"><a href="model-comparison-in-cognitive-science.html#cb259-62" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb259-63"><a href="model-comparison-in-cognitive-science.html#cb259-63" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb259-64"><a href="model-comparison-in-cognitive-science.html#cb259-64" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb259-65"><a href="model-comparison-in-cognitive-science.html#cb259-65" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb259-66"><a href="model-comparison-in-cognitive-science.html#cb259-66" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb259-67"><a href="model-comparison-in-cognitive-science.html#cb259-67" tabindex="-1"></a></span>
<span id="cb259-68"><a href="model-comparison-in-cognitive-science.html#cb259-68" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb259-69"><a href="model-comparison-in-cognitive-science.html#cb259-69" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb259-70"><a href="model-comparison-in-cognitive-science.html#cb259-70" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb259-71"><a href="model-comparison-in-cognitive-science.html#cb259-71" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb259-72"><a href="model-comparison-in-cognitive-science.html#cb259-72" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb259-73"><a href="model-comparison-in-cognitive-science.html#cb259-73" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb259-74"><a href="model-comparison-in-cognitive-science.html#cb259-74" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb259-75"><a href="model-comparison-in-cognitive-science.html#cb259-75" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb259-76"><a href="model-comparison-in-cognitive-science.html#cb259-76" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb259-77"><a href="model-comparison-in-cognitive-science.html#cb259-77" tabindex="-1"></a></span>
<span id="cb259-78"><a href="model-comparison-in-cognitive-science.html#cb259-78" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb259-79"><a href="model-comparison-in-cognitive-science.html#cb259-79" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb259-80"><a href="model-comparison-in-cognitive-science.html#cb259-80" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb259-81"><a href="model-comparison-in-cognitive-science.html#cb259-81" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | biasM + IDs[agent, 1] +  memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb259-82"><a href="model-comparison-in-cognitive-science.html#cb259-82" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb259-83"><a href="model-comparison-in-cognitive-science.html#cb259-83" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb259-84"><a href="model-comparison-in-cognitive-science.html#cb259-84" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb259-85"><a href="model-comparison-in-cognitive-science.html#cb259-85" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb259-86"><a href="model-comparison-in-cognitive-science.html#cb259-86" tabindex="-1"></a></span>
<span id="cb259-87"><a href="model-comparison-in-cognitive-science.html#cb259-87" tabindex="-1"></a></span>
<span id="cb259-88"><a href="model-comparison-in-cognitive-science.html#cb259-88" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb259-89"><a href="model-comparison-in-cognitive-science.html#cb259-89" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb259-90"><a href="model-comparison-in-cognitive-science.html#cb259-90" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb259-91"><a href="model-comparison-in-cognitive-science.html#cb259-91" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb259-92"><a href="model-comparison-in-cognitive-science.html#cb259-92" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb259-93"><a href="model-comparison-in-cognitive-science.html#cb259-93" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb259-94"><a href="model-comparison-in-cognitive-science.html#cb259-94" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb259-95"><a href="model-comparison-in-cognitive-science.html#cb259-95" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb259-96"><a href="model-comparison-in-cognitive-science.html#cb259-96" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb259-97"><a href="model-comparison-in-cognitive-science.html#cb259-97" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb259-98"><a href="model-comparison-in-cognitive-science.html#cb259-98" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb259-99"><a href="model-comparison-in-cognitive-science.html#cb259-99" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb259-100"><a href="model-comparison-in-cognitive-science.html#cb259-100" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb259-101"><a href="model-comparison-in-cognitive-science.html#cb259-101" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb259-102"><a href="model-comparison-in-cognitive-science.html#cb259-102" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb259-103"><a href="model-comparison-in-cognitive-science.html#cb259-103" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb259-104"><a href="model-comparison-in-cognitive-science.html#cb259-104" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb259-105"><a href="model-comparison-in-cognitive-science.html#cb259-105" tabindex="-1"></a><span class="st">   array[trials, agents_test] real log_lik_test;</span></span>
<span id="cb259-106"><a href="model-comparison-in-cognitive-science.html#cb259-106" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb259-107"><a href="model-comparison-in-cognitive-science.html#cb259-107" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb259-108"><a href="model-comparison-in-cognitive-science.html#cb259-108" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb259-109"><a href="model-comparison-in-cognitive-science.html#cb259-109" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb259-110"><a href="model-comparison-in-cognitive-science.html#cb259-110" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb259-111"><a href="model-comparison-in-cognitive-science.html#cb259-111" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb259-112"><a href="model-comparison-in-cognitive-science.html#cb259-112" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb259-113"><a href="model-comparison-in-cognitive-science.html#cb259-113" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb259-114"><a href="model-comparison-in-cognitive-science.html#cb259-114" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb259-115"><a href="model-comparison-in-cognitive-science.html#cb259-115" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb259-116"><a href="model-comparison-in-cognitive-science.html#cb259-116" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb259-117"><a href="model-comparison-in-cognitive-science.html#cb259-117" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb259-118"><a href="model-comparison-in-cognitive-science.html#cb259-118" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb259-119"><a href="model-comparison-in-cognitive-science.html#cb259-119" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  0 * (betaM + IDs[i,2])));</span></span>
<span id="cb259-120"><a href="model-comparison-in-cognitive-science.html#cb259-120" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  1 * (betaM + IDs[i,2])));</span></span>
<span id="cb259-121"><a href="model-comparison-in-cognitive-science.html#cb259-121" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  2 * (betaM + IDs[i,2])));</span></span>
<span id="cb259-122"><a href="model-comparison-in-cognitive-science.html#cb259-122" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb259-123"><a href="model-comparison-in-cognitive-science.html#cb259-123" tabindex="-1"></a><span class="st">      for (t in 1:trials){</span></span>
<span id="cb259-124"><a href="model-comparison-in-cognitive-science.html#cb259-124" tabindex="-1"></a><span class="st">        log_lik[t,i] = bernoulli_logit_lpmf(h[t, i] | biasM + IDs[i, 1] +  memory[t, i] * (betaM + IDs[i, 2]));</span></span>
<span id="cb259-125"><a href="model-comparison-in-cognitive-science.html#cb259-125" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb259-126"><a href="model-comparison-in-cognitive-science.html#cb259-126" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb259-127"><a href="model-comparison-in-cognitive-science.html#cb259-127" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb259-128"><a href="model-comparison-in-cognitive-science.html#cb259-128" tabindex="-1"></a><span class="st">   for (i in 1:agents_test){</span></span>
<span id="cb259-129"><a href="model-comparison-in-cognitive-science.html#cb259-129" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb259-130"><a href="model-comparison-in-cognitive-science.html#cb259-130" tabindex="-1"></a><span class="st">      log_lik_test[t,i] = bernoulli_logit_lpmf(h_test[t,i] | biasM +  memory_test[t, i] * betaM);</span></span>
<span id="cb259-131"><a href="model-comparison-in-cognitive-science.html#cb259-131" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb259-132"><a href="model-comparison-in-cognitive-science.html#cb259-132" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb259-133"><a href="model-comparison-in-cognitive-science.html#cb259-133" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb259-134"><a href="model-comparison-in-cognitive-science.html#cb259-134" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb259-135"><a href="model-comparison-in-cognitive-science.html#cb259-135" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb259-136"><a href="model-comparison-in-cognitive-science.html#cb259-136" tabindex="-1"></a></span>
<span id="cb259-137"><a href="model-comparison-in-cognitive-science.html#cb259-137" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb259-138"><a href="model-comparison-in-cognitive-science.html#cb259-138" tabindex="-1"></a>  stan_memory_cv_model,</span>
<span id="cb259-139"><a href="model-comparison-in-cognitive-science.html#cb259-139" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb259-140"><a href="model-comparison-in-cognitive-science.html#cb259-140" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelMemory_cv.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelMemory_cv.stan&quot;</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="model-comparison-in-cognitive-science.html#cb261-1" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelMemory_cv.stan&quot;</span>)</span>
<span id="cb261-2"><a href="model-comparison-in-cognitive-science.html#cb261-2" tabindex="-1"></a>mod_memory_cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb261-3"><a href="model-comparison-in-cognitive-science.html#cb261-3" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<p>[MISSING: PARALLELIZE]</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="model-comparison-in-cognitive-science.html#cb262-1" tabindex="-1"></a>d<span class="sc">$</span>fold <span class="ot">&lt;-</span> <span class="fu">kfold_split_grouped</span>(<span class="at">K =</span> <span class="dv">10</span>, <span class="at">x =</span> d<span class="sc">$</span>agent)</span>
<span id="cb262-2"><a href="model-comparison-in-cognitive-science.html#cb262-2" tabindex="-1"></a></span>
<span id="cb262-3"><a href="model-comparison-in-cognitive-science.html#cb262-3" tabindex="-1"></a>log_pd_biased_kfold <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1000</span>, <span class="at">ncol =</span> <span class="dv">12000</span>)</span>
<span id="cb262-4"><a href="model-comparison-in-cognitive-science.html#cb262-4" tabindex="-1"></a>log_pd_memory_kfold <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1000</span>, <span class="at">ncol =</span> <span class="dv">12000</span>)</span>
<span id="cb262-5"><a href="model-comparison-in-cognitive-science.html#cb262-5" tabindex="-1"></a></span>
<span id="cb262-6"><a href="model-comparison-in-cognitive-science.html#cb262-6" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">unique</span>(d<span class="sc">$</span>fold)) { </span>
<span id="cb262-7"><a href="model-comparison-in-cognitive-science.html#cb262-7" tabindex="-1"></a>  </span>
<span id="cb262-8"><a href="model-comparison-in-cognitive-science.html#cb262-8" tabindex="-1"></a>  <span class="co"># Training set for k </span></span>
<span id="cb262-9"><a href="model-comparison-in-cognitive-science.html#cb262-9" tabindex="-1"></a>  d_train <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fold <span class="sc">!=</span> k)  </span>
<span id="cb262-10"><a href="model-comparison-in-cognitive-science.html#cb262-10" tabindex="-1"></a>  </span>
<span id="cb262-11"><a href="model-comparison-in-cognitive-science.html#cb262-11" tabindex="-1"></a>  <span class="do">## Create the data</span></span>
<span id="cb262-12"><a href="model-comparison-in-cognitive-science.html#cb262-12" tabindex="-1"></a>  d_memory1_train <span class="ot">&lt;-</span> d_train <span class="sc">%&gt;%</span> </span>
<span id="cb262-13"><a href="model-comparison-in-cognitive-science.html#cb262-13" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-14"><a href="model-comparison-in-cognitive-science.html#cb262-14" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb262-15"><a href="model-comparison-in-cognitive-science.html#cb262-15" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb262-16"><a href="model-comparison-in-cognitive-science.html#cb262-16" tabindex="-1"></a>  d_memory2_train <span class="ot">&lt;-</span> d_train <span class="sc">%&gt;%</span> </span>
<span id="cb262-17"><a href="model-comparison-in-cognitive-science.html#cb262-17" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-18"><a href="model-comparison-in-cognitive-science.html#cb262-18" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb262-19"><a href="model-comparison-in-cognitive-science.html#cb262-19" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb262-20"><a href="model-comparison-in-cognitive-science.html#cb262-20" tabindex="-1"></a>  </span>
<span id="cb262-21"><a href="model-comparison-in-cognitive-science.html#cb262-21" tabindex="-1"></a>  agents_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d_train<span class="sc">$</span>agent))</span>
<span id="cb262-22"><a href="model-comparison-in-cognitive-science.html#cb262-22" tabindex="-1"></a>  </span>
<span id="cb262-23"><a href="model-comparison-in-cognitive-science.html#cb262-23" tabindex="-1"></a>  d_test <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb262-24"><a href="model-comparison-in-cognitive-science.html#cb262-24" tabindex="-1"></a>    <span class="fu">filter</span>(fold <span class="sc">==</span> k) </span>
<span id="cb262-25"><a href="model-comparison-in-cognitive-science.html#cb262-25" tabindex="-1"></a>  d_memory1_test <span class="ot">&lt;-</span> d_test <span class="sc">%&gt;%</span> </span>
<span id="cb262-26"><a href="model-comparison-in-cognitive-science.html#cb262-26" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-27"><a href="model-comparison-in-cognitive-science.html#cb262-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb262-28"><a href="model-comparison-in-cognitive-science.html#cb262-28" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb262-29"><a href="model-comparison-in-cognitive-science.html#cb262-29" tabindex="-1"></a>  d_memory2_test <span class="ot">&lt;-</span> d_test <span class="sc">%&gt;%</span> </span>
<span id="cb262-30"><a href="model-comparison-in-cognitive-science.html#cb262-30" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-31"><a href="model-comparison-in-cognitive-science.html#cb262-31" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb262-32"><a href="model-comparison-in-cognitive-science.html#cb262-32" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb262-33"><a href="model-comparison-in-cognitive-science.html#cb262-33" tabindex="-1"></a>  </span>
<span id="cb262-34"><a href="model-comparison-in-cognitive-science.html#cb262-34" tabindex="-1"></a>  agents_test_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d_test<span class="sc">$</span>agent))</span>
<span id="cb262-35"><a href="model-comparison-in-cognitive-science.html#cb262-35" tabindex="-1"></a>  </span>
<span id="cb262-36"><a href="model-comparison-in-cognitive-science.html#cb262-36" tabindex="-1"></a>  data_memory <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb262-37"><a href="model-comparison-in-cognitive-science.html#cb262-37" tabindex="-1"></a>    <span class="at">trials =</span> trials,</span>
<span id="cb262-38"><a href="model-comparison-in-cognitive-science.html#cb262-38" tabindex="-1"></a>    <span class="at">agents =</span>  agents_n,</span>
<span id="cb262-39"><a href="model-comparison-in-cognitive-science.html#cb262-39" tabindex="-1"></a>    <span class="at">agents_test =</span> agents_test_n,</span>
<span id="cb262-40"><a href="model-comparison-in-cognitive-science.html#cb262-40" tabindex="-1"></a>    <span class="at">h =</span> <span class="fu">as.matrix</span>(d_memory1_train[,<span class="dv">2</span><span class="sc">:</span>(agents_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb262-41"><a href="model-comparison-in-cognitive-science.html#cb262-41" tabindex="-1"></a>    <span class="at">other =</span> <span class="fu">as.matrix</span>(d_memory2_train[,<span class="dv">2</span><span class="sc">:</span>(agents_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb262-42"><a href="model-comparison-in-cognitive-science.html#cb262-42" tabindex="-1"></a>    </span>
<span id="cb262-43"><a href="model-comparison-in-cognitive-science.html#cb262-43" tabindex="-1"></a>    <span class="at">h_test =</span> <span class="fu">as.matrix</span>(d_memory1_test[,<span class="dv">2</span><span class="sc">:</span>(agents_test_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb262-44"><a href="model-comparison-in-cognitive-science.html#cb262-44" tabindex="-1"></a>    <span class="at">other_test =</span> <span class="fu">as.matrix</span>(d_memory2_test[,<span class="dv">2</span><span class="sc">:</span>(agents_test_n <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="cb262-45"><a href="model-comparison-in-cognitive-science.html#cb262-45" tabindex="-1"></a>  </span>
<span id="cb262-46"><a href="model-comparison-in-cognitive-science.html#cb262-46" tabindex="-1"></a>  <span class="co"># Train the models </span></span>
<span id="cb262-47"><a href="model-comparison-in-cognitive-science.html#cb262-47" tabindex="-1"></a>  fit_random <span class="ot">&lt;-</span> mod_biased_cv<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb262-48"><a href="model-comparison-in-cognitive-science.html#cb262-48" tabindex="-1"></a>    <span class="at">data =</span> data_memory,</span>
<span id="cb262-49"><a href="model-comparison-in-cognitive-science.html#cb262-49" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb262-50"><a href="model-comparison-in-cognitive-science.html#cb262-50" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb262-51"><a href="model-comparison-in-cognitive-science.html#cb262-51" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb262-52"><a href="model-comparison-in-cognitive-science.html#cb262-52" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb262-53"><a href="model-comparison-in-cognitive-science.html#cb262-53" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb262-54"><a href="model-comparison-in-cognitive-science.html#cb262-54" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb262-55"><a href="model-comparison-in-cognitive-science.html#cb262-55" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb262-56"><a href="model-comparison-in-cognitive-science.html#cb262-56" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb262-57"><a href="model-comparison-in-cognitive-science.html#cb262-57" tabindex="-1"></a>  )</span>
<span id="cb262-58"><a href="model-comparison-in-cognitive-science.html#cb262-58" tabindex="-1"></a>  </span>
<span id="cb262-59"><a href="model-comparison-in-cognitive-science.html#cb262-59" tabindex="-1"></a>  fit_memory <span class="ot">&lt;-</span> mod_memory_cv<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb262-60"><a href="model-comparison-in-cognitive-science.html#cb262-60" tabindex="-1"></a>    <span class="at">data =</span> data_memory,</span>
<span id="cb262-61"><a href="model-comparison-in-cognitive-science.html#cb262-61" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb262-62"><a href="model-comparison-in-cognitive-science.html#cb262-62" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb262-63"><a href="model-comparison-in-cognitive-science.html#cb262-63" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb262-64"><a href="model-comparison-in-cognitive-science.html#cb262-64" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb262-65"><a href="model-comparison-in-cognitive-science.html#cb262-65" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb262-66"><a href="model-comparison-in-cognitive-science.html#cb262-66" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb262-67"><a href="model-comparison-in-cognitive-science.html#cb262-67" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb262-68"><a href="model-comparison-in-cognitive-science.html#cb262-68" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb262-69"><a href="model-comparison-in-cognitive-science.html#cb262-69" tabindex="-1"></a>  )</span>
<span id="cb262-70"><a href="model-comparison-in-cognitive-science.html#cb262-70" tabindex="-1"></a>  </span>
<span id="cb262-71"><a href="model-comparison-in-cognitive-science.html#cb262-71" tabindex="-1"></a>  <span class="co"># Extract log likelihood which represents </span></span>
<span id="cb262-72"><a href="model-comparison-in-cognitive-science.html#cb262-72" tabindex="-1"></a>  <span class="co"># the pointwise predictive density. </span></span>
<span id="cb262-73"><a href="model-comparison-in-cognitive-science.html#cb262-73" tabindex="-1"></a>  <span class="co"># n.b. the matrix has 1000 row, and 12000 columns. </span></span>
<span id="cb262-74"><a href="model-comparison-in-cognitive-science.html#cb262-74" tabindex="-1"></a>  <span class="co"># d$fold==k yields 12000 logical values, of which 1200 TRUEs, identifying 1200 columns</span></span>
<span id="cb262-75"><a href="model-comparison-in-cognitive-science.html#cb262-75" tabindex="-1"></a>  <span class="do">## the fit blabla yields 1000 obs (samples) and 1190 variables instead of 1200</span></span>
<span id="cb262-76"><a href="model-comparison-in-cognitive-science.html#cb262-76" tabindex="-1"></a>  log_pd_biased_kfold[, d<span class="sc">$</span>fold <span class="sc">==</span> k] <span class="ot">&lt;-</span> fit_random<span class="sc">$</span><span class="fu">draws</span>(<span class="st">&quot;log_lik_test&quot;</span>, <span class="at">format =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb262-77"><a href="model-comparison-in-cognitive-science.html#cb262-77" tabindex="-1"></a>  log_pd_memory_kfold[, d<span class="sc">$</span>fold <span class="sc">==</span> k] <span class="ot">&lt;-</span> fit_memory<span class="sc">$</span><span class="fu">draws</span>(<span class="st">&quot;log_lik_test&quot;</span>, <span class="at">format =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb262-78"><a href="model-comparison-in-cognitive-science.html#cb262-78" tabindex="-1"></a></span>
<span id="cb262-79"><a href="model-comparison-in-cognitive-science.html#cb262-79" tabindex="-1"></a>}</span>
<span id="cb262-80"><a href="model-comparison-in-cognitive-science.html#cb262-80" tabindex="-1"></a></span>
<span id="cb262-81"><a href="model-comparison-in-cognitive-science.html#cb262-81" tabindex="-1"></a><span class="fu">save</span>(log_pd_biased_kfold, log_pd_memory_kfold, <span class="at">file =</span> <span class="st">&quot;simmodels/W6_CV_Biased&amp;Memory.RData&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="calculating-elpd-and-comparing" class="section level2 hasAnchor" number="8.13">
<h2><span class="header-section-number">8.13</span> Calculating elpd and comparing<a href="model-comparison-in-cognitive-science.html#calculating-elpd-and-comparing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="model-comparison-in-cognitive-science.html#cb263-1" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;simmodels/W6_CV_Biased&amp;Memory.RData&quot;</span>) </span>
<span id="cb263-2"><a href="model-comparison-in-cognitive-science.html#cb263-2" tabindex="-1"></a></span>
<span id="cb263-3"><a href="model-comparison-in-cognitive-science.html#cb263-3" tabindex="-1"></a>elpd_biased_kfold <span class="ot">&lt;-</span> <span class="fu">elpd</span>(log_pd_biased_kfold)</span>
<span id="cb263-4"><a href="model-comparison-in-cognitive-science.html#cb263-4" tabindex="-1"></a>elpd_memory_kfold <span class="ot">&lt;-</span> <span class="fu">elpd</span>(log_pd_memory_kfold)</span>
<span id="cb263-5"><a href="model-comparison-in-cognitive-science.html#cb263-5" tabindex="-1"></a></span>
<span id="cb263-6"><a href="model-comparison-in-cognitive-science.html#cb263-6" tabindex="-1"></a><span class="fu">loo_compare</span>(elpd_biased_kfold, elpd_memory_kfold)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1    0.0       0.0 
## model2 -437.3      23.9</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="model-comparison-in-cognitive-science.html#cb265-1" tabindex="-1"></a><span class="co">#loo_model_weights(elpd_biased_kfold, elpd_memory_kfold)</span></span></code></pre></div>
</div>
<div id="limitations-of-model-comparison-techniques" class="section level2 hasAnchor" number="8.14">
<h2><span class="header-section-number">8.14</span> Limitations of model comparison techniques<a href="model-comparison-in-cognitive-science.html#limitations-of-model-comparison-techniques" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>it might be overfitting to the training population, that is, to the</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="individual-differences-in-cognitive-strategies-multilevel-modeling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mixture-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/07-ModelComparison.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
