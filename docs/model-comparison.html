<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Model comparison | 06-ModelComparison</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Model comparison | 06-ModelComparison" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Model comparison | 06-ModelComparison" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2023" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2023-03-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="multilevel-modeling.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-goal-of-the-course"><i class="fa fa-check"></i><b>1.1</b> The goal of the course</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#list-of-lectures-and-practical-exercises"><i class="fa fa-check"></i><b>1.2</b> List of lectures and practical exercises</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preparation-before-the-course"><i class="fa fa-check"></i><b>1.3</b> Preparation before the course</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><i class="fa fa-check"></i><b>2</b> Practical exercise 1 - Building verbal models of the matching pennies game</a>
<ul>
<li class="chapter" data-level="2.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#trying-out-the-game-and-collecting-your-own-data"><i class="fa fa-check"></i><b>2.1</b> Trying out the game and collecting your own data</a></li>
<li class="chapter" data-level="2.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#start-theorizing"><i class="fa fa-check"></i><b>2.2</b> Start Theorizing</a></li>
<li class="chapter" data-level="2.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>2.3</b> The distinction between participant and researcher perspectives</a></li>
<li class="chapter" data-level="2.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#strategies"><i class="fa fa-check"></i><b>2.4</b> Strategies</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#random-strategies"><i class="fa fa-check"></i><b>2.4.1</b> Random strategies</a></li>
<li class="chapter" data-level="2.4.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#immediate-reaction"><i class="fa fa-check"></i><b>2.4.2</b> Immediate reaction</a></li>
<li class="chapter" data-level="2.4.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>2.4.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="2.4.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>2.4.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="2.4.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#reinforcement-learning"><i class="fa fa-check"></i><b>2.4.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="2.4.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#k-tom"><i class="fa fa-check"></i><b>2.4.6</b> k-ToM</a></li>
<li class="chapter" data-level="2.4.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#other-possible-strategies"><i class="fa fa-check"></i><b>2.4.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#cognitive-constraints"><i class="fa fa-check"></i><b>2.5</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#memory"><i class="fa fa-check"></i><b>2.5.1</b> Memory</a></li>
<li class="chapter" data-level="2.5.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#errors"><i class="fa fa-check"></i><b>2.5.2</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#continuity-between-models"><i class="fa fa-check"></i><b>2.6</b> Continuity between models</a></li>
<li class="chapter" data-level="2.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#mixture-of-strategies"><i class="fa fa-check"></i><b>2.7</b> Mixture of strategies</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html"><i class="fa fa-check"></i><b>3</b> Practical exercise 2 - From verbal to formal models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>3.1</b> Defining general conditions</a></li>
<li class="chapter" data-level="3.2" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>3.2</b> Implementing a random agent</a></li>
<li class="chapter" data-level="3.3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>3.3</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="3.4" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>3.4</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>3.4.1</b> And we visualize it</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html"><i class="fa fa-check"></i><b>4</b> Practical exercise 3 - Getting into Stan</a>
<ul>
<li class="chapter" data-level="4.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#simulating-data"><i class="fa fa-check"></i><b>4.2</b> Simulating data</a></li>
<li class="chapter" data-level="4.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#building-our-basic-model-in-stan"><i class="fa fa-check"></i><b>4.3</b> Building our basic model in Stan</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#data"><i class="fa fa-check"></i><b>4.3.1</b> Data</a></li>
<li class="chapter" data-level="4.3.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#model"><i class="fa fa-check"></i><b>4.3.2</b> Model</a></li>
<li class="chapter" data-level="4.3.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#compiling-and-fitting-the-model"><i class="fa fa-check"></i><b>4.3.3</b> Compiling and fitting the model</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#parameter-recovery"><i class="fa fa-check"></i><b>4.4</b> Parameter recovery</a></li>
<li class="chapter" data-level="4.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#the-memory-model-conditioning-theta"><i class="fa fa-check"></i><b>4.5</b> The memory model: conditioning theta</a></li>
<li class="chapter" data-level="4.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#memory-agent-with-internal-parameter"><i class="fa fa-check"></i><b>4.6</b> Memory agent with internal parameter</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#trying-out-a-more-complex-memory-model-with-a-rate-of-forgetting-that-exponentially-discounts-the-past"><i class="fa fa-check"></i><b>4.6.1</b> Trying out a more complex memory model, with a rate of forgetting that exponentially discounts the past</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html"><i class="fa fa-check"></i><b>5</b> Practical exercise 4 - Model quality checks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#generating-and-plotting-additional-variables"><i class="fa fa-check"></i><b>5.1</b> Generating and plotting additional variables</a></li>
<li class="chapter" data-level="5.2" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-priors"><i class="fa fa-check"></i><b>5.2</b> Assessing priors</a></li>
<li class="chapter" data-level="5.3" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-prior-and-posterior-predictions"><i class="fa fa-check"></i><b>5.3</b> Assessing prior and posterior predictions</a></li>
<li class="chapter" data-level="5.4" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>5.4</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="5.5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#the-memory-model"><i class="fa fa-check"></i><b>5.5</b> The memory model</a></li>
<li class="chapter" data-level="5.6" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-check-for-the-memory-model"><i class="fa fa-check"></i><b>5.6</b> Prior sensitivity check for the memory model</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html"><i class="fa fa-check"></i><b>6</b> Multilevel modeling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#intro-to-multilevel-modeling"><i class="fa fa-check"></i><b>6.1</b> Intro to multilevel modeling</a></li>
<li class="chapter" data-level="6.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#a-multilevel-version-of-the-biased-agent-and-of-the-simple-memory-agent"><i class="fa fa-check"></i><b>6.2</b> A multilevel version of the biased agent and of the simple memory agent</a></li>
<li class="chapter" data-level="6.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#generating-the-agents"><i class="fa fa-check"></i><b>6.3</b> Generating the agents</a></li>
<li class="chapter" data-level="6.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#plotting-the-agents"><i class="fa fa-check"></i><b>6.4</b> Plotting the agents</a></li>
<li class="chapter" data-level="6.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#coding-the-multilevel-agents"><i class="fa fa-check"></i><b>6.5</b> Coding the multilevel agents</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-random"><i class="fa fa-check"></i><b>6.5.1</b> Multilevel random</a></li>
<li class="chapter" data-level="6.5.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-random-agents"><i class="fa fa-check"></i><b>6.5.2</b> Assessing multilevel random agents</a></li>
<li class="chapter" data-level="6.5.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory"><i class="fa fa-check"></i><b>6.5.3</b> Multilevel memory</a></li>
<li class="chapter" data-level="6.5.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory"><i class="fa fa-check"></i><b>6.5.4</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization"><i class="fa fa-check"></i><b>6.5.5</b> Multilevel memory with non centered parameterization</a></li>
<li class="chapter" data-level="6.5.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-1"><i class="fa fa-check"></i><b>6.5.6</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.7" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters"><i class="fa fa-check"></i><b>6.5.7</b> Multilevel memory with correlation between parameters</a></li>
<li class="chapter" data-level="6.5.8" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-2"><i class="fa fa-check"></i><b>6.5.8</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.9" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-no-pooling"><i class="fa fa-check"></i><b>6.5.9</b> Multilevel memory no pooling</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-full-pooling"><i class="fa fa-check"></i><b>6.6</b> Multilevel full pooling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="model-comparison.html"><a href="model-comparison.html"><i class="fa fa-check"></i><b>7</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.1" data-path="model-comparison.html"><a href="model-comparison.html#generating-the-agents-1"><i class="fa fa-check"></i><b>7.1</b> Generating the agents</a></li>
<li class="chapter" data-level="7.2" data-path="model-comparison.html"><a href="model-comparison.html#prep-the-data"><i class="fa fa-check"></i><b>7.2</b> Prep the data</a></li>
<li class="chapter" data-level="7.3" data-path="model-comparison.html"><a href="model-comparison.html#create-the-models-random-agents"><i class="fa fa-check"></i><b>7.3</b> Create the models: random agents</a></li>
<li class="chapter" data-level="7.4" data-path="model-comparison.html"><a href="model-comparison.html#multilevel-memory-model"><i class="fa fa-check"></i><b>7.4</b> Multilevel memory model</a></li>
<li class="chapter" data-level="7.5" data-path="model-comparison.html"><a href="model-comparison.html#fitting-the-models-to-the-data"><i class="fa fa-check"></i><b>7.5</b> Fitting the models to the data</a></li>
<li class="chapter" data-level="7.6" data-path="model-comparison.html"><a href="model-comparison.html#implementing-cross-validation"><i class="fa fa-check"></i><b>7.6</b> Implementing Cross-Validation</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="model-comparison.html"><a href="model-comparison.html#create-cross-validation-ready-stan-model-for-biased-agents"><i class="fa fa-check"></i><b>7.6.1</b> Create cross-validation ready stan model for biased agents</a></li>
<li class="chapter" data-level="7.6.2" data-path="model-comparison.html"><a href="model-comparison.html#create-cross-validation-ready-stan-model-for-memory-agents"><i class="fa fa-check"></i><b>7.6.2</b> Create cross-validation ready stan model for memory agents</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="model-comparison.html"><a href="model-comparison.html#calculating-elpd-and-comparing"><i class="fa fa-check"></i><b>7.7</b> Calculating elpd and comparing</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">06-ModelComparison</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-comparison" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Model comparison<a href="model-comparison.html#model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>[MISSING INTRO]</p>
<p>[MISSING: SAME CODE AS IN PREVIOUS CHAPTER, SHOULD I CALL IT FROM COMMON SOURCE, OR JUST LOAD THE DATA?]</p>
<p>Generate data</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="model-comparison.html#cb178-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,</span>
<span id="cb178-2"><a href="model-comparison.html#cb178-2" aria-hidden="true" tabindex="-1"></a>               here,</span>
<span id="cb178-3"><a href="model-comparison.html#cb178-3" aria-hidden="true" tabindex="-1"></a>               posterior,</span>
<span id="cb178-4"><a href="model-comparison.html#cb178-4" aria-hidden="true" tabindex="-1"></a>               cmdstanr,</span>
<span id="cb178-5"><a href="model-comparison.html#cb178-5" aria-hidden="true" tabindex="-1"></a>               brms, </span>
<span id="cb178-6"><a href="model-comparison.html#cb178-6" aria-hidden="true" tabindex="-1"></a>               tidybayes, </span>
<span id="cb178-7"><a href="model-comparison.html#cb178-7" aria-hidden="true" tabindex="-1"></a>               loo, job)</span>
<span id="cb178-8"><a href="model-comparison.html#cb178-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-9"><a href="model-comparison.html#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Shared parameters</span></span>
<span id="cb178-10"><a href="model-comparison.html#cb178-10" aria-hidden="true" tabindex="-1"></a>agents <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb178-11"><a href="model-comparison.html#cb178-11" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb178-12"><a href="model-comparison.html#cb178-12" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb178-13"><a href="model-comparison.html#cb178-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-14"><a href="model-comparison.html#cb178-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Biased agents parameters</span></span>
<span id="cb178-15"><a href="model-comparison.html#cb178-15" aria-hidden="true" tabindex="-1"></a>rateM <span class="ot">&lt;-</span> <span class="fl">1.386</span> <span class="co"># roughly 0.8 once inv_logit scaled</span></span>
<span id="cb178-16"><a href="model-comparison.html#cb178-16" aria-hidden="true" tabindex="-1"></a>rateSD <span class="ot">&lt;-</span> <span class="fl">0.65</span> <span class="co"># roughly giving a sd of 0.1 in prob scale</span></span>
<span id="cb178-17"><a href="model-comparison.html#cb178-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-18"><a href="model-comparison.html#cb178-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Memory agents parameters</span></span>
<span id="cb178-19"><a href="model-comparison.html#cb178-19" aria-hidden="true" tabindex="-1"></a>biasM <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb178-20"><a href="model-comparison.html#cb178-20" aria-hidden="true" tabindex="-1"></a>biasSD <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb178-21"><a href="model-comparison.html#cb178-21" aria-hidden="true" tabindex="-1"></a>betaM <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb178-22"><a href="model-comparison.html#cb178-22" aria-hidden="true" tabindex="-1"></a>betaSD <span class="ot">&lt;-</span> <span class="fl">0.3</span></span></code></pre></div>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="model-comparison.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions of the agents</span></span>
<span id="cb179-2"><a href="model-comparison.html#cb179-2" aria-hidden="true" tabindex="-1"></a>RandomAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(rate, noise) {</span>
<span id="cb179-3"><a href="model-comparison.html#cb179-3" aria-hidden="true" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">inv_logit_scaled</span>(rate))</span>
<span id="cb179-4"><a href="model-comparison.html#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb179-5"><a href="model-comparison.html#cb179-5" aria-hidden="true" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb179-6"><a href="model-comparison.html#cb179-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb179-7"><a href="model-comparison.html#cb179-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb179-8"><a href="model-comparison.html#cb179-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb179-9"><a href="model-comparison.html#cb179-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-10"><a href="model-comparison.html#cb179-10" aria-hidden="true" tabindex="-1"></a>MemoryAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(bias, beta, otherRate, noise) {</span>
<span id="cb179-11"><a href="model-comparison.html#cb179-11" aria-hidden="true" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">inv_logit_scaled</span>(bias <span class="sc">+</span> beta <span class="sc">*</span> <span class="fu">logit_scaled</span>(otherRate))</span>
<span id="cb179-12"><a href="model-comparison.html#cb179-12" aria-hidden="true" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, rate)</span>
<span id="cb179-13"><a href="model-comparison.html#cb179-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb179-14"><a href="model-comparison.html#cb179-14" aria-hidden="true" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb179-15"><a href="model-comparison.html#cb179-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb179-16"><a href="model-comparison.html#cb179-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb179-17"><a href="model-comparison.html#cb179-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="generating-the-agents-1" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Generating the agents<a href="model-comparison.html#generating-the-agents-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: PARALLELIZE]</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="model-comparison.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looping through all the agents to generate the data.</span></span>
<span id="cb180-2"><a href="model-comparison.html#cb180-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb180-3"><a href="model-comparison.html#cb180-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a href="model-comparison.html#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (agent <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>agents) {</span>
<span id="cb180-5"><a href="model-comparison.html#cb180-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-6"><a href="model-comparison.html#cb180-6" aria-hidden="true" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, rateM, rateSD)</span>
<span id="cb180-7"><a href="model-comparison.html#cb180-7" aria-hidden="true" tabindex="-1"></a>  bias <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, biasM, biasSD)</span>
<span id="cb180-8"><a href="model-comparison.html#cb180-8" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, betaM, betaSD)</span>
<span id="cb180-9"><a href="model-comparison.html#cb180-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-10"><a href="model-comparison.html#cb180-10" aria-hidden="true" tabindex="-1"></a>  randomChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb180-11"><a href="model-comparison.html#cb180-11" aria-hidden="true" tabindex="-1"></a>  memoryChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb180-12"><a href="model-comparison.html#cb180-12" aria-hidden="true" tabindex="-1"></a>  memoryRate <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb180-13"><a href="model-comparison.html#cb180-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-14"><a href="model-comparison.html#cb180-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (trial <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>trials) {</span>
<span id="cb180-15"><a href="model-comparison.html#cb180-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb180-16"><a href="model-comparison.html#cb180-16" aria-hidden="true" tabindex="-1"></a>    randomChoice[trial] <span class="ot">&lt;-</span> <span class="fu">RandomAgentNoise_f</span>(rate, noise)</span>
<span id="cb180-17"><a href="model-comparison.html#cb180-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trial <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb180-18"><a href="model-comparison.html#cb180-18" aria-hidden="true" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)</span>
<span id="cb180-19"><a href="model-comparison.html#cb180-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb180-20"><a href="model-comparison.html#cb180-20" aria-hidden="true" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">MemoryAgentNoise_f</span>(bias, beta, <span class="fu">mean</span>(randomChoice[<span class="dv">1</span><span class="sc">:</span>trial], <span class="at">na.rm =</span> T), noise)</span>
<span id="cb180-21"><a href="model-comparison.html#cb180-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb180-22"><a href="model-comparison.html#cb180-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb180-23"><a href="model-comparison.html#cb180-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-24"><a href="model-comparison.html#cb180-24" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(agent, <span class="at">trial =</span> <span class="fu">seq</span>(trials), randomChoice, <span class="at">randomRate =</span> rate, memoryChoice, memoryRate, noise, rateM, rateSD, bias, beta, biasM, biasSD, betaM, betaSD)</span>
<span id="cb180-25"><a href="model-comparison.html#cb180-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-26"><a href="model-comparison.html#cb180-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (agent <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb180-27"><a href="model-comparison.html#cb180-27" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d, temp)</span>
<span id="cb180-28"><a href="model-comparison.html#cb180-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb180-29"><a href="model-comparison.html#cb180-29" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> temp</span>
<span id="cb180-30"><a href="model-comparison.html#cb180-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb180-31"><a href="model-comparison.html#cb180-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-32"><a href="model-comparison.html#cb180-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb180-33"><a href="model-comparison.html#cb180-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-34"><a href="model-comparison.html#cb180-34" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(agent) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb180-35"><a href="model-comparison.html#cb180-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomRate =</span> <span class="fu">cumsum</span>(randomChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(randomChoice),</span>
<span id="cb180-36"><a href="model-comparison.html#cb180-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">memoryRate =</span> <span class="fu">cumsum</span>(memoryChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(memoryChoice)</span>
<span id="cb180-37"><a href="model-comparison.html#cb180-37" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="prep-the-data" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Prep the data<a href="model-comparison.html#prep-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="model-comparison.html#cb181-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb181-2"><a href="model-comparison.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb181-3"><a href="model-comparison.html#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb181-4"><a href="model-comparison.html#cb181-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb181-5"><a href="model-comparison.html#cb181-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-6"><a href="model-comparison.html#cb181-6" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb181-7"><a href="model-comparison.html#cb181-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb181-8"><a href="model-comparison.html#cb181-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb181-9"><a href="model-comparison.html#cb181-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb181-10"><a href="model-comparison.html#cb181-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-11"><a href="model-comparison.html#cb181-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data</span></span>
<span id="cb181-12"><a href="model-comparison.html#cb181-12" aria-hidden="true" tabindex="-1"></a>data_biased <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb181-13"><a href="model-comparison.html#cb181-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb181-14"><a href="model-comparison.html#cb181-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb181-15"><a href="model-comparison.html#cb181-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb181-16"><a href="model-comparison.html#cb181-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb181-17"><a href="model-comparison.html#cb181-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb181-18"><a href="model-comparison.html#cb181-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-19"><a href="model-comparison.html#cb181-19" aria-hidden="true" tabindex="-1"></a>data_memory <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb181-20"><a href="model-comparison.html#cb181-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb181-21"><a href="model-comparison.html#cb181-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb181-22"><a href="model-comparison.html#cb181-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb181-23"><a href="model-comparison.html#cb181-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb181-24"><a href="model-comparison.html#cb181-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="create-the-models-random-agents" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Create the models: random agents<a href="model-comparison.html#create-the-models-random-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>N.B. compared to before we also need to include a log-likelihood, to calculate loo for model comparison.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="model-comparison.html#cb182-1" aria-hidden="true" tabindex="-1"></a>stan_biased_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb182-2"><a href="model-comparison.html#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb182-3"><a href="model-comparison.html#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (right and left). Now multilevel</span></span>
<span id="cb182-4"><a href="model-comparison.html#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb182-5"><a href="model-comparison.html#cb182-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-6"><a href="model-comparison.html#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb182-7"><a href="model-comparison.html#cb182-7" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { // normal distribution with a lower bound</span></span>
<span id="cb182-8"><a href="model-comparison.html#cb182-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb182-9"><a href="model-comparison.html#cb182-9" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb182-10"><a href="model-comparison.html#cb182-10" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb182-11"><a href="model-comparison.html#cb182-11" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb182-12"><a href="model-comparison.html#cb182-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb182-13"><a href="model-comparison.html#cb182-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-14"><a href="model-comparison.html#cb182-14" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of hands</span></span>
<span id="cb182-15"><a href="model-comparison.html#cb182-15" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb182-16"><a href="model-comparison.html#cb182-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb182-17"><a href="model-comparison.html#cb182-17" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb182-18"><a href="model-comparison.html#cb182-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb182-19"><a href="model-comparison.html#cb182-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb182-20"><a href="model-comparison.html#cb182-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-21"><a href="model-comparison.html#cb182-21" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb182-22"><a href="model-comparison.html#cb182-22" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb182-23"><a href="model-comparison.html#cb182-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb182-24"><a href="model-comparison.html#cb182-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;</span></span>
<span id="cb182-25"><a href="model-comparison.html#cb182-25" aria-hidden="true" tabindex="-1"></a><span class="st">  array[agents] real theta;</span></span>
<span id="cb182-26"><a href="model-comparison.html#cb182-26" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb182-27"><a href="model-comparison.html#cb182-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-28"><a href="model-comparison.html#cb182-28" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb182-29"><a href="model-comparison.html#cb182-29" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb182-30"><a href="model-comparison.html#cb182-30" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb182-31"><a href="model-comparison.html#cb182-31" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3)  -</span></span>
<span id="cb182-32"><a href="model-comparison.html#cb182-32" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb182-33"><a href="model-comparison.html#cb182-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-34"><a href="model-comparison.html#cb182-34" aria-hidden="true" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb182-35"><a href="model-comparison.html#cb182-35" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb182-36"><a href="model-comparison.html#cb182-36" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb182-37"><a href="model-comparison.html#cb182-37" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb182-38"><a href="model-comparison.html#cb182-38" aria-hidden="true" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb182-39"><a href="model-comparison.html#cb182-39" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb182-40"><a href="model-comparison.html#cb182-40" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb182-41"><a href="model-comparison.html#cb182-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-42"><a href="model-comparison.html#cb182-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-43"><a href="model-comparison.html#cb182-43" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb182-44"><a href="model-comparison.html#cb182-44" aria-hidden="true" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb182-45"><a href="model-comparison.html#cb182-45" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb182-46"><a href="model-comparison.html#cb182-46" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb182-47"><a href="model-comparison.html#cb182-47" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb182-48"><a href="model-comparison.html#cb182-48" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb182-49"><a href="model-comparison.html#cb182-49" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb182-50"><a href="model-comparison.html#cb182-50" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb182-51"><a href="model-comparison.html#cb182-51" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb182-52"><a href="model-comparison.html#cb182-52" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb182-53"><a href="model-comparison.html#cb182-53" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb182-54"><a href="model-comparison.html#cb182-54" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb182-55"><a href="model-comparison.html#cb182-55" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb182-56"><a href="model-comparison.html#cb182-56" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb182-57"><a href="model-comparison.html#cb182-57" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb182-58"><a href="model-comparison.html#cb182-58" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb182-59"><a href="model-comparison.html#cb182-59" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb182-60"><a href="model-comparison.html#cb182-60" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb182-61"><a href="model-comparison.html#cb182-61" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb182-62"><a href="model-comparison.html#cb182-62" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb182-63"><a href="model-comparison.html#cb182-63" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb182-64"><a href="model-comparison.html#cb182-64" aria-hidden="true" tabindex="-1"></a><span class="st">      log_lik[t,i] = bernoulli_logit_lpmf(h[t,i] | theta[i]);</span></span>
<span id="cb182-65"><a href="model-comparison.html#cb182-65" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb182-66"><a href="model-comparison.html#cb182-66" aria-hidden="true" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb182-67"><a href="model-comparison.html#cb182-67" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb182-68"><a href="model-comparison.html#cb182-68" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb182-69"><a href="model-comparison.html#cb182-69" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb182-70"><a href="model-comparison.html#cb182-70" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb182-71"><a href="model-comparison.html#cb182-71" aria-hidden="true" tabindex="-1"></a>  stan_biased_model,</span>
<span id="cb182-72"><a href="model-comparison.html#cb182-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb182-73"><a href="model-comparison.html#cb182-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelBias.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelBias.stan&quot;</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="model-comparison.html#cb184-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelBias.stan&quot;</span>)</span>
<span id="cb184-2"><a href="model-comparison.html#cb184-2" aria-hidden="true" tabindex="-1"></a>mod_biased <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb184-3"><a href="model-comparison.html#cb184-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb184-4"><a href="model-comparison.html#cb184-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
</div>
<div id="multilevel-memory-model" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Multilevel memory model<a href="model-comparison.html#multilevel-memory-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="model-comparison.html#cb186-1" aria-hidden="true" tabindex="-1"></a>stan_memory_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb186-2"><a href="model-comparison.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb186-3"><a href="model-comparison.html#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (heads and tails)</span></span>
<span id="cb186-4"><a href="model-comparison.html#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb186-5"><a href="model-comparison.html#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb186-6"><a href="model-comparison.html#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb186-7"><a href="model-comparison.html#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb186-8"><a href="model-comparison.html#cb186-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb186-9"><a href="model-comparison.html#cb186-9" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb186-10"><a href="model-comparison.html#cb186-10" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb186-11"><a href="model-comparison.html#cb186-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-12"><a href="model-comparison.html#cb186-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-13"><a href="model-comparison.html#cb186-13" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb186-14"><a href="model-comparison.html#cb186-14" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb186-15"><a href="model-comparison.html#cb186-15" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb186-16"><a href="model-comparison.html#cb186-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb186-17"><a href="model-comparison.html#cb186-17" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb186-18"><a href="model-comparison.html#cb186-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb186-19"><a href="model-comparison.html#cb186-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-20"><a href="model-comparison.html#cb186-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-21"><a href="model-comparison.html#cb186-21" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb186-22"><a href="model-comparison.html#cb186-22" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb186-23"><a href="model-comparison.html#cb186-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb186-24"><a href="model-comparison.html#cb186-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb186-25"><a href="model-comparison.html#cb186-25" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb186-26"><a href="model-comparison.html#cb186-26" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb186-27"><a href="model-comparison.html#cb186-27" aria-hidden="true" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb186-28"><a href="model-comparison.html#cb186-28" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-29"><a href="model-comparison.html#cb186-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-30"><a href="model-comparison.html#cb186-30" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb186-31"><a href="model-comparison.html#cb186-31" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb186-32"><a href="model-comparison.html#cb186-32" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb186-33"><a href="model-comparison.html#cb186-33" aria-hidden="true" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb186-34"><a href="model-comparison.html#cb186-34" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb186-35"><a href="model-comparison.html#cb186-35" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb186-36"><a href="model-comparison.html#cb186-36" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb186-37"><a href="model-comparison.html#cb186-37" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb186-38"><a href="model-comparison.html#cb186-38" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb186-39"><a href="model-comparison.html#cb186-39" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb186-40"><a href="model-comparison.html#cb186-40" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb186-41"><a href="model-comparison.html#cb186-41" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb186-42"><a href="model-comparison.html#cb186-42" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb186-43"><a href="model-comparison.html#cb186-43" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb186-44"><a href="model-comparison.html#cb186-44" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb186-45"><a href="model-comparison.html#cb186-45" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb186-46"><a href="model-comparison.html#cb186-46" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb186-47"><a href="model-comparison.html#cb186-47" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-48"><a href="model-comparison.html#cb186-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-49"><a href="model-comparison.html#cb186-49" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb186-50"><a href="model-comparison.html#cb186-50" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb186-51"><a href="model-comparison.html#cb186-51" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb186-52"><a href="model-comparison.html#cb186-52" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb186-53"><a href="model-comparison.html#cb186-53" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb186-54"><a href="model-comparison.html#cb186-54" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb186-55"><a href="model-comparison.html#cb186-55" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb186-56"><a href="model-comparison.html#cb186-56" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb186-57"><a href="model-comparison.html#cb186-57" aria-hidden="true" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb186-58"><a href="model-comparison.html#cb186-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-59"><a href="model-comparison.html#cb186-59" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb186-60"><a href="model-comparison.html#cb186-60" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb186-61"><a href="model-comparison.html#cb186-61" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb186-62"><a href="model-comparison.html#cb186-62" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | biasM + IDs[agent, 1] +  memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb186-63"><a href="model-comparison.html#cb186-63" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb186-64"><a href="model-comparison.html#cb186-64" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb186-65"><a href="model-comparison.html#cb186-65" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb186-66"><a href="model-comparison.html#cb186-66" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-67"><a href="model-comparison.html#cb186-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-68"><a href="model-comparison.html#cb186-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-69"><a href="model-comparison.html#cb186-69" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb186-70"><a href="model-comparison.html#cb186-70" aria-hidden="true" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb186-71"><a href="model-comparison.html#cb186-71" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb186-72"><a href="model-comparison.html#cb186-72" aria-hidden="true" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb186-73"><a href="model-comparison.html#cb186-73" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb186-74"><a href="model-comparison.html#cb186-74" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-75"><a href="model-comparison.html#cb186-75" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb186-76"><a href="model-comparison.html#cb186-76" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb186-77"><a href="model-comparison.html#cb186-77" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-78"><a href="model-comparison.html#cb186-78" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb186-79"><a href="model-comparison.html#cb186-79" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb186-80"><a href="model-comparison.html#cb186-80" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb186-81"><a href="model-comparison.html#cb186-81" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb186-82"><a href="model-comparison.html#cb186-82" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb186-83"><a href="model-comparison.html#cb186-83" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb186-84"><a href="model-comparison.html#cb186-84" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-85"><a href="model-comparison.html#cb186-85" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb186-86"><a href="model-comparison.html#cb186-86" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-87"><a href="model-comparison.html#cb186-87" aria-hidden="true" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb186-88"><a href="model-comparison.html#cb186-88" aria-hidden="true" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb186-89"><a href="model-comparison.html#cb186-89" aria-hidden="true" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb186-90"><a href="model-comparison.html#cb186-90" aria-hidden="true" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb186-91"><a href="model-comparison.html#cb186-91" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-92"><a href="model-comparison.html#cb186-92" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb186-93"><a href="model-comparison.html#cb186-93" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb186-94"><a href="model-comparison.html#cb186-94" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-95"><a href="model-comparison.html#cb186-95" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb186-96"><a href="model-comparison.html#cb186-96" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb186-97"><a href="model-comparison.html#cb186-97" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb186-98"><a href="model-comparison.html#cb186-98" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb186-99"><a href="model-comparison.html#cb186-99" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  0 * (betaM + IDs[i,2])));</span></span>
<span id="cb186-100"><a href="model-comparison.html#cb186-100" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  1 * (betaM + IDs[i,2])));</span></span>
<span id="cb186-101"><a href="model-comparison.html#cb186-101" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  2 * (betaM + IDs[i,2])));</span></span>
<span id="cb186-102"><a href="model-comparison.html#cb186-102" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb186-103"><a href="model-comparison.html#cb186-103" aria-hidden="true" tabindex="-1"></a><span class="st">      for (t in 1:trials){</span></span>
<span id="cb186-104"><a href="model-comparison.html#cb186-104" aria-hidden="true" tabindex="-1"></a><span class="st">        log_lik[t,i] = bernoulli_logit_lpmf(h[t, i] | biasM + IDs[i, 1] +  memory[t, i] * (betaM + IDs[i, 2]));</span></span>
<span id="cb186-105"><a href="model-comparison.html#cb186-105" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb186-106"><a href="model-comparison.html#cb186-106" aria-hidden="true" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb186-107"><a href="model-comparison.html#cb186-107" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb186-108"><a href="model-comparison.html#cb186-108" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-109"><a href="model-comparison.html#cb186-109" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb186-110"><a href="model-comparison.html#cb186-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-111"><a href="model-comparison.html#cb186-111" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb186-112"><a href="model-comparison.html#cb186-112" aria-hidden="true" tabindex="-1"></a>  stan_memory_model,</span>
<span id="cb186-113"><a href="model-comparison.html#cb186-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb186-114"><a href="model-comparison.html#cb186-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelMemory.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelMemory.stan&quot;</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="model-comparison.html#cb188-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelMemory.stan&quot;</span>)</span>
<span id="cb188-2"><a href="model-comparison.html#cb188-2" aria-hidden="true" tabindex="-1"></a>mod_memory <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb188-3"><a href="model-comparison.html#cb188-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
</div>
<div id="fitting-the-models-to-the-data" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Fitting the models to the data<a href="model-comparison.html#fitting-the-models-to-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="model-comparison.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting biased agent model to biased agent data</span></span>
<span id="cb190-2"><a href="model-comparison.html#cb190-2" aria-hidden="true" tabindex="-1"></a>fit_biased2biased <span class="ot">&lt;-</span> mod_biased<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb190-3"><a href="model-comparison.html#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_biased,</span>
<span id="cb190-4"><a href="model-comparison.html#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb190-5"><a href="model-comparison.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb190-6"><a href="model-comparison.html#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb190-7"><a href="model-comparison.html#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb190-8"><a href="model-comparison.html#cb190-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb190-9"><a href="model-comparison.html#cb190-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb190-10"><a href="model-comparison.html#cb190-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb190-11"><a href="model-comparison.html#cb190-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb190-12"><a href="model-comparison.html#cb190-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb190-13"><a href="model-comparison.html#cb190-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb190-14"><a href="model-comparison.html#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fit_biased2biased, data_biased, </span>
<span id="cb190-15"><a href="model-comparison.html#cb190-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_biased2biased.RData&quot;</span>) </span>
<span id="cb190-16"><a href="model-comparison.html#cb190-16" aria-hidden="true" tabindex="-1"></a>fit_biased2biased<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_biased2biased.RDS&quot;</span>)</span>
<span id="cb190-17"><a href="model-comparison.html#cb190-17" aria-hidden="true" tabindex="-1"></a>fit_biased2biased<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W6_fit_biased2biased&quot;</span>)</span>
<span id="cb190-18"><a href="model-comparison.html#cb190-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-19"><a href="model-comparison.html#cb190-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-20"><a href="model-comparison.html#cb190-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-21"><a href="model-comparison.html#cb190-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting biased agent model to memory agent data</span></span>
<span id="cb190-22"><a href="model-comparison.html#cb190-22" aria-hidden="true" tabindex="-1"></a>fit_biased2memory <span class="ot">&lt;-</span> mod_biased<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb190-23"><a href="model-comparison.html#cb190-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_memory,</span>
<span id="cb190-24"><a href="model-comparison.html#cb190-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb190-25"><a href="model-comparison.html#cb190-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb190-26"><a href="model-comparison.html#cb190-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb190-27"><a href="model-comparison.html#cb190-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb190-28"><a href="model-comparison.html#cb190-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb190-29"><a href="model-comparison.html#cb190-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb190-30"><a href="model-comparison.html#cb190-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb190-31"><a href="model-comparison.html#cb190-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb190-32"><a href="model-comparison.html#cb190-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb190-33"><a href="model-comparison.html#cb190-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb190-34"><a href="model-comparison.html#cb190-34" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fit_biased2memory, data_memory, </span>
<span id="cb190-35"><a href="model-comparison.html#cb190-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_biased2memory.RData&quot;</span>) </span>
<span id="cb190-36"><a href="model-comparison.html#cb190-36" aria-hidden="true" tabindex="-1"></a>fit_biased2memory<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_biased2memory.RDS&quot;</span>)</span>
<span id="cb190-37"><a href="model-comparison.html#cb190-37" aria-hidden="true" tabindex="-1"></a>fit_biased2memory<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W6_fit_biased2memory&quot;</span>)</span>
<span id="cb190-38"><a href="model-comparison.html#cb190-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-39"><a href="model-comparison.html#cb190-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-40"><a href="model-comparison.html#cb190-40" aria-hidden="true" tabindex="-1"></a>fit_memory2biased <span class="ot">&lt;-</span> mod_memory<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb190-41"><a href="model-comparison.html#cb190-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_biased,</span>
<span id="cb190-42"><a href="model-comparison.html#cb190-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb190-43"><a href="model-comparison.html#cb190-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb190-44"><a href="model-comparison.html#cb190-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb190-45"><a href="model-comparison.html#cb190-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb190-46"><a href="model-comparison.html#cb190-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb190-47"><a href="model-comparison.html#cb190-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb190-48"><a href="model-comparison.html#cb190-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb190-49"><a href="model-comparison.html#cb190-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb190-50"><a href="model-comparison.html#cb190-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb190-51"><a href="model-comparison.html#cb190-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb190-52"><a href="model-comparison.html#cb190-52" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fit_memory2biased, data_biased, </span>
<span id="cb190-53"><a href="model-comparison.html#cb190-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_memory2biased.RData&quot;</span>) </span>
<span id="cb190-54"><a href="model-comparison.html#cb190-54" aria-hidden="true" tabindex="-1"></a>fit_memory2biased<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_memory2biased.RDS&quot;</span>)</span>
<span id="cb190-55"><a href="model-comparison.html#cb190-55" aria-hidden="true" tabindex="-1"></a>fit_memory2biased<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W6_fit_memory2biased&quot;</span>)</span>
<span id="cb190-56"><a href="model-comparison.html#cb190-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-57"><a href="model-comparison.html#cb190-57" aria-hidden="true" tabindex="-1"></a>fit_memory2memory <span class="ot">&lt;-</span> mod_memory<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb190-58"><a href="model-comparison.html#cb190-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_memory,</span>
<span id="cb190-59"><a href="model-comparison.html#cb190-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb190-60"><a href="model-comparison.html#cb190-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb190-61"><a href="model-comparison.html#cb190-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb190-62"><a href="model-comparison.html#cb190-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb190-63"><a href="model-comparison.html#cb190-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb190-64"><a href="model-comparison.html#cb190-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb190-65"><a href="model-comparison.html#cb190-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb190-66"><a href="model-comparison.html#cb190-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb190-67"><a href="model-comparison.html#cb190-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb190-68"><a href="model-comparison.html#cb190-68" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb190-69"><a href="model-comparison.html#cb190-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-70"><a href="model-comparison.html#cb190-70" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fit_memory2memory, data_memory, </span>
<span id="cb190-71"><a href="model-comparison.html#cb190-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_memory2memory.RData&quot;</span>) </span>
<span id="cb190-72"><a href="model-comparison.html#cb190-72" aria-hidden="true" tabindex="-1"></a>fit_memory2memory<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_memory2memory.RDS&quot;</span>)</span>
<span id="cb190-73"><a href="model-comparison.html#cb190-73" aria-hidden="true" tabindex="-1"></a>fit_memory2memory<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W6_fit_memory2memory&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="model-comparison.html#cb191-1" aria-hidden="true" tabindex="-1"></a>fit_biased2biased <span class="ot">&lt;-</span> <span class="fu">as_cmdstan_fit</span>(<span class="st">&quot;simmodels/W6_fit_biased2biased-202303141000-1-75c13f.csv&quot;</span>)</span>
<span id="cb191-2"><a href="model-comparison.html#cb191-2" aria-hidden="true" tabindex="-1"></a>Loo_biased2biased <span class="ot">&lt;-</span> fit_biased2biased<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb191-3"><a href="model-comparison.html#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Loo_biased2biased)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="model-comparison.html#cb192-1" aria-hidden="true" tabindex="-1"></a>fit_biased2memory <span class="ot">&lt;-</span> <span class="fu">as_cmdstan_fit</span>(<span class="st">&quot;simmodels/W6_fit_biased2memory-202303141001-1-513269.csv&quot;</span>)</span>
<span id="cb192-2"><a href="model-comparison.html#cb192-2" aria-hidden="true" tabindex="-1"></a>Loo_biased2memory <span class="ot">&lt;-</span> fit_biased2memory<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb192-3"><a href="model-comparison.html#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Loo_biased2memory)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-29-2.png" width="672" /></p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="model-comparison.html#cb193-1" aria-hidden="true" tabindex="-1"></a>fit_memory2biased <span class="ot">&lt;-</span> <span class="fu">as_cmdstan_fit</span>(<span class="st">&quot;simmodels/W6_fit_memory2biased-202303141022-1-778c49.csv&quot;</span>)</span>
<span id="cb193-2"><a href="model-comparison.html#cb193-2" aria-hidden="true" tabindex="-1"></a>Loo_memory2biased <span class="ot">&lt;-</span> fit_memory2biased<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb193-3"><a href="model-comparison.html#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Loo_memory2biased)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-29-3.png" width="672" /></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="model-comparison.html#cb194-1" aria-hidden="true" tabindex="-1"></a>fit_memory2memory <span class="ot">&lt;-</span> <span class="fu">as_cmdstan_fit</span>(<span class="st">&quot;simmodels/W6_fit_memory2memory-202303141150-1-35a401.csv&quot;</span>)</span>
<span id="cb194-2"><a href="model-comparison.html#cb194-2" aria-hidden="true" tabindex="-1"></a>Loo_memory2memory <span class="ot">&lt;-</span> fit_memory2memory<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb194-3"><a href="model-comparison.html#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Loo_memory2memory)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-29-4.png" width="672" /></p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="model-comparison.html#cb195-1" aria-hidden="true" tabindex="-1"></a>elpd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb195-2"><a href="model-comparison.html#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">biased_diff_elpd =</span> </span>
<span id="cb195-3"><a href="model-comparison.html#cb195-3" aria-hidden="true" tabindex="-1"></a>  Loo_biased2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>] <span class="sc">-</span> </span>
<span id="cb195-4"><a href="model-comparison.html#cb195-4" aria-hidden="true" tabindex="-1"></a>  Loo_memory2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>],</span>
<span id="cb195-5"><a href="model-comparison.html#cb195-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">memory_diff_elpd =</span> </span>
<span id="cb195-6"><a href="model-comparison.html#cb195-6" aria-hidden="true" tabindex="-1"></a>  Loo_memory2memory<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>] <span class="sc">-</span></span>
<span id="cb195-7"><a href="model-comparison.html#cb195-7" aria-hidden="true" tabindex="-1"></a>  Loo_biased2memory<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>])</span>
<span id="cb195-8"><a href="model-comparison.html#cb195-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-9"><a href="model-comparison.html#cb195-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elpd, <span class="fu">aes</span>(<span class="at">x =</span> rate, <span class="at">y =</span> biased_diff_elpd)) <span class="sc">+</span></span>
<span id="cb195-10"><a href="model-comparison.html#cb195-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb195-11"><a href="model-comparison.html#cb195-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#xlim(.5,1.01) +</span></span>
<span id="cb195-12"><a href="model-comparison.html#cb195-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ylim(-1.5,1.5) +</span></span>
<span id="cb195-13"><a href="model-comparison.html#cb195-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb195-14"><a href="model-comparison.html#cb195-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb195-15"><a href="model-comparison.html#cb195-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-16"><a href="model-comparison.html#cb195-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elpd, <span class="fu">aes</span>(<span class="at">x =</span> rate, <span class="at">y =</span> memory_diff_elpd)) <span class="sc">+</span></span>
<span id="cb195-17"><a href="model-comparison.html#cb195-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb195-18"><a href="model-comparison.html#cb195-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#xlim(.5,1.01) +</span></span>
<span id="cb195-19"><a href="model-comparison.html#cb195-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ylim(-1.5,1.5) +</span></span>
<span id="cb195-20"><a href="model-comparison.html#cb195-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb195-21"><a href="model-comparison.html#cb195-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb195-22"><a href="model-comparison.html#cb195-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-23"><a href="model-comparison.html#cb195-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb195-24"><a href="model-comparison.html#cb195-24" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-29-5.png" width="672" /></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="model-comparison.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(Loo_biased2biased, Loo_memory2biased)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1  0.0       0.0   
## model2 -2.7       0.5</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="model-comparison.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(Loo_biased2memory, Loo_memory2memory)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model2    0.0       0.0 
## model1 -115.9      11.5</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="model-comparison.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_model_weights</span>(<span class="fu">list</span>(Loo_biased2biased, Loo_memory2biased))</span></code></pre></div>
<pre><code>## Method: stacking
## ------
##        weight
## model1 1.000 
## model2 0.000</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="model-comparison.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_model_weights</span>(<span class="fu">list</span>(Loo_biased2memory, Loo_memory2memory))</span></code></pre></div>
<pre><code>## Method: stacking
## ------
##        weight
## model1 0.000 
## model2 1.000</code></pre>
</div>
<div id="implementing-cross-validation" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Implementing Cross-Validation<a href="model-comparison.html#implementing-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: STAN CODE WITH THE TEST]
[MISSING: VERSION W TRANSFORMED DATA]</p>
<div id="create-cross-validation-ready-stan-model-for-biased-agents" class="section level3 hasAnchor" number="7.6.1">
<h3><span class="header-section-number">7.6.1</span> Create cross-validation ready stan model for biased agents<a href="model-comparison.html#create-cross-validation-ready-stan-model-for-biased-agents" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>N.B. compared to before we also need to include specifics for test data</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="model-comparison.html#cb204-1" aria-hidden="true" tabindex="-1"></a>stan_biased_cv_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb204-2"><a href="model-comparison.html#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb204-3"><a href="model-comparison.html#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (right and left). Now multilevel</span></span>
<span id="cb204-4"><a href="model-comparison.html#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb204-5"><a href="model-comparison.html#cb204-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-6"><a href="model-comparison.html#cb204-6" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb204-7"><a href="model-comparison.html#cb204-7" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { // normal distribution with a lower bound</span></span>
<span id="cb204-8"><a href="model-comparison.html#cb204-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb204-9"><a href="model-comparison.html#cb204-9" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb204-10"><a href="model-comparison.html#cb204-10" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb204-11"><a href="model-comparison.html#cb204-11" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb204-12"><a href="model-comparison.html#cb204-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb204-13"><a href="model-comparison.html#cb204-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-14"><a href="model-comparison.html#cb204-14" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of hands</span></span>
<span id="cb204-15"><a href="model-comparison.html#cb204-15" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb204-16"><a href="model-comparison.html#cb204-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb204-17"><a href="model-comparison.html#cb204-17" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb204-18"><a href="model-comparison.html#cb204-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb204-19"><a href="model-comparison.html#cb204-19" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb204-20"><a href="model-comparison.html#cb204-20" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents_test;</span></span>
<span id="cb204-21"><a href="model-comparison.html#cb204-21" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents_test] int h_test;</span></span>
<span id="cb204-22"><a href="model-comparison.html#cb204-22" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb204-23"><a href="model-comparison.html#cb204-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-24"><a href="model-comparison.html#cb204-24" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb204-25"><a href="model-comparison.html#cb204-25" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb204-26"><a href="model-comparison.html#cb204-26" aria-hidden="true" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb204-27"><a href="model-comparison.html#cb204-27" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;</span></span>
<span id="cb204-28"><a href="model-comparison.html#cb204-28" aria-hidden="true" tabindex="-1"></a><span class="st">  array[agents] real theta;</span></span>
<span id="cb204-29"><a href="model-comparison.html#cb204-29" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb204-30"><a href="model-comparison.html#cb204-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-31"><a href="model-comparison.html#cb204-31" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb204-32"><a href="model-comparison.html#cb204-32" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb204-33"><a href="model-comparison.html#cb204-33" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb204-34"><a href="model-comparison.html#cb204-34" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3)  -</span></span>
<span id="cb204-35"><a href="model-comparison.html#cb204-35" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb204-36"><a href="model-comparison.html#cb204-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-37"><a href="model-comparison.html#cb204-37" aria-hidden="true" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb204-38"><a href="model-comparison.html#cb204-38" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb204-39"><a href="model-comparison.html#cb204-39" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb204-40"><a href="model-comparison.html#cb204-40" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb204-41"><a href="model-comparison.html#cb204-41" aria-hidden="true" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb204-42"><a href="model-comparison.html#cb204-42" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb204-43"><a href="model-comparison.html#cb204-43" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb204-44"><a href="model-comparison.html#cb204-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-45"><a href="model-comparison.html#cb204-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-46"><a href="model-comparison.html#cb204-46" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb204-47"><a href="model-comparison.html#cb204-47" aria-hidden="true" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb204-48"><a href="model-comparison.html#cb204-48" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb204-49"><a href="model-comparison.html#cb204-49" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb204-50"><a href="model-comparison.html#cb204-50" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb204-51"><a href="model-comparison.html#cb204-51" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb204-52"><a href="model-comparison.html#cb204-52" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb204-53"><a href="model-comparison.html#cb204-53" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb204-54"><a href="model-comparison.html#cb204-54" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb204-55"><a href="model-comparison.html#cb204-55" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb204-56"><a href="model-comparison.html#cb204-56" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents_test] real log_lik_test;</span></span>
<span id="cb204-57"><a href="model-comparison.html#cb204-57" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb204-58"><a href="model-comparison.html#cb204-58" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb204-59"><a href="model-comparison.html#cb204-59" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb204-60"><a href="model-comparison.html#cb204-60" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb204-61"><a href="model-comparison.html#cb204-61" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb204-62"><a href="model-comparison.html#cb204-62" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb204-63"><a href="model-comparison.html#cb204-63" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb204-64"><a href="model-comparison.html#cb204-64" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb204-65"><a href="model-comparison.html#cb204-65" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb204-66"><a href="model-comparison.html#cb204-66" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb204-67"><a href="model-comparison.html#cb204-67" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb204-68"><a href="model-comparison.html#cb204-68" aria-hidden="true" tabindex="-1"></a><span class="st">      log_lik[t,i] = bernoulli_logit_lpmf(h[t,i] | theta[i]);</span></span>
<span id="cb204-69"><a href="model-comparison.html#cb204-69" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb204-70"><a href="model-comparison.html#cb204-70" aria-hidden="true" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb204-71"><a href="model-comparison.html#cb204-71" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb204-72"><a href="model-comparison.html#cb204-72" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents_test){</span></span>
<span id="cb204-73"><a href="model-comparison.html#cb204-73" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb204-74"><a href="model-comparison.html#cb204-74" aria-hidden="true" tabindex="-1"></a><span class="st">      log_lik_test[t,i] = bernoulli_lpmf(h_test[t,i] | theta_posterior);</span></span>
<span id="cb204-75"><a href="model-comparison.html#cb204-75" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb204-76"><a href="model-comparison.html#cb204-76" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb204-77"><a href="model-comparison.html#cb204-77" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb204-78"><a href="model-comparison.html#cb204-78" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb204-79"><a href="model-comparison.html#cb204-79" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb204-80"><a href="model-comparison.html#cb204-80" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb204-81"><a href="model-comparison.html#cb204-81" aria-hidden="true" tabindex="-1"></a>  stan_biased_cv_model,</span>
<span id="cb204-82"><a href="model-comparison.html#cb204-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb204-83"><a href="model-comparison.html#cb204-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelBias_cv.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelBias_cv.stan&quot;</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="model-comparison.html#cb206-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelBias_cv.stan&quot;</span>)</span>
<span id="cb206-2"><a href="model-comparison.html#cb206-2" aria-hidden="true" tabindex="-1"></a>mod_biased_cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb206-3"><a href="model-comparison.html#cb206-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb206-4"><a href="model-comparison.html#cb206-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
</div>
<div id="create-cross-validation-ready-stan-model-for-memory-agents" class="section level3 hasAnchor" number="7.6.2">
<h3><span class="header-section-number">7.6.2</span> Create cross-validation ready stan model for memory agents<a href="model-comparison.html#create-cross-validation-ready-stan-model-for-memory-agents" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="model-comparison.html#cb208-1" aria-hidden="true" tabindex="-1"></a>stan_memory_cv_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb208-2"><a href="model-comparison.html#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb208-3"><a href="model-comparison.html#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (heads and tails)</span></span>
<span id="cb208-4"><a href="model-comparison.html#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb208-5"><a href="model-comparison.html#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb208-6"><a href="model-comparison.html#cb208-6" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb208-7"><a href="model-comparison.html#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb208-8"><a href="model-comparison.html#cb208-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb208-9"><a href="model-comparison.html#cb208-9" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb208-10"><a href="model-comparison.html#cb208-10" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb208-11"><a href="model-comparison.html#cb208-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-12"><a href="model-comparison.html#cb208-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-13"><a href="model-comparison.html#cb208-13" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb208-14"><a href="model-comparison.html#cb208-14" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb208-15"><a href="model-comparison.html#cb208-15" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb208-16"><a href="model-comparison.html#cb208-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb208-17"><a href="model-comparison.html#cb208-17" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb208-18"><a href="model-comparison.html#cb208-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb208-19"><a href="model-comparison.html#cb208-19" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb208-20"><a href="model-comparison.html#cb208-20" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents_test;</span></span>
<span id="cb208-21"><a href="model-comparison.html#cb208-21" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents_test] int h_test;</span></span>
<span id="cb208-22"><a href="model-comparison.html#cb208-22" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents_test] int other_test;</span></span>
<span id="cb208-23"><a href="model-comparison.html#cb208-23" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-24"><a href="model-comparison.html#cb208-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-25"><a href="model-comparison.html#cb208-25" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb208-26"><a href="model-comparison.html#cb208-26" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb208-27"><a href="model-comparison.html#cb208-27" aria-hidden="true" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb208-28"><a href="model-comparison.html#cb208-28" aria-hidden="true" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb208-29"><a href="model-comparison.html#cb208-29" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb208-30"><a href="model-comparison.html#cb208-30" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb208-31"><a href="model-comparison.html#cb208-31" aria-hidden="true" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb208-32"><a href="model-comparison.html#cb208-32" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-33"><a href="model-comparison.html#cb208-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-34"><a href="model-comparison.html#cb208-34" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb208-35"><a href="model-comparison.html#cb208-35" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb208-36"><a href="model-comparison.html#cb208-36" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents_test] real memory_test;</span></span>
<span id="cb208-37"><a href="model-comparison.html#cb208-37" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb208-38"><a href="model-comparison.html#cb208-38" aria-hidden="true" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb208-39"><a href="model-comparison.html#cb208-39" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb208-40"><a href="model-comparison.html#cb208-40" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb208-41"><a href="model-comparison.html#cb208-41" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb208-42"><a href="model-comparison.html#cb208-42" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb208-43"><a href="model-comparison.html#cb208-43" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb208-44"><a href="model-comparison.html#cb208-44" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb208-45"><a href="model-comparison.html#cb208-45" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb208-46"><a href="model-comparison.html#cb208-46" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb208-47"><a href="model-comparison.html#cb208-47" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb208-48"><a href="model-comparison.html#cb208-48" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb208-49"><a href="model-comparison.html#cb208-49" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb208-50"><a href="model-comparison.html#cb208-50" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb208-51"><a href="model-comparison.html#cb208-51" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb208-52"><a href="model-comparison.html#cb208-52" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb208-53"><a href="model-comparison.html#cb208-53" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents_test){</span></span>
<span id="cb208-54"><a href="model-comparison.html#cb208-54" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb208-55"><a href="model-comparison.html#cb208-55" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb208-56"><a href="model-comparison.html#cb208-56" aria-hidden="true" tabindex="-1"></a><span class="st">        memory_test[trial, agent] = 0.5;</span></span>
<span id="cb208-57"><a href="model-comparison.html#cb208-57" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb208-58"><a href="model-comparison.html#cb208-58" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb208-59"><a href="model-comparison.html#cb208-59" aria-hidden="true" tabindex="-1"></a><span class="st">        memory_test[trial + 1, agent] = memory_test[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb208-60"><a href="model-comparison.html#cb208-60" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory_test[trial + 1, agent] == 0){memory_test[trial + 1, agent] = 0.01;}</span></span>
<span id="cb208-61"><a href="model-comparison.html#cb208-61" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory_test[trial + 1, agent] == 1){memory_test[trial + 1, agent] = 0.99;}</span></span>
<span id="cb208-62"><a href="model-comparison.html#cb208-62" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb208-63"><a href="model-comparison.html#cb208-63" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb208-64"><a href="model-comparison.html#cb208-64" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb208-65"><a href="model-comparison.html#cb208-65" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb208-66"><a href="model-comparison.html#cb208-66" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-67"><a href="model-comparison.html#cb208-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-68"><a href="model-comparison.html#cb208-68" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb208-69"><a href="model-comparison.html#cb208-69" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb208-70"><a href="model-comparison.html#cb208-70" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb208-71"><a href="model-comparison.html#cb208-71" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb208-72"><a href="model-comparison.html#cb208-72" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb208-73"><a href="model-comparison.html#cb208-73" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb208-74"><a href="model-comparison.html#cb208-74" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb208-75"><a href="model-comparison.html#cb208-75" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb208-76"><a href="model-comparison.html#cb208-76" aria-hidden="true" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb208-77"><a href="model-comparison.html#cb208-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-78"><a href="model-comparison.html#cb208-78" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb208-79"><a href="model-comparison.html#cb208-79" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb208-80"><a href="model-comparison.html#cb208-80" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb208-81"><a href="model-comparison.html#cb208-81" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | biasM + IDs[agent, 1] +  memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb208-82"><a href="model-comparison.html#cb208-82" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb208-83"><a href="model-comparison.html#cb208-83" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb208-84"><a href="model-comparison.html#cb208-84" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb208-85"><a href="model-comparison.html#cb208-85" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-86"><a href="model-comparison.html#cb208-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-87"><a href="model-comparison.html#cb208-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-88"><a href="model-comparison.html#cb208-88" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb208-89"><a href="model-comparison.html#cb208-89" aria-hidden="true" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb208-90"><a href="model-comparison.html#cb208-90" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb208-91"><a href="model-comparison.html#cb208-91" aria-hidden="true" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb208-92"><a href="model-comparison.html#cb208-92" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb208-93"><a href="model-comparison.html#cb208-93" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-94"><a href="model-comparison.html#cb208-94" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb208-95"><a href="model-comparison.html#cb208-95" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb208-96"><a href="model-comparison.html#cb208-96" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-97"><a href="model-comparison.html#cb208-97" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb208-98"><a href="model-comparison.html#cb208-98" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb208-99"><a href="model-comparison.html#cb208-99" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb208-100"><a href="model-comparison.html#cb208-100" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb208-101"><a href="model-comparison.html#cb208-101" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb208-102"><a href="model-comparison.html#cb208-102" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb208-103"><a href="model-comparison.html#cb208-103" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-104"><a href="model-comparison.html#cb208-104" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb208-105"><a href="model-comparison.html#cb208-105" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents_test] real log_lik_test;</span></span>
<span id="cb208-106"><a href="model-comparison.html#cb208-106" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-107"><a href="model-comparison.html#cb208-107" aria-hidden="true" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb208-108"><a href="model-comparison.html#cb208-108" aria-hidden="true" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb208-109"><a href="model-comparison.html#cb208-109" aria-hidden="true" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb208-110"><a href="model-comparison.html#cb208-110" aria-hidden="true" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb208-111"><a href="model-comparison.html#cb208-111" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-112"><a href="model-comparison.html#cb208-112" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb208-113"><a href="model-comparison.html#cb208-113" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb208-114"><a href="model-comparison.html#cb208-114" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-115"><a href="model-comparison.html#cb208-115" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb208-116"><a href="model-comparison.html#cb208-116" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb208-117"><a href="model-comparison.html#cb208-117" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb208-118"><a href="model-comparison.html#cb208-118" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb208-119"><a href="model-comparison.html#cb208-119" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  0 * (betaM + IDs[i,2])));</span></span>
<span id="cb208-120"><a href="model-comparison.html#cb208-120" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  1 * (betaM + IDs[i,2])));</span></span>
<span id="cb208-121"><a href="model-comparison.html#cb208-121" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  2 * (betaM + IDs[i,2])));</span></span>
<span id="cb208-122"><a href="model-comparison.html#cb208-122" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb208-123"><a href="model-comparison.html#cb208-123" aria-hidden="true" tabindex="-1"></a><span class="st">      for (t in 1:trials){</span></span>
<span id="cb208-124"><a href="model-comparison.html#cb208-124" aria-hidden="true" tabindex="-1"></a><span class="st">        log_lik[t,i] = bernoulli_logit_lpmf(h[t, i] | biasM + IDs[i, 1] +  memory[t, i] * (betaM + IDs[i, 2]));</span></span>
<span id="cb208-125"><a href="model-comparison.html#cb208-125" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb208-126"><a href="model-comparison.html#cb208-126" aria-hidden="true" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb208-127"><a href="model-comparison.html#cb208-127" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-128"><a href="model-comparison.html#cb208-128" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents_test){</span></span>
<span id="cb208-129"><a href="model-comparison.html#cb208-129" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb208-130"><a href="model-comparison.html#cb208-130" aria-hidden="true" tabindex="-1"></a><span class="st">      log_lik_test[t,i] = bernoulli_logit_lpmf(h_test[t,i] | biasM +  memory_test[t, i] * betaM);</span></span>
<span id="cb208-131"><a href="model-comparison.html#cb208-131" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb208-132"><a href="model-comparison.html#cb208-132" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb208-133"><a href="model-comparison.html#cb208-133" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb208-134"><a href="model-comparison.html#cb208-134" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-135"><a href="model-comparison.html#cb208-135" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb208-136"><a href="model-comparison.html#cb208-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-137"><a href="model-comparison.html#cb208-137" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb208-138"><a href="model-comparison.html#cb208-138" aria-hidden="true" tabindex="-1"></a>  stan_memory_cv_model,</span>
<span id="cb208-139"><a href="model-comparison.html#cb208-139" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb208-140"><a href="model-comparison.html#cb208-140" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelMemory_cv.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelMemory_cv.stan&quot;</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="model-comparison.html#cb210-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelMemory_cv.stan&quot;</span>)</span>
<span id="cb210-2"><a href="model-comparison.html#cb210-2" aria-hidden="true" tabindex="-1"></a>mod_memory_cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb210-3"><a href="model-comparison.html#cb210-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
<p>[MISSING: PARALLELIZE]</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="model-comparison.html#cb212-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>fold <span class="ot">&lt;-</span> <span class="fu">kfold_split_grouped</span>(<span class="at">K =</span> <span class="dv">10</span>, <span class="at">x =</span> d<span class="sc">$</span>agent)</span>
<span id="cb212-2"><a href="model-comparison.html#cb212-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3"><a href="model-comparison.html#cb212-3" aria-hidden="true" tabindex="-1"></a>log_pd_biased_kfold <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1000</span>, <span class="at">ncol =</span> <span class="dv">12000</span>)</span>
<span id="cb212-4"><a href="model-comparison.html#cb212-4" aria-hidden="true" tabindex="-1"></a>log_pd_memory_kfold <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1000</span>, <span class="at">ncol =</span> <span class="dv">12000</span>)</span>
<span id="cb212-5"><a href="model-comparison.html#cb212-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-6"><a href="model-comparison.html#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">unique</span>(d<span class="sc">$</span>fold)) { </span>
<span id="cb212-7"><a href="model-comparison.html#cb212-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-8"><a href="model-comparison.html#cb212-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Training set for k </span></span>
<span id="cb212-9"><a href="model-comparison.html#cb212-9" aria-hidden="true" tabindex="-1"></a>  d_train <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fold <span class="sc">!=</span> k)  </span>
<span id="cb212-10"><a href="model-comparison.html#cb212-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-11"><a href="model-comparison.html#cb212-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Create the data</span></span>
<span id="cb212-12"><a href="model-comparison.html#cb212-12" aria-hidden="true" tabindex="-1"></a>  d_memory1_train <span class="ot">&lt;-</span> d_train <span class="sc">%&gt;%</span> </span>
<span id="cb212-13"><a href="model-comparison.html#cb212-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb212-14"><a href="model-comparison.html#cb212-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb212-15"><a href="model-comparison.html#cb212-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb212-16"><a href="model-comparison.html#cb212-16" aria-hidden="true" tabindex="-1"></a>  d_memory2_train <span class="ot">&lt;-</span> d_train <span class="sc">%&gt;%</span> </span>
<span id="cb212-17"><a href="model-comparison.html#cb212-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb212-18"><a href="model-comparison.html#cb212-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb212-19"><a href="model-comparison.html#cb212-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb212-20"><a href="model-comparison.html#cb212-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-21"><a href="model-comparison.html#cb212-21" aria-hidden="true" tabindex="-1"></a>  agents_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d_train<span class="sc">$</span>agent))</span>
<span id="cb212-22"><a href="model-comparison.html#cb212-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-23"><a href="model-comparison.html#cb212-23" aria-hidden="true" tabindex="-1"></a>  d_test <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb212-24"><a href="model-comparison.html#cb212-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fold <span class="sc">==</span> k) </span>
<span id="cb212-25"><a href="model-comparison.html#cb212-25" aria-hidden="true" tabindex="-1"></a>  d_memory1_test <span class="ot">&lt;-</span> d_test <span class="sc">%&gt;%</span> </span>
<span id="cb212-26"><a href="model-comparison.html#cb212-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb212-27"><a href="model-comparison.html#cb212-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb212-28"><a href="model-comparison.html#cb212-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb212-29"><a href="model-comparison.html#cb212-29" aria-hidden="true" tabindex="-1"></a>  d_memory2_test <span class="ot">&lt;-</span> d_test <span class="sc">%&gt;%</span> </span>
<span id="cb212-30"><a href="model-comparison.html#cb212-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb212-31"><a href="model-comparison.html#cb212-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb212-32"><a href="model-comparison.html#cb212-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb212-33"><a href="model-comparison.html#cb212-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-34"><a href="model-comparison.html#cb212-34" aria-hidden="true" tabindex="-1"></a>  agents_test_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d_test<span class="sc">$</span>agent))</span>
<span id="cb212-35"><a href="model-comparison.html#cb212-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-36"><a href="model-comparison.html#cb212-36" aria-hidden="true" tabindex="-1"></a>  data_memory <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb212-37"><a href="model-comparison.html#cb212-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">trials =</span> trials,</span>
<span id="cb212-38"><a href="model-comparison.html#cb212-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">agents =</span>  agents_n,</span>
<span id="cb212-39"><a href="model-comparison.html#cb212-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">agents_test =</span> agents_test_n,</span>
<span id="cb212-40"><a href="model-comparison.html#cb212-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">h =</span> <span class="fu">as.matrix</span>(d_memory1_train[,<span class="dv">2</span><span class="sc">:</span>(agents_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb212-41"><a href="model-comparison.html#cb212-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">other =</span> <span class="fu">as.matrix</span>(d_memory2_train[,<span class="dv">2</span><span class="sc">:</span>(agents_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb212-42"><a href="model-comparison.html#cb212-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb212-43"><a href="model-comparison.html#cb212-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">h_test =</span> <span class="fu">as.matrix</span>(d_memory1_test[,<span class="dv">2</span><span class="sc">:</span>(agents_test_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb212-44"><a href="model-comparison.html#cb212-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_test =</span> <span class="fu">as.matrix</span>(d_memory2_test[,<span class="dv">2</span><span class="sc">:</span>(agents_test_n <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="cb212-45"><a href="model-comparison.html#cb212-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-46"><a href="model-comparison.html#cb212-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train the models </span></span>
<span id="cb212-47"><a href="model-comparison.html#cb212-47" aria-hidden="true" tabindex="-1"></a>  fit_random <span class="ot">&lt;-</span> mod_biased_cv<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb212-48"><a href="model-comparison.html#cb212-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_memory,</span>
<span id="cb212-49"><a href="model-comparison.html#cb212-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb212-50"><a href="model-comparison.html#cb212-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb212-51"><a href="model-comparison.html#cb212-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb212-52"><a href="model-comparison.html#cb212-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb212-53"><a href="model-comparison.html#cb212-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb212-54"><a href="model-comparison.html#cb212-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb212-55"><a href="model-comparison.html#cb212-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb212-56"><a href="model-comparison.html#cb212-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb212-57"><a href="model-comparison.html#cb212-57" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb212-58"><a href="model-comparison.html#cb212-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-59"><a href="model-comparison.html#cb212-59" aria-hidden="true" tabindex="-1"></a>  fit_memory <span class="ot">&lt;-</span> mod_memory_cv<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb212-60"><a href="model-comparison.html#cb212-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_memory,</span>
<span id="cb212-61"><a href="model-comparison.html#cb212-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb212-62"><a href="model-comparison.html#cb212-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb212-63"><a href="model-comparison.html#cb212-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb212-64"><a href="model-comparison.html#cb212-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb212-65"><a href="model-comparison.html#cb212-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb212-66"><a href="model-comparison.html#cb212-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb212-67"><a href="model-comparison.html#cb212-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb212-68"><a href="model-comparison.html#cb212-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb212-69"><a href="model-comparison.html#cb212-69" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb212-70"><a href="model-comparison.html#cb212-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb212-71"><a href="model-comparison.html#cb212-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract log likelihood which represents </span></span>
<span id="cb212-72"><a href="model-comparison.html#cb212-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the pointwise predictive density. </span></span>
<span id="cb212-73"><a href="model-comparison.html#cb212-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n.b. the matrix has 1000 row, and 12000 columns. </span></span>
<span id="cb212-74"><a href="model-comparison.html#cb212-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># d$fold==k yields 12000 logical values, of which 1200 TRUEs, identifying 1200 columns</span></span>
<span id="cb212-75"><a href="model-comparison.html#cb212-75" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the fit blabla yields 1000 obs (samples) and 1190 variables instead of 1200</span></span>
<span id="cb212-76"><a href="model-comparison.html#cb212-76" aria-hidden="true" tabindex="-1"></a>  log_pd_biased_kfold[, d<span class="sc">$</span>fold <span class="sc">==</span> k] <span class="ot">&lt;-</span> fit_random<span class="sc">$</span><span class="fu">draws</span>(<span class="st">&quot;log_lik_test&quot;</span>, <span class="at">format =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb212-77"><a href="model-comparison.html#cb212-77" aria-hidden="true" tabindex="-1"></a>  log_pd_memory_kfold[, d<span class="sc">$</span>fold <span class="sc">==</span> k] <span class="ot">&lt;-</span> fit_memory<span class="sc">$</span><span class="fu">draws</span>(<span class="st">&quot;log_lik_test&quot;</span>, <span class="at">format =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb212-78"><a href="model-comparison.html#cb212-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-79"><a href="model-comparison.html#cb212-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-80"><a href="model-comparison.html#cb212-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-81"><a href="model-comparison.html#cb212-81" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(log_pd_biased_kfold, log_pd_memory_kfold, <span class="at">file =</span> <span class="st">&quot;simmodels/W6_CV_Biased&amp;Memory.RData&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="calculating-elpd-and-comparing" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> Calculating elpd and comparing<a href="model-comparison.html#calculating-elpd-and-comparing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="model-comparison.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;simmodels/W6_CV_Biased&amp;Memory.RData&quot;</span>) </span>
<span id="cb213-2"><a href="model-comparison.html#cb213-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-3"><a href="model-comparison.html#cb213-3" aria-hidden="true" tabindex="-1"></a>elpd_biased_kfold <span class="ot">&lt;-</span> <span class="fu">elpd</span>(log_pd_biased_kfold)</span>
<span id="cb213-4"><a href="model-comparison.html#cb213-4" aria-hidden="true" tabindex="-1"></a>elpd_memory_kfold <span class="ot">&lt;-</span> <span class="fu">elpd</span>(log_pd_memory_kfold)</span>
<span id="cb213-5"><a href="model-comparison.html#cb213-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-6"><a href="model-comparison.html#cb213-6" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(elpd_biased_kfold, elpd_memory_kfold)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1    0.0       0.0 
## model2 -437.3      23.9</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="model-comparison.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co">#loo_model_weights(elpd_biased_kfold, elpd_memory_kfold)</span></span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="multilevel-modeling.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/06-ModelComparison.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
