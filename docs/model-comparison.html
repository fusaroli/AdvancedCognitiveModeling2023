<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Model comparison | 09-BayesianModels</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Model comparison | 09-BayesianModels" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Model comparison | 09-BayesianModels" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2023" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2023-03-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="multilevel-modeling.html"/>
<link rel="next" href="bonus-chapter-win-stay-lose-shift.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-goal-of-the-course"><i class="fa fa-check"></i><b>1.1</b> The goal of the course</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#list-of-lectures-and-practical-exercises"><i class="fa fa-check"></i><b>1.2</b> List of lectures and practical exercises</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preparation-before-the-course"><i class="fa fa-check"></i><b>1.3</b> Preparation before the course</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><i class="fa fa-check"></i><b>2</b> Practical exercise 1 - Building verbal models of the matching pennies game</a>
<ul>
<li class="chapter" data-level="2.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#trying-out-the-game-and-collecting-your-own-data"><i class="fa fa-check"></i><b>2.1</b> Trying out the game and collecting your own data</a></li>
<li class="chapter" data-level="2.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#start-theorizing"><i class="fa fa-check"></i><b>2.2</b> Start Theorizing</a></li>
<li class="chapter" data-level="2.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>2.3</b> The distinction between participant and researcher perspectives</a></li>
<li class="chapter" data-level="2.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#strategies"><i class="fa fa-check"></i><b>2.4</b> Strategies</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#random-strategies"><i class="fa fa-check"></i><b>2.4.1</b> Random strategies</a></li>
<li class="chapter" data-level="2.4.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#immediate-reaction"><i class="fa fa-check"></i><b>2.4.2</b> Immediate reaction</a></li>
<li class="chapter" data-level="2.4.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>2.4.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="2.4.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>2.4.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="2.4.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#reinforcement-learning"><i class="fa fa-check"></i><b>2.4.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="2.4.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#k-tom"><i class="fa fa-check"></i><b>2.4.6</b> k-ToM</a></li>
<li class="chapter" data-level="2.4.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#other-possible-strategies"><i class="fa fa-check"></i><b>2.4.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#cognitive-constraints"><i class="fa fa-check"></i><b>2.5</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#memory"><i class="fa fa-check"></i><b>2.5.1</b> Memory</a></li>
<li class="chapter" data-level="2.5.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#errors"><i class="fa fa-check"></i><b>2.5.2</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#continuity-between-models"><i class="fa fa-check"></i><b>2.6</b> Continuity between models</a></li>
<li class="chapter" data-level="2.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#mixture-of-strategies"><i class="fa fa-check"></i><b>2.7</b> Mixture of strategies</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html"><i class="fa fa-check"></i><b>3</b> Practical exercise 2 - From verbal to formal models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>3.1</b> Defining general conditions</a></li>
<li class="chapter" data-level="3.2" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>3.2</b> Implementing a random agent</a></li>
<li class="chapter" data-level="3.3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>3.3</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="3.4" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>3.4</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>3.4.1</b> And we visualize it</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html"><i class="fa fa-check"></i><b>4</b> Practical exercise 3 - Getting into Stan</a>
<ul>
<li class="chapter" data-level="4.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#simulating-data"><i class="fa fa-check"></i><b>4.2</b> Simulating data</a></li>
<li class="chapter" data-level="4.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#building-our-basic-model-in-stan"><i class="fa fa-check"></i><b>4.3</b> Building our basic model in Stan</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#data"><i class="fa fa-check"></i><b>4.3.1</b> Data</a></li>
<li class="chapter" data-level="4.3.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#model"><i class="fa fa-check"></i><b>4.3.2</b> Model</a></li>
<li class="chapter" data-level="4.3.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#compiling-and-fitting-the-model"><i class="fa fa-check"></i><b>4.3.3</b> Compiling and fitting the model</a></li>
<li class="chapter" data-level="4.3.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-model"><i class="fa fa-check"></i><b>4.3.4</b> Summarizing the model</a></li>
<li class="chapter" data-level="4.3.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#assessing-model-quality"><i class="fa fa-check"></i><b>4.3.5</b> Assessing model quality</a></li>
<li class="chapter" data-level="4.3.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-results"><i class="fa fa-check"></i><b>4.3.6</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#parameter-recovery"><i class="fa fa-check"></i><b>4.4</b> Parameter recovery</a></li>
<li class="chapter" data-level="4.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#the-memory-model-conditioning-theta"><i class="fa fa-check"></i><b>4.5</b> The memory model: conditioning theta</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-results-1"><i class="fa fa-check"></i><b>4.5.1</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#memory-agent-with-internal-parameter"><i class="fa fa-check"></i><b>4.6</b> Memory agent with internal parameter</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#trying-out-a-more-complex-memory-model-with-a-rate-of-forgetting-that-exponentially-discounts-the-past"><i class="fa fa-check"></i><b>4.6.1</b> Trying out a more complex memory model, with a rate of forgetting that exponentially discounts the past</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html"><i class="fa fa-check"></i><b>5</b> Practical exercise 4 - Model quality checks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#generating-and-plotting-additional-variables"><i class="fa fa-check"></i><b>5.1</b> Generating and plotting additional variables</a></li>
<li class="chapter" data-level="5.2" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-priors"><i class="fa fa-check"></i><b>5.2</b> Assessing priors</a></li>
<li class="chapter" data-level="5.3" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-prior-and-posterior-predictions"><i class="fa fa-check"></i><b>5.3</b> Assessing prior and posterior predictions</a></li>
<li class="chapter" data-level="5.4" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>5.4</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="5.5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#the-memory-model"><i class="fa fa-check"></i><b>5.5</b> The memory model</a></li>
<li class="chapter" data-level="5.6" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-check-for-the-memory-model"><i class="fa fa-check"></i><b>5.6</b> Prior sensitivity check for the memory model</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html"><i class="fa fa-check"></i><b>6</b> Multilevel modeling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#intro-to-multilevel-modeling"><i class="fa fa-check"></i><b>6.1</b> Intro to multilevel modeling</a></li>
<li class="chapter" data-level="6.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#a-multilevel-version-of-the-biased-agent-and-of-the-simple-memory-agent"><i class="fa fa-check"></i><b>6.2</b> A multilevel version of the biased agent and of the simple memory agent</a></li>
<li class="chapter" data-level="6.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#generating-the-agents"><i class="fa fa-check"></i><b>6.3</b> Generating the agents</a></li>
<li class="chapter" data-level="6.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#plotting-the-agents"><i class="fa fa-check"></i><b>6.4</b> Plotting the agents</a></li>
<li class="chapter" data-level="6.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#coding-the-multilevel-agents"><i class="fa fa-check"></i><b>6.5</b> Coding the multilevel agents</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-random"><i class="fa fa-check"></i><b>6.5.1</b> Multilevel random</a></li>
<li class="chapter" data-level="6.5.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-random-agents"><i class="fa fa-check"></i><b>6.5.2</b> Assessing multilevel random agents</a></li>
<li class="chapter" data-level="6.5.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory"><i class="fa fa-check"></i><b>6.5.3</b> Multilevel memory</a></li>
<li class="chapter" data-level="6.5.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory"><i class="fa fa-check"></i><b>6.5.4</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization"><i class="fa fa-check"></i><b>6.5.5</b> Multilevel memory with non centered parameterization</a></li>
<li class="chapter" data-level="6.5.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-1"><i class="fa fa-check"></i><b>6.5.6</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.7" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters"><i class="fa fa-check"></i><b>6.5.7</b> Multilevel memory with correlation between parameters</a></li>
<li class="chapter" data-level="6.5.8" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-2"><i class="fa fa-check"></i><b>6.5.8</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.9" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-no-pooling"><i class="fa fa-check"></i><b>6.5.9</b> Multilevel memory no pooling</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-full-pooling"><i class="fa fa-check"></i><b>6.6</b> Multilevel full pooling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="model-comparison.html"><a href="model-comparison.html"><i class="fa fa-check"></i><b>7</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.1" data-path="model-comparison.html"><a href="model-comparison.html#define-parameters"><i class="fa fa-check"></i><b>7.1</b> Define parameters</a></li>
<li class="chapter" data-level="7.2" data-path="model-comparison.html"><a href="model-comparison.html#generating-the-agents-1"><i class="fa fa-check"></i><b>7.2</b> Generating the agents</a></li>
<li class="chapter" data-level="7.3" data-path="model-comparison.html"><a href="model-comparison.html#prep-the-data"><i class="fa fa-check"></i><b>7.3</b> Prep the data</a></li>
<li class="chapter" data-level="7.4" data-path="model-comparison.html"><a href="model-comparison.html#create-the-models-random-agents"><i class="fa fa-check"></i><b>7.4</b> Create the models: random agents</a></li>
<li class="chapter" data-level="7.5" data-path="model-comparison.html"><a href="model-comparison.html#multilevel-memory-model"><i class="fa fa-check"></i><b>7.5</b> Multilevel memory model</a></li>
<li class="chapter" data-level="7.6" data-path="model-comparison.html"><a href="model-comparison.html#fitting-the-models-to-the-data"><i class="fa fa-check"></i><b>7.6</b> Fitting the models to the data</a></li>
<li class="chapter" data-level="7.7" data-path="model-comparison.html"><a href="model-comparison.html#implementing-cross-validation"><i class="fa fa-check"></i><b>7.7</b> Implementing Cross-Validation</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="model-comparison.html"><a href="model-comparison.html#create-cross-validation-ready-stan-model-for-biased-agents"><i class="fa fa-check"></i><b>7.7.1</b> Create cross-validation ready stan model for biased agents</a></li>
<li class="chapter" data-level="7.7.2" data-path="model-comparison.html"><a href="model-comparison.html#create-cross-validation-ready-stan-model-for-memory-agents"><i class="fa fa-check"></i><b>7.7.2</b> Create cross-validation ready stan model for memory agents</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="model-comparison.html"><a href="model-comparison.html#calculating-elpd-and-comparing"><i class="fa fa-check"></i><b>7.8</b> Calculating elpd and comparing</a></li>
<li class="chapter" data-level="7.9" data-path="model-comparison.html"><a href="model-comparison.html#mixture-models"><i class="fa fa-check"></i><b>7.9</b> Mixture models</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="model-comparison.html"><a href="model-comparison.html#load-the-dataset"><i class="fa fa-check"></i><b>7.9.1</b> Load the dataset</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="model-comparison.html"><a href="model-comparison.html#stan-model-mixing-biased-and-noise"><i class="fa fa-check"></i><b>7.10</b> Stan model mixing biased and noise</a></li>
<li class="chapter" data-level="7.11" data-path="model-comparison.html"><a href="model-comparison.html#fitting-and-assessing-the-model"><i class="fa fa-check"></i><b>7.11</b> Fitting and assessing the model</a></li>
<li class="chapter" data-level="7.12" data-path="model-comparison.html"><a href="model-comparison.html#basic-evaluation"><i class="fa fa-check"></i><b>7.12</b> Basic evaluation</a></li>
<li class="chapter" data-level="7.13" data-path="model-comparison.html"><a href="model-comparison.html#multilevel-mixture-model"><i class="fa fa-check"></i><b>7.13</b> Multilevel mixture model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html"><i class="fa fa-check"></i><b>8</b> Bonus chapter: Win-Stay-Lose-Shift</a>
<ul>
<li class="chapter" data-level="8.1" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html#load-packages"><i class="fa fa-check"></i><b>8.1</b> Load packages</a></li>
<li class="chapter" data-level="8.2" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html#generate-data"><i class="fa fa-check"></i><b>8.2</b> Generate data</a></li>
<li class="chapter" data-level="8.3" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html#sanity-check-for-the-data"><i class="fa fa-check"></i><b>8.3</b> Sanity check for the data</a></li>
<li class="chapter" data-level="8.4" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html#more-sanity-check"><i class="fa fa-check"></i><b>8.4</b> More sanity check</a></li>
<li class="chapter" data-level="8.5" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html#create-data-for-single-agent-model"><i class="fa fa-check"></i><b>8.5</b> Create data for single agent model</a></li>
<li class="chapter" data-level="8.6" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html#create-the-model"><i class="fa fa-check"></i><b>8.6</b> Create the model</a></li>
<li class="chapter" data-level="8.7" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html#basic-assessment"><i class="fa fa-check"></i><b>8.7</b> Basic assessment</a></li>
<li class="chapter" data-level="8.8" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html#create-multilevel-data"><i class="fa fa-check"></i><b>8.8</b> Create multilevel data</a></li>
<li class="chapter" data-level="8.9" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html#create-the-model-1"><i class="fa fa-check"></i><b>8.9</b> Create the model</a></li>
<li class="chapter" data-level="8.10" data-path="bonus-chapter-win-stay-lose-shift.html"><a href="bonus-chapter-win-stay-lose-shift.html#quality-checks"><i class="fa fa-check"></i><b>8.10</b> Quality checks</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html"><i class="fa fa-check"></i><b>9</b> Bayesian models of cognition</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#load-the-packages"><i class="fa fa-check"></i><b>9.1</b> Load the packages</a></li>
<li class="chapter" data-level="9.2" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#design-the-model"><i class="fa fa-check"></i><b>9.2</b> Design the model</a></li>
<li class="chapter" data-level="9.3" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#create-the-data"><i class="fa fa-check"></i><b>9.3</b> Create the data</a></li>
<li class="chapter" data-level="9.4" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#visualize"><i class="fa fa-check"></i><b>9.4</b> Visualize</a></li>
<li class="chapter" data-level="9.5" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#data-for-stan"><i class="fa fa-check"></i><b>9.5</b> Data for Stan</a></li>
<li class="chapter" data-level="9.6" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#create-the-stan-model"><i class="fa fa-check"></i><b>9.6</b> Create the Stan Model</a></li>
<li class="chapter" data-level="9.7" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#fitting-the-model"><i class="fa fa-check"></i><b>9.7</b> Fitting the model</a></li>
<li class="chapter" data-level="9.8" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#basic-evaluation-1"><i class="fa fa-check"></i><b>9.8</b> Basic evaluation</a></li>
<li class="chapter" data-level="9.9" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#weighted-bayes"><i class="fa fa-check"></i><b>9.9</b> Weighted Bayes</a></li>
<li class="chapter" data-level="9.10" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#visualize-1"><i class="fa fa-check"></i><b>9.10</b> Visualize</a></li>
<li class="chapter" data-level="9.11" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#build-the-weighted-bayes-stan-model-simple-formula"><i class="fa fa-check"></i><b>9.11</b> Build the Weighted Bayes Stan model (simple formula)</a></li>
<li class="chapter" data-level="9.12" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#model-evaluation"><i class="fa fa-check"></i><b>9.12</b> Model evaluation</a></li>
<li class="chapter" data-level="9.13" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#model-recovery"><i class="fa fa-check"></i><b>9.13</b> Model recovery</a></li>
<li class="chapter" data-level="9.14" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#bonus-build-the-weighted-bayes-stan-model-fancier-formula"><i class="fa fa-check"></i><b>9.14</b> Bonus: Build the Weighted Bayes Stan model (fancier formula)</a></li>
<li class="chapter" data-level="9.15" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#evaluation"><i class="fa fa-check"></i><b>9.15</b> Evaluation</a></li>
<li class="chapter" data-level="9.16" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#bonus-build-a-temporal-bayes-storing-current-belief-as-prior-for-next-turn"><i class="fa fa-check"></i><b>9.16</b> Bonus: Build a temporal Bayes (storing current belief as prior for next turn)</a></li>
<li class="chapter" data-level="9.17" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#evaluate"><i class="fa fa-check"></i><b>9.17</b> Evaluate</a></li>
<li class="chapter" data-level="9.18" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel-version-of-the-simple-bayes-model"><i class="fa fa-check"></i><b>9.18</b> Multilevel version of the simple bayes model</a></li>
<li class="chapter" data-level="9.19" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel-version-of-the-weighted-bayes-model"><i class="fa fa-check"></i><b>9.19</b> Multilevel version of the weighted bayes model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">09-BayesianModels</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-comparison" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Model comparison<a href="model-comparison.html#model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>[MISSING INTRO]</p>
<p>Imagine havi</p>
<p>Model comparison defines a broad range of practices aimed at identifying among a set of models the best model for a given data set. What “best” means is, however, a non-trivial question. Ideally, “best” would mean the model describing the mechanism that actually generated the data. However, as we will see that is a tricky proposition and we analysts tend to rely on proxies such as the model that explains the most variance in the (training) data, or - better - the model that best predicts new (test) data. These proxies can be useful, but we should always remember that predictive performance is not a magical solution. It allows us to combat overfitting to the training sample, but it has two key limitations. 1) it might be overfitting to the training population, that is, to the</p>
<p>In this chapter, we rely on previously generated data: biased agents playing against the memory agents. This provides us with data generated according to two different mechanisms: biased agents and memory agents. We can fit both models separately on each of the two sets of agents, so we can compare the relative performance of the two models: can we identify the true model generating the data (in a setup where truth is known)?</p>
<div id="define-parameters" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Define parameters<a href="model-comparison.html#define-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="model-comparison.html#cb182-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,</span>
<span id="cb182-2"><a href="model-comparison.html#cb182-2" aria-hidden="true" tabindex="-1"></a>               here,</span>
<span id="cb182-3"><a href="model-comparison.html#cb182-3" aria-hidden="true" tabindex="-1"></a>               posterior,</span>
<span id="cb182-4"><a href="model-comparison.html#cb182-4" aria-hidden="true" tabindex="-1"></a>               cmdstanr,</span>
<span id="cb182-5"><a href="model-comparison.html#cb182-5" aria-hidden="true" tabindex="-1"></a>               brms, </span>
<span id="cb182-6"><a href="model-comparison.html#cb182-6" aria-hidden="true" tabindex="-1"></a>               tidybayes, </span>
<span id="cb182-7"><a href="model-comparison.html#cb182-7" aria-hidden="true" tabindex="-1"></a>               loo, job)</span>
<span id="cb182-8"><a href="model-comparison.html#cb182-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-9"><a href="model-comparison.html#cb182-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Shared parameters</span></span>
<span id="cb182-10"><a href="model-comparison.html#cb182-10" aria-hidden="true" tabindex="-1"></a>agents <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb182-11"><a href="model-comparison.html#cb182-11" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb182-12"><a href="model-comparison.html#cb182-12" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb182-13"><a href="model-comparison.html#cb182-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-14"><a href="model-comparison.html#cb182-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Biased agents parameters</span></span>
<span id="cb182-15"><a href="model-comparison.html#cb182-15" aria-hidden="true" tabindex="-1"></a>rateM <span class="ot">&lt;-</span> <span class="fl">1.386</span> <span class="co"># roughly 0.8 once inv_logit scaled</span></span>
<span id="cb182-16"><a href="model-comparison.html#cb182-16" aria-hidden="true" tabindex="-1"></a>rateSD <span class="ot">&lt;-</span> <span class="fl">0.65</span> <span class="co"># roughly giving a sd of 0.1 in prob scale</span></span>
<span id="cb182-17"><a href="model-comparison.html#cb182-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-18"><a href="model-comparison.html#cb182-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Memory agents parameters</span></span>
<span id="cb182-19"><a href="model-comparison.html#cb182-19" aria-hidden="true" tabindex="-1"></a>biasM <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb182-20"><a href="model-comparison.html#cb182-20" aria-hidden="true" tabindex="-1"></a>biasSD <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb182-21"><a href="model-comparison.html#cb182-21" aria-hidden="true" tabindex="-1"></a>betaM <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb182-22"><a href="model-comparison.html#cb182-22" aria-hidden="true" tabindex="-1"></a>betaSD <span class="ot">&lt;-</span> <span class="fl">0.3</span></span></code></pre></div>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="model-comparison.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions of the agents</span></span>
<span id="cb183-2"><a href="model-comparison.html#cb183-2" aria-hidden="true" tabindex="-1"></a>RandomAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(rate, noise) {</span>
<span id="cb183-3"><a href="model-comparison.html#cb183-3" aria-hidden="true" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">inv_logit_scaled</span>(rate))</span>
<span id="cb183-4"><a href="model-comparison.html#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb183-5"><a href="model-comparison.html#cb183-5" aria-hidden="true" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb183-6"><a href="model-comparison.html#cb183-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb183-7"><a href="model-comparison.html#cb183-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb183-8"><a href="model-comparison.html#cb183-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-9"><a href="model-comparison.html#cb183-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-10"><a href="model-comparison.html#cb183-10" aria-hidden="true" tabindex="-1"></a>MemoryAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(bias, beta, otherRate, noise) {</span>
<span id="cb183-11"><a href="model-comparison.html#cb183-11" aria-hidden="true" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">inv_logit_scaled</span>(bias <span class="sc">+</span> beta <span class="sc">*</span> <span class="fu">logit_scaled</span>(otherRate))</span>
<span id="cb183-12"><a href="model-comparison.html#cb183-12" aria-hidden="true" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, rate)</span>
<span id="cb183-13"><a href="model-comparison.html#cb183-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb183-14"><a href="model-comparison.html#cb183-14" aria-hidden="true" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb183-15"><a href="model-comparison.html#cb183-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb183-16"><a href="model-comparison.html#cb183-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb183-17"><a href="model-comparison.html#cb183-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="generating-the-agents-1" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Generating the agents<a href="model-comparison.html#generating-the-agents-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: PARALLELIZE]</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="model-comparison.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looping through all the agents to generate the data.</span></span>
<span id="cb184-2"><a href="model-comparison.html#cb184-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb184-3"><a href="model-comparison.html#cb184-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-4"><a href="model-comparison.html#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (agent <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>agents) {</span>
<span id="cb184-5"><a href="model-comparison.html#cb184-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-6"><a href="model-comparison.html#cb184-6" aria-hidden="true" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, rateM, rateSD)</span>
<span id="cb184-7"><a href="model-comparison.html#cb184-7" aria-hidden="true" tabindex="-1"></a>  bias <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, biasM, biasSD)</span>
<span id="cb184-8"><a href="model-comparison.html#cb184-8" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, betaM, betaSD)</span>
<span id="cb184-9"><a href="model-comparison.html#cb184-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-10"><a href="model-comparison.html#cb184-10" aria-hidden="true" tabindex="-1"></a>  randomChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb184-11"><a href="model-comparison.html#cb184-11" aria-hidden="true" tabindex="-1"></a>  memoryChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb184-12"><a href="model-comparison.html#cb184-12" aria-hidden="true" tabindex="-1"></a>  memoryRate <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb184-13"><a href="model-comparison.html#cb184-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-14"><a href="model-comparison.html#cb184-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (trial <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>trials) {</span>
<span id="cb184-15"><a href="model-comparison.html#cb184-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb184-16"><a href="model-comparison.html#cb184-16" aria-hidden="true" tabindex="-1"></a>    randomChoice[trial] <span class="ot">&lt;-</span> <span class="fu">RandomAgentNoise_f</span>(rate, noise)</span>
<span id="cb184-17"><a href="model-comparison.html#cb184-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trial <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb184-18"><a href="model-comparison.html#cb184-18" aria-hidden="true" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)</span>
<span id="cb184-19"><a href="model-comparison.html#cb184-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb184-20"><a href="model-comparison.html#cb184-20" aria-hidden="true" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">MemoryAgentNoise_f</span>(bias, beta, <span class="fu">mean</span>(randomChoice[<span class="dv">1</span><span class="sc">:</span>trial], <span class="at">na.rm =</span> T), noise)</span>
<span id="cb184-21"><a href="model-comparison.html#cb184-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb184-22"><a href="model-comparison.html#cb184-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb184-23"><a href="model-comparison.html#cb184-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-24"><a href="model-comparison.html#cb184-24" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(agent, <span class="at">trial =</span> <span class="fu">seq</span>(trials), randomChoice, <span class="at">randomRate =</span> rate, memoryChoice, memoryRate, noise, rateM, rateSD, bias, beta, biasM, biasSD, betaM, betaSD)</span>
<span id="cb184-25"><a href="model-comparison.html#cb184-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-26"><a href="model-comparison.html#cb184-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (agent <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb184-27"><a href="model-comparison.html#cb184-27" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d, temp)</span>
<span id="cb184-28"><a href="model-comparison.html#cb184-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb184-29"><a href="model-comparison.html#cb184-29" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> temp</span>
<span id="cb184-30"><a href="model-comparison.html#cb184-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb184-31"><a href="model-comparison.html#cb184-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-32"><a href="model-comparison.html#cb184-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-33"><a href="model-comparison.html#cb184-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-34"><a href="model-comparison.html#cb184-34" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(agent) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb184-35"><a href="model-comparison.html#cb184-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomRate =</span> <span class="fu">cumsum</span>(randomChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(randomChoice),</span>
<span id="cb184-36"><a href="model-comparison.html#cb184-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">memoryRate =</span> <span class="fu">cumsum</span>(memoryChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(memoryChoice)</span>
<span id="cb184-37"><a href="model-comparison.html#cb184-37" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="prep-the-data" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Prep the data<a href="model-comparison.html#prep-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="model-comparison.html#cb185-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb185-2"><a href="model-comparison.html#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb185-3"><a href="model-comparison.html#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb185-4"><a href="model-comparison.html#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb185-5"><a href="model-comparison.html#cb185-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-6"><a href="model-comparison.html#cb185-6" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb185-7"><a href="model-comparison.html#cb185-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb185-8"><a href="model-comparison.html#cb185-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb185-9"><a href="model-comparison.html#cb185-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb185-10"><a href="model-comparison.html#cb185-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-11"><a href="model-comparison.html#cb185-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data</span></span>
<span id="cb185-12"><a href="model-comparison.html#cb185-12" aria-hidden="true" tabindex="-1"></a>data_biased <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb185-13"><a href="model-comparison.html#cb185-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb185-14"><a href="model-comparison.html#cb185-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb185-15"><a href="model-comparison.html#cb185-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb185-16"><a href="model-comparison.html#cb185-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb185-17"><a href="model-comparison.html#cb185-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb185-18"><a href="model-comparison.html#cb185-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-19"><a href="model-comparison.html#cb185-19" aria-hidden="true" tabindex="-1"></a>data_memory <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb185-20"><a href="model-comparison.html#cb185-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb185-21"><a href="model-comparison.html#cb185-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb185-22"><a href="model-comparison.html#cb185-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb185-23"><a href="model-comparison.html#cb185-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb185-24"><a href="model-comparison.html#cb185-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="create-the-models-random-agents" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Create the models: random agents<a href="model-comparison.html#create-the-models-random-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>N.B. compared to before we also need to include a log-likelihood, to calculate loo for model comparison.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="model-comparison.html#cb186-1" aria-hidden="true" tabindex="-1"></a>stan_biased_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb186-2"><a href="model-comparison.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb186-3"><a href="model-comparison.html#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (right and left). Now multilevel</span></span>
<span id="cb186-4"><a href="model-comparison.html#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb186-5"><a href="model-comparison.html#cb186-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-6"><a href="model-comparison.html#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb186-7"><a href="model-comparison.html#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { // normal distribution with a lower bound</span></span>
<span id="cb186-8"><a href="model-comparison.html#cb186-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb186-9"><a href="model-comparison.html#cb186-9" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb186-10"><a href="model-comparison.html#cb186-10" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb186-11"><a href="model-comparison.html#cb186-11" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb186-12"><a href="model-comparison.html#cb186-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-13"><a href="model-comparison.html#cb186-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-14"><a href="model-comparison.html#cb186-14" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of hands</span></span>
<span id="cb186-15"><a href="model-comparison.html#cb186-15" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb186-16"><a href="model-comparison.html#cb186-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb186-17"><a href="model-comparison.html#cb186-17" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb186-18"><a href="model-comparison.html#cb186-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb186-19"><a href="model-comparison.html#cb186-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-20"><a href="model-comparison.html#cb186-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-21"><a href="model-comparison.html#cb186-21" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb186-22"><a href="model-comparison.html#cb186-22" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb186-23"><a href="model-comparison.html#cb186-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb186-24"><a href="model-comparison.html#cb186-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;</span></span>
<span id="cb186-25"><a href="model-comparison.html#cb186-25" aria-hidden="true" tabindex="-1"></a><span class="st">  array[agents] real theta;</span></span>
<span id="cb186-26"><a href="model-comparison.html#cb186-26" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-27"><a href="model-comparison.html#cb186-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-28"><a href="model-comparison.html#cb186-28" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb186-29"><a href="model-comparison.html#cb186-29" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb186-30"><a href="model-comparison.html#cb186-30" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb186-31"><a href="model-comparison.html#cb186-31" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3)  -</span></span>
<span id="cb186-32"><a href="model-comparison.html#cb186-32" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb186-33"><a href="model-comparison.html#cb186-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-34"><a href="model-comparison.html#cb186-34" aria-hidden="true" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb186-35"><a href="model-comparison.html#cb186-35" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb186-36"><a href="model-comparison.html#cb186-36" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb186-37"><a href="model-comparison.html#cb186-37" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb186-38"><a href="model-comparison.html#cb186-38" aria-hidden="true" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb186-39"><a href="model-comparison.html#cb186-39" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb186-40"><a href="model-comparison.html#cb186-40" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-41"><a href="model-comparison.html#cb186-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-42"><a href="model-comparison.html#cb186-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-43"><a href="model-comparison.html#cb186-43" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb186-44"><a href="model-comparison.html#cb186-44" aria-hidden="true" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb186-45"><a href="model-comparison.html#cb186-45" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb186-46"><a href="model-comparison.html#cb186-46" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb186-47"><a href="model-comparison.html#cb186-47" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb186-48"><a href="model-comparison.html#cb186-48" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-49"><a href="model-comparison.html#cb186-49" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb186-50"><a href="model-comparison.html#cb186-50" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb186-51"><a href="model-comparison.html#cb186-51" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-52"><a href="model-comparison.html#cb186-52" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb186-53"><a href="model-comparison.html#cb186-53" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-54"><a href="model-comparison.html#cb186-54" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb186-55"><a href="model-comparison.html#cb186-55" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb186-56"><a href="model-comparison.html#cb186-56" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb186-57"><a href="model-comparison.html#cb186-57" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb186-58"><a href="model-comparison.html#cb186-58" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-59"><a href="model-comparison.html#cb186-59" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb186-60"><a href="model-comparison.html#cb186-60" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb186-61"><a href="model-comparison.html#cb186-61" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb186-62"><a href="model-comparison.html#cb186-62" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb186-63"><a href="model-comparison.html#cb186-63" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb186-64"><a href="model-comparison.html#cb186-64" aria-hidden="true" tabindex="-1"></a><span class="st">      log_lik[t,i] = bernoulli_logit_lpmf(h[t,i] | theta[i]);</span></span>
<span id="cb186-65"><a href="model-comparison.html#cb186-65" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb186-66"><a href="model-comparison.html#cb186-66" aria-hidden="true" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb186-67"><a href="model-comparison.html#cb186-67" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb186-68"><a href="model-comparison.html#cb186-68" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb186-69"><a href="model-comparison.html#cb186-69" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb186-70"><a href="model-comparison.html#cb186-70" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb186-71"><a href="model-comparison.html#cb186-71" aria-hidden="true" tabindex="-1"></a>  stan_biased_model,</span>
<span id="cb186-72"><a href="model-comparison.html#cb186-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb186-73"><a href="model-comparison.html#cb186-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelBias.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelBias.stan&quot;</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="model-comparison.html#cb188-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelBias.stan&quot;</span>)</span>
<span id="cb188-2"><a href="model-comparison.html#cb188-2" aria-hidden="true" tabindex="-1"></a>mod_biased <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb188-3"><a href="model-comparison.html#cb188-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb188-4"><a href="model-comparison.html#cb188-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
</div>
<div id="multilevel-memory-model" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Multilevel memory model<a href="model-comparison.html#multilevel-memory-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="model-comparison.html#cb190-1" aria-hidden="true" tabindex="-1"></a>stan_memory_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb190-2"><a href="model-comparison.html#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb190-3"><a href="model-comparison.html#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (heads and tails)</span></span>
<span id="cb190-4"><a href="model-comparison.html#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb190-5"><a href="model-comparison.html#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb190-6"><a href="model-comparison.html#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb190-7"><a href="model-comparison.html#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb190-8"><a href="model-comparison.html#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb190-9"><a href="model-comparison.html#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb190-10"><a href="model-comparison.html#cb190-10" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb190-11"><a href="model-comparison.html#cb190-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb190-12"><a href="model-comparison.html#cb190-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-13"><a href="model-comparison.html#cb190-13" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb190-14"><a href="model-comparison.html#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb190-15"><a href="model-comparison.html#cb190-15" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb190-16"><a href="model-comparison.html#cb190-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb190-17"><a href="model-comparison.html#cb190-17" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb190-18"><a href="model-comparison.html#cb190-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb190-19"><a href="model-comparison.html#cb190-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb190-20"><a href="model-comparison.html#cb190-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-21"><a href="model-comparison.html#cb190-21" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb190-22"><a href="model-comparison.html#cb190-22" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb190-23"><a href="model-comparison.html#cb190-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb190-24"><a href="model-comparison.html#cb190-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb190-25"><a href="model-comparison.html#cb190-25" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb190-26"><a href="model-comparison.html#cb190-26" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb190-27"><a href="model-comparison.html#cb190-27" aria-hidden="true" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb190-28"><a href="model-comparison.html#cb190-28" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb190-29"><a href="model-comparison.html#cb190-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-30"><a href="model-comparison.html#cb190-30" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb190-31"><a href="model-comparison.html#cb190-31" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb190-32"><a href="model-comparison.html#cb190-32" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb190-33"><a href="model-comparison.html#cb190-33" aria-hidden="true" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb190-34"><a href="model-comparison.html#cb190-34" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb190-35"><a href="model-comparison.html#cb190-35" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb190-36"><a href="model-comparison.html#cb190-36" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb190-37"><a href="model-comparison.html#cb190-37" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb190-38"><a href="model-comparison.html#cb190-38" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb190-39"><a href="model-comparison.html#cb190-39" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb190-40"><a href="model-comparison.html#cb190-40" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb190-41"><a href="model-comparison.html#cb190-41" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb190-42"><a href="model-comparison.html#cb190-42" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb190-43"><a href="model-comparison.html#cb190-43" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb190-44"><a href="model-comparison.html#cb190-44" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb190-45"><a href="model-comparison.html#cb190-45" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb190-46"><a href="model-comparison.html#cb190-46" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb190-47"><a href="model-comparison.html#cb190-47" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb190-48"><a href="model-comparison.html#cb190-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-49"><a href="model-comparison.html#cb190-49" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb190-50"><a href="model-comparison.html#cb190-50" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb190-51"><a href="model-comparison.html#cb190-51" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb190-52"><a href="model-comparison.html#cb190-52" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb190-53"><a href="model-comparison.html#cb190-53" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb190-54"><a href="model-comparison.html#cb190-54" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb190-55"><a href="model-comparison.html#cb190-55" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb190-56"><a href="model-comparison.html#cb190-56" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb190-57"><a href="model-comparison.html#cb190-57" aria-hidden="true" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb190-58"><a href="model-comparison.html#cb190-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-59"><a href="model-comparison.html#cb190-59" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb190-60"><a href="model-comparison.html#cb190-60" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb190-61"><a href="model-comparison.html#cb190-61" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb190-62"><a href="model-comparison.html#cb190-62" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | biasM + IDs[agent, 1] +  memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb190-63"><a href="model-comparison.html#cb190-63" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb190-64"><a href="model-comparison.html#cb190-64" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb190-65"><a href="model-comparison.html#cb190-65" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb190-66"><a href="model-comparison.html#cb190-66" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb190-67"><a href="model-comparison.html#cb190-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-68"><a href="model-comparison.html#cb190-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-69"><a href="model-comparison.html#cb190-69" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb190-70"><a href="model-comparison.html#cb190-70" aria-hidden="true" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb190-71"><a href="model-comparison.html#cb190-71" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb190-72"><a href="model-comparison.html#cb190-72" aria-hidden="true" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb190-73"><a href="model-comparison.html#cb190-73" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb190-74"><a href="model-comparison.html#cb190-74" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb190-75"><a href="model-comparison.html#cb190-75" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb190-76"><a href="model-comparison.html#cb190-76" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb190-77"><a href="model-comparison.html#cb190-77" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb190-78"><a href="model-comparison.html#cb190-78" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb190-79"><a href="model-comparison.html#cb190-79" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb190-80"><a href="model-comparison.html#cb190-80" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb190-81"><a href="model-comparison.html#cb190-81" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb190-82"><a href="model-comparison.html#cb190-82" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb190-83"><a href="model-comparison.html#cb190-83" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb190-84"><a href="model-comparison.html#cb190-84" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb190-85"><a href="model-comparison.html#cb190-85" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb190-86"><a href="model-comparison.html#cb190-86" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb190-87"><a href="model-comparison.html#cb190-87" aria-hidden="true" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb190-88"><a href="model-comparison.html#cb190-88" aria-hidden="true" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb190-89"><a href="model-comparison.html#cb190-89" aria-hidden="true" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb190-90"><a href="model-comparison.html#cb190-90" aria-hidden="true" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb190-91"><a href="model-comparison.html#cb190-91" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb190-92"><a href="model-comparison.html#cb190-92" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb190-93"><a href="model-comparison.html#cb190-93" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb190-94"><a href="model-comparison.html#cb190-94" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb190-95"><a href="model-comparison.html#cb190-95" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb190-96"><a href="model-comparison.html#cb190-96" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb190-97"><a href="model-comparison.html#cb190-97" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb190-98"><a href="model-comparison.html#cb190-98" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb190-99"><a href="model-comparison.html#cb190-99" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  0 * (betaM + IDs[i,2])));</span></span>
<span id="cb190-100"><a href="model-comparison.html#cb190-100" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  1 * (betaM + IDs[i,2])));</span></span>
<span id="cb190-101"><a href="model-comparison.html#cb190-101" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  2 * (betaM + IDs[i,2])));</span></span>
<span id="cb190-102"><a href="model-comparison.html#cb190-102" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb190-103"><a href="model-comparison.html#cb190-103" aria-hidden="true" tabindex="-1"></a><span class="st">      for (t in 1:trials){</span></span>
<span id="cb190-104"><a href="model-comparison.html#cb190-104" aria-hidden="true" tabindex="-1"></a><span class="st">        log_lik[t,i] = bernoulli_logit_lpmf(h[t, i] | biasM + IDs[i, 1] +  memory[t, i] * (betaM + IDs[i, 2]));</span></span>
<span id="cb190-105"><a href="model-comparison.html#cb190-105" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb190-106"><a href="model-comparison.html#cb190-106" aria-hidden="true" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb190-107"><a href="model-comparison.html#cb190-107" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb190-108"><a href="model-comparison.html#cb190-108" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb190-109"><a href="model-comparison.html#cb190-109" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb190-110"><a href="model-comparison.html#cb190-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-111"><a href="model-comparison.html#cb190-111" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb190-112"><a href="model-comparison.html#cb190-112" aria-hidden="true" tabindex="-1"></a>  stan_memory_model,</span>
<span id="cb190-113"><a href="model-comparison.html#cb190-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb190-114"><a href="model-comparison.html#cb190-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelMemory.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelMemory.stan&quot;</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="model-comparison.html#cb192-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelMemory.stan&quot;</span>)</span>
<span id="cb192-2"><a href="model-comparison.html#cb192-2" aria-hidden="true" tabindex="-1"></a>mod_memory <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb192-3"><a href="model-comparison.html#cb192-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
</div>
<div id="fitting-the-models-to-the-data" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Fitting the models to the data<a href="model-comparison.html#fitting-the-models-to-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="model-comparison.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting biased agent model to biased agent data</span></span>
<span id="cb194-2"><a href="model-comparison.html#cb194-2" aria-hidden="true" tabindex="-1"></a>fit_biased2biased <span class="ot">&lt;-</span> mod_biased<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb194-3"><a href="model-comparison.html#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_biased,</span>
<span id="cb194-4"><a href="model-comparison.html#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb194-5"><a href="model-comparison.html#cb194-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb194-6"><a href="model-comparison.html#cb194-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb194-7"><a href="model-comparison.html#cb194-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb194-8"><a href="model-comparison.html#cb194-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb194-9"><a href="model-comparison.html#cb194-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb194-10"><a href="model-comparison.html#cb194-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb194-11"><a href="model-comparison.html#cb194-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb194-12"><a href="model-comparison.html#cb194-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb194-13"><a href="model-comparison.html#cb194-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-14"><a href="model-comparison.html#cb194-14" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fit_biased2biased, data_biased, </span>
<span id="cb194-15"><a href="model-comparison.html#cb194-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_biased2biased.RData&quot;</span>) </span>
<span id="cb194-16"><a href="model-comparison.html#cb194-16" aria-hidden="true" tabindex="-1"></a>fit_biased2biased<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_biased2biased.RDS&quot;</span>)</span>
<span id="cb194-17"><a href="model-comparison.html#cb194-17" aria-hidden="true" tabindex="-1"></a>fit_biased2biased<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W6_fit_biased2biased&quot;</span>)</span>
<span id="cb194-18"><a href="model-comparison.html#cb194-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-19"><a href="model-comparison.html#cb194-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-20"><a href="model-comparison.html#cb194-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-21"><a href="model-comparison.html#cb194-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting biased agent model to memory agent data</span></span>
<span id="cb194-22"><a href="model-comparison.html#cb194-22" aria-hidden="true" tabindex="-1"></a>fit_biased2memory <span class="ot">&lt;-</span> mod_biased<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb194-23"><a href="model-comparison.html#cb194-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_memory,</span>
<span id="cb194-24"><a href="model-comparison.html#cb194-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb194-25"><a href="model-comparison.html#cb194-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb194-26"><a href="model-comparison.html#cb194-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb194-27"><a href="model-comparison.html#cb194-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb194-28"><a href="model-comparison.html#cb194-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb194-29"><a href="model-comparison.html#cb194-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb194-30"><a href="model-comparison.html#cb194-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb194-31"><a href="model-comparison.html#cb194-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb194-32"><a href="model-comparison.html#cb194-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb194-33"><a href="model-comparison.html#cb194-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-34"><a href="model-comparison.html#cb194-34" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fit_biased2memory, data_memory, </span>
<span id="cb194-35"><a href="model-comparison.html#cb194-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_biased2memory.RData&quot;</span>) </span>
<span id="cb194-36"><a href="model-comparison.html#cb194-36" aria-hidden="true" tabindex="-1"></a>fit_biased2memory<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_biased2memory.RDS&quot;</span>)</span>
<span id="cb194-37"><a href="model-comparison.html#cb194-37" aria-hidden="true" tabindex="-1"></a>fit_biased2memory<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W6_fit_biased2memory&quot;</span>)</span>
<span id="cb194-38"><a href="model-comparison.html#cb194-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-39"><a href="model-comparison.html#cb194-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-40"><a href="model-comparison.html#cb194-40" aria-hidden="true" tabindex="-1"></a>fit_memory2biased <span class="ot">&lt;-</span> mod_memory<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb194-41"><a href="model-comparison.html#cb194-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_biased,</span>
<span id="cb194-42"><a href="model-comparison.html#cb194-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb194-43"><a href="model-comparison.html#cb194-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb194-44"><a href="model-comparison.html#cb194-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb194-45"><a href="model-comparison.html#cb194-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb194-46"><a href="model-comparison.html#cb194-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb194-47"><a href="model-comparison.html#cb194-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb194-48"><a href="model-comparison.html#cb194-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb194-49"><a href="model-comparison.html#cb194-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb194-50"><a href="model-comparison.html#cb194-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb194-51"><a href="model-comparison.html#cb194-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-52"><a href="model-comparison.html#cb194-52" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fit_memory2biased, data_biased, </span>
<span id="cb194-53"><a href="model-comparison.html#cb194-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_memory2biased.RData&quot;</span>) </span>
<span id="cb194-54"><a href="model-comparison.html#cb194-54" aria-hidden="true" tabindex="-1"></a>fit_memory2biased<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_memory2biased.RDS&quot;</span>)</span>
<span id="cb194-55"><a href="model-comparison.html#cb194-55" aria-hidden="true" tabindex="-1"></a>fit_memory2biased<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W6_fit_memory2biased&quot;</span>)</span>
<span id="cb194-56"><a href="model-comparison.html#cb194-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-57"><a href="model-comparison.html#cb194-57" aria-hidden="true" tabindex="-1"></a>fit_memory2memory <span class="ot">&lt;-</span> mod_memory<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb194-58"><a href="model-comparison.html#cb194-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_memory,</span>
<span id="cb194-59"><a href="model-comparison.html#cb194-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb194-60"><a href="model-comparison.html#cb194-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb194-61"><a href="model-comparison.html#cb194-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb194-62"><a href="model-comparison.html#cb194-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb194-63"><a href="model-comparison.html#cb194-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb194-64"><a href="model-comparison.html#cb194-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb194-65"><a href="model-comparison.html#cb194-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb194-66"><a href="model-comparison.html#cb194-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb194-67"><a href="model-comparison.html#cb194-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb194-68"><a href="model-comparison.html#cb194-68" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-69"><a href="model-comparison.html#cb194-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-70"><a href="model-comparison.html#cb194-70" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fit_memory2memory, data_memory, </span>
<span id="cb194-71"><a href="model-comparison.html#cb194-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_memory2memory.RData&quot;</span>) </span>
<span id="cb194-72"><a href="model-comparison.html#cb194-72" aria-hidden="true" tabindex="-1"></a>fit_memory2memory<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_memory2memory.RDS&quot;</span>)</span>
<span id="cb194-73"><a href="model-comparison.html#cb194-73" aria-hidden="true" tabindex="-1"></a>fit_memory2memory<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W6_fit_memory2memory&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="model-comparison.html#cb195-1" aria-hidden="true" tabindex="-1"></a>fit_biased2biased <span class="ot">&lt;-</span> <span class="fu">as_cmdstan_fit</span>(<span class="st">&quot;simmodels/W6_fit_biased2biased-202303141000-1-75c13f.csv&quot;</span>)</span>
<span id="cb195-2"><a href="model-comparison.html#cb195-2" aria-hidden="true" tabindex="-1"></a>Loo_biased2biased <span class="ot">&lt;-</span> fit_biased2biased<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb195-3"><a href="model-comparison.html#cb195-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(Loo_biased2biased)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="model-comparison.html#cb196-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> p1 <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">0.4</span>)</span>
<span id="cb196-2"><a href="model-comparison.html#cb196-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-3"><a href="model-comparison.html#cb196-3" aria-hidden="true" tabindex="-1"></a>fit_biased2memory <span class="ot">&lt;-</span> <span class="fu">as_cmdstan_fit</span>(<span class="st">&quot;simmodels/W6_fit_biased2memory-202303141001-1-513269.csv&quot;</span>)</span>
<span id="cb196-4"><a href="model-comparison.html#cb196-4" aria-hidden="true" tabindex="-1"></a>Loo_biased2memory <span class="ot">&lt;-</span> fit_biased2memory<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb196-5"><a href="model-comparison.html#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Loo_biased2memory)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="model-comparison.html#cb197-1" aria-hidden="true" tabindex="-1"></a>fit_memory2biased <span class="ot">&lt;-</span> <span class="fu">as_cmdstan_fit</span>(<span class="st">&quot;simmodels/W6_fit_memory2biased-202303141022-1-778c49.csv&quot;</span>)</span>
<span id="cb197-2"><a href="model-comparison.html#cb197-2" aria-hidden="true" tabindex="-1"></a>Loo_memory2biased <span class="ot">&lt;-</span> fit_memory2biased<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb197-3"><a href="model-comparison.html#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Loo_memory2biased)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-14-3.png" width="672" /></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="model-comparison.html#cb198-1" aria-hidden="true" tabindex="-1"></a>fit_memory2memory <span class="ot">&lt;-</span> <span class="fu">as_cmdstan_fit</span>(<span class="st">&quot;simmodels/W6_fit_memory2memory-202303141150-1-35a401.csv&quot;</span>)</span>
<span id="cb198-2"><a href="model-comparison.html#cb198-2" aria-hidden="true" tabindex="-1"></a>Loo_memory2memory <span class="ot">&lt;-</span> fit_memory2memory<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb198-3"><a href="model-comparison.html#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Loo_memory2memory)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-14-4.png" width="672" /></p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="model-comparison.html#cb199-1" aria-hidden="true" tabindex="-1"></a>elpd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb199-2"><a href="model-comparison.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">seq</span>(<span class="dv">12000</span>),</span>
<span id="cb199-3"><a href="model-comparison.html#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">biased_diff_elpd =</span> </span>
<span id="cb199-4"><a href="model-comparison.html#cb199-4" aria-hidden="true" tabindex="-1"></a>  Loo_biased2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>] <span class="sc">-</span> </span>
<span id="cb199-5"><a href="model-comparison.html#cb199-5" aria-hidden="true" tabindex="-1"></a>  Loo_memory2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>],</span>
<span id="cb199-6"><a href="model-comparison.html#cb199-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">memory_diff_elpd =</span> </span>
<span id="cb199-7"><a href="model-comparison.html#cb199-7" aria-hidden="true" tabindex="-1"></a>  Loo_memory2memory<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>] <span class="sc">-</span></span>
<span id="cb199-8"><a href="model-comparison.html#cb199-8" aria-hidden="true" tabindex="-1"></a>  Loo_biased2memory<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>])</span>
<span id="cb199-9"><a href="model-comparison.html#cb199-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-10"><a href="model-comparison.html#cb199-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elpd, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> biased_diff_elpd)) <span class="sc">+</span></span>
<span id="cb199-11"><a href="model-comparison.html#cb199-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb199-12"><a href="model-comparison.html#cb199-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#xlim(.5,1.01) +</span></span>
<span id="cb199-13"><a href="model-comparison.html#cb199-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ylim(-1.5,1.5) +</span></span>
<span id="cb199-14"><a href="model-comparison.html#cb199-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb199-15"><a href="model-comparison.html#cb199-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb199-16"><a href="model-comparison.html#cb199-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-17"><a href="model-comparison.html#cb199-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elpd, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> memory_diff_elpd)) <span class="sc">+</span></span>
<span id="cb199-18"><a href="model-comparison.html#cb199-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb199-19"><a href="model-comparison.html#cb199-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#xlim(.5,1.01) +</span></span>
<span id="cb199-20"><a href="model-comparison.html#cb199-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ylim(-1.5,1.5) +</span></span>
<span id="cb199-21"><a href="model-comparison.html#cb199-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb199-22"><a href="model-comparison.html#cb199-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb199-23"><a href="model-comparison.html#cb199-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-24"><a href="model-comparison.html#cb199-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb199-25"><a href="model-comparison.html#cb199-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-14-5.png" width="672" /></p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="model-comparison.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(Loo_biased2biased, Loo_memory2biased)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1  0.0       0.0   
## model2 -2.7       0.5</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="model-comparison.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(Loo_biased2memory, Loo_memory2memory)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model2    0.0       0.0 
## model1 -115.9      11.5</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="model-comparison.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_model_weights</span>(<span class="fu">list</span>(Loo_biased2biased, Loo_memory2biased))</span></code></pre></div>
<pre><code>## Method: stacking
## ------
##        weight
## model1 1.000 
## model2 0.000</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="model-comparison.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_model_weights</span>(<span class="fu">list</span>(Loo_biased2memory, Loo_memory2memory))</span></code></pre></div>
<pre><code>## Method: stacking
## ------
##        weight
## model1 0.000 
## model2 1.000</code></pre>
</div>
<div id="implementing-cross-validation" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> Implementing Cross-Validation<a href="model-comparison.html#implementing-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: STAN CODE WITH THE TEST]
[MISSING: VERSION W TRANSFORMED DATA]</p>
<div id="create-cross-validation-ready-stan-model-for-biased-agents" class="section level3 hasAnchor" number="7.7.1">
<h3><span class="header-section-number">7.7.1</span> Create cross-validation ready stan model for biased agents<a href="model-comparison.html#create-cross-validation-ready-stan-model-for-biased-agents" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>N.B. compared to before we also need to include specifics for test data</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="model-comparison.html#cb208-1" aria-hidden="true" tabindex="-1"></a>stan_biased_cv_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb208-2"><a href="model-comparison.html#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb208-3"><a href="model-comparison.html#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (right and left). Now multilevel</span></span>
<span id="cb208-4"><a href="model-comparison.html#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb208-5"><a href="model-comparison.html#cb208-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-6"><a href="model-comparison.html#cb208-6" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb208-7"><a href="model-comparison.html#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { // normal distribution with a lower bound</span></span>
<span id="cb208-8"><a href="model-comparison.html#cb208-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb208-9"><a href="model-comparison.html#cb208-9" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb208-10"><a href="model-comparison.html#cb208-10" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb208-11"><a href="model-comparison.html#cb208-11" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb208-12"><a href="model-comparison.html#cb208-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-13"><a href="model-comparison.html#cb208-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-14"><a href="model-comparison.html#cb208-14" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of hands</span></span>
<span id="cb208-15"><a href="model-comparison.html#cb208-15" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb208-16"><a href="model-comparison.html#cb208-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb208-17"><a href="model-comparison.html#cb208-17" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb208-18"><a href="model-comparison.html#cb208-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb208-19"><a href="model-comparison.html#cb208-19" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb208-20"><a href="model-comparison.html#cb208-20" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents_test;</span></span>
<span id="cb208-21"><a href="model-comparison.html#cb208-21" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents_test] int h_test;</span></span>
<span id="cb208-22"><a href="model-comparison.html#cb208-22" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-23"><a href="model-comparison.html#cb208-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-24"><a href="model-comparison.html#cb208-24" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb208-25"><a href="model-comparison.html#cb208-25" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb208-26"><a href="model-comparison.html#cb208-26" aria-hidden="true" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb208-27"><a href="model-comparison.html#cb208-27" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;</span></span>
<span id="cb208-28"><a href="model-comparison.html#cb208-28" aria-hidden="true" tabindex="-1"></a><span class="st">  array[agents] real theta;</span></span>
<span id="cb208-29"><a href="model-comparison.html#cb208-29" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-30"><a href="model-comparison.html#cb208-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-31"><a href="model-comparison.html#cb208-31" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb208-32"><a href="model-comparison.html#cb208-32" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb208-33"><a href="model-comparison.html#cb208-33" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb208-34"><a href="model-comparison.html#cb208-34" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3)  -</span></span>
<span id="cb208-35"><a href="model-comparison.html#cb208-35" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb208-36"><a href="model-comparison.html#cb208-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-37"><a href="model-comparison.html#cb208-37" aria-hidden="true" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb208-38"><a href="model-comparison.html#cb208-38" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb208-39"><a href="model-comparison.html#cb208-39" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb208-40"><a href="model-comparison.html#cb208-40" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb208-41"><a href="model-comparison.html#cb208-41" aria-hidden="true" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb208-42"><a href="model-comparison.html#cb208-42" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb208-43"><a href="model-comparison.html#cb208-43" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-44"><a href="model-comparison.html#cb208-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-45"><a href="model-comparison.html#cb208-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-46"><a href="model-comparison.html#cb208-46" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb208-47"><a href="model-comparison.html#cb208-47" aria-hidden="true" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb208-48"><a href="model-comparison.html#cb208-48" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb208-49"><a href="model-comparison.html#cb208-49" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb208-50"><a href="model-comparison.html#cb208-50" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb208-51"><a href="model-comparison.html#cb208-51" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-52"><a href="model-comparison.html#cb208-52" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb208-53"><a href="model-comparison.html#cb208-53" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb208-54"><a href="model-comparison.html#cb208-54" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-55"><a href="model-comparison.html#cb208-55" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb208-56"><a href="model-comparison.html#cb208-56" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents_test] real log_lik_test;</span></span>
<span id="cb208-57"><a href="model-comparison.html#cb208-57" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-58"><a href="model-comparison.html#cb208-58" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb208-59"><a href="model-comparison.html#cb208-59" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb208-60"><a href="model-comparison.html#cb208-60" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb208-61"><a href="model-comparison.html#cb208-61" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb208-62"><a href="model-comparison.html#cb208-62" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-63"><a href="model-comparison.html#cb208-63" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb208-64"><a href="model-comparison.html#cb208-64" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb208-65"><a href="model-comparison.html#cb208-65" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-66"><a href="model-comparison.html#cb208-66" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb208-67"><a href="model-comparison.html#cb208-67" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb208-68"><a href="model-comparison.html#cb208-68" aria-hidden="true" tabindex="-1"></a><span class="st">      log_lik[t,i] = bernoulli_logit_lpmf(h[t,i] | theta[i]);</span></span>
<span id="cb208-69"><a href="model-comparison.html#cb208-69" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb208-70"><a href="model-comparison.html#cb208-70" aria-hidden="true" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb208-71"><a href="model-comparison.html#cb208-71" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb208-72"><a href="model-comparison.html#cb208-72" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents_test){</span></span>
<span id="cb208-73"><a href="model-comparison.html#cb208-73" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb208-74"><a href="model-comparison.html#cb208-74" aria-hidden="true" tabindex="-1"></a><span class="st">      log_lik_test[t,i] = bernoulli_lpmf(h_test[t,i] | theta_posterior);</span></span>
<span id="cb208-75"><a href="model-comparison.html#cb208-75" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb208-76"><a href="model-comparison.html#cb208-76" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb208-77"><a href="model-comparison.html#cb208-77" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb208-78"><a href="model-comparison.html#cb208-78" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb208-79"><a href="model-comparison.html#cb208-79" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb208-80"><a href="model-comparison.html#cb208-80" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb208-81"><a href="model-comparison.html#cb208-81" aria-hidden="true" tabindex="-1"></a>  stan_biased_cv_model,</span>
<span id="cb208-82"><a href="model-comparison.html#cb208-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb208-83"><a href="model-comparison.html#cb208-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelBias_cv.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelBias_cv.stan&quot;</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="model-comparison.html#cb210-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelBias_cv.stan&quot;</span>)</span>
<span id="cb210-2"><a href="model-comparison.html#cb210-2" aria-hidden="true" tabindex="-1"></a>mod_biased_cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb210-3"><a href="model-comparison.html#cb210-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb210-4"><a href="model-comparison.html#cb210-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
</div>
<div id="create-cross-validation-ready-stan-model-for-memory-agents" class="section level3 hasAnchor" number="7.7.2">
<h3><span class="header-section-number">7.7.2</span> Create cross-validation ready stan model for memory agents<a href="model-comparison.html#create-cross-validation-ready-stan-model-for-memory-agents" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="model-comparison.html#cb212-1" aria-hidden="true" tabindex="-1"></a>stan_memory_cv_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb212-2"><a href="model-comparison.html#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb212-3"><a href="model-comparison.html#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (heads and tails)</span></span>
<span id="cb212-4"><a href="model-comparison.html#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb212-5"><a href="model-comparison.html#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb212-6"><a href="model-comparison.html#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb212-7"><a href="model-comparison.html#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb212-8"><a href="model-comparison.html#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb212-9"><a href="model-comparison.html#cb212-9" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb212-10"><a href="model-comparison.html#cb212-10" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb212-11"><a href="model-comparison.html#cb212-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb212-12"><a href="model-comparison.html#cb212-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-13"><a href="model-comparison.html#cb212-13" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb212-14"><a href="model-comparison.html#cb212-14" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb212-15"><a href="model-comparison.html#cb212-15" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb212-16"><a href="model-comparison.html#cb212-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb212-17"><a href="model-comparison.html#cb212-17" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb212-18"><a href="model-comparison.html#cb212-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb212-19"><a href="model-comparison.html#cb212-19" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb212-20"><a href="model-comparison.html#cb212-20" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents_test;</span></span>
<span id="cb212-21"><a href="model-comparison.html#cb212-21" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents_test] int h_test;</span></span>
<span id="cb212-22"><a href="model-comparison.html#cb212-22" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents_test] int other_test;</span></span>
<span id="cb212-23"><a href="model-comparison.html#cb212-23" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb212-24"><a href="model-comparison.html#cb212-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-25"><a href="model-comparison.html#cb212-25" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb212-26"><a href="model-comparison.html#cb212-26" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb212-27"><a href="model-comparison.html#cb212-27" aria-hidden="true" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb212-28"><a href="model-comparison.html#cb212-28" aria-hidden="true" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb212-29"><a href="model-comparison.html#cb212-29" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb212-30"><a href="model-comparison.html#cb212-30" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb212-31"><a href="model-comparison.html#cb212-31" aria-hidden="true" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb212-32"><a href="model-comparison.html#cb212-32" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb212-33"><a href="model-comparison.html#cb212-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-34"><a href="model-comparison.html#cb212-34" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb212-35"><a href="model-comparison.html#cb212-35" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb212-36"><a href="model-comparison.html#cb212-36" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents_test] real memory_test;</span></span>
<span id="cb212-37"><a href="model-comparison.html#cb212-37" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb212-38"><a href="model-comparison.html#cb212-38" aria-hidden="true" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb212-39"><a href="model-comparison.html#cb212-39" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb212-40"><a href="model-comparison.html#cb212-40" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb212-41"><a href="model-comparison.html#cb212-41" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb212-42"><a href="model-comparison.html#cb212-42" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb212-43"><a href="model-comparison.html#cb212-43" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb212-44"><a href="model-comparison.html#cb212-44" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb212-45"><a href="model-comparison.html#cb212-45" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb212-46"><a href="model-comparison.html#cb212-46" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb212-47"><a href="model-comparison.html#cb212-47" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb212-48"><a href="model-comparison.html#cb212-48" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb212-49"><a href="model-comparison.html#cb212-49" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb212-50"><a href="model-comparison.html#cb212-50" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb212-51"><a href="model-comparison.html#cb212-51" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb212-52"><a href="model-comparison.html#cb212-52" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb212-53"><a href="model-comparison.html#cb212-53" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents_test){</span></span>
<span id="cb212-54"><a href="model-comparison.html#cb212-54" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb212-55"><a href="model-comparison.html#cb212-55" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb212-56"><a href="model-comparison.html#cb212-56" aria-hidden="true" tabindex="-1"></a><span class="st">        memory_test[trial, agent] = 0.5;</span></span>
<span id="cb212-57"><a href="model-comparison.html#cb212-57" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb212-58"><a href="model-comparison.html#cb212-58" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb212-59"><a href="model-comparison.html#cb212-59" aria-hidden="true" tabindex="-1"></a><span class="st">        memory_test[trial + 1, agent] = memory_test[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb212-60"><a href="model-comparison.html#cb212-60" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory_test[trial + 1, agent] == 0){memory_test[trial + 1, agent] = 0.01;}</span></span>
<span id="cb212-61"><a href="model-comparison.html#cb212-61" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory_test[trial + 1, agent] == 1){memory_test[trial + 1, agent] = 0.99;}</span></span>
<span id="cb212-62"><a href="model-comparison.html#cb212-62" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb212-63"><a href="model-comparison.html#cb212-63" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb212-64"><a href="model-comparison.html#cb212-64" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb212-65"><a href="model-comparison.html#cb212-65" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb212-66"><a href="model-comparison.html#cb212-66" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb212-67"><a href="model-comparison.html#cb212-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-68"><a href="model-comparison.html#cb212-68" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb212-69"><a href="model-comparison.html#cb212-69" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb212-70"><a href="model-comparison.html#cb212-70" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb212-71"><a href="model-comparison.html#cb212-71" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb212-72"><a href="model-comparison.html#cb212-72" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb212-73"><a href="model-comparison.html#cb212-73" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb212-74"><a href="model-comparison.html#cb212-74" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb212-75"><a href="model-comparison.html#cb212-75" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb212-76"><a href="model-comparison.html#cb212-76" aria-hidden="true" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb212-77"><a href="model-comparison.html#cb212-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-78"><a href="model-comparison.html#cb212-78" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb212-79"><a href="model-comparison.html#cb212-79" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb212-80"><a href="model-comparison.html#cb212-80" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb212-81"><a href="model-comparison.html#cb212-81" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | biasM + IDs[agent, 1] +  memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb212-82"><a href="model-comparison.html#cb212-82" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb212-83"><a href="model-comparison.html#cb212-83" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb212-84"><a href="model-comparison.html#cb212-84" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb212-85"><a href="model-comparison.html#cb212-85" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb212-86"><a href="model-comparison.html#cb212-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-87"><a href="model-comparison.html#cb212-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-88"><a href="model-comparison.html#cb212-88" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb212-89"><a href="model-comparison.html#cb212-89" aria-hidden="true" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb212-90"><a href="model-comparison.html#cb212-90" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb212-91"><a href="model-comparison.html#cb212-91" aria-hidden="true" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb212-92"><a href="model-comparison.html#cb212-92" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb212-93"><a href="model-comparison.html#cb212-93" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb212-94"><a href="model-comparison.html#cb212-94" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb212-95"><a href="model-comparison.html#cb212-95" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb212-96"><a href="model-comparison.html#cb212-96" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb212-97"><a href="model-comparison.html#cb212-97" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb212-98"><a href="model-comparison.html#cb212-98" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb212-99"><a href="model-comparison.html#cb212-99" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb212-100"><a href="model-comparison.html#cb212-100" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb212-101"><a href="model-comparison.html#cb212-101" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb212-102"><a href="model-comparison.html#cb212-102" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb212-103"><a href="model-comparison.html#cb212-103" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb212-104"><a href="model-comparison.html#cb212-104" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb212-105"><a href="model-comparison.html#cb212-105" aria-hidden="true" tabindex="-1"></a><span class="st">   array[trials, agents_test] real log_lik_test;</span></span>
<span id="cb212-106"><a href="model-comparison.html#cb212-106" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb212-107"><a href="model-comparison.html#cb212-107" aria-hidden="true" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb212-108"><a href="model-comparison.html#cb212-108" aria-hidden="true" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb212-109"><a href="model-comparison.html#cb212-109" aria-hidden="true" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb212-110"><a href="model-comparison.html#cb212-110" aria-hidden="true" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb212-111"><a href="model-comparison.html#cb212-111" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb212-112"><a href="model-comparison.html#cb212-112" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb212-113"><a href="model-comparison.html#cb212-113" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb212-114"><a href="model-comparison.html#cb212-114" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb212-115"><a href="model-comparison.html#cb212-115" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb212-116"><a href="model-comparison.html#cb212-116" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb212-117"><a href="model-comparison.html#cb212-117" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb212-118"><a href="model-comparison.html#cb212-118" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb212-119"><a href="model-comparison.html#cb212-119" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  0 * (betaM + IDs[i,2])));</span></span>
<span id="cb212-120"><a href="model-comparison.html#cb212-120" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  1 * (betaM + IDs[i,2])));</span></span>
<span id="cb212-121"><a href="model-comparison.html#cb212-121" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  2 * (betaM + IDs[i,2])));</span></span>
<span id="cb212-122"><a href="model-comparison.html#cb212-122" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb212-123"><a href="model-comparison.html#cb212-123" aria-hidden="true" tabindex="-1"></a><span class="st">      for (t in 1:trials){</span></span>
<span id="cb212-124"><a href="model-comparison.html#cb212-124" aria-hidden="true" tabindex="-1"></a><span class="st">        log_lik[t,i] = bernoulli_logit_lpmf(h[t, i] | biasM + IDs[i, 1] +  memory[t, i] * (betaM + IDs[i, 2]));</span></span>
<span id="cb212-125"><a href="model-comparison.html#cb212-125" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb212-126"><a href="model-comparison.html#cb212-126" aria-hidden="true" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb212-127"><a href="model-comparison.html#cb212-127" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb212-128"><a href="model-comparison.html#cb212-128" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents_test){</span></span>
<span id="cb212-129"><a href="model-comparison.html#cb212-129" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb212-130"><a href="model-comparison.html#cb212-130" aria-hidden="true" tabindex="-1"></a><span class="st">      log_lik_test[t,i] = bernoulli_logit_lpmf(h_test[t,i] | biasM +  memory_test[t, i] * betaM);</span></span>
<span id="cb212-131"><a href="model-comparison.html#cb212-131" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb212-132"><a href="model-comparison.html#cb212-132" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb212-133"><a href="model-comparison.html#cb212-133" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb212-134"><a href="model-comparison.html#cb212-134" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb212-135"><a href="model-comparison.html#cb212-135" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb212-136"><a href="model-comparison.html#cb212-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-137"><a href="model-comparison.html#cb212-137" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb212-138"><a href="model-comparison.html#cb212-138" aria-hidden="true" tabindex="-1"></a>  stan_memory_cv_model,</span>
<span id="cb212-139"><a href="model-comparison.html#cb212-139" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb212-140"><a href="model-comparison.html#cb212-140" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelMemory_cv.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelMemory_cv.stan&quot;</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="model-comparison.html#cb214-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelMemory_cv.stan&quot;</span>)</span>
<span id="cb214-2"><a href="model-comparison.html#cb214-2" aria-hidden="true" tabindex="-1"></a>mod_memory_cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb214-3"><a href="model-comparison.html#cb214-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
<p>[MISSING: PARALLELIZE]</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="model-comparison.html#cb216-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>fold <span class="ot">&lt;-</span> <span class="fu">kfold_split_grouped</span>(<span class="at">K =</span> <span class="dv">10</span>, <span class="at">x =</span> d<span class="sc">$</span>agent)</span>
<span id="cb216-2"><a href="model-comparison.html#cb216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-3"><a href="model-comparison.html#cb216-3" aria-hidden="true" tabindex="-1"></a>log_pd_biased_kfold <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1000</span>, <span class="at">ncol =</span> <span class="dv">12000</span>)</span>
<span id="cb216-4"><a href="model-comparison.html#cb216-4" aria-hidden="true" tabindex="-1"></a>log_pd_memory_kfold <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1000</span>, <span class="at">ncol =</span> <span class="dv">12000</span>)</span>
<span id="cb216-5"><a href="model-comparison.html#cb216-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-6"><a href="model-comparison.html#cb216-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">unique</span>(d<span class="sc">$</span>fold)) { </span>
<span id="cb216-7"><a href="model-comparison.html#cb216-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb216-8"><a href="model-comparison.html#cb216-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Training set for k </span></span>
<span id="cb216-9"><a href="model-comparison.html#cb216-9" aria-hidden="true" tabindex="-1"></a>  d_train <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fold <span class="sc">!=</span> k)  </span>
<span id="cb216-10"><a href="model-comparison.html#cb216-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb216-11"><a href="model-comparison.html#cb216-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Create the data</span></span>
<span id="cb216-12"><a href="model-comparison.html#cb216-12" aria-hidden="true" tabindex="-1"></a>  d_memory1_train <span class="ot">&lt;-</span> d_train <span class="sc">%&gt;%</span> </span>
<span id="cb216-13"><a href="model-comparison.html#cb216-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb216-14"><a href="model-comparison.html#cb216-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb216-15"><a href="model-comparison.html#cb216-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb216-16"><a href="model-comparison.html#cb216-16" aria-hidden="true" tabindex="-1"></a>  d_memory2_train <span class="ot">&lt;-</span> d_train <span class="sc">%&gt;%</span> </span>
<span id="cb216-17"><a href="model-comparison.html#cb216-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb216-18"><a href="model-comparison.html#cb216-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb216-19"><a href="model-comparison.html#cb216-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb216-20"><a href="model-comparison.html#cb216-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb216-21"><a href="model-comparison.html#cb216-21" aria-hidden="true" tabindex="-1"></a>  agents_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d_train<span class="sc">$</span>agent))</span>
<span id="cb216-22"><a href="model-comparison.html#cb216-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb216-23"><a href="model-comparison.html#cb216-23" aria-hidden="true" tabindex="-1"></a>  d_test <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb216-24"><a href="model-comparison.html#cb216-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fold <span class="sc">==</span> k) </span>
<span id="cb216-25"><a href="model-comparison.html#cb216-25" aria-hidden="true" tabindex="-1"></a>  d_memory1_test <span class="ot">&lt;-</span> d_test <span class="sc">%&gt;%</span> </span>
<span id="cb216-26"><a href="model-comparison.html#cb216-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb216-27"><a href="model-comparison.html#cb216-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb216-28"><a href="model-comparison.html#cb216-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb216-29"><a href="model-comparison.html#cb216-29" aria-hidden="true" tabindex="-1"></a>  d_memory2_test <span class="ot">&lt;-</span> d_test <span class="sc">%&gt;%</span> </span>
<span id="cb216-30"><a href="model-comparison.html#cb216-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb216-31"><a href="model-comparison.html#cb216-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb216-32"><a href="model-comparison.html#cb216-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb216-33"><a href="model-comparison.html#cb216-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb216-34"><a href="model-comparison.html#cb216-34" aria-hidden="true" tabindex="-1"></a>  agents_test_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d_test<span class="sc">$</span>agent))</span>
<span id="cb216-35"><a href="model-comparison.html#cb216-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb216-36"><a href="model-comparison.html#cb216-36" aria-hidden="true" tabindex="-1"></a>  data_memory <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb216-37"><a href="model-comparison.html#cb216-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">trials =</span> trials,</span>
<span id="cb216-38"><a href="model-comparison.html#cb216-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">agents =</span>  agents_n,</span>
<span id="cb216-39"><a href="model-comparison.html#cb216-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">agents_test =</span> agents_test_n,</span>
<span id="cb216-40"><a href="model-comparison.html#cb216-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">h =</span> <span class="fu">as.matrix</span>(d_memory1_train[,<span class="dv">2</span><span class="sc">:</span>(agents_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb216-41"><a href="model-comparison.html#cb216-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">other =</span> <span class="fu">as.matrix</span>(d_memory2_train[,<span class="dv">2</span><span class="sc">:</span>(agents_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb216-42"><a href="model-comparison.html#cb216-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb216-43"><a href="model-comparison.html#cb216-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">h_test =</span> <span class="fu">as.matrix</span>(d_memory1_test[,<span class="dv">2</span><span class="sc">:</span>(agents_test_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb216-44"><a href="model-comparison.html#cb216-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_test =</span> <span class="fu">as.matrix</span>(d_memory2_test[,<span class="dv">2</span><span class="sc">:</span>(agents_test_n <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="cb216-45"><a href="model-comparison.html#cb216-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb216-46"><a href="model-comparison.html#cb216-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train the models </span></span>
<span id="cb216-47"><a href="model-comparison.html#cb216-47" aria-hidden="true" tabindex="-1"></a>  fit_random <span class="ot">&lt;-</span> mod_biased_cv<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb216-48"><a href="model-comparison.html#cb216-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_memory,</span>
<span id="cb216-49"><a href="model-comparison.html#cb216-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb216-50"><a href="model-comparison.html#cb216-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb216-51"><a href="model-comparison.html#cb216-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb216-52"><a href="model-comparison.html#cb216-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb216-53"><a href="model-comparison.html#cb216-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb216-54"><a href="model-comparison.html#cb216-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb216-55"><a href="model-comparison.html#cb216-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb216-56"><a href="model-comparison.html#cb216-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb216-57"><a href="model-comparison.html#cb216-57" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb216-58"><a href="model-comparison.html#cb216-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb216-59"><a href="model-comparison.html#cb216-59" aria-hidden="true" tabindex="-1"></a>  fit_memory <span class="ot">&lt;-</span> mod_memory_cv<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb216-60"><a href="model-comparison.html#cb216-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_memory,</span>
<span id="cb216-61"><a href="model-comparison.html#cb216-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb216-62"><a href="model-comparison.html#cb216-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb216-63"><a href="model-comparison.html#cb216-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb216-64"><a href="model-comparison.html#cb216-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb216-65"><a href="model-comparison.html#cb216-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb216-66"><a href="model-comparison.html#cb216-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb216-67"><a href="model-comparison.html#cb216-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb216-68"><a href="model-comparison.html#cb216-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb216-69"><a href="model-comparison.html#cb216-69" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb216-70"><a href="model-comparison.html#cb216-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb216-71"><a href="model-comparison.html#cb216-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract log likelihood which represents </span></span>
<span id="cb216-72"><a href="model-comparison.html#cb216-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the pointwise predictive density. </span></span>
<span id="cb216-73"><a href="model-comparison.html#cb216-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n.b. the matrix has 1000 row, and 12000 columns. </span></span>
<span id="cb216-74"><a href="model-comparison.html#cb216-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># d$fold==k yields 12000 logical values, of which 1200 TRUEs, identifying 1200 columns</span></span>
<span id="cb216-75"><a href="model-comparison.html#cb216-75" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the fit blabla yields 1000 obs (samples) and 1190 variables instead of 1200</span></span>
<span id="cb216-76"><a href="model-comparison.html#cb216-76" aria-hidden="true" tabindex="-1"></a>  log_pd_biased_kfold[, d<span class="sc">$</span>fold <span class="sc">==</span> k] <span class="ot">&lt;-</span> fit_random<span class="sc">$</span><span class="fu">draws</span>(<span class="st">&quot;log_lik_test&quot;</span>, <span class="at">format =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb216-77"><a href="model-comparison.html#cb216-77" aria-hidden="true" tabindex="-1"></a>  log_pd_memory_kfold[, d<span class="sc">$</span>fold <span class="sc">==</span> k] <span class="ot">&lt;-</span> fit_memory<span class="sc">$</span><span class="fu">draws</span>(<span class="st">&quot;log_lik_test&quot;</span>, <span class="at">format =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb216-78"><a href="model-comparison.html#cb216-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-79"><a href="model-comparison.html#cb216-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb216-80"><a href="model-comparison.html#cb216-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-81"><a href="model-comparison.html#cb216-81" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(log_pd_biased_kfold, log_pd_memory_kfold, <span class="at">file =</span> <span class="st">&quot;simmodels/W6_CV_Biased&amp;Memory.RData&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="calculating-elpd-and-comparing" class="section level2 hasAnchor" number="7.8">
<h2><span class="header-section-number">7.8</span> Calculating elpd and comparing<a href="model-comparison.html#calculating-elpd-and-comparing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="model-comparison.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;simmodels/W6_CV_Biased&amp;Memory.RData&quot;</span>) </span>
<span id="cb217-2"><a href="model-comparison.html#cb217-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-3"><a href="model-comparison.html#cb217-3" aria-hidden="true" tabindex="-1"></a>elpd_biased_kfold <span class="ot">&lt;-</span> <span class="fu">elpd</span>(log_pd_biased_kfold)</span>
<span id="cb217-4"><a href="model-comparison.html#cb217-4" aria-hidden="true" tabindex="-1"></a>elpd_memory_kfold <span class="ot">&lt;-</span> <span class="fu">elpd</span>(log_pd_memory_kfold)</span>
<span id="cb217-5"><a href="model-comparison.html#cb217-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-6"><a href="model-comparison.html#cb217-6" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(elpd_biased_kfold, elpd_memory_kfold)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1    0.0       0.0 
## model2 -437.3      23.9</code></pre>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="model-comparison.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co">#loo_model_weights(elpd_biased_kfold, elpd_memory_kfold)</span></span></code></pre></div>

</div>
<div id="mixture-models" class="section level2 hasAnchor" number="7.9">
<h2><span class="header-section-number">7.9</span> Mixture models<a href="model-comparison.html#mixture-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="load-the-dataset" class="section level3 hasAnchor" number="7.9.1">
<h3><span class="header-section-number">7.9.1</span> Load the dataset<a href="model-comparison.html#load-the-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We load the data set from chapter NN, where we loop through possible rates and noise levels, and pick one agent to build up the model progressively.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="model-comparison.html#cb220-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;simdata/W3_randomnoise.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 7920 Columns: 5
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (5): trial, choice, rate, noise, cumulativerate
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="model-comparison.html#cb222-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(rate <span class="sc">==</span> <span class="fl">0.8</span> <span class="sc">&amp;</span> noise <span class="sc">==</span> <span class="fl">0.1</span>)</span>
<span id="cb222-2"><a href="model-comparison.html#cb222-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-3"><a href="model-comparison.html#cb222-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb222-4"><a href="model-comparison.html#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">120</span>,</span>
<span id="cb222-5"><a href="model-comparison.html#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> dd<span class="sc">$</span>choice</span>
<span id="cb222-6"><a href="model-comparison.html#cb222-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div id="stan-model-mixing-biased-and-noise" class="section level2 hasAnchor" number="7.10">
<h2><span class="header-section-number">7.10</span> Stan model mixing biased and noise<a href="model-comparison.html#stan-model-mixing-biased-and-noise" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We then build a Stan model with the noise parameter</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="model-comparison.html#cb223-1" aria-hidden="true" tabindex="-1"></a>stan_mixture_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb223-2"><a href="model-comparison.html#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="st">// This Stan model defines a mixture of bernoulli (random bias + noise)</span></span>
<span id="cb223-3"><a href="model-comparison.html#cb223-3" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb223-4"><a href="model-comparison.html#cb223-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-5"><a href="model-comparison.html#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of heads</span></span>
<span id="cb223-6"><a href="model-comparison.html#cb223-6" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb223-7"><a href="model-comparison.html#cb223-7" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower=1&gt; n;</span></span>
<span id="cb223-8"><a href="model-comparison.html#cb223-8" aria-hidden="true" tabindex="-1"></a><span class="st"> array[n] int h;</span></span>
<span id="cb223-9"><a href="model-comparison.html#cb223-9" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb223-10"><a href="model-comparison.html#cb223-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-11"><a href="model-comparison.html#cb223-11" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb223-12"><a href="model-comparison.html#cb223-12" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb223-13"><a href="model-comparison.html#cb223-13" aria-hidden="true" tabindex="-1"></a><span class="st">  real bias;</span></span>
<span id="cb223-14"><a href="model-comparison.html#cb223-14" aria-hidden="true" tabindex="-1"></a><span class="st">  real noise;</span></span>
<span id="cb223-15"><a href="model-comparison.html#cb223-15" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb223-16"><a href="model-comparison.html#cb223-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-17"><a href="model-comparison.html#cb223-17" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb223-18"><a href="model-comparison.html#cb223-18" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb223-19"><a href="model-comparison.html#cb223-19" aria-hidden="true" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb223-20"><a href="model-comparison.html#cb223-20" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | 0, 1);</span></span>
<span id="cb223-21"><a href="model-comparison.html#cb223-21" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(noise | 0, 1);</span></span>
<span id="cb223-22"><a href="model-comparison.html#cb223-22" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb223-23"><a href="model-comparison.html#cb223-23" aria-hidden="true" tabindex="-1"></a><span class="st">  // The model consists of a binomial distributions with a rate theta</span></span>
<span id="cb223-24"><a href="model-comparison.html#cb223-24" aria-hidden="true" tabindex="-1"></a><span class="st">  target += log_sum_exp(log(inv_logit(noise)) +</span></span>
<span id="cb223-25"><a href="model-comparison.html#cb223-25" aria-hidden="true" tabindex="-1"></a><span class="st">            bernoulli_logit_lpmf(h | 0),</span></span>
<span id="cb223-26"><a href="model-comparison.html#cb223-26" aria-hidden="true" tabindex="-1"></a><span class="st">            log1m(inv_logit(noise)) +  bernoulli_logit_lpmf(h | bias));</span></span>
<span id="cb223-27"><a href="model-comparison.html#cb223-27" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb223-28"><a href="model-comparison.html#cb223-28" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb223-29"><a href="model-comparison.html#cb223-29" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb223-30"><a href="model-comparison.html#cb223-30" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; noise_p;</span></span>
<span id="cb223-31"><a href="model-comparison.html#cb223-31" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; bias_p;</span></span>
<span id="cb223-32"><a href="model-comparison.html#cb223-32" aria-hidden="true" tabindex="-1"></a><span class="st">  noise_p = inv_logit(noise);</span></span>
<span id="cb223-33"><a href="model-comparison.html#cb223-33" aria-hidden="true" tabindex="-1"></a><span class="st">  bias_p = inv_logit(bias);</span></span>
<span id="cb223-34"><a href="model-comparison.html#cb223-34" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb223-35"><a href="model-comparison.html#cb223-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-36"><a href="model-comparison.html#cb223-36" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb223-37"><a href="model-comparison.html#cb223-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-38"><a href="model-comparison.html#cb223-38" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb223-39"><a href="model-comparison.html#cb223-39" aria-hidden="true" tabindex="-1"></a>  stan_mixture_model,</span>
<span id="cb223-40"><a href="model-comparison.html#cb223-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb223-41"><a href="model-comparison.html#cb223-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MixtureSingle.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MixtureSingle.stan&quot;</code></pre>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="model-comparison.html#cb225-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MixtureSingle.stan&quot;</span>)</span>
<span id="cb225-2"><a href="model-comparison.html#cb225-2" aria-hidden="true" tabindex="-1"></a>mod_mixture <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb225-3"><a href="model-comparison.html#cb225-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
</div>
<div id="fitting-and-assessing-the-model" class="section level2 hasAnchor" number="7.11">
<h2><span class="header-section-number">7.11</span> Fitting and assessing the model<a href="model-comparison.html#fitting-and-assessing-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="model-comparison.html#cb227-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod_mixture<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb227-2"><a href="model-comparison.html#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb227-3"><a href="model-comparison.html#cb227-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb227-4"><a href="model-comparison.html#cb227-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb227-5"><a href="model-comparison.html#cb227-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb227-6"><a href="model-comparison.html#cb227-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb227-7"><a href="model-comparison.html#cb227-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb227-8"><a href="model-comparison.html#cb227-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb227-9"><a href="model-comparison.html#cb227-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb227-10"><a href="model-comparison.html#cb227-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb227-11"><a href="model-comparison.html#cb227-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb227-12"><a href="model-comparison.html#cb227-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 0.1 seconds.
## Chain 2 finished in 0.2 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 0.1 seconds.
## Total execution time: 0.2 seconds.</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="model-comparison.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(samples, data, </span>
<span id="cb229-2"><a href="model-comparison.html#cb229-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W7_singlemixture.RData&quot;</span>) </span>
<span id="cb229-3"><a href="model-comparison.html#cb229-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W7_singlemixture.RDS&quot;</span>)</span>
<span id="cb229-4"><a href="model-comparison.html#cb229-4" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W7_singlemixture&quot;</span>)</span></code></pre></div>
<pre><code>## Moved 2 files and set internal paths to new locations:
## - /Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/simmodels/W7_singlemixture-202303240929-1-372a0a.csv
## - /Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/simmodels/W7_singlemixture-202303240929-2-372a0a.csv</code></pre>
<p>[MISSING: EVALUATION]</p>
</div>
<div id="basic-evaluation" class="section level2 hasAnchor" number="7.12">
<h2><span class="header-section-number">7.12</span> Basic evaluation<a href="model-comparison.html#basic-evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="model-comparison.html#cb231-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 10
##   variable    mean  median     sd    mad      q5     q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;      &lt;num&gt;   &lt;num&gt;  &lt;num&gt;  &lt;num&gt;   &lt;num&gt;   &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
## 1 lp__     -68.2   -67.9   0.979  0.738  -70.1   -67.2    1.00    1466.    2065.
## 2 bias       1.19    1.19  0.211  0.213    0.856   1.54   1.00    2476.    2117.
## 3 noise     -0.400  -0.392 0.917  0.903   -1.93    1.10   1.00    2688.    2213.
## 4 noise_p    0.416   0.403 0.191  0.208    0.126   0.750  1.00    2688.    2213.
## 5 bias_p     0.765   0.766 0.0376 0.0381   0.702   0.824  1.00    2476.    2117.</code></pre>
</div>
<div id="multilevel-mixture-model" class="section level2 hasAnchor" number="7.13">
<h2><span class="header-section-number">7.13</span> Multilevel mixture model<a href="model-comparison.html#multilevel-mixture-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="model-comparison.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Multilevel mixture</span></span>
<span id="cb233-2"><a href="model-comparison.html#cb233-2" aria-hidden="true" tabindex="-1"></a>stan_multilevelMixture_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb233-3"><a href="model-comparison.html#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb233-4"><a href="model-comparison.html#cb233-4" aria-hidden="true" tabindex="-1"></a><span class="st">// This Stan model defines a mixture of bernoulli (random bias + noise)</span></span>
<span id="cb233-5"><a href="model-comparison.html#cb233-5" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb233-6"><a href="model-comparison.html#cb233-6" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb233-7"><a href="model-comparison.html#cb233-7" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb233-8"><a href="model-comparison.html#cb233-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb233-9"><a href="model-comparison.html#cb233-9" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb233-10"><a href="model-comparison.html#cb233-10" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb233-11"><a href="model-comparison.html#cb233-11" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb233-12"><a href="model-comparison.html#cb233-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb233-13"><a href="model-comparison.html#cb233-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-14"><a href="model-comparison.html#cb233-14" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of heads</span></span>
<span id="cb233-15"><a href="model-comparison.html#cb233-15" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb233-16"><a href="model-comparison.html#cb233-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb233-17"><a href="model-comparison.html#cb233-17" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb233-18"><a href="model-comparison.html#cb233-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb233-19"><a href="model-comparison.html#cb233-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb233-20"><a href="model-comparison.html#cb233-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-21"><a href="model-comparison.html#cb233-21" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb233-22"><a href="model-comparison.html#cb233-22" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb233-23"><a href="model-comparison.html#cb233-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb233-24"><a href="model-comparison.html#cb233-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real noiseM; // p of noise</span></span>
<span id="cb233-25"><a href="model-comparison.html#cb233-25" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb233-26"><a href="model-comparison.html#cb233-26" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb233-27"><a href="model-comparison.html#cb233-27" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb233-28"><a href="model-comparison.html#cb233-28" aria-hidden="true" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb233-29"><a href="model-comparison.html#cb233-29" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb233-30"><a href="model-comparison.html#cb233-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-31"><a href="model-comparison.html#cb233-31" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb233-32"><a href="model-comparison.html#cb233-32" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb233-33"><a href="model-comparison.html#cb233-33" aria-hidden="true" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb233-34"><a href="model-comparison.html#cb233-34" aria-hidden="true" tabindex="-1"></a><span class="st"> }</span></span>
<span id="cb233-35"><a href="model-comparison.html#cb233-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-36"><a href="model-comparison.html#cb233-36" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb233-37"><a href="model-comparison.html#cb233-37" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb233-38"><a href="model-comparison.html#cb233-38" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb233-39"><a href="model-comparison.html#cb233-39" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb233-40"><a href="model-comparison.html#cb233-40" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb233-41"><a href="model-comparison.html#cb233-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-42"><a href="model-comparison.html#cb233-42" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(noiseM | -1, .5);</span></span>
<span id="cb233-43"><a href="model-comparison.html#cb233-43" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb233-44"><a href="model-comparison.html#cb233-44" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb233-45"><a href="model-comparison.html#cb233-45" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb233-46"><a href="model-comparison.html#cb233-46" aria-hidden="true" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb233-47"><a href="model-comparison.html#cb233-47" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb233-48"><a href="model-comparison.html#cb233-48" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb233-49"><a href="model-comparison.html#cb233-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-50"><a href="model-comparison.html#cb233-50" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb233-51"><a href="model-comparison.html#cb233-51" aria-hidden="true" tabindex="-1"></a><span class="st">    target += log_sum_exp(</span></span>
<span id="cb233-52"><a href="model-comparison.html#cb233-52" aria-hidden="true" tabindex="-1"></a><span class="st">            log(inv_logit(noiseM + IDs[i,2])) +  // p of noise</span></span>
<span id="cb233-53"><a href="model-comparison.html#cb233-53" aria-hidden="true" tabindex="-1"></a><span class="st">                    bernoulli_logit_lpmf(h[,i] | 0), // times post likelihood of the noise model</span></span>
<span id="cb233-54"><a href="model-comparison.html#cb233-54" aria-hidden="true" tabindex="-1"></a><span class="st">            log1m(inv_logit(noiseM + IDs[i,2])) + // 1 - p of noise</span></span>
<span id="cb233-55"><a href="model-comparison.html#cb233-55" aria-hidden="true" tabindex="-1"></a><span class="st">                    bernoulli_logit_lpmf(h[,i] | thetaM + IDs[i,1])); // times post likelihood of the bias model</span></span>
<span id="cb233-56"><a href="model-comparison.html#cb233-56" aria-hidden="true" tabindex="-1"></a><span class="st">                    </span></span>
<span id="cb233-57"><a href="model-comparison.html#cb233-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-58"><a href="model-comparison.html#cb233-58" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb233-59"><a href="model-comparison.html#cb233-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-60"><a href="model-comparison.html#cb233-60" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb233-61"><a href="model-comparison.html#cb233-61" aria-hidden="true" tabindex="-1"></a><span class="st">  real thetaM_prior;</span></span>
<span id="cb233-62"><a href="model-comparison.html#cb233-62" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb233-63"><a href="model-comparison.html#cb233-63" aria-hidden="true" tabindex="-1"></a><span class="st">  real noiseM_prior;</span></span>
<span id="cb233-64"><a href="model-comparison.html#cb233-64" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; noiseSD_prior;</span></span>
<span id="cb233-65"><a href="model-comparison.html#cb233-65" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb233-66"><a href="model-comparison.html#cb233-66" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; noise_prior;</span></span>
<span id="cb233-67"><a href="model-comparison.html#cb233-67" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb233-68"><a href="model-comparison.html#cb233-68" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; noise_posterior;</span></span>
<span id="cb233-69"><a href="model-comparison.html#cb233-69" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb233-70"><a href="model-comparison.html#cb233-70" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials,agents] int&lt;lower=0, upper = trials&gt; prior_noise;</span></span>
<span id="cb233-71"><a href="model-comparison.html#cb233-71" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials,agents] int&lt;lower=0, upper = trials&gt; posterior_noise;</span></span>
<span id="cb233-72"><a href="model-comparison.html#cb233-72" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials,agents] int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb233-73"><a href="model-comparison.html#cb233-73" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials,agents] int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb233-74"><a href="model-comparison.html#cb233-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-75"><a href="model-comparison.html#cb233-75" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real log_lik;</span></span>
<span id="cb233-76"><a href="model-comparison.html#cb233-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-77"><a href="model-comparison.html#cb233-77" aria-hidden="true" tabindex="-1"></a><span class="st">  thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb233-78"><a href="model-comparison.html#cb233-78" aria-hidden="true" tabindex="-1"></a><span class="st">  thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb233-79"><a href="model-comparison.html#cb233-79" aria-hidden="true" tabindex="-1"></a><span class="st">  theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb233-80"><a href="model-comparison.html#cb233-80" aria-hidden="true" tabindex="-1"></a><span class="st">  noiseM_prior = normal_rng(-1,.5);</span></span>
<span id="cb233-81"><a href="model-comparison.html#cb233-81" aria-hidden="true" tabindex="-1"></a><span class="st">  noiseSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb233-82"><a href="model-comparison.html#cb233-82" aria-hidden="true" tabindex="-1"></a><span class="st">  noise_prior = inv_logit(normal_rng(noiseM_prior, noiseSD_prior));</span></span>
<span id="cb233-83"><a href="model-comparison.html#cb233-83" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb233-84"><a href="model-comparison.html#cb233-84" aria-hidden="true" tabindex="-1"></a><span class="st">  theta_posterior = inv_logit(normal_rng(thetaM, tau[1]));</span></span>
<span id="cb233-85"><a href="model-comparison.html#cb233-85" aria-hidden="true" tabindex="-1"></a><span class="st">  noise_posterior = inv_logit(normal_rng(noiseM, tau[2]));</span></span>
<span id="cb233-86"><a href="model-comparison.html#cb233-86" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb233-87"><a href="model-comparison.html#cb233-87" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb233-88"><a href="model-comparison.html#cb233-88" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb233-89"><a href="model-comparison.html#cb233-89" aria-hidden="true" tabindex="-1"></a><span class="st">     </span></span>
<span id="cb233-90"><a href="model-comparison.html#cb233-90" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb233-91"><a href="model-comparison.html#cb233-91" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb233-92"><a href="model-comparison.html#cb233-92" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_noise[t,i] = bernoulli_rng(noise_prior);</span></span>
<span id="cb233-93"><a href="model-comparison.html#cb233-93" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_noise[t,i] = bernoulli_rng(inv_logit(noiseM + IDs[i,2]));</span></span>
<span id="cb233-94"><a href="model-comparison.html#cb233-94" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb233-95"><a href="model-comparison.html#cb233-95" aria-hidden="true" tabindex="-1"></a><span class="st">      if(prior_noise[t,i]==1){</span></span>
<span id="cb233-96"><a href="model-comparison.html#cb233-96" aria-hidden="true" tabindex="-1"></a><span class="st">        prior_preds[t,i] = bernoulli_rng(theta_prior);</span></span>
<span id="cb233-97"><a href="model-comparison.html#cb233-97" aria-hidden="true" tabindex="-1"></a><span class="st">      } else{</span></span>
<span id="cb233-98"><a href="model-comparison.html#cb233-98" aria-hidden="true" tabindex="-1"></a><span class="st">        prior_preds[t,i] = bernoulli_rng(0.5);</span></span>
<span id="cb233-99"><a href="model-comparison.html#cb233-99" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb233-100"><a href="model-comparison.html#cb233-100" aria-hidden="true" tabindex="-1"></a><span class="st">      if(posterior_noise[t,i]==1){</span></span>
<span id="cb233-101"><a href="model-comparison.html#cb233-101" aria-hidden="true" tabindex="-1"></a><span class="st">        posterior_preds[t,i] = bernoulli_rng(inv_logit(thetaM + IDs[i,1]));</span></span>
<span id="cb233-102"><a href="model-comparison.html#cb233-102" aria-hidden="true" tabindex="-1"></a><span class="st">      } else{</span></span>
<span id="cb233-103"><a href="model-comparison.html#cb233-103" aria-hidden="true" tabindex="-1"></a><span class="st">        posterior_preds[t,i] = bernoulli_rng(0.5);</span></span>
<span id="cb233-104"><a href="model-comparison.html#cb233-104" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb233-105"><a href="model-comparison.html#cb233-105" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb233-106"><a href="model-comparison.html#cb233-106" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb233-107"><a href="model-comparison.html#cb233-107" aria-hidden="true" tabindex="-1"></a><span class="st">      log_lik[t,i] = log_sum_exp(</span></span>
<span id="cb233-108"><a href="model-comparison.html#cb233-108" aria-hidden="true" tabindex="-1"></a><span class="st">            log(inv_logit(noiseM + IDs[i,2])) +  // p of noise</span></span>
<span id="cb233-109"><a href="model-comparison.html#cb233-109" aria-hidden="true" tabindex="-1"></a><span class="st">                    bernoulli_logit_lpmf(h[t,i] | 0), // times post likelihood of the noise model</span></span>
<span id="cb233-110"><a href="model-comparison.html#cb233-110" aria-hidden="true" tabindex="-1"></a><span class="st">            log1m(inv_logit(noiseM + IDs[i,2])) + // 1 - p of noise</span></span>
<span id="cb233-111"><a href="model-comparison.html#cb233-111" aria-hidden="true" tabindex="-1"></a><span class="st">                    bernoulli_logit_lpmf(h[t,i] | thetaM + IDs[i,1])); // times post likelihood of the bias model</span></span>
<span id="cb233-112"><a href="model-comparison.html#cb233-112" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb233-113"><a href="model-comparison.html#cb233-113" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb233-114"><a href="model-comparison.html#cb233-114" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb233-115"><a href="model-comparison.html#cb233-115" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb233-116"><a href="model-comparison.html#cb233-116" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb233-117"><a href="model-comparison.html#cb233-117" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb233-118"><a href="model-comparison.html#cb233-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-119"><a href="model-comparison.html#cb233-119" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb233-120"><a href="model-comparison.html#cb233-120" aria-hidden="true" tabindex="-1"></a>  stan_multilevelMixture_model,</span>
<span id="cb233-121"><a href="model-comparison.html#cb233-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb233-122"><a href="model-comparison.html#cb233-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MixtureMultilevel.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MixtureMultilevel.stan&quot;</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="model-comparison.html#cb235-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MixtureMultilevel.stan&quot;</span>)</span>
<span id="cb235-2"><a href="model-comparison.html#cb235-2" aria-hidden="true" tabindex="-1"></a>mod_mixture <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb235-3"><a href="model-comparison.html#cb235-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="model-comparison.html#cb237-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod_mixture<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb237-2"><a href="model-comparison.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_biased,</span>
<span id="cb237-3"><a href="model-comparison.html#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb237-4"><a href="model-comparison.html#cb237-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb237-5"><a href="model-comparison.html#cb237-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb237-6"><a href="model-comparison.html#cb237-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb237-7"><a href="model-comparison.html#cb237-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb237-8"><a href="model-comparison.html#cb237-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb237-9"><a href="model-comparison.html#cb237-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb237-10"><a href="model-comparison.html#cb237-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb237-11"><a href="model-comparison.html#cb237-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb237-12"><a href="model-comparison.html#cb237-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 124.9 seconds.
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 129.0 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 126.9 seconds.
## Total execution time: 129.1 seconds.</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="model-comparison.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(samples, data, </span>
<span id="cb239-2"><a href="model-comparison.html#cb239-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W7_multimixture.RData&quot;</span>) </span>
<span id="cb239-3"><a href="model-comparison.html#cb239-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W7_multimixture.RDS&quot;</span>)</span>
<span id="cb239-4"><a href="model-comparison.html#cb239-4" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W7_multimixture&quot;</span>)</span></code></pre></div>
<pre><code>## Moved 2 files and set internal paths to new locations:
## - /Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/simmodels/W7_multimixture-202303240933-1-62416b.csv
## - /Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/simmodels/W7_multimixture-202303240933-2-62416b.csv</code></pre>
<p>[MISSING: EVALUATION]</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="model-comparison.html#cb241-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## # A tibble: 60,417 × 10
##    variable          mean      median      sd     mad         q5       q95  rhat ess_bulk ess_tail
##    &lt;chr&gt;            &lt;num&gt;       &lt;num&gt;   &lt;num&gt;   &lt;num&gt;      &lt;num&gt;     &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
##  1 lp__       -6413.      -6412.      12.9    12.9    -6435.     -6392.     1.00     617.    1593.
##  2 thetaM         1.31        1.31     0.0657  0.0650     1.20       1.42   1.00     959.    1657.
##  3 noiseM        -2.53       -2.52     0.320   0.318     -3.08      -2.02   1.00    3693.    2620.
##  4 tau[1]         0.599       0.599    0.0501  0.0504     0.521      0.685  1.00     648.    1444.
##  5 tau[2]         0.201       0.171    0.152   0.149      0.0160     0.491  1.00    2949.    2471.
##  6 z_IDs[1,1]    -0.301      -0.314    0.352   0.348     -0.862      0.293  1.00    6135.    2887.
##  7 z_IDs[2,1]    -0.00973     0.0182   1.01    0.987     -1.69       1.62   1.00   10330.    3009.
##  8 z_IDs[1,2]     0.720       0.713    0.404   0.404      0.0791     1.38   1.00    5924.    2728.
##  9 z_IDs[2,2]    -0.00433     0.00141  0.994   1.02      -1.62       1.65   1.00    9280.    2919.
## 10 z_IDs[1,3]    -1.22       -1.43     0.820   0.429     -2.05       0.725  1.00    1725.    2060.
## # … with 60,407 more rows</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="model-comparison.html#cb243-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">loo</span>()</span></code></pre></div>
<pre><code>## Warning: Some Pareto k diagnostic values are slightly high. See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<pre><code>## 
## Computed from 4000 by 12000 log-likelihood matrix
## 
##          Estimate    SE
## elpd_loo  -6223.1  52.4
## p_loo       115.1   2.6
## looic     12446.1 104.8
## ------
## Monte Carlo SE of elpd_loo is 0.6.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     11683 97.4%   86        
##  (0.5, 0.7]   (ok)         317  2.6%   898       
##    (0.7, 1]   (bad)          0  0.0%   &lt;NA&gt;      
##    (1, Inf)   (very bad)     0  0.0%   &lt;NA&gt;      
## 
## All Pareto k estimates are ok (k &lt; 0.7).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>[MISSING: PARAMETER RECOVERY]</p>
<p>[MISSING: BIASED VS. MEMORY?]</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="multilevel-modeling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bonus-chapter-win-stay-lose-shift.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/06-ModelComparison.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
