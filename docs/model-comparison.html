<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Model comparison | 11 - Reinforcement Learning</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Model comparison | 11 - Reinforcement Learning" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Model comparison | 11 - Reinforcement Learning" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2023" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2024-02-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="multilevel-modeling.html"/>
<link rel="next" href="bonus-chapter-additional-models-developed-by-students.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-goal-of-the-course"><i class="fa fa-check"></i><b>1.1</b> The goal of the course</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#list-of-lectures-and-practical-exercises"><i class="fa fa-check"></i><b>1.2</b> List of lectures and practical exercises</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preparation-before-the-course"><i class="fa fa-check"></i><b>1.3</b> Preparation before the course</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html"><i class="fa fa-check"></i><b>2</b> Building verbal models of the matching pennies game</a>
<ul>
<li class="chapter" data-level="2.1" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#trying-out-the-game-and-collecting-your-own-data"><i class="fa fa-check"></i><b>2.1</b> Trying out the game and collecting your own data</a></li>
<li class="chapter" data-level="2.2" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#start-theorizing"><i class="fa fa-check"></i><b>2.2</b> Start Theorizing</a></li>
<li class="chapter" data-level="2.3" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>2.3</b> The distinction between participant and researcher perspectives</a></li>
<li class="chapter" data-level="2.4" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#strategies"><i class="fa fa-check"></i><b>2.4</b> Strategies</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#random-strategies"><i class="fa fa-check"></i><b>2.4.1</b> Random strategies</a></li>
<li class="chapter" data-level="2.4.2" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#immediate-reaction"><i class="fa fa-check"></i><b>2.4.2</b> Immediate reaction</a></li>
<li class="chapter" data-level="2.4.3" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>2.4.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="2.4.4" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>2.4.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="2.4.5" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#reinforcement-learning"><i class="fa fa-check"></i><b>2.4.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="2.4.6" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#k-tom"><i class="fa fa-check"></i><b>2.4.6</b> k-ToM</a></li>
<li class="chapter" data-level="2.4.7" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#other-possible-strategies"><i class="fa fa-check"></i><b>2.4.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#cognitive-constraints"><i class="fa fa-check"></i><b>2.5</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#memory"><i class="fa fa-check"></i><b>2.5.1</b> Memory</a></li>
<li class="chapter" data-level="2.5.2" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#perseveration"><i class="fa fa-check"></i><b>2.5.2</b> Perseveration</a></li>
<li class="chapter" data-level="2.5.3" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#errors"><i class="fa fa-check"></i><b>2.5.3</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#continuity-between-models"><i class="fa fa-check"></i><b>2.6</b> Continuity between models</a></li>
<li class="chapter" data-level="2.7" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#mixture-of-strategies"><i class="fa fa-check"></i><b>2.7</b> Mixture of strategies</a></li>
<li class="chapter" data-level="2.8" data-path="building-verbal-models-of-the-matching-pennies-game.html"><a href="building-verbal-models-of-the-matching-pennies-game.html#differences-from-more-traditional-general-linear-model-based-approaches"><i class="fa fa-check"></i><b>2.8</b> Differences from more traditional (general linear model-based) approaches</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html"><i class="fa fa-check"></i><b>3</b> From verbal to formal models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>3.1</b> Defining general conditions</a></li>
<li class="chapter" data-level="3.2" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>3.2</b> Implementing a random agent</a></li>
<li class="chapter" data-level="3.3" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>3.3</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="3.4" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>3.4</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="from-verbal-to-formal-models.html"><a href="from-verbal-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>3.4.1</b> And we visualize it</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html"><i class="fa fa-check"></i><b>4</b> Practical exercise 3 - Getting into Stan</a>
<ul>
<li class="chapter" data-level="4.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#simulating-data"><i class="fa fa-check"></i><b>4.2</b> Simulating data</a></li>
<li class="chapter" data-level="4.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#building-our-basic-model-in-stan"><i class="fa fa-check"></i><b>4.3</b> Building our basic model in Stan</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#data"><i class="fa fa-check"></i><b>4.3.1</b> Data</a></li>
<li class="chapter" data-level="4.3.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#model"><i class="fa fa-check"></i><b>4.3.2</b> Model</a></li>
<li class="chapter" data-level="4.3.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#compiling-and-fitting-the-model"><i class="fa fa-check"></i><b>4.3.3</b> Compiling and fitting the model</a></li>
<li class="chapter" data-level="4.3.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-model"><i class="fa fa-check"></i><b>4.3.4</b> Summarizing the model</a></li>
<li class="chapter" data-level="4.3.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#assessing-model-quality"><i class="fa fa-check"></i><b>4.3.5</b> Assessing model quality</a></li>
<li class="chapter" data-level="4.3.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-results"><i class="fa fa-check"></i><b>4.3.6</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#parameter-recovery"><i class="fa fa-check"></i><b>4.4</b> Parameter recovery</a></li>
<li class="chapter" data-level="4.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#the-memory-model-conditioning-theta"><i class="fa fa-check"></i><b>4.5</b> The memory model: conditioning theta</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-results-1"><i class="fa fa-check"></i><b>4.5.1</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#memory-agent-with-internal-parameter"><i class="fa fa-check"></i><b>4.6</b> Memory agent with internal parameter</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#trying-out-a-more-complex-memory-model-with-a-rate-of-forgetting-that-exponentially-discounts-the-past"><i class="fa fa-check"></i><b>4.6.1</b> Trying out a more complex memory model, with a rate of forgetting that exponentially discounts the past</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html"><i class="fa fa-check"></i><b>5</b> Practical exercise 4 - Model quality checks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#generating-and-plotting-additional-variables"><i class="fa fa-check"></i><b>5.1</b> Generating and plotting additional variables</a></li>
<li class="chapter" data-level="5.2" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-priors"><i class="fa fa-check"></i><b>5.2</b> Assessing priors</a></li>
<li class="chapter" data-level="5.3" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-prior-and-posterior-predictions"><i class="fa fa-check"></i><b>5.3</b> Assessing prior and posterior predictions</a></li>
<li class="chapter" data-level="5.4" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>5.4</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="5.5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#the-memory-model"><i class="fa fa-check"></i><b>5.5</b> The memory model</a></li>
<li class="chapter" data-level="5.6" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-check-for-the-memory-model"><i class="fa fa-check"></i><b>5.6</b> Prior sensitivity check for the memory model</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html"><i class="fa fa-check"></i><b>6</b> Multilevel modeling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#intro-to-multilevel-modeling"><i class="fa fa-check"></i><b>6.1</b> Intro to multilevel modeling</a></li>
<li class="chapter" data-level="6.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#a-multilevel-version-of-the-biased-agent-and-of-the-simple-memory-agent"><i class="fa fa-check"></i><b>6.2</b> A multilevel version of the biased agent and of the simple memory agent</a></li>
<li class="chapter" data-level="6.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#generating-the-agents"><i class="fa fa-check"></i><b>6.3</b> Generating the agents</a></li>
<li class="chapter" data-level="6.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#plotting-the-agents"><i class="fa fa-check"></i><b>6.4</b> Plotting the agents</a></li>
<li class="chapter" data-level="6.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#coding-the-multilevel-agents"><i class="fa fa-check"></i><b>6.5</b> Coding the multilevel agents</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-random"><i class="fa fa-check"></i><b>6.5.1</b> Multilevel random</a></li>
<li class="chapter" data-level="6.5.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-random-agents"><i class="fa fa-check"></i><b>6.5.2</b> Assessing multilevel random agents</a></li>
<li class="chapter" data-level="6.5.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory"><i class="fa fa-check"></i><b>6.5.3</b> Multilevel memory</a></li>
<li class="chapter" data-level="6.5.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory"><i class="fa fa-check"></i><b>6.5.4</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization"><i class="fa fa-check"></i><b>6.5.5</b> Multilevel memory with non centered parameterization</a></li>
<li class="chapter" data-level="6.5.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-1"><i class="fa fa-check"></i><b>6.5.6</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.7" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters"><i class="fa fa-check"></i><b>6.5.7</b> Multilevel memory with correlation between parameters</a></li>
<li class="chapter" data-level="6.5.8" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-2"><i class="fa fa-check"></i><b>6.5.8</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.9" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-no-pooling"><i class="fa fa-check"></i><b>6.5.9</b> Multilevel memory no pooling</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-full-pooling"><i class="fa fa-check"></i><b>6.6</b> Multilevel full pooling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="model-comparison.html"><a href="model-comparison.html"><i class="fa fa-check"></i><b>7</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.1" data-path="model-comparison.html"><a href="model-comparison.html#define-parameters"><i class="fa fa-check"></i><b>7.1</b> Define parameters</a></li>
<li class="chapter" data-level="7.2" data-path="model-comparison.html"><a href="model-comparison.html#define-biased-and-memory-agents"><i class="fa fa-check"></i><b>7.2</b> Define biased and memory agents</a></li>
<li class="chapter" data-level="7.3" data-path="model-comparison.html"><a href="model-comparison.html#generating-the-agents-1"><i class="fa fa-check"></i><b>7.3</b> Generating the agents</a></li>
<li class="chapter" data-level="7.4" data-path="model-comparison.html"><a href="model-comparison.html#prep-the-data"><i class="fa fa-check"></i><b>7.4</b> Prep the data</a></li>
<li class="chapter" data-level="7.5" data-path="model-comparison.html"><a href="model-comparison.html#log-posterior-likelihood"><i class="fa fa-check"></i><b>7.5</b> Log posterior likelihood</a></li>
<li class="chapter" data-level="7.6" data-path="model-comparison.html"><a href="model-comparison.html#create-the-models-multilevel-biased-agents"><i class="fa fa-check"></i><b>7.6</b> Create the models: multilevel biased agents</a></li>
<li class="chapter" data-level="7.7" data-path="model-comparison.html"><a href="model-comparison.html#multilevel-memory-model"><i class="fa fa-check"></i><b>7.7</b> Multilevel memory model</a></li>
<li class="chapter" data-level="7.8" data-path="model-comparison.html"><a href="model-comparison.html#fitting-the-models-to-the-data"><i class="fa fa-check"></i><b>7.8</b> Fitting the models to the data</a></li>
<li class="chapter" data-level="7.9" data-path="model-comparison.html"><a href="model-comparison.html#calculating-the-expected-log-predictive-density-of-a-model"><i class="fa fa-check"></i><b>7.9</b> Calculating the expected log predictive density of a model</a></li>
<li class="chapter" data-level="7.10" data-path="model-comparison.html"><a href="model-comparison.html#implementing-cross-validation"><i class="fa fa-check"></i><b>7.10</b> Implementing Cross-Validation</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="model-comparison.html"><a href="model-comparison.html#create-cross-validation-ready-stan-model-for-biased-agents"><i class="fa fa-check"></i><b>7.10.1</b> Create cross-validation ready stan model for biased agents</a></li>
<li class="chapter" data-level="7.10.2" data-path="model-comparison.html"><a href="model-comparison.html#create-cross-validation-ready-stan-model-for-memory-agents"><i class="fa fa-check"></i><b>7.10.2</b> Create cross-validation ready stan model for memory agents</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="model-comparison.html"><a href="model-comparison.html#calculating-elpd-and-comparing"><i class="fa fa-check"></i><b>7.11</b> Calculating elpd and comparing</a></li>
<li class="chapter" data-level="7.12" data-path="model-comparison.html"><a href="model-comparison.html#limitations-of-model-comparison-techniques"><i class="fa fa-check"></i><b>7.12</b> Limitations of model comparison techniques</a></li>
<li class="chapter" data-level="7.13" data-path="model-comparison.html"><a href="model-comparison.html#mixture-models"><i class="fa fa-check"></i><b>7.13</b> Mixture models</a>
<ul>
<li class="chapter" data-level="7.13.1" data-path="model-comparison.html"><a href="model-comparison.html#load-the-dataset"><i class="fa fa-check"></i><b>7.13.1</b> Load the dataset</a></li>
</ul></li>
<li class="chapter" data-level="7.14" data-path="model-comparison.html"><a href="model-comparison.html#stan-model-mixing-biased-and-noise"><i class="fa fa-check"></i><b>7.14</b> Stan model mixing biased and noise</a></li>
<li class="chapter" data-level="7.15" data-path="model-comparison.html"><a href="model-comparison.html#fitting-and-assessing-the-model"><i class="fa fa-check"></i><b>7.15</b> Fitting and assessing the model</a></li>
<li class="chapter" data-level="7.16" data-path="model-comparison.html"><a href="model-comparison.html#basic-evaluation"><i class="fa fa-check"></i><b>7.16</b> Basic evaluation</a></li>
<li class="chapter" data-level="7.17" data-path="model-comparison.html"><a href="model-comparison.html#multilevel-mixture-model"><i class="fa fa-check"></i><b>7.17</b> Multilevel mixture model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html"><i class="fa fa-check"></i><b>8</b> Bonus chapter: Additional models developed by students</a>
<ul>
<li class="chapter" data-level="8.1" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#additional-models"><i class="fa fa-check"></i><b>8.1</b> Additional models</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#probabilistic-win-stay-lose-shift"><i class="fa fa-check"></i><b>8.1.1</b> Probabilistic Win Stay Lose Shift</a></li>
<li class="chapter" data-level="8.1.2" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#probabilistic-asymmetric-win-stay-lose-shift"><i class="fa fa-check"></i><b>8.1.2</b> Probabilistic asymmetric Win Stay Lose Shift</a></li>
<li class="chapter" data-level="8.1.3" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-rate"><i class="fa fa-check"></i><b>8.1.3</b> Memory agent with exponential memory decay (rate)</a></li>
<li class="chapter" data-level="8.1.4" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-exponential"><i class="fa fa-check"></i><b>8.1.4</b> Memory agent with exponential memory decay (exponential)</a></li>
<li class="chapter" data-level="8.1.5" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-but-separate-memory-for-wins-and-losses"><i class="fa fa-check"></i><b>8.1.5</b> Memory agent with exponential memory decay, but separate memory for wins and losses</a></li>
<li class="chapter" data-level="8.1.6" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-and-with-confidence"><i class="fa fa-check"></i><b>8.1.6</b> Memory agent with exponential memory decay, and with confidence</a></li>
<li class="chapter" data-level="8.1.7" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#reinforcement-learning-rescorla-wagner"><i class="fa fa-check"></i><b>8.1.7</b> Reinforcement learning (Rescorla Wagner)</a></li>
<li class="chapter" data-level="8.1.8" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#hierarchical-gaussian-filter"><i class="fa fa-check"></i><b>8.1.8</b> Hierarchical gaussian filter</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#implementing-the-wsls-model"><i class="fa fa-check"></i><b>8.2</b> Implementing the WSLS model</a></li>
<li class="chapter" data-level="8.3" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#load-packages"><i class="fa fa-check"></i><b>8.3</b> Load packages</a></li>
<li class="chapter" data-level="8.4" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#generate-data"><i class="fa fa-check"></i><b>8.4</b> Generate data</a></li>
<li class="chapter" data-level="8.5" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#sanity-check-for-the-data"><i class="fa fa-check"></i><b>8.5</b> Sanity check for the data</a></li>
<li class="chapter" data-level="8.6" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#more-sanity-check"><i class="fa fa-check"></i><b>8.6</b> More sanity check</a></li>
<li class="chapter" data-level="8.7" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-data-for-single-agent-model"><i class="fa fa-check"></i><b>8.7</b> Create data for single agent model</a></li>
<li class="chapter" data-level="8.8" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-the-model"><i class="fa fa-check"></i><b>8.8</b> Create the model</a></li>
<li class="chapter" data-level="8.9" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#basic-assessment"><i class="fa fa-check"></i><b>8.9</b> Basic assessment</a></li>
<li class="chapter" data-level="8.10" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-multilevel-data"><i class="fa fa-check"></i><b>8.10</b> Create multilevel data</a></li>
<li class="chapter" data-level="8.11" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-the-model-1"><i class="fa fa-check"></i><b>8.11</b> Create the model</a></li>
<li class="chapter" data-level="8.12" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#quality-checks"><i class="fa fa-check"></i><b>8.12</b> Quality checks</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html"><i class="fa fa-check"></i><b>9</b> Bayesian models of cognition</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#load-the-packages"><i class="fa fa-check"></i><b>9.1</b> Load the packages</a></li>
<li class="chapter" data-level="9.2" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#design-the-model"><i class="fa fa-check"></i><b>9.2</b> Design the model</a></li>
<li class="chapter" data-level="9.3" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#create-the-data"><i class="fa fa-check"></i><b>9.3</b> Create the data</a></li>
<li class="chapter" data-level="9.4" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#visualize"><i class="fa fa-check"></i><b>9.4</b> Visualize</a></li>
<li class="chapter" data-level="9.5" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#data-for-stan"><i class="fa fa-check"></i><b>9.5</b> Data for Stan</a></li>
<li class="chapter" data-level="9.6" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#create-the-stan-model"><i class="fa fa-check"></i><b>9.6</b> Create the Stan Model</a></li>
<li class="chapter" data-level="9.7" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#fitting-the-model"><i class="fa fa-check"></i><b>9.7</b> Fitting the model</a></li>
<li class="chapter" data-level="9.8" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#basic-evaluation-1"><i class="fa fa-check"></i><b>9.8</b> Basic evaluation</a></li>
<li class="chapter" data-level="9.9" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#weighted-bayes"><i class="fa fa-check"></i><b>9.9</b> Weighted Bayes</a></li>
<li class="chapter" data-level="9.10" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#visualize-1"><i class="fa fa-check"></i><b>9.10</b> Visualize</a></li>
<li class="chapter" data-level="9.11" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#build-the-weighted-bayes-stan-model-simple-formula"><i class="fa fa-check"></i><b>9.11</b> Build the Weighted Bayes Stan model (simple formula)</a></li>
<li class="chapter" data-level="9.12" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#model-evaluation"><i class="fa fa-check"></i><b>9.12</b> Model evaluation</a></li>
<li class="chapter" data-level="9.13" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#model-recovery"><i class="fa fa-check"></i><b>9.13</b> Model recovery</a></li>
<li class="chapter" data-level="9.14" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel"><i class="fa fa-check"></i><b>9.14</b> Multilevel</a></li>
<li class="chapter" data-level="9.15" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#bonus-build-the-weighted-bayes-stan-model-fancier-formula"><i class="fa fa-check"></i><b>9.15</b> Bonus: Build the Weighted Bayes Stan model (fancier formula)</a></li>
<li class="chapter" data-level="9.16" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#evaluation"><i class="fa fa-check"></i><b>9.16</b> Evaluation</a></li>
<li class="chapter" data-level="9.17" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#build-a-temporal-bayes-storing-current-belief-as-prior-for-next-turn"><i class="fa fa-check"></i><b>9.17</b> Build a temporal Bayes (storing current belief as prior for next turn)</a></li>
<li class="chapter" data-level="9.18" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#evaluate"><i class="fa fa-check"></i><b>9.18</b> Evaluate</a></li>
<li class="chapter" data-level="9.19" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel-version-of-the-simple-bayes-model"><i class="fa fa-check"></i><b>9.19</b> Multilevel version of the simple bayes model</a></li>
<li class="chapter" data-level="9.20" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel-version-of-the-weighted-bayes-model"><i class="fa fa-check"></i><b>9.20</b> Multilevel version of the weighted bayes model</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="categorization-models.html"><a href="categorization-models.html"><i class="fa fa-check"></i><b>10</b> Categorization models</a>
<ul>
<li class="chapter" data-level="10.1" data-path="categorization-models.html"><a href="categorization-models.html#multilevel-gcm"><i class="fa fa-check"></i><b>10.1</b> Multilevel GCM</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="categorization-models.html"><a href="categorization-models.html#simulate-hierarchical-simplices"><i class="fa fa-check"></i><b>10.1.1</b> Simulate hierarchical simplices</a></li>
<li class="chapter" data-level="10.1.2" data-path="categorization-models.html"><a href="categorization-models.html#set-up-the-data-simulation"><i class="fa fa-check"></i><b>10.1.2</b> Set up the data simulation</a></li>
<li class="chapter" data-level="10.1.3" data-path="categorization-models.html"><a href="categorization-models.html#set-up-the-stan-model"><i class="fa fa-check"></i><b>10.1.3</b> Set up the Stan model</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="categorization-models.html"><a href="categorization-models.html#now-we-parallelize-n.b.-not-finished"><i class="fa fa-check"></i><b>10.2</b> Now we parallelize [N.B. NOT FINISHED]</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="categorization-models.html"><a href="categorization-models.html#student-produced-models-of-categorization"><i class="fa fa-check"></i><b>10.2.1</b> Student-produced models of categorization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="categorization-models-1.html"><a href="categorization-models-1.html"><i class="fa fa-check"></i><b>11</b> Categorization models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="categorization-models-1.html"><a href="categorization-models-1.html#defining-parameters"><i class="fa fa-check"></i><b>11.1</b> Defining parameters</a></li>
<li class="chapter" data-level="11.2" data-path="categorization-models-1.html"><a href="categorization-models-1.html#simulating-with-alpha-0.9-and-p-0.9"><i class="fa fa-check"></i><b>11.2</b> Simulating with alpha 0.9 and p 0.9</a></li>
<li class="chapter" data-level="11.3" data-path="categorization-models-1.html"><a href="categorization-models-1.html#simulating-with-p-0.75"><i class="fa fa-check"></i><b>11.3</b> Simulating with p = 0.75</a></li>
<li class="chapter" data-level="11.4" data-path="categorization-models-1.html"><a href="categorization-models-1.html#what-about-asymmetric-learning"><i class="fa fa-check"></i><b>11.4</b> What about asymmetric learning?</a></li>
<li class="chapter" data-level="11.5" data-path="categorization-models-1.html"><a href="categorization-models-1.html#model-fitting-symmetric-rl"><i class="fa fa-check"></i><b>11.5</b> Model fitting: symmetric RL</a></li>
<li class="chapter" data-level="11.6" data-path="categorization-models-1.html"><a href="categorization-models-1.html#model-fitting-asymmetric-rl"><i class="fa fa-check"></i><b>11.6</b> Model fitting: asymmetric RL</a></li>
<li class="chapter" data-level="11.7" data-path="categorization-models-1.html"><a href="categorization-models-1.html#model-fitting-multilevel"><i class="fa fa-check"></i><b>11.7</b> Model fitting: multilevel</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">11 - Reinforcement Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-comparison" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Model comparison<a href="model-comparison.html#model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>[MISSING INTRO]</p>
<p>Imagine having several models of what might be going on and want to know which is the best explanation of the data. E.g. Are people more likely to use a memory strategy, or a win stay lose shift strategy? Or are we justified in assuming that people react differently to losses than to wins (e.g. by being more likely to shift when losing, than to stay when winning)? Or would we be justified in assuming that capuchin monkeys and cognitive science students use the same model?</p>
<p>Model comparison defines a broad range of practices aimed at identifying among a set of models the best model for a given data set. What “best” means is, however, a non-trivial question. Ideally, “best” would mean the model describing the mechanism that actually generated the data. However, as we will see that is a tricky proposition and we analysts tend to rely on proxies. There are many of such proxies in the literature. For instance, Nicenboim et al (2023) suggests employing either Bayes Factors or cross-validation (<a href="https://vasishth.github.io/bayescogsci/book/ch-comparison.html" class="uri">https://vasishth.github.io/bayescogsci/book/ch-comparison.html</a>). In this course, we rely on cross-validation based predictive performance (this chapter) and mixture models (next chapter).</p>
<p>In other words, this chapter will assess models in terms of their (estimated) ability to predict new (test) data. Remember that predictive performance is a very useful tool, but not a magical solution. It allows us to combat overfitting to the training sample (your model snuggling to your data so much that it fits both signal and noise), but it has key limitations, which we will discuss at the end of the chapter.</p>
<p>To learn how to make model comparison, in this chapter, we rely on our usual simulation based approach to ensure that the method is doing what we want. We simulate the behavior of biased agents playing against the memory agents. This provides us with data generated according to two different mechanisms: biased agents and memory agents. We can fit both models separately on each of the two sets of agents, so we can compare the relative performance of the two models: can we identify the true model generating the data (in a setup where truth is known)? This is what is usually called “model recovery” and complements nicely “parameter recovery”. In model recovery we assess whether we can identify the correct model, in parameter recovery we assess whether - once we know the correct model - we can identify the correct parameter values.</p>
<p>Let’s get going.</p>
<div id="define-parameters" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Define parameters<a href="model-comparison.html#define-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="model-comparison.html#cb174-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,</span>
<span id="cb174-2"><a href="model-comparison.html#cb174-2" tabindex="-1"></a>               here,</span>
<span id="cb174-3"><a href="model-comparison.html#cb174-3" tabindex="-1"></a>               posterior,</span>
<span id="cb174-4"><a href="model-comparison.html#cb174-4" tabindex="-1"></a>               cmdstanr,</span>
<span id="cb174-5"><a href="model-comparison.html#cb174-5" tabindex="-1"></a>               brms, </span>
<span id="cb174-6"><a href="model-comparison.html#cb174-6" tabindex="-1"></a>               tidybayes, </span>
<span id="cb174-7"><a href="model-comparison.html#cb174-7" tabindex="-1"></a>               loo, job)</span>
<span id="cb174-8"><a href="model-comparison.html#cb174-8" tabindex="-1"></a></span>
<span id="cb174-9"><a href="model-comparison.html#cb174-9" tabindex="-1"></a><span class="co"># Shared parameters</span></span>
<span id="cb174-10"><a href="model-comparison.html#cb174-10" tabindex="-1"></a>agents <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb174-11"><a href="model-comparison.html#cb174-11" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb174-12"><a href="model-comparison.html#cb174-12" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb174-13"><a href="model-comparison.html#cb174-13" tabindex="-1"></a></span>
<span id="cb174-14"><a href="model-comparison.html#cb174-14" tabindex="-1"></a><span class="co"># Biased agents parameters</span></span>
<span id="cb174-15"><a href="model-comparison.html#cb174-15" tabindex="-1"></a>rateM <span class="ot">&lt;-</span> <span class="fl">1.386</span> <span class="co"># roughly 0.8 once inv_logit scaled</span></span>
<span id="cb174-16"><a href="model-comparison.html#cb174-16" tabindex="-1"></a>rateSD <span class="ot">&lt;-</span> <span class="fl">0.65</span> <span class="co"># roughly giving a sd of 0.1 in prob scale</span></span>
<span id="cb174-17"><a href="model-comparison.html#cb174-17" tabindex="-1"></a></span>
<span id="cb174-18"><a href="model-comparison.html#cb174-18" tabindex="-1"></a><span class="co"># Memory agents parameters</span></span>
<span id="cb174-19"><a href="model-comparison.html#cb174-19" tabindex="-1"></a>biasM <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb174-20"><a href="model-comparison.html#cb174-20" tabindex="-1"></a>biasSD <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb174-21"><a href="model-comparison.html#cb174-21" tabindex="-1"></a>betaM <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb174-22"><a href="model-comparison.html#cb174-22" tabindex="-1"></a>betaSD <span class="ot">&lt;-</span> <span class="fl">0.3</span></span></code></pre></div>
</div>
<div id="define-biased-and-memory-agents" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Define biased and memory agents<a href="model-comparison.html#define-biased-and-memory-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="model-comparison.html#cb175-1" tabindex="-1"></a><span class="co"># Functions of the agents</span></span>
<span id="cb175-2"><a href="model-comparison.html#cb175-2" tabindex="-1"></a>RandomAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(rate, noise) {</span>
<span id="cb175-3"><a href="model-comparison.html#cb175-3" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">inv_logit_scaled</span>(rate))</span>
<span id="cb175-4"><a href="model-comparison.html#cb175-4" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb175-5"><a href="model-comparison.html#cb175-5" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb175-6"><a href="model-comparison.html#cb175-6" tabindex="-1"></a>  }</span>
<span id="cb175-7"><a href="model-comparison.html#cb175-7" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb175-8"><a href="model-comparison.html#cb175-8" tabindex="-1"></a>}</span>
<span id="cb175-9"><a href="model-comparison.html#cb175-9" tabindex="-1"></a></span>
<span id="cb175-10"><a href="model-comparison.html#cb175-10" tabindex="-1"></a>MemoryAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(bias, beta, otherRate, noise) {</span>
<span id="cb175-11"><a href="model-comparison.html#cb175-11" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">inv_logit_scaled</span>(bias <span class="sc">+</span> beta <span class="sc">*</span> <span class="fu">logit_scaled</span>(otherRate))</span>
<span id="cb175-12"><a href="model-comparison.html#cb175-12" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, rate)</span>
<span id="cb175-13"><a href="model-comparison.html#cb175-13" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb175-14"><a href="model-comparison.html#cb175-14" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb175-15"><a href="model-comparison.html#cb175-15" tabindex="-1"></a>  }</span>
<span id="cb175-16"><a href="model-comparison.html#cb175-16" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb175-17"><a href="model-comparison.html#cb175-17" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="generating-the-agents-1" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Generating the agents<a href="model-comparison.html#generating-the-agents-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: PARALLELIZE]</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="model-comparison.html#cb176-1" tabindex="-1"></a><span class="co"># Looping through all the agents to generate the data.</span></span>
<span id="cb176-2"><a href="model-comparison.html#cb176-2" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb176-3"><a href="model-comparison.html#cb176-3" tabindex="-1"></a></span>
<span id="cb176-4"><a href="model-comparison.html#cb176-4" tabindex="-1"></a><span class="cf">for</span> (agent <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>agents) {</span>
<span id="cb176-5"><a href="model-comparison.html#cb176-5" tabindex="-1"></a>  </span>
<span id="cb176-6"><a href="model-comparison.html#cb176-6" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, rateM, rateSD)</span>
<span id="cb176-7"><a href="model-comparison.html#cb176-7" tabindex="-1"></a>  bias <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, biasM, biasSD)</span>
<span id="cb176-8"><a href="model-comparison.html#cb176-8" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, betaM, betaSD)</span>
<span id="cb176-9"><a href="model-comparison.html#cb176-9" tabindex="-1"></a>  </span>
<span id="cb176-10"><a href="model-comparison.html#cb176-10" tabindex="-1"></a>  randomChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb176-11"><a href="model-comparison.html#cb176-11" tabindex="-1"></a>  memoryChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb176-12"><a href="model-comparison.html#cb176-12" tabindex="-1"></a>  memoryRate <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb176-13"><a href="model-comparison.html#cb176-13" tabindex="-1"></a>  </span>
<span id="cb176-14"><a href="model-comparison.html#cb176-14" tabindex="-1"></a>  <span class="cf">for</span> (trial <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>trials) {</span>
<span id="cb176-15"><a href="model-comparison.html#cb176-15" tabindex="-1"></a>    </span>
<span id="cb176-16"><a href="model-comparison.html#cb176-16" tabindex="-1"></a>    randomChoice[trial] <span class="ot">&lt;-</span> <span class="fu">RandomAgentNoise_f</span>(rate, noise)</span>
<span id="cb176-17"><a href="model-comparison.html#cb176-17" tabindex="-1"></a>    <span class="cf">if</span> (trial <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb176-18"><a href="model-comparison.html#cb176-18" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)</span>
<span id="cb176-19"><a href="model-comparison.html#cb176-19" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb176-20"><a href="model-comparison.html#cb176-20" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">MemoryAgentNoise_f</span>(bias, beta, <span class="fu">mean</span>(randomChoice[<span class="dv">1</span><span class="sc">:</span>trial], <span class="at">na.rm =</span> T), noise)</span>
<span id="cb176-21"><a href="model-comparison.html#cb176-21" tabindex="-1"></a>    }</span>
<span id="cb176-22"><a href="model-comparison.html#cb176-22" tabindex="-1"></a>  }</span>
<span id="cb176-23"><a href="model-comparison.html#cb176-23" tabindex="-1"></a>  </span>
<span id="cb176-24"><a href="model-comparison.html#cb176-24" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(agent, <span class="at">trial =</span> <span class="fu">seq</span>(trials), randomChoice, <span class="at">randomRate =</span> rate, memoryChoice, memoryRate, noise, rateM, rateSD, bias, beta, biasM, biasSD, betaM, betaSD)</span>
<span id="cb176-25"><a href="model-comparison.html#cb176-25" tabindex="-1"></a>  </span>
<span id="cb176-26"><a href="model-comparison.html#cb176-26" tabindex="-1"></a>  <span class="cf">if</span> (agent <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb176-27"><a href="model-comparison.html#cb176-27" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d, temp)</span>
<span id="cb176-28"><a href="model-comparison.html#cb176-28" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb176-29"><a href="model-comparison.html#cb176-29" tabindex="-1"></a>    d <span class="ot">&lt;-</span> temp</span>
<span id="cb176-30"><a href="model-comparison.html#cb176-30" tabindex="-1"></a>  }</span>
<span id="cb176-31"><a href="model-comparison.html#cb176-31" tabindex="-1"></a>  </span>
<span id="cb176-32"><a href="model-comparison.html#cb176-32" tabindex="-1"></a>}</span>
<span id="cb176-33"><a href="model-comparison.html#cb176-33" tabindex="-1"></a></span>
<span id="cb176-34"><a href="model-comparison.html#cb176-34" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(agent) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb176-35"><a href="model-comparison.html#cb176-35" tabindex="-1"></a>  <span class="at">randomRate =</span> <span class="fu">cumsum</span>(randomChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(randomChoice),</span>
<span id="cb176-36"><a href="model-comparison.html#cb176-36" tabindex="-1"></a>  <span class="at">memoryRate =</span> <span class="fu">cumsum</span>(memoryChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(memoryChoice)</span>
<span id="cb176-37"><a href="model-comparison.html#cb176-37" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="prep-the-data" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Prep the data<a href="model-comparison.html#prep-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="model-comparison.html#cb177-1" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb177-2"><a href="model-comparison.html#cb177-2" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb177-3"><a href="model-comparison.html#cb177-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb177-4"><a href="model-comparison.html#cb177-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb177-5"><a href="model-comparison.html#cb177-5" tabindex="-1"></a></span>
<span id="cb177-6"><a href="model-comparison.html#cb177-6" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb177-7"><a href="model-comparison.html#cb177-7" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb177-8"><a href="model-comparison.html#cb177-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb177-9"><a href="model-comparison.html#cb177-9" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb177-10"><a href="model-comparison.html#cb177-10" tabindex="-1"></a></span>
<span id="cb177-11"><a href="model-comparison.html#cb177-11" tabindex="-1"></a><span class="do">## Create the data</span></span>
<span id="cb177-12"><a href="model-comparison.html#cb177-12" tabindex="-1"></a>data_biased <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb177-13"><a href="model-comparison.html#cb177-13" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb177-14"><a href="model-comparison.html#cb177-14" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb177-15"><a href="model-comparison.html#cb177-15" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb177-16"><a href="model-comparison.html#cb177-16" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb177-17"><a href="model-comparison.html#cb177-17" tabindex="-1"></a>)</span>
<span id="cb177-18"><a href="model-comparison.html#cb177-18" tabindex="-1"></a></span>
<span id="cb177-19"><a href="model-comparison.html#cb177-19" tabindex="-1"></a>data_memory <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb177-20"><a href="model-comparison.html#cb177-20" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb177-21"><a href="model-comparison.html#cb177-21" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb177-22"><a href="model-comparison.html#cb177-22" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb177-23"><a href="model-comparison.html#cb177-23" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb177-24"><a href="model-comparison.html#cb177-24" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="log-posterior-likelihood" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Log posterior likelihood<a href="model-comparison.html#log-posterior-likelihood" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While the previous sections did not present any new materials (and therefore weren’t much commented), as we create our Stan models to fit to the data, we need to (re)introduce the notion of log-likelihood, or even better, log posterior likelihood.</p>
<p>Given certain values for our parameters (let’s say a bias of 0 and beta for memory of 1) and for our variables (let’s say the vector of memory values estimated by the agent on a trial by trial basis), the model will predict a certain distribution of outcomes, that is, a certain distribution of choices (n times right, m times left hand). Comparing this to the actual data, we can identify how likely the model is to produce it. In other words, the probability that the model will actually generate the data we observed out of all its possible outcomes. Remember that we are doing Bayesian statistics, so this probability needs to be combined with the probability of the parameter values given the priors on those parameters. This would give us a <em>posterior likelihood</em> of the model’s parameter values given the data. The last step is that we need to work on a log scale. Working on a log scale is very useful because it avoids low probabilities (close to 0) being rounded down to exactly 0. [MISSING A LINK TO A LENGTHIER EXPLANATION]. By log-transforming the posterior likelihood, we now have the <em>log-posterior likelihood</em>.</p>
<p>Now, remember that our agent’s memory varies on a trial by trial level. In other words, for each data point, for each agent we can calculate separate values of log-posterior likelihood for each of the possible values of the parameters. That is, we can have a distribution of log-posterior likelihood for each data point.</p>
<p>Luckily for us telling Stan to calculate and such distributions is extremely easy: we just need to add to the generated quantities block the same log probability density/mass statement that we use in the model block, but here we specify it should be saved (replacing target += with an actual variable to be filled).</p>
<p>N.B. Some of you might be wandering: if Stan is already using the log-posterior probability in the sampling process, why do we need to tell it to calculate and save it? Fair enough point. But Stan does not save by default (to avoid clogging your computer with endless data) and we need the log posterior likelihood saved as “log_lik” in order to be able to use more automated functions later on.</p>
</div>
<div id="create-the-models-multilevel-biased-agents" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Create the models: multilevel biased agents<a href="model-comparison.html#create-the-models-multilevel-biased-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Remember to add the log_lik part in the generated quantities block!</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="model-comparison.html#cb178-1" tabindex="-1"></a>stan_biased_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb178-2"><a href="model-comparison.html#cb178-2" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb178-3"><a href="model-comparison.html#cb178-3" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { // normal distribution with a lower bound</span></span>
<span id="cb178-4"><a href="model-comparison.html#cb178-4" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb178-5"><a href="model-comparison.html#cb178-5" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb178-6"><a href="model-comparison.html#cb178-6" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb178-7"><a href="model-comparison.html#cb178-7" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb178-8"><a href="model-comparison.html#cb178-8" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb178-9"><a href="model-comparison.html#cb178-9" tabindex="-1"></a></span>
<span id="cb178-10"><a href="model-comparison.html#cb178-10" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of hands</span></span>
<span id="cb178-11"><a href="model-comparison.html#cb178-11" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb178-12"><a href="model-comparison.html#cb178-12" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb178-13"><a href="model-comparison.html#cb178-13" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb178-14"><a href="model-comparison.html#cb178-14" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb178-15"><a href="model-comparison.html#cb178-15" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb178-16"><a href="model-comparison.html#cb178-16" tabindex="-1"></a></span>
<span id="cb178-17"><a href="model-comparison.html#cb178-17" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb178-18"><a href="model-comparison.html#cb178-18" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb178-19"><a href="model-comparison.html#cb178-19" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb178-20"><a href="model-comparison.html#cb178-20" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;</span></span>
<span id="cb178-21"><a href="model-comparison.html#cb178-21" tabindex="-1"></a><span class="st">  array[agents] real theta;</span></span>
<span id="cb178-22"><a href="model-comparison.html#cb178-22" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb178-23"><a href="model-comparison.html#cb178-23" tabindex="-1"></a></span>
<span id="cb178-24"><a href="model-comparison.html#cb178-24" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb178-25"><a href="model-comparison.html#cb178-25" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb178-26"><a href="model-comparison.html#cb178-26" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb178-27"><a href="model-comparison.html#cb178-27" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3)  -</span></span>
<span id="cb178-28"><a href="model-comparison.html#cb178-28" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb178-29"><a href="model-comparison.html#cb178-29" tabindex="-1"></a></span>
<span id="cb178-30"><a href="model-comparison.html#cb178-30" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb178-31"><a href="model-comparison.html#cb178-31" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb178-32"><a href="model-comparison.html#cb178-32" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb178-33"><a href="model-comparison.html#cb178-33" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb178-34"><a href="model-comparison.html#cb178-34" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb178-35"><a href="model-comparison.html#cb178-35" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb178-36"><a href="model-comparison.html#cb178-36" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb178-37"><a href="model-comparison.html#cb178-37" tabindex="-1"></a></span>
<span id="cb178-38"><a href="model-comparison.html#cb178-38" tabindex="-1"></a></span>
<span id="cb178-39"><a href="model-comparison.html#cb178-39" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb178-40"><a href="model-comparison.html#cb178-40" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb178-41"><a href="model-comparison.html#cb178-41" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb178-42"><a href="model-comparison.html#cb178-42" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb178-43"><a href="model-comparison.html#cb178-43" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb178-44"><a href="model-comparison.html#cb178-44" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb178-45"><a href="model-comparison.html#cb178-45" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb178-46"><a href="model-comparison.html#cb178-46" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb178-47"><a href="model-comparison.html#cb178-47" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb178-48"><a href="model-comparison.html#cb178-48" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb178-49"><a href="model-comparison.html#cb178-49" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb178-50"><a href="model-comparison.html#cb178-50" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb178-51"><a href="model-comparison.html#cb178-51" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb178-52"><a href="model-comparison.html#cb178-52" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb178-53"><a href="model-comparison.html#cb178-53" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb178-54"><a href="model-comparison.html#cb178-54" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb178-55"><a href="model-comparison.html#cb178-55" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb178-56"><a href="model-comparison.html#cb178-56" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb178-57"><a href="model-comparison.html#cb178-57" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb178-58"><a href="model-comparison.html#cb178-58" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb178-59"><a href="model-comparison.html#cb178-59" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb178-60"><a href="model-comparison.html#cb178-60" tabindex="-1"></a><span class="st">      log_lik[t,i] = bernoulli_logit_lpmf(h[t,i] | theta[i]);</span></span>
<span id="cb178-61"><a href="model-comparison.html#cb178-61" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb178-62"><a href="model-comparison.html#cb178-62" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb178-63"><a href="model-comparison.html#cb178-63" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb178-64"><a href="model-comparison.html#cb178-64" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb178-65"><a href="model-comparison.html#cb178-65" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb178-66"><a href="model-comparison.html#cb178-66" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb178-67"><a href="model-comparison.html#cb178-67" tabindex="-1"></a>  stan_biased_model,</span>
<span id="cb178-68"><a href="model-comparison.html#cb178-68" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb178-69"><a href="model-comparison.html#cb178-69" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelBias.stan&quot;</span>)</span>
<span id="cb178-70"><a href="model-comparison.html#cb178-70" tabindex="-1"></a></span>
<span id="cb178-71"><a href="model-comparison.html#cb178-71" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelBias.stan&quot;</span>)</span>
<span id="cb178-72"><a href="model-comparison.html#cb178-72" tabindex="-1"></a>mod_biased <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb178-73"><a href="model-comparison.html#cb178-73" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb178-74"><a href="model-comparison.html#cb178-74" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
</div>
<div id="multilevel-memory-model" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> Multilevel memory model<a href="model-comparison.html#multilevel-memory-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="model-comparison.html#cb179-1" tabindex="-1"></a>stan_memory_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb179-2"><a href="model-comparison.html#cb179-2" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb179-3"><a href="model-comparison.html#cb179-3" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb179-4"><a href="model-comparison.html#cb179-4" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb179-5"><a href="model-comparison.html#cb179-5" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb179-6"><a href="model-comparison.html#cb179-6" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb179-7"><a href="model-comparison.html#cb179-7" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb179-8"><a href="model-comparison.html#cb179-8" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb179-9"><a href="model-comparison.html#cb179-9" tabindex="-1"></a></span>
<span id="cb179-10"><a href="model-comparison.html#cb179-10" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb179-11"><a href="model-comparison.html#cb179-11" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb179-12"><a href="model-comparison.html#cb179-12" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb179-13"><a href="model-comparison.html#cb179-13" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb179-14"><a href="model-comparison.html#cb179-14" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb179-15"><a href="model-comparison.html#cb179-15" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb179-16"><a href="model-comparison.html#cb179-16" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb179-17"><a href="model-comparison.html#cb179-17" tabindex="-1"></a></span>
<span id="cb179-18"><a href="model-comparison.html#cb179-18" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb179-19"><a href="model-comparison.html#cb179-19" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb179-20"><a href="model-comparison.html#cb179-20" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb179-21"><a href="model-comparison.html#cb179-21" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb179-22"><a href="model-comparison.html#cb179-22" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb179-23"><a href="model-comparison.html#cb179-23" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb179-24"><a href="model-comparison.html#cb179-24" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb179-25"><a href="model-comparison.html#cb179-25" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb179-26"><a href="model-comparison.html#cb179-26" tabindex="-1"></a></span>
<span id="cb179-27"><a href="model-comparison.html#cb179-27" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb179-28"><a href="model-comparison.html#cb179-28" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb179-29"><a href="model-comparison.html#cb179-29" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb179-30"><a href="model-comparison.html#cb179-30" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb179-31"><a href="model-comparison.html#cb179-31" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb179-32"><a href="model-comparison.html#cb179-32" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb179-33"><a href="model-comparison.html#cb179-33" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb179-34"><a href="model-comparison.html#cb179-34" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb179-35"><a href="model-comparison.html#cb179-35" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb179-36"><a href="model-comparison.html#cb179-36" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb179-37"><a href="model-comparison.html#cb179-37" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb179-38"><a href="model-comparison.html#cb179-38" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb179-39"><a href="model-comparison.html#cb179-39" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb179-40"><a href="model-comparison.html#cb179-40" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb179-41"><a href="model-comparison.html#cb179-41" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb179-42"><a href="model-comparison.html#cb179-42" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb179-43"><a href="model-comparison.html#cb179-43" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb179-44"><a href="model-comparison.html#cb179-44" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb179-45"><a href="model-comparison.html#cb179-45" tabindex="-1"></a></span>
<span id="cb179-46"><a href="model-comparison.html#cb179-46" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb179-47"><a href="model-comparison.html#cb179-47" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb179-48"><a href="model-comparison.html#cb179-48" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb179-49"><a href="model-comparison.html#cb179-49" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb179-50"><a href="model-comparison.html#cb179-50" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb179-51"><a href="model-comparison.html#cb179-51" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb179-52"><a href="model-comparison.html#cb179-52" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb179-53"><a href="model-comparison.html#cb179-53" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb179-54"><a href="model-comparison.html#cb179-54" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb179-55"><a href="model-comparison.html#cb179-55" tabindex="-1"></a></span>
<span id="cb179-56"><a href="model-comparison.html#cb179-56" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb179-57"><a href="model-comparison.html#cb179-57" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb179-58"><a href="model-comparison.html#cb179-58" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb179-59"><a href="model-comparison.html#cb179-59" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | biasM + IDs[agent, 1] +  memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb179-60"><a href="model-comparison.html#cb179-60" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb179-61"><a href="model-comparison.html#cb179-61" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb179-62"><a href="model-comparison.html#cb179-62" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb179-63"><a href="model-comparison.html#cb179-63" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb179-64"><a href="model-comparison.html#cb179-64" tabindex="-1"></a></span>
<span id="cb179-65"><a href="model-comparison.html#cb179-65" tabindex="-1"></a></span>
<span id="cb179-66"><a href="model-comparison.html#cb179-66" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb179-67"><a href="model-comparison.html#cb179-67" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb179-68"><a href="model-comparison.html#cb179-68" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb179-69"><a href="model-comparison.html#cb179-69" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb179-70"><a href="model-comparison.html#cb179-70" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb179-71"><a href="model-comparison.html#cb179-71" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb179-72"><a href="model-comparison.html#cb179-72" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb179-73"><a href="model-comparison.html#cb179-73" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb179-74"><a href="model-comparison.html#cb179-74" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb179-75"><a href="model-comparison.html#cb179-75" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb179-76"><a href="model-comparison.html#cb179-76" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb179-77"><a href="model-comparison.html#cb179-77" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb179-78"><a href="model-comparison.html#cb179-78" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb179-79"><a href="model-comparison.html#cb179-79" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb179-80"><a href="model-comparison.html#cb179-80" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb179-81"><a href="model-comparison.html#cb179-81" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb179-82"><a href="model-comparison.html#cb179-82" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb179-83"><a href="model-comparison.html#cb179-83" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb179-84"><a href="model-comparison.html#cb179-84" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb179-85"><a href="model-comparison.html#cb179-85" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb179-86"><a href="model-comparison.html#cb179-86" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb179-87"><a href="model-comparison.html#cb179-87" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb179-88"><a href="model-comparison.html#cb179-88" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb179-89"><a href="model-comparison.html#cb179-89" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb179-90"><a href="model-comparison.html#cb179-90" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb179-91"><a href="model-comparison.html#cb179-91" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb179-92"><a href="model-comparison.html#cb179-92" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb179-93"><a href="model-comparison.html#cb179-93" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb179-94"><a href="model-comparison.html#cb179-94" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb179-95"><a href="model-comparison.html#cb179-95" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb179-96"><a href="model-comparison.html#cb179-96" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  0 * (betaM + IDs[i,2])));</span></span>
<span id="cb179-97"><a href="model-comparison.html#cb179-97" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  1 * (betaM + IDs[i,2])));</span></span>
<span id="cb179-98"><a href="model-comparison.html#cb179-98" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  2 * (betaM + IDs[i,2])));</span></span>
<span id="cb179-99"><a href="model-comparison.html#cb179-99" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb179-100"><a href="model-comparison.html#cb179-100" tabindex="-1"></a><span class="st">      for (t in 1:trials){</span></span>
<span id="cb179-101"><a href="model-comparison.html#cb179-101" tabindex="-1"></a><span class="st">        log_lik[t,i] = bernoulli_logit_lpmf(h[t, i] | biasM + IDs[i, 1] +  memory[t, i] * (betaM + IDs[i, 2]));</span></span>
<span id="cb179-102"><a href="model-comparison.html#cb179-102" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb179-103"><a href="model-comparison.html#cb179-103" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb179-104"><a href="model-comparison.html#cb179-104" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb179-105"><a href="model-comparison.html#cb179-105" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb179-106"><a href="model-comparison.html#cb179-106" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb179-107"><a href="model-comparison.html#cb179-107" tabindex="-1"></a></span>
<span id="cb179-108"><a href="model-comparison.html#cb179-108" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb179-109"><a href="model-comparison.html#cb179-109" tabindex="-1"></a>  stan_memory_model,</span>
<span id="cb179-110"><a href="model-comparison.html#cb179-110" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb179-111"><a href="model-comparison.html#cb179-111" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelMemory.stan&quot;</span>)</span>
<span id="cb179-112"><a href="model-comparison.html#cb179-112" tabindex="-1"></a></span>
<span id="cb179-113"><a href="model-comparison.html#cb179-113" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelMemory.stan&quot;</span>)</span>
<span id="cb179-114"><a href="model-comparison.html#cb179-114" tabindex="-1"></a>mod_memory <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb179-115"><a href="model-comparison.html#cb179-115" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
</div>
<div id="fitting-the-models-to-the-data" class="section level2 hasAnchor" number="7.8">
<h2><span class="header-section-number">7.8</span> Fitting the models to the data<a href="model-comparison.html#fitting-the-models-to-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="model-comparison.html#cb180-1" tabindex="-1"></a><span class="co"># Fitting biased agent model to biased agent data</span></span>
<span id="cb180-2"><a href="model-comparison.html#cb180-2" tabindex="-1"></a>fit_biased2biased <span class="ot">&lt;-</span> mod_biased<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb180-3"><a href="model-comparison.html#cb180-3" tabindex="-1"></a>  <span class="at">data =</span> data_biased,</span>
<span id="cb180-4"><a href="model-comparison.html#cb180-4" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb180-5"><a href="model-comparison.html#cb180-5" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb180-6"><a href="model-comparison.html#cb180-6" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb180-7"><a href="model-comparison.html#cb180-7" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb180-8"><a href="model-comparison.html#cb180-8" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb180-9"><a href="model-comparison.html#cb180-9" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb180-10"><a href="model-comparison.html#cb180-10" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb180-11"><a href="model-comparison.html#cb180-11" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;simmodels&quot;</span>,</span>
<span id="cb180-12"><a href="model-comparison.html#cb180-12" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb180-13"><a href="model-comparison.html#cb180-13" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb180-14"><a href="model-comparison.html#cb180-14" tabindex="-1"></a>)</span>
<span id="cb180-15"><a href="model-comparison.html#cb180-15" tabindex="-1"></a></span>
<span id="cb180-16"><a href="model-comparison.html#cb180-16" tabindex="-1"></a>fit_biased2biased<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_biased2biased.RDS&quot;</span>)</span>
<span id="cb180-17"><a href="model-comparison.html#cb180-17" tabindex="-1"></a></span>
<span id="cb180-18"><a href="model-comparison.html#cb180-18" tabindex="-1"></a></span>
<span id="cb180-19"><a href="model-comparison.html#cb180-19" tabindex="-1"></a><span class="co"># Fitting biased agent model to memory agent data</span></span>
<span id="cb180-20"><a href="model-comparison.html#cb180-20" tabindex="-1"></a>fit_biased2memory <span class="ot">&lt;-</span> mod_biased<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb180-21"><a href="model-comparison.html#cb180-21" tabindex="-1"></a>  <span class="at">data =</span> data_memory,</span>
<span id="cb180-22"><a href="model-comparison.html#cb180-22" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb180-23"><a href="model-comparison.html#cb180-23" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb180-24"><a href="model-comparison.html#cb180-24" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb180-25"><a href="model-comparison.html#cb180-25" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb180-26"><a href="model-comparison.html#cb180-26" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb180-27"><a href="model-comparison.html#cb180-27" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb180-28"><a href="model-comparison.html#cb180-28" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb180-29"><a href="model-comparison.html#cb180-29" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;simmodels&quot;</span>,</span>
<span id="cb180-30"><a href="model-comparison.html#cb180-30" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb180-31"><a href="model-comparison.html#cb180-31" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb180-32"><a href="model-comparison.html#cb180-32" tabindex="-1"></a>)</span>
<span id="cb180-33"><a href="model-comparison.html#cb180-33" tabindex="-1"></a></span>
<span id="cb180-34"><a href="model-comparison.html#cb180-34" tabindex="-1"></a>fit_biased2memory<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_biased2memory.RDS&quot;</span>)</span>
<span id="cb180-35"><a href="model-comparison.html#cb180-35" tabindex="-1"></a></span>
<span id="cb180-36"><a href="model-comparison.html#cb180-36" tabindex="-1"></a>fit_memory2biased <span class="ot">&lt;-</span> mod_memory<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb180-37"><a href="model-comparison.html#cb180-37" tabindex="-1"></a>  <span class="at">data =</span> data_biased,</span>
<span id="cb180-38"><a href="model-comparison.html#cb180-38" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb180-39"><a href="model-comparison.html#cb180-39" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb180-40"><a href="model-comparison.html#cb180-40" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb180-41"><a href="model-comparison.html#cb180-41" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb180-42"><a href="model-comparison.html#cb180-42" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb180-43"><a href="model-comparison.html#cb180-43" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb180-44"><a href="model-comparison.html#cb180-44" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb180-45"><a href="model-comparison.html#cb180-45" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;simmodels&quot;</span>,</span>
<span id="cb180-46"><a href="model-comparison.html#cb180-46" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb180-47"><a href="model-comparison.html#cb180-47" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb180-48"><a href="model-comparison.html#cb180-48" tabindex="-1"></a>)</span>
<span id="cb180-49"><a href="model-comparison.html#cb180-49" tabindex="-1"></a></span>
<span id="cb180-50"><a href="model-comparison.html#cb180-50" tabindex="-1"></a>fit_memory2biased<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_memory2biased.RDS&quot;</span>)</span>
<span id="cb180-51"><a href="model-comparison.html#cb180-51" tabindex="-1"></a></span>
<span id="cb180-52"><a href="model-comparison.html#cb180-52" tabindex="-1"></a>fit_memory2memory <span class="ot">&lt;-</span> mod_memory<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb180-53"><a href="model-comparison.html#cb180-53" tabindex="-1"></a>  <span class="at">data =</span> data_memory,</span>
<span id="cb180-54"><a href="model-comparison.html#cb180-54" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb180-55"><a href="model-comparison.html#cb180-55" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb180-56"><a href="model-comparison.html#cb180-56" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb180-57"><a href="model-comparison.html#cb180-57" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb180-58"><a href="model-comparison.html#cb180-58" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb180-59"><a href="model-comparison.html#cb180-59" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb180-60"><a href="model-comparison.html#cb180-60" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb180-61"><a href="model-comparison.html#cb180-61" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;simmodels&quot;</span>,</span>
<span id="cb180-62"><a href="model-comparison.html#cb180-62" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb180-63"><a href="model-comparison.html#cb180-63" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb180-64"><a href="model-comparison.html#cb180-64" tabindex="-1"></a>)</span>
<span id="cb180-65"><a href="model-comparison.html#cb180-65" tabindex="-1"></a></span>
<span id="cb180-66"><a href="model-comparison.html#cb180-66" tabindex="-1"></a>fit_memory2memory<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W6_fit_memory2memory.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="calculating-the-expected-log-predictive-density-of-a-model" class="section level2 hasAnchor" number="7.9">
<h2><span class="header-section-number">7.9</span> Calculating the expected log predictive density of a model<a href="model-comparison.html#calculating-the-expected-log-predictive-density-of-a-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous section, we fitted each model (biased and memory) to each dataset (biased and memory), and calculated and saved the log-posterior likelihood distributions for each data point. However, as we know from previous courses, calculating the goodness of fit of a model on the actual data it has been trained/fitted on is a bad idea. Models - expecially complex models - tend to overfit to the data. The multilevel implementation we have used is a bit skeptical of the data (it pools information across agents and combines it with the data from any given agent, thus de facto regularizing the estimates). Still overfitting is a serious risk.</p>
<p>Machine learning has made common practices of validation, that is, of keeping parts of the dataset out of the training/fitting process, in order to then see how well the trained model can predict those untouched data, and get an <em>out of sample error</em>. [RANT ON INTERNAL VS. EXTERNAL TEST SET: HOW WELL DOES IT GENERALIZE TO DIVERSE CONTEXTS?].</p>
<p>When the datasets are small, as it is often the case in cognitive science, keeping a substantial portion of the data out - substantial enough to be representative of a more general population - is problematic as it risks starving the model of data: there might not be enough data for reliable estimation of the parameter values. This is where the notion of cross-validation comes in: we can split the dataset in k folds, let’s say k = 10. Then each fold is in turn kept aside as validation set, the model is fitted on the other folds, and its predictive performance tested on the validation set. Repeat this operation of each of the folds. This operation ensures that all the data can be used for training as well as for validation, and is in its own terms quite genial. However, this does not mean it is free of shortcomings. First, small validation folds might not be representative of the diversity of true out-of-sample populations - and there is a tendency to set k equal to the number of datapoints (leave-one-out cross validation). Second, there are many ways in which information could leak or contaminate across folds if the pipeline is not very careful (e.g. via data preprocessing scaling the full dataset, or hyper-parameter estimation). Third, and crucial for our case here, cross validation implies refitting the model k times, which for Bayesian models might be very cumbersome (I once had a model that took 6 weeks to run).</p>
<p>The elpd (expected log predictive density) is an attempt at estimating the out-of-sample error without actually re-running the model. To understand elpd we need to decompose it in several steps.</p>
<ul>
<li><p>Log pointwise predictive density (lppd) is the sum of the logarithm of the average log posterior likelihood of each observation ( Pr(yi) )</p></li>
<li><p>A penalty is given according to the sum of the variance in log posterior likelihood per each observation. The more unstable (varying) the higher the penalty.</p></li>
<li><p>This is all still fully based on the training sample. Elpd moves it one step forward by weighting the lppd according to the frequency of the observation in the dataset excluding that observation. The more frequent, the more it matters. N.B. elpd only keeps one datapoint out, meaning that dependencies within larger clusters (e.g. repeated measures by participants) confound the measure.</p></li>
</ul>
<p>Let’s calculate this, and then we will implement a more properly cross-validated version.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="model-comparison.html#cb181-1" tabindex="-1"></a>fit_biased2biased <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W6_fit_memory2memory.RDS&quot;</span>)</span>
<span id="cb181-2"><a href="model-comparison.html#cb181-2" tabindex="-1"></a></span>
<span id="cb181-3"><a href="model-comparison.html#cb181-3" tabindex="-1"></a>Loo_biased2biased <span class="ot">&lt;-</span> fit_biased2biased<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb181-4"><a href="model-comparison.html#cb181-4" tabindex="-1"></a></span>
<span id="cb181-5"><a href="model-comparison.html#cb181-5" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(Loo_biased2biased)</span></code></pre></div>
<p><img src="series_files/figure-html/06%20assess%20predictive%20performance-1.png" width="672" /></p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="model-comparison.html#cb182-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> p1 <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">0.4</span>)</span>
<span id="cb182-2"><a href="model-comparison.html#cb182-2" tabindex="-1"></a></span>
<span id="cb182-3"><a href="model-comparison.html#cb182-3" tabindex="-1"></a>fit_biased2memory <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W6_fit_biased2memory.RDS&quot;</span>)</span>
<span id="cb182-4"><a href="model-comparison.html#cb182-4" tabindex="-1"></a>Loo_biased2memory <span class="ot">&lt;-</span> fit_biased2memory<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb182-5"><a href="model-comparison.html#cb182-5" tabindex="-1"></a><span class="fu">plot</span>(Loo_biased2memory)</span></code></pre></div>
<p><img src="series_files/figure-html/06%20assess%20predictive%20performance-2.png" width="672" /></p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="model-comparison.html#cb183-1" tabindex="-1"></a>fit_memory2biased <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W6_fit_memory2biased.RDS&quot;</span>)</span>
<span id="cb183-2"><a href="model-comparison.html#cb183-2" tabindex="-1"></a>Loo_memory2biased <span class="ot">&lt;-</span> fit_memory2biased<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb183-3"><a href="model-comparison.html#cb183-3" tabindex="-1"></a><span class="fu">plot</span>(Loo_memory2biased)</span></code></pre></div>
<p><img src="series_files/figure-html/06%20assess%20predictive%20performance-3.png" width="672" /></p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="model-comparison.html#cb184-1" tabindex="-1"></a>fit_memory2memory <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W6_fit_memory2memory.RDS&quot;</span>)</span>
<span id="cb184-2"><a href="model-comparison.html#cb184-2" tabindex="-1"></a>Loo_memory2memory <span class="ot">&lt;-</span> fit_memory2memory<span class="sc">$</span><span class="fu">loo</span>(<span class="at">save_psis =</span> <span class="cn">TRUE</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb184-3"><a href="model-comparison.html#cb184-3" tabindex="-1"></a><span class="fu">plot</span>(Loo_memory2memory)</span></code></pre></div>
<p><img src="series_files/figure-html/06%20assess%20predictive%20performance-4.png" width="672" /></p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="model-comparison.html#cb185-1" tabindex="-1"></a>elpd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb185-2"><a href="model-comparison.html#cb185-2" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">seq</span>(<span class="dv">12000</span>),</span>
<span id="cb185-3"><a href="model-comparison.html#cb185-3" tabindex="-1"></a>  <span class="at">biased_diff_elpd =</span> </span>
<span id="cb185-4"><a href="model-comparison.html#cb185-4" tabindex="-1"></a>  Loo_biased2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>] <span class="sc">-</span> </span>
<span id="cb185-5"><a href="model-comparison.html#cb185-5" tabindex="-1"></a>  Loo_memory2biased<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>],</span>
<span id="cb185-6"><a href="model-comparison.html#cb185-6" tabindex="-1"></a>  <span class="at">memory_diff_elpd =</span> </span>
<span id="cb185-7"><a href="model-comparison.html#cb185-7" tabindex="-1"></a>  Loo_memory2memory<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>] <span class="sc">-</span></span>
<span id="cb185-8"><a href="model-comparison.html#cb185-8" tabindex="-1"></a>  Loo_biased2memory<span class="sc">$</span>pointwise[, <span class="st">&quot;elpd_loo&quot;</span>])</span>
<span id="cb185-9"><a href="model-comparison.html#cb185-9" tabindex="-1"></a></span>
<span id="cb185-10"><a href="model-comparison.html#cb185-10" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elpd, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> biased_diff_elpd)) <span class="sc">+</span></span>
<span id="cb185-11"><a href="model-comparison.html#cb185-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb185-12"><a href="model-comparison.html#cb185-12" tabindex="-1"></a>  <span class="co">#xlim(.5,1.01) +</span></span>
<span id="cb185-13"><a href="model-comparison.html#cb185-13" tabindex="-1"></a>  <span class="co">#ylim(-1.5,1.5) +</span></span>
<span id="cb185-14"><a href="model-comparison.html#cb185-14" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb185-15"><a href="model-comparison.html#cb185-15" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb185-16"><a href="model-comparison.html#cb185-16" tabindex="-1"></a></span>
<span id="cb185-17"><a href="model-comparison.html#cb185-17" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elpd, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> memory_diff_elpd)) <span class="sc">+</span></span>
<span id="cb185-18"><a href="model-comparison.html#cb185-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb185-19"><a href="model-comparison.html#cb185-19" tabindex="-1"></a>  <span class="co">#xlim(.5,1.01) +</span></span>
<span id="cb185-20"><a href="model-comparison.html#cb185-20" tabindex="-1"></a>  <span class="co">#ylim(-1.5,1.5) +</span></span>
<span id="cb185-21"><a href="model-comparison.html#cb185-21" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb185-22"><a href="model-comparison.html#cb185-22" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb185-23"><a href="model-comparison.html#cb185-23" tabindex="-1"></a></span>
<span id="cb185-24"><a href="model-comparison.html#cb185-24" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb185-25"><a href="model-comparison.html#cb185-25" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="series_files/figure-html/06%20assess%20predictive%20performance-5.png" width="672" /></p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="model-comparison.html#cb186-1" tabindex="-1"></a><span class="fu">loo_compare</span>(Loo_biased2biased, Loo_memory2biased)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1     0.0       0.0
## model2 -1414.1      83.1</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="model-comparison.html#cb188-1" tabindex="-1"></a><span class="fu">loo_compare</span>(Loo_biased2memory, Loo_memory2memory)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model2    0.0       0.0 
## model1 -127.1      11.9</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="model-comparison.html#cb190-1" tabindex="-1"></a><span class="fu">loo_model_weights</span>(<span class="fu">list</span>(Loo_biased2biased, Loo_memory2biased))</span></code></pre></div>
<pre><code>## Method: stacking
## ------
##        weight
## model1 0.768 
## model2 0.232</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="model-comparison.html#cb192-1" tabindex="-1"></a><span class="fu">loo_model_weights</span>(<span class="fu">list</span>(Loo_biased2memory, Loo_memory2memory))</span></code></pre></div>
<pre><code>## Method: stacking
## ------
##        weight
## model1 0.000 
## model2 1.000</code></pre>
</div>
<div id="implementing-cross-validation" class="section level2 hasAnchor" number="7.10">
<h2><span class="header-section-number">7.10</span> Implementing Cross-Validation<a href="model-comparison.html#implementing-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As we mentioned, elpd per se is only an approximation of the cross-validated performance and it only leaves one datapoint out at a time.
[MISSING: VERSION W TRANSFORMED DATA]</p>
<div id="create-cross-validation-ready-stan-model-for-biased-agents" class="section level3 hasAnchor" number="7.10.1">
<h3><span class="header-section-number">7.10.1</span> Create cross-validation ready stan model for biased agents<a href="model-comparison.html#create-cross-validation-ready-stan-model-for-biased-agents" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>N.B. compared to before we also need to include specifics for test data</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="model-comparison.html#cb194-1" tabindex="-1"></a>stan_biased_cv_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb194-2"><a href="model-comparison.html#cb194-2" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb194-3"><a href="model-comparison.html#cb194-3" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (right and left). Now multilevel</span></span>
<span id="cb194-4"><a href="model-comparison.html#cb194-4" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb194-5"><a href="model-comparison.html#cb194-5" tabindex="-1"></a></span>
<span id="cb194-6"><a href="model-comparison.html#cb194-6" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb194-7"><a href="model-comparison.html#cb194-7" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { // normal distribution with a lower bound</span></span>
<span id="cb194-8"><a href="model-comparison.html#cb194-8" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb194-9"><a href="model-comparison.html#cb194-9" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb194-10"><a href="model-comparison.html#cb194-10" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb194-11"><a href="model-comparison.html#cb194-11" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb194-12"><a href="model-comparison.html#cb194-12" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb194-13"><a href="model-comparison.html#cb194-13" tabindex="-1"></a></span>
<span id="cb194-14"><a href="model-comparison.html#cb194-14" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of hands</span></span>
<span id="cb194-15"><a href="model-comparison.html#cb194-15" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb194-16"><a href="model-comparison.html#cb194-16" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb194-17"><a href="model-comparison.html#cb194-17" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb194-18"><a href="model-comparison.html#cb194-18" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb194-19"><a href="model-comparison.html#cb194-19" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb194-20"><a href="model-comparison.html#cb194-20" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents_test;</span></span>
<span id="cb194-21"><a href="model-comparison.html#cb194-21" tabindex="-1"></a><span class="st"> array[trials, agents_test] int h_test;</span></span>
<span id="cb194-22"><a href="model-comparison.html#cb194-22" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb194-23"><a href="model-comparison.html#cb194-23" tabindex="-1"></a></span>
<span id="cb194-24"><a href="model-comparison.html#cb194-24" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb194-25"><a href="model-comparison.html#cb194-25" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb194-26"><a href="model-comparison.html#cb194-26" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb194-27"><a href="model-comparison.html#cb194-27" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;</span></span>
<span id="cb194-28"><a href="model-comparison.html#cb194-28" tabindex="-1"></a><span class="st">  array[agents] real theta;</span></span>
<span id="cb194-29"><a href="model-comparison.html#cb194-29" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb194-30"><a href="model-comparison.html#cb194-30" tabindex="-1"></a></span>
<span id="cb194-31"><a href="model-comparison.html#cb194-31" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb194-32"><a href="model-comparison.html#cb194-32" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb194-33"><a href="model-comparison.html#cb194-33" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb194-34"><a href="model-comparison.html#cb194-34" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3)  -</span></span>
<span id="cb194-35"><a href="model-comparison.html#cb194-35" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb194-36"><a href="model-comparison.html#cb194-36" tabindex="-1"></a></span>
<span id="cb194-37"><a href="model-comparison.html#cb194-37" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb194-38"><a href="model-comparison.html#cb194-38" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb194-39"><a href="model-comparison.html#cb194-39" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb194-40"><a href="model-comparison.html#cb194-40" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb194-41"><a href="model-comparison.html#cb194-41" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb194-42"><a href="model-comparison.html#cb194-42" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb194-43"><a href="model-comparison.html#cb194-43" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb194-44"><a href="model-comparison.html#cb194-44" tabindex="-1"></a></span>
<span id="cb194-45"><a href="model-comparison.html#cb194-45" tabindex="-1"></a></span>
<span id="cb194-46"><a href="model-comparison.html#cb194-46" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb194-47"><a href="model-comparison.html#cb194-47" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb194-48"><a href="model-comparison.html#cb194-48" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb194-49"><a href="model-comparison.html#cb194-49" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb194-50"><a href="model-comparison.html#cb194-50" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb194-51"><a href="model-comparison.html#cb194-51" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb194-52"><a href="model-comparison.html#cb194-52" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb194-53"><a href="model-comparison.html#cb194-53" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb194-54"><a href="model-comparison.html#cb194-54" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb194-55"><a href="model-comparison.html#cb194-55" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb194-56"><a href="model-comparison.html#cb194-56" tabindex="-1"></a><span class="st">   array[trials, agents_test] real log_lik_test;</span></span>
<span id="cb194-57"><a href="model-comparison.html#cb194-57" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb194-58"><a href="model-comparison.html#cb194-58" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb194-59"><a href="model-comparison.html#cb194-59" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb194-60"><a href="model-comparison.html#cb194-60" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb194-61"><a href="model-comparison.html#cb194-61" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb194-62"><a href="model-comparison.html#cb194-62" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb194-63"><a href="model-comparison.html#cb194-63" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb194-64"><a href="model-comparison.html#cb194-64" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb194-65"><a href="model-comparison.html#cb194-65" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb194-66"><a href="model-comparison.html#cb194-66" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb194-67"><a href="model-comparison.html#cb194-67" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb194-68"><a href="model-comparison.html#cb194-68" tabindex="-1"></a><span class="st">      log_lik[t,i] = bernoulli_logit_lpmf(h[t,i] | theta[i]);</span></span>
<span id="cb194-69"><a href="model-comparison.html#cb194-69" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb194-70"><a href="model-comparison.html#cb194-70" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb194-71"><a href="model-comparison.html#cb194-71" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb194-72"><a href="model-comparison.html#cb194-72" tabindex="-1"></a><span class="st">   for (i in 1:agents_test){</span></span>
<span id="cb194-73"><a href="model-comparison.html#cb194-73" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb194-74"><a href="model-comparison.html#cb194-74" tabindex="-1"></a><span class="st">      log_lik_test[t,i] = bernoulli_lpmf(h_test[t,i] | theta_posterior);</span></span>
<span id="cb194-75"><a href="model-comparison.html#cb194-75" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb194-76"><a href="model-comparison.html#cb194-76" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb194-77"><a href="model-comparison.html#cb194-77" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb194-78"><a href="model-comparison.html#cb194-78" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb194-79"><a href="model-comparison.html#cb194-79" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb194-80"><a href="model-comparison.html#cb194-80" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb194-81"><a href="model-comparison.html#cb194-81" tabindex="-1"></a>  stan_biased_cv_model,</span>
<span id="cb194-82"><a href="model-comparison.html#cb194-82" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb194-83"><a href="model-comparison.html#cb194-83" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelBias_cv.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelBias_cv.stan&quot;</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="model-comparison.html#cb196-1" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelBias_cv.stan&quot;</span>)</span>
<span id="cb196-2"><a href="model-comparison.html#cb196-2" tabindex="-1"></a>mod_biased_cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb196-3"><a href="model-comparison.html#cb196-3" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb196-4"><a href="model-comparison.html#cb196-4" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
</div>
<div id="create-cross-validation-ready-stan-model-for-memory-agents" class="section level3 hasAnchor" number="7.10.2">
<h3><span class="header-section-number">7.10.2</span> Create cross-validation ready stan model for memory agents<a href="model-comparison.html#create-cross-validation-ready-stan-model-for-memory-agents" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="model-comparison.html#cb197-1" tabindex="-1"></a>stan_memory_cv_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb197-2"><a href="model-comparison.html#cb197-2" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb197-3"><a href="model-comparison.html#cb197-3" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (heads and tails)</span></span>
<span id="cb197-4"><a href="model-comparison.html#cb197-4" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb197-5"><a href="model-comparison.html#cb197-5" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb197-6"><a href="model-comparison.html#cb197-6" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb197-7"><a href="model-comparison.html#cb197-7" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb197-8"><a href="model-comparison.html#cb197-8" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb197-9"><a href="model-comparison.html#cb197-9" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb197-10"><a href="model-comparison.html#cb197-10" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb197-11"><a href="model-comparison.html#cb197-11" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb197-12"><a href="model-comparison.html#cb197-12" tabindex="-1"></a></span>
<span id="cb197-13"><a href="model-comparison.html#cb197-13" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb197-14"><a href="model-comparison.html#cb197-14" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb197-15"><a href="model-comparison.html#cb197-15" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb197-16"><a href="model-comparison.html#cb197-16" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb197-17"><a href="model-comparison.html#cb197-17" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb197-18"><a href="model-comparison.html#cb197-18" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb197-19"><a href="model-comparison.html#cb197-19" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb197-20"><a href="model-comparison.html#cb197-20" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents_test;</span></span>
<span id="cb197-21"><a href="model-comparison.html#cb197-21" tabindex="-1"></a><span class="st"> array[trials, agents_test] int h_test;</span></span>
<span id="cb197-22"><a href="model-comparison.html#cb197-22" tabindex="-1"></a><span class="st"> array[trials, agents_test] int other_test;</span></span>
<span id="cb197-23"><a href="model-comparison.html#cb197-23" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb197-24"><a href="model-comparison.html#cb197-24" tabindex="-1"></a></span>
<span id="cb197-25"><a href="model-comparison.html#cb197-25" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb197-26"><a href="model-comparison.html#cb197-26" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb197-27"><a href="model-comparison.html#cb197-27" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb197-28"><a href="model-comparison.html#cb197-28" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb197-29"><a href="model-comparison.html#cb197-29" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb197-30"><a href="model-comparison.html#cb197-30" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb197-31"><a href="model-comparison.html#cb197-31" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb197-32"><a href="model-comparison.html#cb197-32" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb197-33"><a href="model-comparison.html#cb197-33" tabindex="-1"></a></span>
<span id="cb197-34"><a href="model-comparison.html#cb197-34" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb197-35"><a href="model-comparison.html#cb197-35" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb197-36"><a href="model-comparison.html#cb197-36" tabindex="-1"></a><span class="st">  array[trials, agents_test] real memory_test;</span></span>
<span id="cb197-37"><a href="model-comparison.html#cb197-37" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb197-38"><a href="model-comparison.html#cb197-38" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb197-39"><a href="model-comparison.html#cb197-39" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb197-40"><a href="model-comparison.html#cb197-40" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb197-41"><a href="model-comparison.html#cb197-41" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb197-42"><a href="model-comparison.html#cb197-42" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb197-43"><a href="model-comparison.html#cb197-43" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb197-44"><a href="model-comparison.html#cb197-44" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb197-45"><a href="model-comparison.html#cb197-45" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb197-46"><a href="model-comparison.html#cb197-46" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb197-47"><a href="model-comparison.html#cb197-47" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb197-48"><a href="model-comparison.html#cb197-48" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb197-49"><a href="model-comparison.html#cb197-49" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb197-50"><a href="model-comparison.html#cb197-50" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb197-51"><a href="model-comparison.html#cb197-51" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb197-52"><a href="model-comparison.html#cb197-52" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb197-53"><a href="model-comparison.html#cb197-53" tabindex="-1"></a><span class="st">  for (agent in 1:agents_test){</span></span>
<span id="cb197-54"><a href="model-comparison.html#cb197-54" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb197-55"><a href="model-comparison.html#cb197-55" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb197-56"><a href="model-comparison.html#cb197-56" tabindex="-1"></a><span class="st">        memory_test[trial, agent] = 0.5;</span></span>
<span id="cb197-57"><a href="model-comparison.html#cb197-57" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb197-58"><a href="model-comparison.html#cb197-58" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb197-59"><a href="model-comparison.html#cb197-59" tabindex="-1"></a><span class="st">        memory_test[trial + 1, agent] = memory_test[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb197-60"><a href="model-comparison.html#cb197-60" tabindex="-1"></a><span class="st">        if (memory_test[trial + 1, agent] == 0){memory_test[trial + 1, agent] = 0.01;}</span></span>
<span id="cb197-61"><a href="model-comparison.html#cb197-61" tabindex="-1"></a><span class="st">        if (memory_test[trial + 1, agent] == 1){memory_test[trial + 1, agent] = 0.99;}</span></span>
<span id="cb197-62"><a href="model-comparison.html#cb197-62" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb197-63"><a href="model-comparison.html#cb197-63" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb197-64"><a href="model-comparison.html#cb197-64" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb197-65"><a href="model-comparison.html#cb197-65" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb197-66"><a href="model-comparison.html#cb197-66" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb197-67"><a href="model-comparison.html#cb197-67" tabindex="-1"></a></span>
<span id="cb197-68"><a href="model-comparison.html#cb197-68" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb197-69"><a href="model-comparison.html#cb197-69" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb197-70"><a href="model-comparison.html#cb197-70" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb197-71"><a href="model-comparison.html#cb197-71" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb197-72"><a href="model-comparison.html#cb197-72" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb197-73"><a href="model-comparison.html#cb197-73" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb197-74"><a href="model-comparison.html#cb197-74" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb197-75"><a href="model-comparison.html#cb197-75" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb197-76"><a href="model-comparison.html#cb197-76" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb197-77"><a href="model-comparison.html#cb197-77" tabindex="-1"></a></span>
<span id="cb197-78"><a href="model-comparison.html#cb197-78" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb197-79"><a href="model-comparison.html#cb197-79" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb197-80"><a href="model-comparison.html#cb197-80" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb197-81"><a href="model-comparison.html#cb197-81" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | biasM + IDs[agent, 1] +  memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb197-82"><a href="model-comparison.html#cb197-82" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb197-83"><a href="model-comparison.html#cb197-83" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb197-84"><a href="model-comparison.html#cb197-84" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb197-85"><a href="model-comparison.html#cb197-85" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb197-86"><a href="model-comparison.html#cb197-86" tabindex="-1"></a></span>
<span id="cb197-87"><a href="model-comparison.html#cb197-87" tabindex="-1"></a></span>
<span id="cb197-88"><a href="model-comparison.html#cb197-88" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb197-89"><a href="model-comparison.html#cb197-89" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb197-90"><a href="model-comparison.html#cb197-90" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb197-91"><a href="model-comparison.html#cb197-91" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb197-92"><a href="model-comparison.html#cb197-92" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb197-93"><a href="model-comparison.html#cb197-93" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb197-94"><a href="model-comparison.html#cb197-94" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb197-95"><a href="model-comparison.html#cb197-95" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb197-96"><a href="model-comparison.html#cb197-96" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb197-97"><a href="model-comparison.html#cb197-97" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb197-98"><a href="model-comparison.html#cb197-98" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb197-99"><a href="model-comparison.html#cb197-99" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb197-100"><a href="model-comparison.html#cb197-100" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb197-101"><a href="model-comparison.html#cb197-101" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb197-102"><a href="model-comparison.html#cb197-102" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb197-103"><a href="model-comparison.html#cb197-103" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb197-104"><a href="model-comparison.html#cb197-104" tabindex="-1"></a><span class="st">   array[trials, agents] real log_lik;</span></span>
<span id="cb197-105"><a href="model-comparison.html#cb197-105" tabindex="-1"></a><span class="st">   array[trials, agents_test] real log_lik_test;</span></span>
<span id="cb197-106"><a href="model-comparison.html#cb197-106" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb197-107"><a href="model-comparison.html#cb197-107" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb197-108"><a href="model-comparison.html#cb197-108" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb197-109"><a href="model-comparison.html#cb197-109" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb197-110"><a href="model-comparison.html#cb197-110" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb197-111"><a href="model-comparison.html#cb197-111" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb197-112"><a href="model-comparison.html#cb197-112" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb197-113"><a href="model-comparison.html#cb197-113" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb197-114"><a href="model-comparison.html#cb197-114" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb197-115"><a href="model-comparison.html#cb197-115" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb197-116"><a href="model-comparison.html#cb197-116" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb197-117"><a href="model-comparison.html#cb197-117" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb197-118"><a href="model-comparison.html#cb197-118" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb197-119"><a href="model-comparison.html#cb197-119" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  0 * (betaM + IDs[i,2])));</span></span>
<span id="cb197-120"><a href="model-comparison.html#cb197-120" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  1 * (betaM + IDs[i,2])));</span></span>
<span id="cb197-121"><a href="model-comparison.html#cb197-121" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  2 * (betaM + IDs[i,2])));</span></span>
<span id="cb197-122"><a href="model-comparison.html#cb197-122" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb197-123"><a href="model-comparison.html#cb197-123" tabindex="-1"></a><span class="st">      for (t in 1:trials){</span></span>
<span id="cb197-124"><a href="model-comparison.html#cb197-124" tabindex="-1"></a><span class="st">        log_lik[t,i] = bernoulli_logit_lpmf(h[t, i] | biasM + IDs[i, 1] +  memory[t, i] * (betaM + IDs[i, 2]));</span></span>
<span id="cb197-125"><a href="model-comparison.html#cb197-125" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb197-126"><a href="model-comparison.html#cb197-126" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb197-127"><a href="model-comparison.html#cb197-127" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb197-128"><a href="model-comparison.html#cb197-128" tabindex="-1"></a><span class="st">   for (i in 1:agents_test){</span></span>
<span id="cb197-129"><a href="model-comparison.html#cb197-129" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb197-130"><a href="model-comparison.html#cb197-130" tabindex="-1"></a><span class="st">      log_lik_test[t,i] = bernoulli_logit_lpmf(h_test[t,i] | biasM +  memory_test[t, i] * betaM);</span></span>
<span id="cb197-131"><a href="model-comparison.html#cb197-131" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb197-132"><a href="model-comparison.html#cb197-132" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb197-133"><a href="model-comparison.html#cb197-133" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb197-134"><a href="model-comparison.html#cb197-134" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb197-135"><a href="model-comparison.html#cb197-135" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb197-136"><a href="model-comparison.html#cb197-136" tabindex="-1"></a></span>
<span id="cb197-137"><a href="model-comparison.html#cb197-137" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb197-138"><a href="model-comparison.html#cb197-138" tabindex="-1"></a>  stan_memory_cv_model,</span>
<span id="cb197-139"><a href="model-comparison.html#cb197-139" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb197-140"><a href="model-comparison.html#cb197-140" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MultilevelMemory_cv.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MultilevelMemory_cv.stan&quot;</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="model-comparison.html#cb199-1" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MultilevelMemory_cv.stan&quot;</span>)</span>
<span id="cb199-2"><a href="model-comparison.html#cb199-2" tabindex="-1"></a>mod_memory_cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb199-3"><a href="model-comparison.html#cb199-3" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<p>[MISSING: PARALLELIZE]</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="model-comparison.html#cb200-1" tabindex="-1"></a>d<span class="sc">$</span>fold <span class="ot">&lt;-</span> <span class="fu">kfold_split_grouped</span>(<span class="at">K =</span> <span class="dv">10</span>, <span class="at">x =</span> d<span class="sc">$</span>agent)</span>
<span id="cb200-2"><a href="model-comparison.html#cb200-2" tabindex="-1"></a></span>
<span id="cb200-3"><a href="model-comparison.html#cb200-3" tabindex="-1"></a>log_pd_biased_kfold <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1000</span>, <span class="at">ncol =</span> <span class="dv">12000</span>)</span>
<span id="cb200-4"><a href="model-comparison.html#cb200-4" tabindex="-1"></a>log_pd_memory_kfold <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">1000</span>, <span class="at">ncol =</span> <span class="dv">12000</span>)</span>
<span id="cb200-5"><a href="model-comparison.html#cb200-5" tabindex="-1"></a></span>
<span id="cb200-6"><a href="model-comparison.html#cb200-6" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">unique</span>(d<span class="sc">$</span>fold)) { </span>
<span id="cb200-7"><a href="model-comparison.html#cb200-7" tabindex="-1"></a>  </span>
<span id="cb200-8"><a href="model-comparison.html#cb200-8" tabindex="-1"></a>  <span class="co"># Training set for k </span></span>
<span id="cb200-9"><a href="model-comparison.html#cb200-9" tabindex="-1"></a>  d_train <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fold <span class="sc">!=</span> k)  </span>
<span id="cb200-10"><a href="model-comparison.html#cb200-10" tabindex="-1"></a>  </span>
<span id="cb200-11"><a href="model-comparison.html#cb200-11" tabindex="-1"></a>  <span class="do">## Create the data</span></span>
<span id="cb200-12"><a href="model-comparison.html#cb200-12" tabindex="-1"></a>  d_memory1_train <span class="ot">&lt;-</span> d_train <span class="sc">%&gt;%</span> </span>
<span id="cb200-13"><a href="model-comparison.html#cb200-13" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb200-14"><a href="model-comparison.html#cb200-14" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb200-15"><a href="model-comparison.html#cb200-15" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb200-16"><a href="model-comparison.html#cb200-16" tabindex="-1"></a>  d_memory2_train <span class="ot">&lt;-</span> d_train <span class="sc">%&gt;%</span> </span>
<span id="cb200-17"><a href="model-comparison.html#cb200-17" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb200-18"><a href="model-comparison.html#cb200-18" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb200-19"><a href="model-comparison.html#cb200-19" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb200-20"><a href="model-comparison.html#cb200-20" tabindex="-1"></a>  </span>
<span id="cb200-21"><a href="model-comparison.html#cb200-21" tabindex="-1"></a>  agents_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d_train<span class="sc">$</span>agent))</span>
<span id="cb200-22"><a href="model-comparison.html#cb200-22" tabindex="-1"></a>  </span>
<span id="cb200-23"><a href="model-comparison.html#cb200-23" tabindex="-1"></a>  d_test <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb200-24"><a href="model-comparison.html#cb200-24" tabindex="-1"></a>    <span class="fu">filter</span>(fold <span class="sc">==</span> k) </span>
<span id="cb200-25"><a href="model-comparison.html#cb200-25" tabindex="-1"></a>  d_memory1_test <span class="ot">&lt;-</span> d_test <span class="sc">%&gt;%</span> </span>
<span id="cb200-26"><a href="model-comparison.html#cb200-26" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb200-27"><a href="model-comparison.html#cb200-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb200-28"><a href="model-comparison.html#cb200-28" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb200-29"><a href="model-comparison.html#cb200-29" tabindex="-1"></a>  d_memory2_test <span class="ot">&lt;-</span> d_test <span class="sc">%&gt;%</span> </span>
<span id="cb200-30"><a href="model-comparison.html#cb200-30" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb200-31"><a href="model-comparison.html#cb200-31" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb200-32"><a href="model-comparison.html#cb200-32" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb200-33"><a href="model-comparison.html#cb200-33" tabindex="-1"></a>  </span>
<span id="cb200-34"><a href="model-comparison.html#cb200-34" tabindex="-1"></a>  agents_test_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d_test<span class="sc">$</span>agent))</span>
<span id="cb200-35"><a href="model-comparison.html#cb200-35" tabindex="-1"></a>  </span>
<span id="cb200-36"><a href="model-comparison.html#cb200-36" tabindex="-1"></a>  data_memory <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb200-37"><a href="model-comparison.html#cb200-37" tabindex="-1"></a>    <span class="at">trials =</span> trials,</span>
<span id="cb200-38"><a href="model-comparison.html#cb200-38" tabindex="-1"></a>    <span class="at">agents =</span>  agents_n,</span>
<span id="cb200-39"><a href="model-comparison.html#cb200-39" tabindex="-1"></a>    <span class="at">agents_test =</span> agents_test_n,</span>
<span id="cb200-40"><a href="model-comparison.html#cb200-40" tabindex="-1"></a>    <span class="at">h =</span> <span class="fu">as.matrix</span>(d_memory1_train[,<span class="dv">2</span><span class="sc">:</span>(agents_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb200-41"><a href="model-comparison.html#cb200-41" tabindex="-1"></a>    <span class="at">other =</span> <span class="fu">as.matrix</span>(d_memory2_train[,<span class="dv">2</span><span class="sc">:</span>(agents_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb200-42"><a href="model-comparison.html#cb200-42" tabindex="-1"></a>    </span>
<span id="cb200-43"><a href="model-comparison.html#cb200-43" tabindex="-1"></a>    <span class="at">h_test =</span> <span class="fu">as.matrix</span>(d_memory1_test[,<span class="dv">2</span><span class="sc">:</span>(agents_test_n <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb200-44"><a href="model-comparison.html#cb200-44" tabindex="-1"></a>    <span class="at">other_test =</span> <span class="fu">as.matrix</span>(d_memory2_test[,<span class="dv">2</span><span class="sc">:</span>(agents_test_n <span class="sc">+</span> <span class="dv">1</span>)]))</span>
<span id="cb200-45"><a href="model-comparison.html#cb200-45" tabindex="-1"></a>  </span>
<span id="cb200-46"><a href="model-comparison.html#cb200-46" tabindex="-1"></a>  <span class="co"># Train the models </span></span>
<span id="cb200-47"><a href="model-comparison.html#cb200-47" tabindex="-1"></a>  fit_random <span class="ot">&lt;-</span> mod_biased_cv<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb200-48"><a href="model-comparison.html#cb200-48" tabindex="-1"></a>    <span class="at">data =</span> data_memory,</span>
<span id="cb200-49"><a href="model-comparison.html#cb200-49" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb200-50"><a href="model-comparison.html#cb200-50" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb200-51"><a href="model-comparison.html#cb200-51" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb200-52"><a href="model-comparison.html#cb200-52" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb200-53"><a href="model-comparison.html#cb200-53" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb200-54"><a href="model-comparison.html#cb200-54" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb200-55"><a href="model-comparison.html#cb200-55" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb200-56"><a href="model-comparison.html#cb200-56" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb200-57"><a href="model-comparison.html#cb200-57" tabindex="-1"></a>  )</span>
<span id="cb200-58"><a href="model-comparison.html#cb200-58" tabindex="-1"></a>  </span>
<span id="cb200-59"><a href="model-comparison.html#cb200-59" tabindex="-1"></a>  fit_memory <span class="ot">&lt;-</span> mod_memory_cv<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb200-60"><a href="model-comparison.html#cb200-60" tabindex="-1"></a>    <span class="at">data =</span> data_memory,</span>
<span id="cb200-61"><a href="model-comparison.html#cb200-61" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb200-62"><a href="model-comparison.html#cb200-62" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb200-63"><a href="model-comparison.html#cb200-63" tabindex="-1"></a>    <span class="at">threads_per_chain =</span> <span class="dv">4</span>,</span>
<span id="cb200-64"><a href="model-comparison.html#cb200-64" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb200-65"><a href="model-comparison.html#cb200-65" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb200-66"><a href="model-comparison.html#cb200-66" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb200-67"><a href="model-comparison.html#cb200-67" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb200-68"><a href="model-comparison.html#cb200-68" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb200-69"><a href="model-comparison.html#cb200-69" tabindex="-1"></a>  )</span>
<span id="cb200-70"><a href="model-comparison.html#cb200-70" tabindex="-1"></a>  </span>
<span id="cb200-71"><a href="model-comparison.html#cb200-71" tabindex="-1"></a>  <span class="co"># Extract log likelihood which represents </span></span>
<span id="cb200-72"><a href="model-comparison.html#cb200-72" tabindex="-1"></a>  <span class="co"># the pointwise predictive density. </span></span>
<span id="cb200-73"><a href="model-comparison.html#cb200-73" tabindex="-1"></a>  <span class="co"># n.b. the matrix has 1000 row, and 12000 columns. </span></span>
<span id="cb200-74"><a href="model-comparison.html#cb200-74" tabindex="-1"></a>  <span class="co"># d$fold==k yields 12000 logical values, of which 1200 TRUEs, identifying 1200 columns</span></span>
<span id="cb200-75"><a href="model-comparison.html#cb200-75" tabindex="-1"></a>  <span class="do">## the fit blabla yields 1000 obs (samples) and 1190 variables instead of 1200</span></span>
<span id="cb200-76"><a href="model-comparison.html#cb200-76" tabindex="-1"></a>  log_pd_biased_kfold[, d<span class="sc">$</span>fold <span class="sc">==</span> k] <span class="ot">&lt;-</span> fit_random<span class="sc">$</span><span class="fu">draws</span>(<span class="st">&quot;log_lik_test&quot;</span>, <span class="at">format =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb200-77"><a href="model-comparison.html#cb200-77" tabindex="-1"></a>  log_pd_memory_kfold[, d<span class="sc">$</span>fold <span class="sc">==</span> k] <span class="ot">&lt;-</span> fit_memory<span class="sc">$</span><span class="fu">draws</span>(<span class="st">&quot;log_lik_test&quot;</span>, <span class="at">format =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb200-78"><a href="model-comparison.html#cb200-78" tabindex="-1"></a></span>
<span id="cb200-79"><a href="model-comparison.html#cb200-79" tabindex="-1"></a>}</span>
<span id="cb200-80"><a href="model-comparison.html#cb200-80" tabindex="-1"></a></span>
<span id="cb200-81"><a href="model-comparison.html#cb200-81" tabindex="-1"></a><span class="fu">save</span>(log_pd_biased_kfold, log_pd_memory_kfold, <span class="at">file =</span> <span class="st">&quot;simmodels/W6_CV_Biased&amp;Memory.RData&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="calculating-elpd-and-comparing" class="section level2 hasAnchor" number="7.11">
<h2><span class="header-section-number">7.11</span> Calculating elpd and comparing<a href="model-comparison.html#calculating-elpd-and-comparing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="model-comparison.html#cb201-1" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;simmodels/W6_CV_Biased&amp;Memory.RData&quot;</span>) </span>
<span id="cb201-2"><a href="model-comparison.html#cb201-2" tabindex="-1"></a></span>
<span id="cb201-3"><a href="model-comparison.html#cb201-3" tabindex="-1"></a>elpd_biased_kfold <span class="ot">&lt;-</span> <span class="fu">elpd</span>(log_pd_biased_kfold)</span>
<span id="cb201-4"><a href="model-comparison.html#cb201-4" tabindex="-1"></a>elpd_memory_kfold <span class="ot">&lt;-</span> <span class="fu">elpd</span>(log_pd_memory_kfold)</span>
<span id="cb201-5"><a href="model-comparison.html#cb201-5" tabindex="-1"></a></span>
<span id="cb201-6"><a href="model-comparison.html#cb201-6" tabindex="-1"></a><span class="fu">loo_compare</span>(elpd_biased_kfold, elpd_memory_kfold)</span></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1    0.0       0.0 
## model2 -437.3      23.9</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="model-comparison.html#cb203-1" tabindex="-1"></a><span class="co">#loo_model_weights(elpd_biased_kfold, elpd_memory_kfold)</span></span></code></pre></div>
</div>
<div id="limitations-of-model-comparison-techniques" class="section level2 hasAnchor" number="7.12">
<h2><span class="header-section-number">7.12</span> Limitations of model comparison techniques<a href="model-comparison.html#limitations-of-model-comparison-techniques" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>it might be overfitting to the training population, that is, to the</li>
</ol>

</div>
<div id="mixture-models" class="section level2 hasAnchor" number="7.13">
<h2><span class="header-section-number">7.13</span> Mixture models<a href="model-comparison.html#mixture-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="load-the-dataset" class="section level3 hasAnchor" number="7.13.1">
<h3><span class="header-section-number">7.13.1</span> Load the dataset<a href="model-comparison.html#load-the-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We load the data set from chapter NN, where we loop through possible rates and noise levels, and pick one agent to build up the model progressively.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="model-comparison.html#cb204-1" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;simdata/W3_randomnoise.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 7920 Columns: 5
## ── Column specification ────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (5): trial, choice, rate, noise, cumulativerate
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="model-comparison.html#cb206-1" tabindex="-1"></a>dd <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(rate <span class="sc">==</span> <span class="fl">0.8</span> <span class="sc">&amp;</span> noise <span class="sc">==</span> <span class="fl">0.1</span>)</span>
<span id="cb206-2"><a href="model-comparison.html#cb206-2" tabindex="-1"></a></span>
<span id="cb206-3"><a href="model-comparison.html#cb206-3" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb206-4"><a href="model-comparison.html#cb206-4" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">120</span>,</span>
<span id="cb206-5"><a href="model-comparison.html#cb206-5" tabindex="-1"></a>  <span class="at">h =</span> dd<span class="sc">$</span>choice</span>
<span id="cb206-6"><a href="model-comparison.html#cb206-6" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div id="stan-model-mixing-biased-and-noise" class="section level2 hasAnchor" number="7.14">
<h2><span class="header-section-number">7.14</span> Stan model mixing biased and noise<a href="model-comparison.html#stan-model-mixing-biased-and-noise" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We then build a Stan model with the noise parameter</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="model-comparison.html#cb207-1" tabindex="-1"></a>stan_mixture_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb207-2"><a href="model-comparison.html#cb207-2" tabindex="-1"></a><span class="st">// This Stan model defines a mixture of bernoulli (random bias + noise)</span></span>
<span id="cb207-3"><a href="model-comparison.html#cb207-3" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb207-4"><a href="model-comparison.html#cb207-4" tabindex="-1"></a></span>
<span id="cb207-5"><a href="model-comparison.html#cb207-5" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of heads</span></span>
<span id="cb207-6"><a href="model-comparison.html#cb207-6" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb207-7"><a href="model-comparison.html#cb207-7" tabindex="-1"></a><span class="st"> int&lt;lower=1&gt; n;</span></span>
<span id="cb207-8"><a href="model-comparison.html#cb207-8" tabindex="-1"></a><span class="st"> array[n] int h;</span></span>
<span id="cb207-9"><a href="model-comparison.html#cb207-9" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb207-10"><a href="model-comparison.html#cb207-10" tabindex="-1"></a></span>
<span id="cb207-11"><a href="model-comparison.html#cb207-11" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb207-12"><a href="model-comparison.html#cb207-12" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb207-13"><a href="model-comparison.html#cb207-13" tabindex="-1"></a><span class="st">  real bias;</span></span>
<span id="cb207-14"><a href="model-comparison.html#cb207-14" tabindex="-1"></a><span class="st">  real noise;</span></span>
<span id="cb207-15"><a href="model-comparison.html#cb207-15" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb207-16"><a href="model-comparison.html#cb207-16" tabindex="-1"></a></span>
<span id="cb207-17"><a href="model-comparison.html#cb207-17" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb207-18"><a href="model-comparison.html#cb207-18" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb207-19"><a href="model-comparison.html#cb207-19" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb207-20"><a href="model-comparison.html#cb207-20" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | 0, 1);</span></span>
<span id="cb207-21"><a href="model-comparison.html#cb207-21" tabindex="-1"></a><span class="st">  target += normal_lpdf(noise | 0, 1);</span></span>
<span id="cb207-22"><a href="model-comparison.html#cb207-22" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb207-23"><a href="model-comparison.html#cb207-23" tabindex="-1"></a><span class="st">  // The model consists of a binomial distributions with a rate theta</span></span>
<span id="cb207-24"><a href="model-comparison.html#cb207-24" tabindex="-1"></a><span class="st">  target += log_sum_exp(log(inv_logit(noise)) +</span></span>
<span id="cb207-25"><a href="model-comparison.html#cb207-25" tabindex="-1"></a><span class="st">            bernoulli_logit_lpmf(h | 0),</span></span>
<span id="cb207-26"><a href="model-comparison.html#cb207-26" tabindex="-1"></a><span class="st">            log1m(inv_logit(noise)) +  bernoulli_logit_lpmf(h | bias));</span></span>
<span id="cb207-27"><a href="model-comparison.html#cb207-27" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb207-28"><a href="model-comparison.html#cb207-28" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb207-29"><a href="model-comparison.html#cb207-29" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb207-30"><a href="model-comparison.html#cb207-30" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; noise_p;</span></span>
<span id="cb207-31"><a href="model-comparison.html#cb207-31" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; bias_p;</span></span>
<span id="cb207-32"><a href="model-comparison.html#cb207-32" tabindex="-1"></a><span class="st">  noise_p = inv_logit(noise);</span></span>
<span id="cb207-33"><a href="model-comparison.html#cb207-33" tabindex="-1"></a><span class="st">  bias_p = inv_logit(bias);</span></span>
<span id="cb207-34"><a href="model-comparison.html#cb207-34" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb207-35"><a href="model-comparison.html#cb207-35" tabindex="-1"></a></span>
<span id="cb207-36"><a href="model-comparison.html#cb207-36" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb207-37"><a href="model-comparison.html#cb207-37" tabindex="-1"></a></span>
<span id="cb207-38"><a href="model-comparison.html#cb207-38" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb207-39"><a href="model-comparison.html#cb207-39" tabindex="-1"></a>  stan_mixture_model,</span>
<span id="cb207-40"><a href="model-comparison.html#cb207-40" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb207-41"><a href="model-comparison.html#cb207-41" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MixtureSingle.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MixtureSingle.stan&quot;</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="model-comparison.html#cb209-1" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MixtureSingle.stan&quot;</span>)</span>
<span id="cb209-2"><a href="model-comparison.html#cb209-2" tabindex="-1"></a>mod_mixture <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb209-3"><a href="model-comparison.html#cb209-3" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
</div>
<div id="fitting-and-assessing-the-model" class="section level2 hasAnchor" number="7.15">
<h2><span class="header-section-number">7.15</span> Fitting and assessing the model<a href="model-comparison.html#fitting-and-assessing-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="model-comparison.html#cb210-1" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod_mixture<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb210-2"><a href="model-comparison.html#cb210-2" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb210-3"><a href="model-comparison.html#cb210-3" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb210-4"><a href="model-comparison.html#cb210-4" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb210-5"><a href="model-comparison.html#cb210-5" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb210-6"><a href="model-comparison.html#cb210-6" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb210-7"><a href="model-comparison.html#cb210-7" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb210-8"><a href="model-comparison.html#cb210-8" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb210-9"><a href="model-comparison.html#cb210-9" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb210-10"><a href="model-comparison.html#cb210-10" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb210-11"><a href="model-comparison.html#cb210-11" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb210-12"><a href="model-comparison.html#cb210-12" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 0.2 seconds.
## Chain 2 finished in 0.2 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 0.2 seconds.
## Total execution time: 0.3 seconds.</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="model-comparison.html#cb212-1" tabindex="-1"></a><span class="fu">save</span>(samples, data, </span>
<span id="cb212-2"><a href="model-comparison.html#cb212-2" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W7_singlemixture.RData&quot;</span>) </span>
<span id="cb212-3"><a href="model-comparison.html#cb212-3" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W7_singlemixture.RDS&quot;</span>)</span>
<span id="cb212-4"><a href="model-comparison.html#cb212-4" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W7_singlemixture&quot;</span>)</span></code></pre></div>
<pre><code>## Moved 2 files and set internal paths to new locations:
## - /Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/simmodels/W7_singlemixture-202402142307-1-7cd9f8.csv
## - /Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/simmodels/W7_singlemixture-202402142307-2-7cd9f8.csv</code></pre>
<p>[MISSING: EVALUATION]</p>
</div>
<div id="basic-evaluation" class="section level2 hasAnchor" number="7.16">
<h2><span class="header-section-number">7.16</span> Basic evaluation<a href="model-comparison.html#basic-evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="model-comparison.html#cb214-1" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 10
##   variable    mean  median     sd    mad      q5     q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 lp__     -65.7   -65.4   1.03   0.713  -67.7   -64.7    1.00    1396.    1708.
## 2 bias       1.28    1.28  0.216  0.212    0.942   1.65   1.00    1990.    1860.
## 3 noise     -0.400  -0.408 0.928  0.941   -1.92    1.11   1.00    2054.    2137.
## 4 noise_p    0.416   0.399 0.193  0.218    0.128   0.753  1.00    2054.    2137.
## 5 bias_p     0.781   0.782 0.0364 0.0361   0.719   0.839  1.00    1990.    1860.</code></pre>
</div>
<div id="multilevel-mixture-model" class="section level2 hasAnchor" number="7.17">
<h2><span class="header-section-number">7.17</span> Multilevel mixture model<a href="model-comparison.html#multilevel-mixture-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="model-comparison.html#cb216-1" tabindex="-1"></a><span class="do">### Multilevel mixture</span></span>
<span id="cb216-2"><a href="model-comparison.html#cb216-2" tabindex="-1"></a>stan_multilevelMixture_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb216-3"><a href="model-comparison.html#cb216-3" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb216-4"><a href="model-comparison.html#cb216-4" tabindex="-1"></a><span class="st">// This Stan model defines a mixture of bernoulli (random bias + noise)</span></span>
<span id="cb216-5"><a href="model-comparison.html#cb216-5" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb216-6"><a href="model-comparison.html#cb216-6" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb216-7"><a href="model-comparison.html#cb216-7" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb216-8"><a href="model-comparison.html#cb216-8" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb216-9"><a href="model-comparison.html#cb216-9" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb216-10"><a href="model-comparison.html#cb216-10" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb216-11"><a href="model-comparison.html#cb216-11" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb216-12"><a href="model-comparison.html#cb216-12" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb216-13"><a href="model-comparison.html#cb216-13" tabindex="-1"></a></span>
<span id="cb216-14"><a href="model-comparison.html#cb216-14" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of heads</span></span>
<span id="cb216-15"><a href="model-comparison.html#cb216-15" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb216-16"><a href="model-comparison.html#cb216-16" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb216-17"><a href="model-comparison.html#cb216-17" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb216-18"><a href="model-comparison.html#cb216-18" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb216-19"><a href="model-comparison.html#cb216-19" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb216-20"><a href="model-comparison.html#cb216-20" tabindex="-1"></a></span>
<span id="cb216-21"><a href="model-comparison.html#cb216-21" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb216-22"><a href="model-comparison.html#cb216-22" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb216-23"><a href="model-comparison.html#cb216-23" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb216-24"><a href="model-comparison.html#cb216-24" tabindex="-1"></a><span class="st">  real noiseM; // p of noise</span></span>
<span id="cb216-25"><a href="model-comparison.html#cb216-25" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb216-26"><a href="model-comparison.html#cb216-26" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb216-27"><a href="model-comparison.html#cb216-27" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb216-28"><a href="model-comparison.html#cb216-28" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb216-29"><a href="model-comparison.html#cb216-29" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb216-30"><a href="model-comparison.html#cb216-30" tabindex="-1"></a></span>
<span id="cb216-31"><a href="model-comparison.html#cb216-31" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb216-32"><a href="model-comparison.html#cb216-32" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb216-33"><a href="model-comparison.html#cb216-33" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb216-34"><a href="model-comparison.html#cb216-34" tabindex="-1"></a><span class="st"> }</span></span>
<span id="cb216-35"><a href="model-comparison.html#cb216-35" tabindex="-1"></a></span>
<span id="cb216-36"><a href="model-comparison.html#cb216-36" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb216-37"><a href="model-comparison.html#cb216-37" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb216-38"><a href="model-comparison.html#cb216-38" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb216-39"><a href="model-comparison.html#cb216-39" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb216-40"><a href="model-comparison.html#cb216-40" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb216-41"><a href="model-comparison.html#cb216-41" tabindex="-1"></a></span>
<span id="cb216-42"><a href="model-comparison.html#cb216-42" tabindex="-1"></a><span class="st">  target += normal_lpdf(noiseM | -1, .5);</span></span>
<span id="cb216-43"><a href="model-comparison.html#cb216-43" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb216-44"><a href="model-comparison.html#cb216-44" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb216-45"><a href="model-comparison.html#cb216-45" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb216-46"><a href="model-comparison.html#cb216-46" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb216-47"><a href="model-comparison.html#cb216-47" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb216-48"><a href="model-comparison.html#cb216-48" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb216-49"><a href="model-comparison.html#cb216-49" tabindex="-1"></a></span>
<span id="cb216-50"><a href="model-comparison.html#cb216-50" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb216-51"><a href="model-comparison.html#cb216-51" tabindex="-1"></a><span class="st">    target += log_sum_exp(</span></span>
<span id="cb216-52"><a href="model-comparison.html#cb216-52" tabindex="-1"></a><span class="st">            log(inv_logit(noiseM + IDs[i,2])) +  // p of noise</span></span>
<span id="cb216-53"><a href="model-comparison.html#cb216-53" tabindex="-1"></a><span class="st">                    bernoulli_logit_lpmf(h[,i] | 0), // times post likelihood of the noise model</span></span>
<span id="cb216-54"><a href="model-comparison.html#cb216-54" tabindex="-1"></a><span class="st">            log1m(inv_logit(noiseM + IDs[i,2])) + // 1 - p of noise</span></span>
<span id="cb216-55"><a href="model-comparison.html#cb216-55" tabindex="-1"></a><span class="st">                    bernoulli_logit_lpmf(h[,i] | thetaM + IDs[i,1])); // times post likelihood of the bias model</span></span>
<span id="cb216-56"><a href="model-comparison.html#cb216-56" tabindex="-1"></a><span class="st">                    </span></span>
<span id="cb216-57"><a href="model-comparison.html#cb216-57" tabindex="-1"></a></span>
<span id="cb216-58"><a href="model-comparison.html#cb216-58" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb216-59"><a href="model-comparison.html#cb216-59" tabindex="-1"></a></span>
<span id="cb216-60"><a href="model-comparison.html#cb216-60" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb216-61"><a href="model-comparison.html#cb216-61" tabindex="-1"></a><span class="st">  real thetaM_prior;</span></span>
<span id="cb216-62"><a href="model-comparison.html#cb216-62" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb216-63"><a href="model-comparison.html#cb216-63" tabindex="-1"></a><span class="st">  real noiseM_prior;</span></span>
<span id="cb216-64"><a href="model-comparison.html#cb216-64" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; noiseSD_prior;</span></span>
<span id="cb216-65"><a href="model-comparison.html#cb216-65" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb216-66"><a href="model-comparison.html#cb216-66" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; noise_prior;</span></span>
<span id="cb216-67"><a href="model-comparison.html#cb216-67" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb216-68"><a href="model-comparison.html#cb216-68" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; noise_posterior;</span></span>
<span id="cb216-69"><a href="model-comparison.html#cb216-69" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb216-70"><a href="model-comparison.html#cb216-70" tabindex="-1"></a><span class="st">  array[trials,agents] int&lt;lower=0, upper = trials&gt; prior_noise;</span></span>
<span id="cb216-71"><a href="model-comparison.html#cb216-71" tabindex="-1"></a><span class="st">  array[trials,agents] int&lt;lower=0, upper = trials&gt; posterior_noise;</span></span>
<span id="cb216-72"><a href="model-comparison.html#cb216-72" tabindex="-1"></a><span class="st">  array[trials,agents] int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb216-73"><a href="model-comparison.html#cb216-73" tabindex="-1"></a><span class="st">  array[trials,agents] int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb216-74"><a href="model-comparison.html#cb216-74" tabindex="-1"></a></span>
<span id="cb216-75"><a href="model-comparison.html#cb216-75" tabindex="-1"></a><span class="st">  array[trials, agents] real log_lik;</span></span>
<span id="cb216-76"><a href="model-comparison.html#cb216-76" tabindex="-1"></a></span>
<span id="cb216-77"><a href="model-comparison.html#cb216-77" tabindex="-1"></a><span class="st">  thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb216-78"><a href="model-comparison.html#cb216-78" tabindex="-1"></a><span class="st">  thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb216-79"><a href="model-comparison.html#cb216-79" tabindex="-1"></a><span class="st">  theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb216-80"><a href="model-comparison.html#cb216-80" tabindex="-1"></a><span class="st">  noiseM_prior = normal_rng(-1,.5);</span></span>
<span id="cb216-81"><a href="model-comparison.html#cb216-81" tabindex="-1"></a><span class="st">  noiseSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb216-82"><a href="model-comparison.html#cb216-82" tabindex="-1"></a><span class="st">  noise_prior = inv_logit(normal_rng(noiseM_prior, noiseSD_prior));</span></span>
<span id="cb216-83"><a href="model-comparison.html#cb216-83" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb216-84"><a href="model-comparison.html#cb216-84" tabindex="-1"></a><span class="st">  theta_posterior = inv_logit(normal_rng(thetaM, tau[1]));</span></span>
<span id="cb216-85"><a href="model-comparison.html#cb216-85" tabindex="-1"></a><span class="st">  noise_posterior = inv_logit(normal_rng(noiseM, tau[2]));</span></span>
<span id="cb216-86"><a href="model-comparison.html#cb216-86" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb216-87"><a href="model-comparison.html#cb216-87" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb216-88"><a href="model-comparison.html#cb216-88" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb216-89"><a href="model-comparison.html#cb216-89" tabindex="-1"></a><span class="st">     </span></span>
<span id="cb216-90"><a href="model-comparison.html#cb216-90" tabindex="-1"></a><span class="st">    for (t in 1:trials){</span></span>
<span id="cb216-91"><a href="model-comparison.html#cb216-91" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb216-92"><a href="model-comparison.html#cb216-92" tabindex="-1"></a><span class="st">      prior_noise[t,i] = bernoulli_rng(noise_prior);</span></span>
<span id="cb216-93"><a href="model-comparison.html#cb216-93" tabindex="-1"></a><span class="st">      posterior_noise[t,i] = bernoulli_rng(inv_logit(noiseM + IDs[i,2]));</span></span>
<span id="cb216-94"><a href="model-comparison.html#cb216-94" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb216-95"><a href="model-comparison.html#cb216-95" tabindex="-1"></a><span class="st">      if(prior_noise[t,i]==1){</span></span>
<span id="cb216-96"><a href="model-comparison.html#cb216-96" tabindex="-1"></a><span class="st">        prior_preds[t,i] = bernoulli_rng(theta_prior);</span></span>
<span id="cb216-97"><a href="model-comparison.html#cb216-97" tabindex="-1"></a><span class="st">      } else{</span></span>
<span id="cb216-98"><a href="model-comparison.html#cb216-98" tabindex="-1"></a><span class="st">        prior_preds[t,i] = bernoulli_rng(0.5);</span></span>
<span id="cb216-99"><a href="model-comparison.html#cb216-99" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb216-100"><a href="model-comparison.html#cb216-100" tabindex="-1"></a><span class="st">      if(posterior_noise[t,i]==1){</span></span>
<span id="cb216-101"><a href="model-comparison.html#cb216-101" tabindex="-1"></a><span class="st">        posterior_preds[t,i] = bernoulli_rng(inv_logit(thetaM + IDs[i,1]));</span></span>
<span id="cb216-102"><a href="model-comparison.html#cb216-102" tabindex="-1"></a><span class="st">      } else{</span></span>
<span id="cb216-103"><a href="model-comparison.html#cb216-103" tabindex="-1"></a><span class="st">        posterior_preds[t,i] = bernoulli_rng(0.5);</span></span>
<span id="cb216-104"><a href="model-comparison.html#cb216-104" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb216-105"><a href="model-comparison.html#cb216-105" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb216-106"><a href="model-comparison.html#cb216-106" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb216-107"><a href="model-comparison.html#cb216-107" tabindex="-1"></a><span class="st">      log_lik[t,i] = log_sum_exp(</span></span>
<span id="cb216-108"><a href="model-comparison.html#cb216-108" tabindex="-1"></a><span class="st">            log(inv_logit(noiseM + IDs[i,2])) +  // p of noise</span></span>
<span id="cb216-109"><a href="model-comparison.html#cb216-109" tabindex="-1"></a><span class="st">                    bernoulli_logit_lpmf(h[t,i] | 0), // times post likelihood of the noise model</span></span>
<span id="cb216-110"><a href="model-comparison.html#cb216-110" tabindex="-1"></a><span class="st">            log1m(inv_logit(noiseM + IDs[i,2])) + // 1 - p of noise</span></span>
<span id="cb216-111"><a href="model-comparison.html#cb216-111" tabindex="-1"></a><span class="st">                    bernoulli_logit_lpmf(h[t,i] | thetaM + IDs[i,1])); // times post likelihood of the bias model</span></span>
<span id="cb216-112"><a href="model-comparison.html#cb216-112" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb216-113"><a href="model-comparison.html#cb216-113" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb216-114"><a href="model-comparison.html#cb216-114" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb216-115"><a href="model-comparison.html#cb216-115" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb216-116"><a href="model-comparison.html#cb216-116" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb216-117"><a href="model-comparison.html#cb216-117" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb216-118"><a href="model-comparison.html#cb216-118" tabindex="-1"></a></span>
<span id="cb216-119"><a href="model-comparison.html#cb216-119" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb216-120"><a href="model-comparison.html#cb216-120" tabindex="-1"></a>  stan_multilevelMixture_model,</span>
<span id="cb216-121"><a href="model-comparison.html#cb216-121" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb216-122"><a href="model-comparison.html#cb216-122" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W6_MixtureMultilevel.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W6_MixtureMultilevel.stan&quot;</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="model-comparison.html#cb218-1" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W6_MixtureMultilevel.stan&quot;</span>)</span>
<span id="cb218-2"><a href="model-comparison.html#cb218-2" tabindex="-1"></a>mod_mixture <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb218-3"><a href="model-comparison.html#cb218-3" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span>
<span id="cb218-4"><a href="model-comparison.html#cb218-4" tabindex="-1"></a></span>
<span id="cb218-5"><a href="model-comparison.html#cb218-5" tabindex="-1"></a></span>
<span id="cb218-6"><a href="model-comparison.html#cb218-6" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod_mixture<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb218-7"><a href="model-comparison.html#cb218-7" tabindex="-1"></a>  <span class="at">data =</span> data_biased,</span>
<span id="cb218-8"><a href="model-comparison.html#cb218-8" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb218-9"><a href="model-comparison.html#cb218-9" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb218-10"><a href="model-comparison.html#cb218-10" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb218-11"><a href="model-comparison.html#cb218-11" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb218-12"><a href="model-comparison.html#cb218-12" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb218-13"><a href="model-comparison.html#cb218-13" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb218-14"><a href="model-comparison.html#cb218-14" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb218-15"><a href="model-comparison.html#cb218-15" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb218-16"><a href="model-comparison.html#cb218-16" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb218-17"><a href="model-comparison.html#cb218-17" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 126.5 seconds.
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 128.0 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 127.2 seconds.
## Total execution time: 128.2 seconds.</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="model-comparison.html#cb220-1" tabindex="-1"></a><span class="fu">save</span>(samples, data, </span>
<span id="cb220-2"><a href="model-comparison.html#cb220-2" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;simmodels/W7_multimixture.RData&quot;</span>) </span>
<span id="cb220-3"><a href="model-comparison.html#cb220-3" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W7_multimixture.RDS&quot;</span>)</span>
<span id="cb220-4"><a href="model-comparison.html#cb220-4" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_output_files</span>(<span class="at">dir =</span> <span class="st">&quot;simmodels&quot;</span>, <span class="at">basename =</span> <span class="st">&quot;W7_multimixture&quot;</span>)</span></code></pre></div>
<pre><code>## Moved 2 files and set internal paths to new locations:
## - /Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/simmodels/W7_multimixture-202402142310-1-34d434.csv
## - /Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/simmodels/W7_multimixture-202402142310-2-34d434.csv</code></pre>
<p>[MISSING: EVALUATION]</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="model-comparison.html#cb222-1" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## # A tibble: 60,417 × 10
##    variable      mean   median      sd     mad       q5      q95  rhat ess_bulk ess_tail
##    &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 lp__      -6.36e+3 -6.36e+3 12.4    12.3    -6.38e+3 -6.34e+3  1.00    1042.    1964.
##  2 thetaM     1.36e+0  1.36e+0  0.0681  0.0686  1.25e+0  1.48e+0  1.00     690.    1295.
##  3 noiseM    -2.50e+0 -2.49e+0  0.316   0.315  -3.02e+0 -1.98e+0  1.00    4449.    2822.
##  4 tau[1]     6.13e-1  6.12e-1  0.0512  0.0501  5.32e-1  7.01e-1  1.00    1328.    2398.
##  5 tau[2]     2.04e-1  1.74e-1  0.154   0.150   1.65e-2  5.04e-1  1.00    3225.    2146.
##  6 z_IDs[1,… -9.89e-1 -9.90e-1  0.335   0.323  -1.54e+0 -4.32e-1  1.00    3404.    2731.
##  7 z_IDs[2,… -1.27e-2 -3.20e-2  0.999   0.970  -1.66e+0  1.65e+0  1.00    6980.    2385.
##  8 z_IDs[1,…  2.07e+0  2.05e+0  0.522   0.508   1.25e+0  2.97e+0  1.00    5776.    3029.
##  9 z_IDs[2,… -1.36e-2 -3.70e-3  1.00    0.980  -1.66e+0  1.64e+0  1.00    6082.    2961.
## 10 z_IDs[1,… -4.31e-1 -4.35e-1  0.356   0.362  -1.02e+0  1.60e-1  1.00    3908.    2225.
## # ℹ 60,407 more rows</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="model-comparison.html#cb224-1" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">loo</span>()</span></code></pre></div>
<pre><code>## Warning: Some Pareto k diagnostic values are too high. See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<pre><code>## 
## Computed from 4000 by 12000 log-likelihood matrix
## 
##          Estimate    SE
## elpd_loo  -6171.3  52.2
## p_loo       111.5   2.5
## looic     12342.5 104.3
## ------
## Monte Carlo SE of elpd_loo is NA.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     11732 97.8%   586       
##  (0.5, 0.7]   (ok)         174  1.5%   1624      
##    (0.7, 1]   (bad)         94  0.8%   718       
##    (1, Inf)   (very bad)     0  0.0%   &lt;NA&gt;      
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>[MISSING: PARAMETER RECOVERY]</p>
<p>[MISSING: BIASED VS. MEMORY?]</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="multilevel-modeling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bonus-chapter-additional-models-developed-by-students.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/06-ModelComparison.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
