<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Multilevel modeling | 10-CategorizationModels</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Multilevel modeling | 10-CategorizationModels" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Multilevel modeling | 10-CategorizationModels" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2023" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2023-03-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="practical-exercise-4---model-quality-checks.html"/>
<link rel="next" href="model-comparison.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-goal-of-the-course"><i class="fa fa-check"></i><b>1.1</b> The goal of the course</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#list-of-lectures-and-practical-exercises"><i class="fa fa-check"></i><b>1.2</b> List of lectures and practical exercises</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preparation-before-the-course"><i class="fa fa-check"></i><b>1.3</b> Preparation before the course</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><i class="fa fa-check"></i><b>2</b> Practical exercise 1 - Building verbal models of the matching pennies game</a>
<ul>
<li class="chapter" data-level="2.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#trying-out-the-game-and-collecting-your-own-data"><i class="fa fa-check"></i><b>2.1</b> Trying out the game and collecting your own data</a></li>
<li class="chapter" data-level="2.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#start-theorizing"><i class="fa fa-check"></i><b>2.2</b> Start Theorizing</a></li>
<li class="chapter" data-level="2.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>2.3</b> The distinction between participant and researcher perspectives</a></li>
<li class="chapter" data-level="2.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#strategies"><i class="fa fa-check"></i><b>2.4</b> Strategies</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#random-strategies"><i class="fa fa-check"></i><b>2.4.1</b> Random strategies</a></li>
<li class="chapter" data-level="2.4.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#immediate-reaction"><i class="fa fa-check"></i><b>2.4.2</b> Immediate reaction</a></li>
<li class="chapter" data-level="2.4.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>2.4.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="2.4.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>2.4.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="2.4.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#reinforcement-learning"><i class="fa fa-check"></i><b>2.4.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="2.4.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#k-tom"><i class="fa fa-check"></i><b>2.4.6</b> k-ToM</a></li>
<li class="chapter" data-level="2.4.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#other-possible-strategies"><i class="fa fa-check"></i><b>2.4.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#cognitive-constraints"><i class="fa fa-check"></i><b>2.5</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#memory"><i class="fa fa-check"></i><b>2.5.1</b> Memory</a></li>
<li class="chapter" data-level="2.5.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#errors"><i class="fa fa-check"></i><b>2.5.2</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#continuity-between-models"><i class="fa fa-check"></i><b>2.6</b> Continuity between models</a></li>
<li class="chapter" data-level="2.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#mixture-of-strategies"><i class="fa fa-check"></i><b>2.7</b> Mixture of strategies</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html"><i class="fa fa-check"></i><b>3</b> Practical exercise 2 - From verbal to formal models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>3.1</b> Defining general conditions</a></li>
<li class="chapter" data-level="3.2" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>3.2</b> Implementing a random agent</a></li>
<li class="chapter" data-level="3.3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>3.3</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="3.4" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>3.4</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>3.4.1</b> And we visualize it</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html"><i class="fa fa-check"></i><b>4</b> Practical exercise 3 - Getting into Stan</a>
<ul>
<li class="chapter" data-level="4.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#simulating-data"><i class="fa fa-check"></i><b>4.2</b> Simulating data</a></li>
<li class="chapter" data-level="4.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#building-our-basic-model-in-stan"><i class="fa fa-check"></i><b>4.3</b> Building our basic model in Stan</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#data"><i class="fa fa-check"></i><b>4.3.1</b> Data</a></li>
<li class="chapter" data-level="4.3.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#model"><i class="fa fa-check"></i><b>4.3.2</b> Model</a></li>
<li class="chapter" data-level="4.3.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#compiling-and-fitting-the-model"><i class="fa fa-check"></i><b>4.3.3</b> Compiling and fitting the model</a></li>
<li class="chapter" data-level="4.3.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-model"><i class="fa fa-check"></i><b>4.3.4</b> Summarizing the model</a></li>
<li class="chapter" data-level="4.3.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#assessing-model-quality"><i class="fa fa-check"></i><b>4.3.5</b> Assessing model quality</a></li>
<li class="chapter" data-level="4.3.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-results"><i class="fa fa-check"></i><b>4.3.6</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#parameter-recovery"><i class="fa fa-check"></i><b>4.4</b> Parameter recovery</a></li>
<li class="chapter" data-level="4.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#the-memory-model-conditioning-theta"><i class="fa fa-check"></i><b>4.5</b> The memory model: conditioning theta</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#summarizing-the-results-1"><i class="fa fa-check"></i><b>4.5.1</b> Summarizing the results</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#memory-agent-with-internal-parameter"><i class="fa fa-check"></i><b>4.6</b> Memory agent with internal parameter</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#trying-out-a-more-complex-memory-model-with-a-rate-of-forgetting-that-exponentially-discounts-the-past"><i class="fa fa-check"></i><b>4.6.1</b> Trying out a more complex memory model, with a rate of forgetting that exponentially discounts the past</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html"><i class="fa fa-check"></i><b>5</b> Practical exercise 4 - Model quality checks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#generating-and-plotting-additional-variables"><i class="fa fa-check"></i><b>5.1</b> Generating and plotting additional variables</a></li>
<li class="chapter" data-level="5.2" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-priors"><i class="fa fa-check"></i><b>5.2</b> Assessing priors</a></li>
<li class="chapter" data-level="5.3" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-prior-and-posterior-predictions"><i class="fa fa-check"></i><b>5.3</b> Assessing prior and posterior predictions</a></li>
<li class="chapter" data-level="5.4" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>5.4</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="5.5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#the-memory-model"><i class="fa fa-check"></i><b>5.5</b> The memory model</a></li>
<li class="chapter" data-level="5.6" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-check-for-the-memory-model"><i class="fa fa-check"></i><b>5.6</b> Prior sensitivity check for the memory model</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html"><i class="fa fa-check"></i><b>6</b> Multilevel modeling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#intro-to-multilevel-modeling"><i class="fa fa-check"></i><b>6.1</b> Intro to multilevel modeling</a></li>
<li class="chapter" data-level="6.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#a-multilevel-version-of-the-biased-agent-and-of-the-simple-memory-agent"><i class="fa fa-check"></i><b>6.2</b> A multilevel version of the biased agent and of the simple memory agent</a></li>
<li class="chapter" data-level="6.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#generating-the-agents"><i class="fa fa-check"></i><b>6.3</b> Generating the agents</a></li>
<li class="chapter" data-level="6.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#plotting-the-agents"><i class="fa fa-check"></i><b>6.4</b> Plotting the agents</a></li>
<li class="chapter" data-level="6.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#coding-the-multilevel-agents"><i class="fa fa-check"></i><b>6.5</b> Coding the multilevel agents</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-random"><i class="fa fa-check"></i><b>6.5.1</b> Multilevel random</a></li>
<li class="chapter" data-level="6.5.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-random-agents"><i class="fa fa-check"></i><b>6.5.2</b> Assessing multilevel random agents</a></li>
<li class="chapter" data-level="6.5.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory"><i class="fa fa-check"></i><b>6.5.3</b> Multilevel memory</a></li>
<li class="chapter" data-level="6.5.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory"><i class="fa fa-check"></i><b>6.5.4</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization"><i class="fa fa-check"></i><b>6.5.5</b> Multilevel memory with non centered parameterization</a></li>
<li class="chapter" data-level="6.5.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-1"><i class="fa fa-check"></i><b>6.5.6</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.7" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters"><i class="fa fa-check"></i><b>6.5.7</b> Multilevel memory with correlation between parameters</a></li>
<li class="chapter" data-level="6.5.8" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-2"><i class="fa fa-check"></i><b>6.5.8</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.9" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-no-pooling"><i class="fa fa-check"></i><b>6.5.9</b> Multilevel memory no pooling</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-full-pooling"><i class="fa fa-check"></i><b>6.6</b> Multilevel full pooling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="model-comparison.html"><a href="model-comparison.html"><i class="fa fa-check"></i><b>7</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.1" data-path="model-comparison.html"><a href="model-comparison.html#define-parameters"><i class="fa fa-check"></i><b>7.1</b> Define parameters</a></li>
<li class="chapter" data-level="7.2" data-path="model-comparison.html"><a href="model-comparison.html#define-biased-and-memory-agents"><i class="fa fa-check"></i><b>7.2</b> Define biased and memory agents</a></li>
<li class="chapter" data-level="7.3" data-path="model-comparison.html"><a href="model-comparison.html#generating-the-agents-1"><i class="fa fa-check"></i><b>7.3</b> Generating the agents</a></li>
<li class="chapter" data-level="7.4" data-path="model-comparison.html"><a href="model-comparison.html#prep-the-data"><i class="fa fa-check"></i><b>7.4</b> Prep the data</a></li>
<li class="chapter" data-level="7.5" data-path="model-comparison.html"><a href="model-comparison.html#log-posterior-likelihood"><i class="fa fa-check"></i><b>7.5</b> Log posterior likelihood</a></li>
<li class="chapter" data-level="7.6" data-path="model-comparison.html"><a href="model-comparison.html#create-the-models-multilevel-biased-agents"><i class="fa fa-check"></i><b>7.6</b> Create the models: multilevel biased agents</a></li>
<li class="chapter" data-level="7.7" data-path="model-comparison.html"><a href="model-comparison.html#multilevel-memory-model"><i class="fa fa-check"></i><b>7.7</b> Multilevel memory model</a></li>
<li class="chapter" data-level="7.8" data-path="model-comparison.html"><a href="model-comparison.html#fitting-the-models-to-the-data"><i class="fa fa-check"></i><b>7.8</b> Fitting the models to the data</a></li>
<li class="chapter" data-level="7.9" data-path="model-comparison.html"><a href="model-comparison.html#calculating-the-expected-log-predictive-density-of-a-model"><i class="fa fa-check"></i><b>7.9</b> Calculating the expected log predictive density of a model</a></li>
<li class="chapter" data-level="7.10" data-path="model-comparison.html"><a href="model-comparison.html#implementing-cross-validation"><i class="fa fa-check"></i><b>7.10</b> Implementing Cross-Validation</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="model-comparison.html"><a href="model-comparison.html#create-cross-validation-ready-stan-model-for-biased-agents"><i class="fa fa-check"></i><b>7.10.1</b> Create cross-validation ready stan model for biased agents</a></li>
<li class="chapter" data-level="7.10.2" data-path="model-comparison.html"><a href="model-comparison.html#create-cross-validation-ready-stan-model-for-memory-agents"><i class="fa fa-check"></i><b>7.10.2</b> Create cross-validation ready stan model for memory agents</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="model-comparison.html"><a href="model-comparison.html#calculating-elpd-and-comparing"><i class="fa fa-check"></i><b>7.11</b> Calculating elpd and comparing</a></li>
<li class="chapter" data-level="7.12" data-path="model-comparison.html"><a href="model-comparison.html#limitations-of-model-comparison-techniques"><i class="fa fa-check"></i><b>7.12</b> Limitations of model comparison techniques</a></li>
<li class="chapter" data-level="7.13" data-path="model-comparison.html"><a href="model-comparison.html#mixture-models"><i class="fa fa-check"></i><b>7.13</b> Mixture models</a>
<ul>
<li class="chapter" data-level="7.13.1" data-path="model-comparison.html"><a href="model-comparison.html#load-the-dataset"><i class="fa fa-check"></i><b>7.13.1</b> Load the dataset</a></li>
</ul></li>
<li class="chapter" data-level="7.14" data-path="model-comparison.html"><a href="model-comparison.html#stan-model-mixing-biased-and-noise"><i class="fa fa-check"></i><b>7.14</b> Stan model mixing biased and noise</a></li>
<li class="chapter" data-level="7.15" data-path="model-comparison.html"><a href="model-comparison.html#fitting-and-assessing-the-model"><i class="fa fa-check"></i><b>7.15</b> Fitting and assessing the model</a></li>
<li class="chapter" data-level="7.16" data-path="model-comparison.html"><a href="model-comparison.html#basic-evaluation"><i class="fa fa-check"></i><b>7.16</b> Basic evaluation</a></li>
<li class="chapter" data-level="7.17" data-path="model-comparison.html"><a href="model-comparison.html#multilevel-mixture-model"><i class="fa fa-check"></i><b>7.17</b> Multilevel mixture model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html"><i class="fa fa-check"></i><b>8</b> Bonus chapter: Additional models developed by students</a>
<ul>
<li class="chapter" data-level="8.1" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#additional-models"><i class="fa fa-check"></i><b>8.1</b> Additional models</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#probabilistic-win-stay-lose-shift"><i class="fa fa-check"></i><b>8.1.1</b> Probabilistic Win Stay Lose Shift</a></li>
<li class="chapter" data-level="8.1.2" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#probabilistic-asymmetric-win-stay-lose-shift"><i class="fa fa-check"></i><b>8.1.2</b> Probabilistic asymmetric Win Stay Lose Shift</a></li>
<li class="chapter" data-level="8.1.3" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-rate"><i class="fa fa-check"></i><b>8.1.3</b> Memory agent with exponential memory decay (rate)</a></li>
<li class="chapter" data-level="8.1.4" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-exponential"><i class="fa fa-check"></i><b>8.1.4</b> Memory agent with exponential memory decay (exponential)</a></li>
<li class="chapter" data-level="8.1.5" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-but-separate-memory-for-wins-and-losses"><i class="fa fa-check"></i><b>8.1.5</b> Memory agent with exponential memory decay, but separate memory for wins and losses</a></li>
<li class="chapter" data-level="8.1.6" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#memory-agent-with-exponential-memory-decay-and-with-confidence"><i class="fa fa-check"></i><b>8.1.6</b> Memory agent with exponential memory decay, and with confidence</a></li>
<li class="chapter" data-level="8.1.7" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#reinforcement-learning-rescorla-wagner"><i class="fa fa-check"></i><b>8.1.7</b> Reinforcement learning (Rescorla Wagner)</a></li>
<li class="chapter" data-level="8.1.8" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#hierarchical-gaussian-filter"><i class="fa fa-check"></i><b>8.1.8</b> Hierarchical gaussian filter</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#implementing-the-wsls-model"><i class="fa fa-check"></i><b>8.2</b> Implementing the WSLS model</a></li>
<li class="chapter" data-level="8.3" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#load-packages"><i class="fa fa-check"></i><b>8.3</b> Load packages</a></li>
<li class="chapter" data-level="8.4" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#generate-data"><i class="fa fa-check"></i><b>8.4</b> Generate data</a></li>
<li class="chapter" data-level="8.5" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#sanity-check-for-the-data"><i class="fa fa-check"></i><b>8.5</b> Sanity check for the data</a></li>
<li class="chapter" data-level="8.6" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#more-sanity-check"><i class="fa fa-check"></i><b>8.6</b> More sanity check</a></li>
<li class="chapter" data-level="8.7" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-data-for-single-agent-model"><i class="fa fa-check"></i><b>8.7</b> Create data for single agent model</a></li>
<li class="chapter" data-level="8.8" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-the-model"><i class="fa fa-check"></i><b>8.8</b> Create the model</a></li>
<li class="chapter" data-level="8.9" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#basic-assessment"><i class="fa fa-check"></i><b>8.9</b> Basic assessment</a></li>
<li class="chapter" data-level="8.10" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-multilevel-data"><i class="fa fa-check"></i><b>8.10</b> Create multilevel data</a></li>
<li class="chapter" data-level="8.11" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#create-the-model-1"><i class="fa fa-check"></i><b>8.11</b> Create the model</a></li>
<li class="chapter" data-level="8.12" data-path="bonus-chapter-additional-models-developed-by-students.html"><a href="bonus-chapter-additional-models-developed-by-students.html#quality-checks"><i class="fa fa-check"></i><b>8.12</b> Quality checks</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html"><i class="fa fa-check"></i><b>9</b> Bayesian models of cognition</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#load-the-packages"><i class="fa fa-check"></i><b>9.1</b> Load the packages</a></li>
<li class="chapter" data-level="9.2" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#design-the-model"><i class="fa fa-check"></i><b>9.2</b> Design the model</a></li>
<li class="chapter" data-level="9.3" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#create-the-data"><i class="fa fa-check"></i><b>9.3</b> Create the data</a></li>
<li class="chapter" data-level="9.4" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#visualize"><i class="fa fa-check"></i><b>9.4</b> Visualize</a></li>
<li class="chapter" data-level="9.5" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#data-for-stan"><i class="fa fa-check"></i><b>9.5</b> Data for Stan</a></li>
<li class="chapter" data-level="9.6" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#create-the-stan-model"><i class="fa fa-check"></i><b>9.6</b> Create the Stan Model</a></li>
<li class="chapter" data-level="9.7" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#fitting-the-model"><i class="fa fa-check"></i><b>9.7</b> Fitting the model</a></li>
<li class="chapter" data-level="9.8" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#basic-evaluation-1"><i class="fa fa-check"></i><b>9.8</b> Basic evaluation</a></li>
<li class="chapter" data-level="9.9" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#weighted-bayes"><i class="fa fa-check"></i><b>9.9</b> Weighted Bayes</a></li>
<li class="chapter" data-level="9.10" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#visualize-1"><i class="fa fa-check"></i><b>9.10</b> Visualize</a></li>
<li class="chapter" data-level="9.11" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#build-the-weighted-bayes-stan-model-simple-formula"><i class="fa fa-check"></i><b>9.11</b> Build the Weighted Bayes Stan model (simple formula)</a></li>
<li class="chapter" data-level="9.12" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#model-evaluation"><i class="fa fa-check"></i><b>9.12</b> Model evaluation</a></li>
<li class="chapter" data-level="9.13" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#model-recovery"><i class="fa fa-check"></i><b>9.13</b> Model recovery</a></li>
<li class="chapter" data-level="9.14" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel"><i class="fa fa-check"></i><b>9.14</b> Multilevel</a></li>
<li class="chapter" data-level="9.15" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#bonus-build-the-weighted-bayes-stan-model-fancier-formula"><i class="fa fa-check"></i><b>9.15</b> Bonus: Build the Weighted Bayes Stan model (fancier formula)</a></li>
<li class="chapter" data-level="9.16" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#evaluation"><i class="fa fa-check"></i><b>9.16</b> Evaluation</a></li>
<li class="chapter" data-level="9.17" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#build-a-temporal-bayes-storing-current-belief-as-prior-for-next-turn"><i class="fa fa-check"></i><b>9.17</b> Build a temporal Bayes (storing current belief as prior for next turn)</a></li>
<li class="chapter" data-level="9.18" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#evaluate"><i class="fa fa-check"></i><b>9.18</b> Evaluate</a></li>
<li class="chapter" data-level="9.19" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel-version-of-the-simple-bayes-model"><i class="fa fa-check"></i><b>9.19</b> Multilevel version of the simple bayes model</a></li>
<li class="chapter" data-level="9.20" data-path="bayesian-models-of-cognition.html"><a href="bayesian-models-of-cognition.html#multilevel-version-of-the-weighted-bayes-model"><i class="fa fa-check"></i><b>9.20</b> Multilevel version of the weighted bayes model</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="categorization-models.html"><a href="categorization-models.html"><i class="fa fa-check"></i><b>10</b> Categorization models</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">10-CategorizationModels</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multilevel-modeling" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Multilevel modeling<a href="multilevel-modeling.html#multilevel-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="intro-to-multilevel-modeling" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Intro to multilevel modeling<a href="multilevel-modeling.html#intro-to-multilevel-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[Explanation on what multilevel modeling is - structure in the data, partial pooling, repeated measures]</p>
</div>
<div id="a-multilevel-version-of-the-biased-agent-and-of-the-simple-memory-agent" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> A multilevel version of the biased agent and of the simple memory agent<a href="multilevel-modeling.html#a-multilevel-version-of-the-biased-agent-and-of-the-simple-memory-agent" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We are now conceptualizing our agents as being part of (sampled from) a more general population. This general population is characterized by a population level average parameter value (e.g. a general bias of 0.8 as we all like right hands more) and a certain variation in the population (e.g. a standard deviation of 0.1, as we are all a bit different from each other). Each biased agent’s rate is then sampled from that distribution. Same for the memory agents.</p>
<p>[MISSING: DAG PLOTS OF THE TWO SCENARIOS]</p>
<p>Again, it’s practical to work in log odds. Why? Well, it’s not unconceivable that an agent would be 3 sd from the mean. So a biased agent could have a rate of 0.8 + 3 * 0.1, which gives a rate of 1.1. It’s kinda impossible to choose 110% of the time the right hand. We want an easy way to avoid these situations without too carefully tweaking our parameters, or including exception statements (e.g. if rate &gt; 1, then rate = 1). Conversion to log odds is again a wonderful way to work in a boundless space, and in the last step shrinking everything back to 0-1 probability space.</p>
<p>N.B. we model all agents with some added noise as we assume it cannot be eliminated from our studies.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="multilevel-modeling.html#cb119-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,</span>
<span id="cb119-2"><a href="multilevel-modeling.html#cb119-2" aria-hidden="true" tabindex="-1"></a>               here,</span>
<span id="cb119-3"><a href="multilevel-modeling.html#cb119-3" aria-hidden="true" tabindex="-1"></a>               posterior,</span>
<span id="cb119-4"><a href="multilevel-modeling.html#cb119-4" aria-hidden="true" tabindex="-1"></a>               cmdstanr,</span>
<span id="cb119-5"><a href="multilevel-modeling.html#cb119-5" aria-hidden="true" tabindex="-1"></a>               brms, tidybayes)</span>
<span id="cb119-6"><a href="multilevel-modeling.html#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="multilevel-modeling.html#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Shared parameters</span></span>
<span id="cb119-8"><a href="multilevel-modeling.html#cb119-8" aria-hidden="true" tabindex="-1"></a>agents <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb119-9"><a href="multilevel-modeling.html#cb119-9" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb119-10"><a href="multilevel-modeling.html#cb119-10" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb119-11"><a href="multilevel-modeling.html#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="multilevel-modeling.html#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Biased agents parameters</span></span>
<span id="cb119-13"><a href="multilevel-modeling.html#cb119-13" aria-hidden="true" tabindex="-1"></a>rateM <span class="ot">&lt;-</span> <span class="fl">1.386</span> <span class="co"># roughly 0.8 once inv_logit scaled</span></span>
<span id="cb119-14"><a href="multilevel-modeling.html#cb119-14" aria-hidden="true" tabindex="-1"></a>rateSD <span class="ot">&lt;-</span> <span class="fl">0.65</span> <span class="co"># roughly giving a sd of 0.1 in prob scale</span></span>
<span id="cb119-15"><a href="multilevel-modeling.html#cb119-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-16"><a href="multilevel-modeling.html#cb119-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Memory agents parameters</span></span>
<span id="cb119-17"><a href="multilevel-modeling.html#cb119-17" aria-hidden="true" tabindex="-1"></a>biasM <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb119-18"><a href="multilevel-modeling.html#cb119-18" aria-hidden="true" tabindex="-1"></a>biasSD <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb119-19"><a href="multilevel-modeling.html#cb119-19" aria-hidden="true" tabindex="-1"></a>betaM <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb119-20"><a href="multilevel-modeling.html#cb119-20" aria-hidden="true" tabindex="-1"></a>betaSD <span class="ot">&lt;-</span> <span class="fl">0.3</span></span></code></pre></div>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="multilevel-modeling.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions of the agents</span></span>
<span id="cb120-2"><a href="multilevel-modeling.html#cb120-2" aria-hidden="true" tabindex="-1"></a>RandomAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(rate, noise) {</span>
<span id="cb120-3"><a href="multilevel-modeling.html#cb120-3" aria-hidden="true" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">inv_logit_scaled</span>(rate))</span>
<span id="cb120-4"><a href="multilevel-modeling.html#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb120-5"><a href="multilevel-modeling.html#cb120-5" aria-hidden="true" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb120-6"><a href="multilevel-modeling.html#cb120-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb120-7"><a href="multilevel-modeling.html#cb120-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb120-8"><a href="multilevel-modeling.html#cb120-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-9"><a href="multilevel-modeling.html#cb120-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-10"><a href="multilevel-modeling.html#cb120-10" aria-hidden="true" tabindex="-1"></a>MemoryAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(bias, beta, otherRate, noise) {</span>
<span id="cb120-11"><a href="multilevel-modeling.html#cb120-11" aria-hidden="true" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">inv_logit_scaled</span>(bias <span class="sc">+</span> beta <span class="sc">*</span> <span class="fu">logit_scaled</span>(otherRate))</span>
<span id="cb120-12"><a href="multilevel-modeling.html#cb120-12" aria-hidden="true" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, rate)</span>
<span id="cb120-13"><a href="multilevel-modeling.html#cb120-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb120-14"><a href="multilevel-modeling.html#cb120-14" aria-hidden="true" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb120-15"><a href="multilevel-modeling.html#cb120-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb120-16"><a href="multilevel-modeling.html#cb120-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb120-17"><a href="multilevel-modeling.html#cb120-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="generating-the-agents" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Generating the agents<a href="multilevel-modeling.html#generating-the-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: PARALLELIZE]</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="multilevel-modeling.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looping through all the agents to generate the data.</span></span>
<span id="cb121-2"><a href="multilevel-modeling.html#cb121-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb121-3"><a href="multilevel-modeling.html#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="multilevel-modeling.html#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (agent <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>agents) {</span>
<span id="cb121-5"><a href="multilevel-modeling.html#cb121-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-6"><a href="multilevel-modeling.html#cb121-6" aria-hidden="true" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, rateM, rateSD)</span>
<span id="cb121-7"><a href="multilevel-modeling.html#cb121-7" aria-hidden="true" tabindex="-1"></a>  bias <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, biasM, biasSD)</span>
<span id="cb121-8"><a href="multilevel-modeling.html#cb121-8" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, betaM, betaSD)</span>
<span id="cb121-9"><a href="multilevel-modeling.html#cb121-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-10"><a href="multilevel-modeling.html#cb121-10" aria-hidden="true" tabindex="-1"></a>  randomChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb121-11"><a href="multilevel-modeling.html#cb121-11" aria-hidden="true" tabindex="-1"></a>  memoryChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb121-12"><a href="multilevel-modeling.html#cb121-12" aria-hidden="true" tabindex="-1"></a>  memoryRate <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb121-13"><a href="multilevel-modeling.html#cb121-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-14"><a href="multilevel-modeling.html#cb121-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (trial <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>trials) {</span>
<span id="cb121-15"><a href="multilevel-modeling.html#cb121-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb121-16"><a href="multilevel-modeling.html#cb121-16" aria-hidden="true" tabindex="-1"></a>    randomChoice[trial] <span class="ot">&lt;-</span> <span class="fu">RandomAgentNoise_f</span>(rate, noise)</span>
<span id="cb121-17"><a href="multilevel-modeling.html#cb121-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trial <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb121-18"><a href="multilevel-modeling.html#cb121-18" aria-hidden="true" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)</span>
<span id="cb121-19"><a href="multilevel-modeling.html#cb121-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb121-20"><a href="multilevel-modeling.html#cb121-20" aria-hidden="true" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">MemoryAgentNoise_f</span>(bias, beta, <span class="fu">mean</span>(randomChoice[<span class="dv">1</span><span class="sc">:</span>trial], <span class="at">na.rm =</span> T), noise)</span>
<span id="cb121-21"><a href="multilevel-modeling.html#cb121-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb121-22"><a href="multilevel-modeling.html#cb121-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb121-23"><a href="multilevel-modeling.html#cb121-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-24"><a href="multilevel-modeling.html#cb121-24" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(agent, <span class="at">trial =</span> <span class="fu">seq</span>(trials), randomChoice, <span class="at">randomRate =</span> rate, memoryChoice, memoryRate, noise, rateM, rateSD, bias, beta, biasM, biasSD, betaM, betaSD)</span>
<span id="cb121-25"><a href="multilevel-modeling.html#cb121-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-26"><a href="multilevel-modeling.html#cb121-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (agent <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb121-27"><a href="multilevel-modeling.html#cb121-27" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d, temp)</span>
<span id="cb121-28"><a href="multilevel-modeling.html#cb121-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb121-29"><a href="multilevel-modeling.html#cb121-29" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> temp</span>
<span id="cb121-30"><a href="multilevel-modeling.html#cb121-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb121-31"><a href="multilevel-modeling.html#cb121-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-32"><a href="multilevel-modeling.html#cb121-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb121-33"><a href="multilevel-modeling.html#cb121-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-34"><a href="multilevel-modeling.html#cb121-34" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(agent) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb121-35"><a href="multilevel-modeling.html#cb121-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomRate =</span> <span class="fu">cumsum</span>(randomChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(randomChoice),</span>
<span id="cb121-36"><a href="multilevel-modeling.html#cb121-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">memoryRate =</span> <span class="fu">cumsum</span>(memoryChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(memoryChoice)</span>
<span id="cb121-37"><a href="multilevel-modeling.html#cb121-37" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="plotting-the-agents" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Plotting the agents<a href="multilevel-modeling.html#plotting-the-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="multilevel-modeling.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot of the proportion of right hand choices for the random agents</span></span>
<span id="cb122-2"><a href="multilevel-modeling.html#cb122-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(d, <span class="fu">aes</span>(trial, randomRate, <span class="at">group =</span> agent, <span class="at">color =</span> agent)) <span class="sc">+</span> </span>
<span id="cb122-3"><a href="multilevel-modeling.html#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb122-4"><a href="multilevel-modeling.html#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb122-5"><a href="multilevel-modeling.html#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb122-6"><a href="multilevel-modeling.html#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() </span>
<span id="cb122-7"><a href="multilevel-modeling.html#cb122-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot of the proportion of right hand choices for the memory agents</span></span>
<span id="cb122-8"><a href="multilevel-modeling.html#cb122-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(d, <span class="fu">aes</span>(trial, memoryRate, <span class="at">group =</span> agent, <span class="at">color =</span> agent)) <span class="sc">+</span> </span>
<span id="cb122-9"><a href="multilevel-modeling.html#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb122-10"><a href="multilevel-modeling.html#cb122-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb122-11"><a href="multilevel-modeling.html#cb122-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb122-12"><a href="multilevel-modeling.html#cb122-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() </span>
<span id="cb122-13"><a href="multilevel-modeling.html#cb122-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="series_files/figure-html/Plotitng%20the%20agents-1.png" width="672" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="multilevel-modeling.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot of whether memory and random agents are matched in proportion at different stages</span></span>
<span id="cb123-2"><a href="multilevel-modeling.html#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="multilevel-modeling.html#cb123-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(trial <span class="sc">==</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(randomRate, memoryRate)) <span class="sc">+</span></span>
<span id="cb123-4"><a href="multilevel-modeling.html#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb123-5"><a href="multilevel-modeling.html#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb123-6"><a href="multilevel-modeling.html#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-7"><a href="multilevel-modeling.html#cb123-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb123-8"><a href="multilevel-modeling.html#cb123-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb123-9"><a href="multilevel-modeling.html#cb123-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;correlation at 10 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-10"><a href="multilevel-modeling.html#cb123-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb123-11"><a href="multilevel-modeling.html#cb123-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-12"><a href="multilevel-modeling.html#cb123-12" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(trial <span class="sc">==</span> <span class="dv">60</span>) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(randomRate, memoryRate)) <span class="sc">+</span></span>
<span id="cb123-13"><a href="multilevel-modeling.html#cb123-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb123-14"><a href="multilevel-modeling.html#cb123-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb123-15"><a href="multilevel-modeling.html#cb123-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-16"><a href="multilevel-modeling.html#cb123-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb123-17"><a href="multilevel-modeling.html#cb123-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb123-18"><a href="multilevel-modeling.html#cb123-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;correlation at 60 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-19"><a href="multilevel-modeling.html#cb123-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb123-20"><a href="multilevel-modeling.html#cb123-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-21"><a href="multilevel-modeling.html#cb123-21" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(trial <span class="sc">==</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(randomRate, memoryRate)) <span class="sc">+</span></span>
<span id="cb123-22"><a href="multilevel-modeling.html#cb123-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb123-23"><a href="multilevel-modeling.html#cb123-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb123-24"><a href="multilevel-modeling.html#cb123-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-25"><a href="multilevel-modeling.html#cb123-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb123-26"><a href="multilevel-modeling.html#cb123-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb123-27"><a href="multilevel-modeling.html#cb123-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;correlation at 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-28"><a href="multilevel-modeling.html#cb123-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb123-29"><a href="multilevel-modeling.html#cb123-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-30"><a href="multilevel-modeling.html#cb123-30" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;
## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (`geom_smooth()`).</code></pre>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (`geom_smooth()`).</code></pre>
<p><img src="series_files/figure-html/Plotitng%20the%20agents-2.png" width="672" /></p>
<p>Note that as the n of trials increases, the memory model matches the random model better and better</p>
</div>
<div id="coding-the-multilevel-agents" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Coding the multilevel agents<a href="multilevel-modeling.html#coding-the-multilevel-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="multilevel-random" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Multilevel random<a href="multilevel-modeling.html#multilevel-random" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Remember that the simulated parameters are:
* biasM &lt;- 0
* biasSD &lt;- 0.1
* betaM &lt;- 1.5
* betaSD &lt;- 0.3</p>
<p>Prep the data</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="multilevel-modeling.html#cb128-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb128-2"><a href="multilevel-modeling.html#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-3"><a href="multilevel-modeling.html#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb128-4"><a href="multilevel-modeling.html#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb128-5"><a href="multilevel-modeling.html#cb128-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-6"><a href="multilevel-modeling.html#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data</span></span>
<span id="cb128-7"><a href="multilevel-modeling.html#cb128-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb128-8"><a href="multilevel-modeling.html#cb128-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb128-9"><a href="multilevel-modeling.html#cb128-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb128-10"><a href="multilevel-modeling.html#cb128-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb128-11"><a href="multilevel-modeling.html#cb128-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="multilevel-modeling.html#cb129-1" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb129-2"><a href="multilevel-modeling.html#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb129-3"><a href="multilevel-modeling.html#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (right and left). Now multilevel</span></span>
<span id="cb129-4"><a href="multilevel-modeling.html#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb129-5"><a href="multilevel-modeling.html#cb129-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-6"><a href="multilevel-modeling.html#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb129-7"><a href="multilevel-modeling.html#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { // normal distribution with a lower bound</span></span>
<span id="cb129-8"><a href="multilevel-modeling.html#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb129-9"><a href="multilevel-modeling.html#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb129-10"><a href="multilevel-modeling.html#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb129-11"><a href="multilevel-modeling.html#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb129-12"><a href="multilevel-modeling.html#cb129-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb129-13"><a href="multilevel-modeling.html#cb129-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-14"><a href="multilevel-modeling.html#cb129-14" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of hands</span></span>
<span id="cb129-15"><a href="multilevel-modeling.html#cb129-15" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb129-16"><a href="multilevel-modeling.html#cb129-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb129-17"><a href="multilevel-modeling.html#cb129-17" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb129-18"><a href="multilevel-modeling.html#cb129-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb129-19"><a href="multilevel-modeling.html#cb129-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb129-20"><a href="multilevel-modeling.html#cb129-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-21"><a href="multilevel-modeling.html#cb129-21" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb129-22"><a href="multilevel-modeling.html#cb129-22" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb129-23"><a href="multilevel-modeling.html#cb129-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb129-24"><a href="multilevel-modeling.html#cb129-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;</span></span>
<span id="cb129-25"><a href="multilevel-modeling.html#cb129-25" aria-hidden="true" tabindex="-1"></a><span class="st">  array[agents] real theta;</span></span>
<span id="cb129-26"><a href="multilevel-modeling.html#cb129-26" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb129-27"><a href="multilevel-modeling.html#cb129-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-28"><a href="multilevel-modeling.html#cb129-28" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb129-29"><a href="multilevel-modeling.html#cb129-29" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb129-30"><a href="multilevel-modeling.html#cb129-30" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb129-31"><a href="multilevel-modeling.html#cb129-31" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3)  -</span></span>
<span id="cb129-32"><a href="multilevel-modeling.html#cb129-32" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb129-33"><a href="multilevel-modeling.html#cb129-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-34"><a href="multilevel-modeling.html#cb129-34" aria-hidden="true" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb129-35"><a href="multilevel-modeling.html#cb129-35" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb129-36"><a href="multilevel-modeling.html#cb129-36" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb129-37"><a href="multilevel-modeling.html#cb129-37" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb129-38"><a href="multilevel-modeling.html#cb129-38" aria-hidden="true" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb129-39"><a href="multilevel-modeling.html#cb129-39" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb129-40"><a href="multilevel-modeling.html#cb129-40" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb129-41"><a href="multilevel-modeling.html#cb129-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-42"><a href="multilevel-modeling.html#cb129-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-43"><a href="multilevel-modeling.html#cb129-43" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb129-44"><a href="multilevel-modeling.html#cb129-44" aria-hidden="true" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb129-45"><a href="multilevel-modeling.html#cb129-45" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb129-46"><a href="multilevel-modeling.html#cb129-46" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb129-47"><a href="multilevel-modeling.html#cb129-47" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb129-48"><a href="multilevel-modeling.html#cb129-48" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb129-49"><a href="multilevel-modeling.html#cb129-49" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb129-50"><a href="multilevel-modeling.html#cb129-50" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb129-51"><a href="multilevel-modeling.html#cb129-51" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb129-52"><a href="multilevel-modeling.html#cb129-52" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb129-53"><a href="multilevel-modeling.html#cb129-53" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb129-54"><a href="multilevel-modeling.html#cb129-54" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb129-55"><a href="multilevel-modeling.html#cb129-55" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb129-56"><a href="multilevel-modeling.html#cb129-56" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb129-57"><a href="multilevel-modeling.html#cb129-57" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb129-58"><a href="multilevel-modeling.html#cb129-58" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb129-59"><a href="multilevel-modeling.html#cb129-59" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb129-60"><a href="multilevel-modeling.html#cb129-60" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb129-61"><a href="multilevel-modeling.html#cb129-61" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb129-62"><a href="multilevel-modeling.html#cb129-62" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb129-63"><a href="multilevel-modeling.html#cb129-63" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb129-64"><a href="multilevel-modeling.html#cb129-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb129-65"><a href="multilevel-modeling.html#cb129-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelBias.stan&quot;</span>)</span>
<span id="cb129-66"><a href="multilevel-modeling.html#cb129-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-67"><a href="multilevel-modeling.html#cb129-67" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelBias.stan&quot;</span>)</span>
<span id="cb129-68"><a href="multilevel-modeling.html#cb129-68" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb129-69"><a href="multilevel-modeling.html#cb129-69" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb129-70"><a href="multilevel-modeling.html#cb129-70" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span>
<span id="cb129-71"><a href="multilevel-modeling.html#cb129-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-72"><a href="multilevel-modeling.html#cb129-72" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb129-73"><a href="multilevel-modeling.html#cb129-73" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb129-74"><a href="multilevel-modeling.html#cb129-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb129-75"><a href="multilevel-modeling.html#cb129-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb129-76"><a href="multilevel-modeling.html#cb129-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb129-77"><a href="multilevel-modeling.html#cb129-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb129-78"><a href="multilevel-modeling.html#cb129-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb129-79"><a href="multilevel-modeling.html#cb129-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb129-80"><a href="multilevel-modeling.html#cb129-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb129-81"><a href="multilevel-modeling.html#cb129-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb129-82"><a href="multilevel-modeling.html#cb129-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb129-83"><a href="multilevel-modeling.html#cb129-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb129-84"><a href="multilevel-modeling.html#cb129-84" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb129-85"><a href="multilevel-modeling.html#cb129-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-86"><a href="multilevel-modeling.html#cb129-86" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W5_MultilevelBias.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-multilevel-random-agents" class="section level3 hasAnchor" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Assessing multilevel random agents<a href="multilevel-modeling.html#assessing-multilevel-random-agents" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Besides the usual prior predictive checks, prior posterior update checks, posterior predictive checks, based on the population level estimates; we also want to plot at least a few of the single agents to assess how well the model is doing for them.</p>
<p>[MISSING: PLOT MODEL ESTIMATES AGAINST N OF HEADS BY PARTICIPANT]</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="multilevel-modeling.html#cb130-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W5_MultilevelBias.RDS&quot;</span>)</span>
<span id="cb130-2"><a href="multilevel-modeling.html#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="multilevel-modeling.html#cb130-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code></pre></div>
<pre><code>## File /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelBias-202303101235-1-84831d.csv not found
## File /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelBias-202303101235-2-84831d.csv not found
## No valid input files, exiting.</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="multilevel-modeling.html#cb132-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>() </span></code></pre></div>
<pre><code>## # A tibble: 109 × 10
##    variable      mean    median     sd    mad        q5       q95  rhat ess_bulk
##    &lt;chr&gt;        &lt;num&gt;     &lt;num&gt;  &lt;num&gt;  &lt;num&gt;     &lt;num&gt;     &lt;num&gt; &lt;num&gt;    &lt;num&gt;
##  1 lp__     -5780.    -5780.    7.26   7.35   -5792.    -5769.     1.00    1370.
##  2 thetaM       1.49      1.49  0.0664 0.0678     1.38      1.60   1.00    7644.
##  3 thetaSD      0.637     0.634 0.0523 0.0526     0.557     0.727  1.00    5220.
##  4 theta[1]     0.663     0.661 0.184  0.188      0.366     0.968  1.00    8209.
##  5 theta[2]     0.909     0.909 0.190  0.195      0.604     1.22   1.00   10277.
##  6 theta[3]     1.28      1.27  0.216  0.213      0.932     1.64   1.00    9117.
##  7 theta[4]     2.16      2.15  0.274  0.279      1.73      2.62   1.00    8381.
##  8 theta[5]     1.51      1.50  0.217  0.214      1.16      1.86   1.00    8492.
##  9 theta[6]     2.32      2.31  0.281  0.273      1.88      2.80   1.00    9372.
## 10 theta[7]     2.10      2.09  0.275  0.267      1.66      2.57   1.00    9292.
## # ℹ 99 more rows
## # ℹ 1 more variable: ess_tail &lt;num&gt;</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="multilevel-modeling.html#cb134-1" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>()) </span>
<span id="cb134-2"><a href="multilevel-modeling.html#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="multilevel-modeling.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, thetaM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb134-4"><a href="multilevel-modeling.html#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb134-5"><a href="multilevel-modeling.html#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-1.png" width="672" /></p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="multilevel-modeling.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, thetaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb135-2"><a href="multilevel-modeling.html#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb135-3"><a href="multilevel-modeling.html#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-2.png" width="672" /></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="multilevel-modeling.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb136-2"><a href="multilevel-modeling.html#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(prior_preds), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb136-3"><a href="multilevel-modeling.html#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb136-4"><a href="multilevel-modeling.html#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Prior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb136-5"><a href="multilevel-modeling.html#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-3.png" width="672" /></p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="multilevel-modeling.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb138-2"><a href="multilevel-modeling.html#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(thetaM), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb138-3"><a href="multilevel-modeling.html#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(thetaM_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb138-4"><a href="multilevel-modeling.html#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1.386</span>) <span class="sc">+</span></span>
<span id="cb138-5"><a href="multilevel-modeling.html#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb138-6"><a href="multilevel-modeling.html#cb138-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb138-7"><a href="multilevel-modeling.html#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-4.png" width="672" /></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="multilevel-modeling.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb139-2"><a href="multilevel-modeling.html#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(thetaSD), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb139-3"><a href="multilevel-modeling.html#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(thetaSD_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb139-4"><a href="multilevel-modeling.html#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.65</span>) <span class="sc">+</span></span>
<span id="cb139-5"><a href="multilevel-modeling.html#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variance of Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-6"><a href="multilevel-modeling.html#cb139-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-7"><a href="multilevel-modeling.html#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-5.png" width="672" /></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="multilevel-modeling.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb140-2"><a href="multilevel-modeling.html#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(theta_posterior), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb140-3"><a href="multilevel-modeling.html#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(theta_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb140-4"><a href="multilevel-modeling.html#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Overall Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb140-5"><a href="multilevel-modeling.html#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb140-6"><a href="multilevel-modeling.html#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-6.png" width="672" /></p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="multilevel-modeling.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb141-2"><a href="multilevel-modeling.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(prior_preds), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb141-3"><a href="multilevel-modeling.html#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(posterior_preds), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb141-4"><a href="multilevel-modeling.html#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb141-5"><a href="multilevel-modeling.html#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Predictive Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb141-6"><a href="multilevel-modeling.html#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-7.png" width="672" /></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="multilevel-modeling.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb143-2"><a href="multilevel-modeling.html#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[1]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-3"><a href="multilevel-modeling.html#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[15]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-4"><a href="multilevel-modeling.html#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[21]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-5"><a href="multilevel-modeling.html#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[31]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-6"><a href="multilevel-modeling.html#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[41]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-7"><a href="multilevel-modeling.html#cb143-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[51]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-8"><a href="multilevel-modeling.html#cb143-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[61]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-9"><a href="multilevel-modeling.html#cb143-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(thetaM_prior)), <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-10"><a href="multilevel-modeling.html#cb143-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(theta_prior), <span class="at">fill =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-11"><a href="multilevel-modeling.html#cb143-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb143-12"><a href="multilevel-modeling.html#cb143-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb143-13"><a href="multilevel-modeling.html#cb143-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20individual%20level%20features%20of%20multilevel%20random%20agents-1.png" width="672" /></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="multilevel-modeling.html#cb144-1" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> draws_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb144-2"><a href="multilevel-modeling.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds1 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[1]</span><span class="st">`</span>)),</span>
<span id="cb144-3"><a href="multilevel-modeling.html#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds11 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[11]</span><span class="st">`</span>)),</span>
<span id="cb144-4"><a href="multilevel-modeling.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds21 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[21]</span><span class="st">`</span>)),</span>
<span id="cb144-5"><a href="multilevel-modeling.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds31 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[31]</span><span class="st">`</span>)),</span>
<span id="cb144-6"><a href="multilevel-modeling.html#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds41 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[41]</span><span class="st">`</span>)),</span>
<span id="cb144-7"><a href="multilevel-modeling.html#cb144-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds51 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[51]</span><span class="st">`</span>)),</span>
<span id="cb144-8"><a href="multilevel-modeling.html#cb144-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds61 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[61]</span><span class="st">`</span>)),</span>
<span id="cb144-9"><a href="multilevel-modeling.html#cb144-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds71 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[71]</span><span class="st">`</span>)),</span>
<span id="cb144-10"><a href="multilevel-modeling.html#cb144-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds81 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[81]</span><span class="st">`</span>)),</span>
<span id="cb144-11"><a href="multilevel-modeling.html#cb144-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds91 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[91]</span><span class="st">`</span>)),</span>
<span id="cb144-12"><a href="multilevel-modeling.html#cb144-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb144-13"><a href="multilevel-modeling.html#cb144-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-14"><a href="multilevel-modeling.html#cb144-14" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(agent) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">right =</span> <span class="fu">sum</span>(randomChoice))</span>
<span id="cb144-15"><a href="multilevel-modeling.html#cb144-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-16"><a href="multilevel-modeling.html#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb144-17"><a href="multilevel-modeling.html#cb144-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(posterior_preds), <span class="at">color =</span> <span class="st">&quot;skyblue1&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb144-18"><a href="multilevel-modeling.html#cb144-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> d2, <span class="fu">aes</span>(right),  <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb144-19"><a href="multilevel-modeling.html#cb144-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb144-20"><a href="multilevel-modeling.html#cb144-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb144-21"><a href="multilevel-modeling.html#cb144-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20individual%20level%20features%20of%20multilevel%20random%20agents-2.png" width="672" /></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="multilevel-modeling.html#cb145-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb145-2"><a href="multilevel-modeling.html#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(preds1), <span class="at">color =</span> <span class="st">&quot;skyblue1&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb145-3"><a href="multilevel-modeling.html#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="fu">subset</span>(d2, agent <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">$</span>right, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb145-4"><a href="multilevel-modeling.html#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb145-5"><a href="multilevel-modeling.html#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="multilevel-modeling.html#cb145-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb145-7"><a href="multilevel-modeling.html#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(preds11), <span class="at">color =</span> <span class="st">&quot;skyblue1&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb145-8"><a href="multilevel-modeling.html#cb145-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="fu">subset</span>(d2, agent <span class="sc">==</span> <span class="dv">11</span>)<span class="sc">$</span>right, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb145-9"><a href="multilevel-modeling.html#cb145-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb145-10"><a href="multilevel-modeling.html#cb145-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb145-11"><a href="multilevel-modeling.html#cb145-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb145-12"><a href="multilevel-modeling.html#cb145-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(preds21), <span class="at">color =</span> <span class="st">&quot;skyblue1&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb145-13"><a href="multilevel-modeling.html#cb145-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="fu">subset</span>(d2, agent <span class="sc">==</span> <span class="dv">21</span>)<span class="sc">$</span>right, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb145-14"><a href="multilevel-modeling.html#cb145-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb145-15"><a href="multilevel-modeling.html#cb145-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-16"><a href="multilevel-modeling.html#cb145-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb145-17"><a href="multilevel-modeling.html#cb145-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20individual%20level%20features%20of%20multilevel%20random%20agents-3.png" width="672" /></p>
</div>
<div id="multilevel-memory" class="section level3 hasAnchor" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> Multilevel memory<a href="multilevel-modeling.html#multilevel-memory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>[MISSING: DAGS]
[MISSING: EXPLAIN NEW STAN CODE]
[MISSING: POP VS IND LEVEL PREDICTIONS]</p>
<p>Prep the data</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="multilevel-modeling.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data </span></span>
<span id="cb146-2"><a href="multilevel-modeling.html#cb146-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb146-3"><a href="multilevel-modeling.html#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb146-4"><a href="multilevel-modeling.html#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb146-5"><a href="multilevel-modeling.html#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb146-6"><a href="multilevel-modeling.html#cb146-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-7"><a href="multilevel-modeling.html#cb146-7" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb146-8"><a href="multilevel-modeling.html#cb146-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb146-9"><a href="multilevel-modeling.html#cb146-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb146-10"><a href="multilevel-modeling.html#cb146-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb146-11"><a href="multilevel-modeling.html#cb146-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-12"><a href="multilevel-modeling.html#cb146-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-13"><a href="multilevel-modeling.html#cb146-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb146-14"><a href="multilevel-modeling.html#cb146-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb146-15"><a href="multilevel-modeling.html#cb146-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb146-16"><a href="multilevel-modeling.html#cb146-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d1[<span class="dv">1</span><span class="sc">:</span><span class="dv">120</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb146-17"><a href="multilevel-modeling.html#cb146-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">120</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb146-18"><a href="multilevel-modeling.html#cb146-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Code, compile and fit the model</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="multilevel-modeling.html#cb147-1" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb147-2"><a href="multilevel-modeling.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb147-3"><a href="multilevel-modeling.html#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb147-4"><a href="multilevel-modeling.html#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb147-5"><a href="multilevel-modeling.html#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb147-6"><a href="multilevel-modeling.html#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb147-7"><a href="multilevel-modeling.html#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb147-8"><a href="multilevel-modeling.html#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb147-9"><a href="multilevel-modeling.html#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb147-10"><a href="multilevel-modeling.html#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb147-11"><a href="multilevel-modeling.html#cb147-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-12"><a href="multilevel-modeling.html#cb147-12" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb147-13"><a href="multilevel-modeling.html#cb147-13" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb147-14"><a href="multilevel-modeling.html#cb147-14" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb147-15"><a href="multilevel-modeling.html#cb147-15" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb147-16"><a href="multilevel-modeling.html#cb147-16" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb147-17"><a href="multilevel-modeling.html#cb147-17" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb147-18"><a href="multilevel-modeling.html#cb147-18" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb147-19"><a href="multilevel-modeling.html#cb147-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-20"><a href="multilevel-modeling.html#cb147-20" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb147-21"><a href="multilevel-modeling.html#cb147-21" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb147-22"><a href="multilevel-modeling.html#cb147-22" aria-hidden="true" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb147-23"><a href="multilevel-modeling.html#cb147-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; biasSD;</span></span>
<span id="cb147-24"><a href="multilevel-modeling.html#cb147-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb147-25"><a href="multilevel-modeling.html#cb147-25" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; betaSD;</span></span>
<span id="cb147-26"><a href="multilevel-modeling.html#cb147-26" aria-hidden="true" tabindex="-1"></a><span class="st">  array[agents] real bias;</span></span>
<span id="cb147-27"><a href="multilevel-modeling.html#cb147-27" aria-hidden="true" tabindex="-1"></a><span class="st">  array[agents] real beta;</span></span>
<span id="cb147-28"><a href="multilevel-modeling.html#cb147-28" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb147-29"><a href="multilevel-modeling.html#cb147-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-30"><a href="multilevel-modeling.html#cb147-30" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb147-31"><a href="multilevel-modeling.html#cb147-31" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb147-32"><a href="multilevel-modeling.html#cb147-32" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb147-33"><a href="multilevel-modeling.html#cb147-33" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb147-34"><a href="multilevel-modeling.html#cb147-34" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb147-35"><a href="multilevel-modeling.html#cb147-35" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb147-36"><a href="multilevel-modeling.html#cb147-36" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb147-37"><a href="multilevel-modeling.html#cb147-37" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb147-38"><a href="multilevel-modeling.html#cb147-38" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb147-39"><a href="multilevel-modeling.html#cb147-39" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb147-40"><a href="multilevel-modeling.html#cb147-40" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb147-41"><a href="multilevel-modeling.html#cb147-41" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb147-42"><a href="multilevel-modeling.html#cb147-42" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb147-43"><a href="multilevel-modeling.html#cb147-43" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb147-44"><a href="multilevel-modeling.html#cb147-44" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb147-45"><a href="multilevel-modeling.html#cb147-45" aria-hidden="true" tabindex="-1"></a><span class="st"> }</span></span>
<span id="cb147-46"><a href="multilevel-modeling.html#cb147-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-47"><a href="multilevel-modeling.html#cb147-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-48"><a href="multilevel-modeling.html#cb147-48" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb147-49"><a href="multilevel-modeling.html#cb147-49" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb147-50"><a href="multilevel-modeling.html#cb147-50" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb147-51"><a href="multilevel-modeling.html#cb147-51" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasSD | 0, .3)  -</span></span>
<span id="cb147-52"><a href="multilevel-modeling.html#cb147-52" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb147-53"><a href="multilevel-modeling.html#cb147-53" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb147-54"><a href="multilevel-modeling.html#cb147-54" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaSD | 0, .3)  -</span></span>
<span id="cb147-55"><a href="multilevel-modeling.html#cb147-55" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb147-56"><a href="multilevel-modeling.html#cb147-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-57"><a href="multilevel-modeling.html#cb147-57" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | biasM, biasSD); </span></span>
<span id="cb147-58"><a href="multilevel-modeling.html#cb147-58" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(beta | betaM, betaSD); </span></span>
<span id="cb147-59"><a href="multilevel-modeling.html#cb147-59" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb147-60"><a href="multilevel-modeling.html#cb147-60" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents)</span></span>
<span id="cb147-61"><a href="multilevel-modeling.html#cb147-61" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb147-62"><a href="multilevel-modeling.html#cb147-62" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial,agent] | </span></span>
<span id="cb147-63"><a href="multilevel-modeling.html#cb147-63" aria-hidden="true" tabindex="-1"></a><span class="st">            bias[agent] +  logit(memory[trial, agent]) * (beta[agent]));</span></span>
<span id="cb147-64"><a href="multilevel-modeling.html#cb147-64" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb147-65"><a href="multilevel-modeling.html#cb147-65" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb147-66"><a href="multilevel-modeling.html#cb147-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-67"><a href="multilevel-modeling.html#cb147-67" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb147-68"><a href="multilevel-modeling.html#cb147-68" aria-hidden="true" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb147-69"><a href="multilevel-modeling.html#cb147-69" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb147-70"><a href="multilevel-modeling.html#cb147-70" aria-hidden="true" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb147-71"><a href="multilevel-modeling.html#cb147-71" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb147-72"><a href="multilevel-modeling.html#cb147-72" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb147-73"><a href="multilevel-modeling.html#cb147-73" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb147-74"><a href="multilevel-modeling.html#cb147-74" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb147-75"><a href="multilevel-modeling.html#cb147-75" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb147-76"><a href="multilevel-modeling.html#cb147-76" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb147-77"><a href="multilevel-modeling.html#cb147-77" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb147-78"><a href="multilevel-modeling.html#cb147-78" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb147-79"><a href="multilevel-modeling.html#cb147-79" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb147-80"><a href="multilevel-modeling.html#cb147-80" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb147-81"><a href="multilevel-modeling.html#cb147-81" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb147-82"><a href="multilevel-modeling.html#cb147-82" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_predsID0;</span></span>
<span id="cb147-83"><a href="multilevel-modeling.html#cb147-83" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_predsID1;</span></span>
<span id="cb147-84"><a href="multilevel-modeling.html#cb147-84" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_predsID2;</span></span>
<span id="cb147-85"><a href="multilevel-modeling.html#cb147-85" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb147-86"><a href="multilevel-modeling.html#cb147-86" aria-hidden="true" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb147-87"><a href="multilevel-modeling.html#cb147-87" aria-hidden="true" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb147-88"><a href="multilevel-modeling.html#cb147-88" aria-hidden="true" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb147-89"><a href="multilevel-modeling.html#cb147-89" aria-hidden="true" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb147-90"><a href="multilevel-modeling.html#cb147-90" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb147-91"><a href="multilevel-modeling.html#cb147-91" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb147-92"><a href="multilevel-modeling.html#cb147-92" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb147-93"><a href="multilevel-modeling.html#cb147-93" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb147-94"><a href="multilevel-modeling.html#cb147-94" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds0 = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb147-95"><a href="multilevel-modeling.html#cb147-95" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds1 = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb147-96"><a href="multilevel-modeling.html#cb147-96" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds2 = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb147-97"><a href="multilevel-modeling.html#cb147-97" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds0 = binomial_rng(trials, inv_logit(biasM + 0 * betaM));</span></span>
<span id="cb147-98"><a href="multilevel-modeling.html#cb147-98" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds1 = binomial_rng(trials, inv_logit(biasM + 1 * betaM));</span></span>
<span id="cb147-99"><a href="multilevel-modeling.html#cb147-99" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds2 = binomial_rng(trials, inv_logit(biasM + 2 * betaM));</span></span>
<span id="cb147-100"><a href="multilevel-modeling.html#cb147-100" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb147-101"><a href="multilevel-modeling.html#cb147-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-102"><a href="multilevel-modeling.html#cb147-102" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb147-103"><a href="multilevel-modeling.html#cb147-103" aria-hidden="true" tabindex="-1"></a><span class="st">    posterior_predsID0[agent] = binomial_rng(trials, inv_logit(bias[agent] +  0 * beta[agent]));</span></span>
<span id="cb147-104"><a href="multilevel-modeling.html#cb147-104" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_predsID1[agent] = binomial_rng(trials, inv_logit(bias[agent] +  1 * beta[agent]));</span></span>
<span id="cb147-105"><a href="multilevel-modeling.html#cb147-105" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_predsID2[agent] = binomial_rng(trials, inv_logit(bias[agent] +  2 * beta[agent]));</span></span>
<span id="cb147-106"><a href="multilevel-modeling.html#cb147-106" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb147-107"><a href="multilevel-modeling.html#cb147-107" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb147-108"><a href="multilevel-modeling.html#cb147-108" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb147-109"><a href="multilevel-modeling.html#cb147-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-110"><a href="multilevel-modeling.html#cb147-110" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb147-111"><a href="multilevel-modeling.html#cb147-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-112"><a href="multilevel-modeling.html#cb147-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-113"><a href="multilevel-modeling.html#cb147-113" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb147-114"><a href="multilevel-modeling.html#cb147-114" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb147-115"><a href="multilevel-modeling.html#cb147-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb147-116"><a href="multilevel-modeling.html#cb147-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelMemory.stan&quot;</span>)</span>
<span id="cb147-117"><a href="multilevel-modeling.html#cb147-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-118"><a href="multilevel-modeling.html#cb147-118" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelMemory.stan&quot;</span>)</span>
<span id="cb147-119"><a href="multilevel-modeling.html#cb147-119" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb147-120"><a href="multilevel-modeling.html#cb147-120" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb147-121"><a href="multilevel-modeling.html#cb147-121" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span>
<span id="cb147-122"><a href="multilevel-modeling.html#cb147-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-123"><a href="multilevel-modeling.html#cb147-123" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb147-124"><a href="multilevel-modeling.html#cb147-124" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb147-125"><a href="multilevel-modeling.html#cb147-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb147-126"><a href="multilevel-modeling.html#cb147-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb147-127"><a href="multilevel-modeling.html#cb147-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb147-128"><a href="multilevel-modeling.html#cb147-128" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb147-129"><a href="multilevel-modeling.html#cb147-129" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb147-130"><a href="multilevel-modeling.html#cb147-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb147-131"><a href="multilevel-modeling.html#cb147-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb147-132"><a href="multilevel-modeling.html#cb147-132" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb147-133"><a href="multilevel-modeling.html#cb147-133" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb147-134"><a href="multilevel-modeling.html#cb147-134" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb147-135"><a href="multilevel-modeling.html#cb147-135" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb147-136"><a href="multilevel-modeling.html#cb147-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-137"><a href="multilevel-modeling.html#cb147-137" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W5_MultilevelMemory_centered.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-multilevel-memory" class="section level3 hasAnchor" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> Assessing multilevel memory<a href="multilevel-modeling.html#assessing-multilevel-memory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="multilevel-modeling.html#cb148-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W5_MultilevelMemory_centered.RDS&quot;</span>)</span>
<span id="cb148-2"><a href="multilevel-modeling.html#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="multilevel-modeling.html#cb148-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code></pre></div>
<pre><code>## File /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory-202303101235-1-8e8f81.csv not found
## File /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory-202303101235-2-8e8f81.csv not found
## No valid input files, exiting.</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="multilevel-modeling.html#cb150-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;biasM&quot;</span>, <span class="st">&quot;betaM&quot;</span>, <span class="st">&quot;biasSD&quot;</span>, <span class="st">&quot;betaSD&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4 × 10
##   variable  mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;    &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
## 1 biasM    0.539  0.537 0.0872 0.0859 0.400 0.686  1.00     324.     718.
## 2 betaM    1.02   1.02  0.0700 0.0694 0.906 1.14   1.00     460.    1066.
## 3 biasSD   0.283  0.282 0.0672 0.0689 0.176 0.394  1.01     269.     277.
## 4 betaSD   0.410  0.407 0.0493 0.0499 0.332 0.494  1.00    1438.    2248.</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="multilevel-modeling.html#cb152-1" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>()) </span>
<span id="cb152-2"><a href="multilevel-modeling.html#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="multilevel-modeling.html#cb152-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, biasM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb152-4"><a href="multilevel-modeling.html#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb152-5"><a href="multilevel-modeling.html#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb152-6"><a href="multilevel-modeling.html#cb152-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-7"><a href="multilevel-modeling.html#cb152-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, biasSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb152-8"><a href="multilevel-modeling.html#cb152-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb152-9"><a href="multilevel-modeling.html#cb152-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb152-10"><a href="multilevel-modeling.html#cb152-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-11"><a href="multilevel-modeling.html#cb152-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, betaM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb152-12"><a href="multilevel-modeling.html#cb152-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb152-13"><a href="multilevel-modeling.html#cb152-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb152-14"><a href="multilevel-modeling.html#cb152-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-15"><a href="multilevel-modeling.html#cb152-15" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb152-16"><a href="multilevel-modeling.html#cb152-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb152-17"><a href="multilevel-modeling.html#cb152-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb152-18"><a href="multilevel-modeling.html#cb152-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-19"><a href="multilevel-modeling.html#cb152-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20centered:%20markov%20chains-1.png" width="672" /></p>
<div id="predictive-prior-checks" class="section level4 hasAnchor" number="6.5.4.1">
<h4><span class="header-section-number">6.5.4.1</span> Predictive prior checks<a href="multilevel-modeling.html#predictive-prior-checks" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="multilevel-modeling.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb153-2"><a href="multilevel-modeling.html#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb153-3"><a href="multilevel-modeling.html#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds0</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb153-4"><a href="multilevel-modeling.html#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds1</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb153-5"><a href="multilevel-modeling.html#cb153-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds2</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb153-6"><a href="multilevel-modeling.html#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb153-7"><a href="multilevel-modeling.html#cb153-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb153-8"><a href="multilevel-modeling.html#cb153-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20centered:%20prior%20checks-1.png" width="672" /></p>
</div>
<div id="prior-posterior-update-checks" class="section level4 hasAnchor" number="6.5.4.2">
<h4><span class="header-section-number">6.5.4.2</span> Prior posterior update checks<a href="multilevel-modeling.html#prior-posterior-update-checks" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>biasM &lt;- 0
biasSD &lt;- 0.1
betaM &lt;- 1.5
betaSD &lt;- 0.3</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="multilevel-modeling.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb155-2"><a href="multilevel-modeling.html#cb155-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb155-3"><a href="multilevel-modeling.html#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasM), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb155-4"><a href="multilevel-modeling.html#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasM_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb155-5"><a href="multilevel-modeling.html#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb155-6"><a href="multilevel-modeling.html#cb155-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean bias&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-7"><a href="multilevel-modeling.html#cb155-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-8"><a href="multilevel-modeling.html#cb155-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb155-9"><a href="multilevel-modeling.html#cb155-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-10"><a href="multilevel-modeling.html#cb155-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb155-11"><a href="multilevel-modeling.html#cb155-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasSD), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb155-12"><a href="multilevel-modeling.html#cb155-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasSD_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb155-13"><a href="multilevel-modeling.html#cb155-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb155-14"><a href="multilevel-modeling.html#cb155-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variance of bias&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-15"><a href="multilevel-modeling.html#cb155-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-16"><a href="multilevel-modeling.html#cb155-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb155-17"><a href="multilevel-modeling.html#cb155-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-18"><a href="multilevel-modeling.html#cb155-18" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb155-19"><a href="multilevel-modeling.html#cb155-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaM), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb155-20"><a href="multilevel-modeling.html#cb155-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaM_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb155-21"><a href="multilevel-modeling.html#cb155-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb155-22"><a href="multilevel-modeling.html#cb155-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean Beta&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-23"><a href="multilevel-modeling.html#cb155-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-24"><a href="multilevel-modeling.html#cb155-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb155-25"><a href="multilevel-modeling.html#cb155-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-26"><a href="multilevel-modeling.html#cb155-26" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb155-27"><a href="multilevel-modeling.html#cb155-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaSD), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb155-28"><a href="multilevel-modeling.html#cb155-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaSD_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb155-29"><a href="multilevel-modeling.html#cb155-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb155-30"><a href="multilevel-modeling.html#cb155-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variance of beta&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-31"><a href="multilevel-modeling.html#cb155-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-32"><a href="multilevel-modeling.html#cb155-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb155-33"><a href="multilevel-modeling.html#cb155-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-34"><a href="multilevel-modeling.html#cb155-34" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 </span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20centered:%20prior%20posterior%20update%20checks-1.png" width="672" /></p>
</div>
<div id="posterior-predictive-checks" class="section level4 hasAnchor" number="6.5.4.3">
<h4><span class="header-section-number">6.5.4.3</span> Posterior predictive checks<a href="multilevel-modeling.html#posterior-predictive-checks" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="multilevel-modeling.html#cb156-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb156-2"><a href="multilevel-modeling.html#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds0</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb156-3"><a href="multilevel-modeling.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds0</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb156-4"><a href="multilevel-modeling.html#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-5"><a href="multilevel-modeling.html#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-6"><a href="multilevel-modeling.html#cb156-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb156-7"><a href="multilevel-modeling.html#cb156-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-8"><a href="multilevel-modeling.html#cb156-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb156-9"><a href="multilevel-modeling.html#cb156-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds1</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb156-10"><a href="multilevel-modeling.html#cb156-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds1</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb156-11"><a href="multilevel-modeling.html#cb156-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-12"><a href="multilevel-modeling.html#cb156-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-13"><a href="multilevel-modeling.html#cb156-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb156-14"><a href="multilevel-modeling.html#cb156-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-15"><a href="multilevel-modeling.html#cb156-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb156-16"><a href="multilevel-modeling.html#cb156-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds2</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb156-17"><a href="multilevel-modeling.html#cb156-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds2</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb156-18"><a href="multilevel-modeling.html#cb156-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-19"><a href="multilevel-modeling.html#cb156-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-20"><a href="multilevel-modeling.html#cb156-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb156-21"><a href="multilevel-modeling.html#cb156-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-22"><a href="multilevel-modeling.html#cb156-22" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20centered:%20posterior%20predictive%20checks-1.png" width="672" /></p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="multilevel-modeling.html#cb158-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasM, biasSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb158-2"><a href="multilevel-modeling.html#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb158-3"><a href="multilevel-modeling.html#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb158-4"><a href="multilevel-modeling.html#cb158-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(betaM, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb158-5"><a href="multilevel-modeling.html#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb158-6"><a href="multilevel-modeling.html#cb158-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb158-7"><a href="multilevel-modeling.html#cb158-7" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasM, betaM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb158-8"><a href="multilevel-modeling.html#cb158-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb158-9"><a href="multilevel-modeling.html#cb158-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb158-10"><a href="multilevel-modeling.html#cb158-10" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasSD, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb158-11"><a href="multilevel-modeling.html#cb158-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb158-12"><a href="multilevel-modeling.html#cb158-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb158-13"><a href="multilevel-modeling.html#cb158-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-14"><a href="multilevel-modeling.html#cb158-14" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20centered:%20posterior%20predictive%20checks-2.png" width="672" /></p>
</div>
</div>
<div id="multilevel-memory-with-non-centered-parameterization" class="section level3 hasAnchor" number="6.5.5">
<h3><span class="header-section-number">6.5.5</span> Multilevel memory with non centered parameterization<a href="multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Prep the data</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="multilevel-modeling.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data </span></span>
<span id="cb159-2"><a href="multilevel-modeling.html#cb159-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb159-3"><a href="multilevel-modeling.html#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb159-4"><a href="multilevel-modeling.html#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb159-5"><a href="multilevel-modeling.html#cb159-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb159-6"><a href="multilevel-modeling.html#cb159-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-7"><a href="multilevel-modeling.html#cb159-7" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb159-8"><a href="multilevel-modeling.html#cb159-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb159-9"><a href="multilevel-modeling.html#cb159-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb159-10"><a href="multilevel-modeling.html#cb159-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb159-11"><a href="multilevel-modeling.html#cb159-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-12"><a href="multilevel-modeling.html#cb159-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-13"><a href="multilevel-modeling.html#cb159-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb159-14"><a href="multilevel-modeling.html#cb159-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb159-15"><a href="multilevel-modeling.html#cb159-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb159-16"><a href="multilevel-modeling.html#cb159-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d1[<span class="dv">1</span><span class="sc">:</span><span class="dv">120</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb159-17"><a href="multilevel-modeling.html#cb159-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">120</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb159-18"><a href="multilevel-modeling.html#cb159-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Code, compile and and fit the model</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="multilevel-modeling.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="do">## NON-CENTERED PARAMETRIZATION</span></span>
<span id="cb160-2"><a href="multilevel-modeling.html#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="multilevel-modeling.html#cb160-3" aria-hidden="true" tabindex="-1"></a>stan_model_nc <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb160-4"><a href="multilevel-modeling.html#cb160-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-5"><a href="multilevel-modeling.html#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb160-6"><a href="multilevel-modeling.html#cb160-6" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model is a multilevel memory agent</span></span>
<span id="cb160-7"><a href="multilevel-modeling.html#cb160-7" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb160-8"><a href="multilevel-modeling.html#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb160-9"><a href="multilevel-modeling.html#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb160-10"><a href="multilevel-modeling.html#cb160-10" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb160-11"><a href="multilevel-modeling.html#cb160-11" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb160-12"><a href="multilevel-modeling.html#cb160-12" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb160-13"><a href="multilevel-modeling.html#cb160-13" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb160-14"><a href="multilevel-modeling.html#cb160-14" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb160-15"><a href="multilevel-modeling.html#cb160-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-16"><a href="multilevel-modeling.html#cb160-16" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb160-17"><a href="multilevel-modeling.html#cb160-17" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb160-18"><a href="multilevel-modeling.html#cb160-18" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb160-19"><a href="multilevel-modeling.html#cb160-19" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb160-20"><a href="multilevel-modeling.html#cb160-20" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb160-21"><a href="multilevel-modeling.html#cb160-21" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb160-22"><a href="multilevel-modeling.html#cb160-22" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb160-23"><a href="multilevel-modeling.html#cb160-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-24"><a href="multilevel-modeling.html#cb160-24" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb160-25"><a href="multilevel-modeling.html#cb160-25" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb160-26"><a href="multilevel-modeling.html#cb160-26" aria-hidden="true" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb160-27"><a href="multilevel-modeling.html#cb160-27" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; biasSD;</span></span>
<span id="cb160-28"><a href="multilevel-modeling.html#cb160-28" aria-hidden="true" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb160-29"><a href="multilevel-modeling.html#cb160-29" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; betaSD;</span></span>
<span id="cb160-30"><a href="multilevel-modeling.html#cb160-30" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[agents] biasID_z;</span></span>
<span id="cb160-31"><a href="multilevel-modeling.html#cb160-31" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[agents] betaID_z;</span></span>
<span id="cb160-32"><a href="multilevel-modeling.html#cb160-32" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb160-33"><a href="multilevel-modeling.html#cb160-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-34"><a href="multilevel-modeling.html#cb160-34" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb160-35"><a href="multilevel-modeling.html#cb160-35" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb160-36"><a href="multilevel-modeling.html#cb160-36" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[agents] biasID;</span></span>
<span id="cb160-37"><a href="multilevel-modeling.html#cb160-37" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[agents] betaID;</span></span>
<span id="cb160-38"><a href="multilevel-modeling.html#cb160-38" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb160-39"><a href="multilevel-modeling.html#cb160-39" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb160-40"><a href="multilevel-modeling.html#cb160-40" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb160-41"><a href="multilevel-modeling.html#cb160-41" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb160-42"><a href="multilevel-modeling.html#cb160-42" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb160-43"><a href="multilevel-modeling.html#cb160-43" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb160-44"><a href="multilevel-modeling.html#cb160-44" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb160-45"><a href="multilevel-modeling.html#cb160-45" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb160-46"><a href="multilevel-modeling.html#cb160-46" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb160-47"><a href="multilevel-modeling.html#cb160-47" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb160-48"><a href="multilevel-modeling.html#cb160-48" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb160-49"><a href="multilevel-modeling.html#cb160-49" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb160-50"><a href="multilevel-modeling.html#cb160-50" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb160-51"><a href="multilevel-modeling.html#cb160-51" aria-hidden="true" tabindex="-1"></a><span class="st">  biasID = biasID_z * biasSD;</span></span>
<span id="cb160-52"><a href="multilevel-modeling.html#cb160-52" aria-hidden="true" tabindex="-1"></a><span class="st">  betaID = betaID_z * betaSD;</span></span>
<span id="cb160-53"><a href="multilevel-modeling.html#cb160-53" aria-hidden="true" tabindex="-1"></a><span class="st"> }</span></span>
<span id="cb160-54"><a href="multilevel-modeling.html#cb160-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-55"><a href="multilevel-modeling.html#cb160-55" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb160-56"><a href="multilevel-modeling.html#cb160-56" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb160-57"><a href="multilevel-modeling.html#cb160-57" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb160-58"><a href="multilevel-modeling.html#cb160-58" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasSD | 0, .3)  -</span></span>
<span id="cb160-59"><a href="multilevel-modeling.html#cb160-59" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb160-60"><a href="multilevel-modeling.html#cb160-60" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb160-61"><a href="multilevel-modeling.html#cb160-61" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaSD | 0, .3)  -</span></span>
<span id="cb160-62"><a href="multilevel-modeling.html#cb160-62" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb160-63"><a href="multilevel-modeling.html#cb160-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-64"><a href="multilevel-modeling.html#cb160-64" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(biasID_z)); // target += normal_lpdf(to_vector(biasID_z) | 0, 1);</span></span>
<span id="cb160-65"><a href="multilevel-modeling.html#cb160-65" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(betaID_z)); // target += normal_lpdf(to_vector(betaID_z) | 0, 1);</span></span>
<span id="cb160-66"><a href="multilevel-modeling.html#cb160-66" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb160-67"><a href="multilevel-modeling.html#cb160-67" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb160-68"><a href="multilevel-modeling.html#cb160-68" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb160-69"><a href="multilevel-modeling.html#cb160-69" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial,agent] | </span></span>
<span id="cb160-70"><a href="multilevel-modeling.html#cb160-70" aria-hidden="true" tabindex="-1"></a><span class="st">            biasM + biasID[agent] +  logit(memory[trial, agent]) * (betaM + betaID[agent]));</span></span>
<span id="cb160-71"><a href="multilevel-modeling.html#cb160-71" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb160-72"><a href="multilevel-modeling.html#cb160-72" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb160-73"><a href="multilevel-modeling.html#cb160-73" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb160-74"><a href="multilevel-modeling.html#cb160-74" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb160-75"><a href="multilevel-modeling.html#cb160-75" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb160-76"><a href="multilevel-modeling.html#cb160-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-77"><a href="multilevel-modeling.html#cb160-77" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb160-78"><a href="multilevel-modeling.html#cb160-78" aria-hidden="true" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb160-79"><a href="multilevel-modeling.html#cb160-79" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb160-80"><a href="multilevel-modeling.html#cb160-80" aria-hidden="true" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb160-81"><a href="multilevel-modeling.html#cb160-81" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb160-82"><a href="multilevel-modeling.html#cb160-82" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb160-83"><a href="multilevel-modeling.html#cb160-83" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb160-84"><a href="multilevel-modeling.html#cb160-84" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb160-85"><a href="multilevel-modeling.html#cb160-85" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb160-86"><a href="multilevel-modeling.html#cb160-86" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb160-87"><a href="multilevel-modeling.html#cb160-87" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb160-88"><a href="multilevel-modeling.html#cb160-88" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb160-89"><a href="multilevel-modeling.html#cb160-89" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb160-90"><a href="multilevel-modeling.html#cb160-90" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb160-91"><a href="multilevel-modeling.html#cb160-91" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb160-92"><a href="multilevel-modeling.html#cb160-92" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb160-93"><a href="multilevel-modeling.html#cb160-93" aria-hidden="true" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb160-94"><a href="multilevel-modeling.html#cb160-94" aria-hidden="true" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb160-95"><a href="multilevel-modeling.html#cb160-95" aria-hidden="true" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb160-96"><a href="multilevel-modeling.html#cb160-96" aria-hidden="true" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb160-97"><a href="multilevel-modeling.html#cb160-97" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb160-98"><a href="multilevel-modeling.html#cb160-98" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb160-99"><a href="multilevel-modeling.html#cb160-99" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb160-100"><a href="multilevel-modeling.html#cb160-100" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb160-101"><a href="multilevel-modeling.html#cb160-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-102"><a href="multilevel-modeling.html#cb160-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-103"><a href="multilevel-modeling.html#cb160-103" aria-hidden="true" tabindex="-1"></a><span class="st">for (agent in 1:agents){</span></span>
<span id="cb160-104"><a href="multilevel-modeling.html#cb160-104" aria-hidden="true" tabindex="-1"></a><span class="st">    prior_preds0[agent] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb160-105"><a href="multilevel-modeling.html#cb160-105" aria-hidden="true" tabindex="-1"></a><span class="st">    prior_preds1[agent] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb160-106"><a href="multilevel-modeling.html#cb160-106" aria-hidden="true" tabindex="-1"></a><span class="st">    prior_preds2[agent] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb160-107"><a href="multilevel-modeling.html#cb160-107" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds0[agent] = binomial_rng(trials, inv_logit(biasM + biasID[agent] +  0 * (betaM + betaID[agent])));</span></span>
<span id="cb160-108"><a href="multilevel-modeling.html#cb160-108" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds1[agent] = binomial_rng(trials, inv_logit(biasM + biasID[agent] +  1 * (betaM + betaID[agent])));</span></span>
<span id="cb160-109"><a href="multilevel-modeling.html#cb160-109" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds2[agent] = binomial_rng(trials, inv_logit(biasM + biasID[agent] +  2 * (betaM + betaID[agent])));</span></span>
<span id="cb160-110"><a href="multilevel-modeling.html#cb160-110" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb160-111"><a href="multilevel-modeling.html#cb160-111" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb160-112"><a href="multilevel-modeling.html#cb160-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-113"><a href="multilevel-modeling.html#cb160-113" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb160-114"><a href="multilevel-modeling.html#cb160-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-115"><a href="multilevel-modeling.html#cb160-115" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb160-116"><a href="multilevel-modeling.html#cb160-116" aria-hidden="true" tabindex="-1"></a>  stan_model_nc,</span>
<span id="cb160-117"><a href="multilevel-modeling.html#cb160-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb160-118"><a href="multilevel-modeling.html#cb160-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelMemory_nc.stan&quot;</span>)</span>
<span id="cb160-119"><a href="multilevel-modeling.html#cb160-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-120"><a href="multilevel-modeling.html#cb160-120" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelMemory_nc.stan&quot;</span>)</span>
<span id="cb160-121"><a href="multilevel-modeling.html#cb160-121" aria-hidden="true" tabindex="-1"></a>mod_nc <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb160-122"><a href="multilevel-modeling.html#cb160-122" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb160-123"><a href="multilevel-modeling.html#cb160-123" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span>
<span id="cb160-124"><a href="multilevel-modeling.html#cb160-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-125"><a href="multilevel-modeling.html#cb160-125" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb160-126"><a href="multilevel-modeling.html#cb160-126" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod_nc<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb160-127"><a href="multilevel-modeling.html#cb160-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb160-128"><a href="multilevel-modeling.html#cb160-128" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb160-129"><a href="multilevel-modeling.html#cb160-129" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb160-130"><a href="multilevel-modeling.html#cb160-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb160-131"><a href="multilevel-modeling.html#cb160-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb160-132"><a href="multilevel-modeling.html#cb160-132" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb160-133"><a href="multilevel-modeling.html#cb160-133" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb160-134"><a href="multilevel-modeling.html#cb160-134" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb160-135"><a href="multilevel-modeling.html#cb160-135" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb160-136"><a href="multilevel-modeling.html#cb160-136" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb160-137"><a href="multilevel-modeling.html#cb160-137" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb160-138"><a href="multilevel-modeling.html#cb160-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-139"><a href="multilevel-modeling.html#cb160-139" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W5_MultilevelMemory_noncentered.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-multilevel-memory-1" class="section level3 hasAnchor" number="6.5.6">
<h3><span class="header-section-number">6.5.6</span> Assessing multilevel memory<a href="multilevel-modeling.html#assessing-multilevel-memory-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="multilevel-modeling.html#cb161-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W5_MultilevelMemory_noncentered.RDS&quot;</span>)</span>
<span id="cb161-2"><a href="multilevel-modeling.html#cb161-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-3"><a href="multilevel-modeling.html#cb161-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code></pre></div>
<pre><code>## File /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory_nc-202303101250-1-612dbb.csv not found
## File /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory_nc-202303101250-2-612dbb.csv not found
## No valid input files, exiting.</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="multilevel-modeling.html#cb163-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;biasM&quot;</span>, <span class="st">&quot;betaM&quot;</span>, <span class="st">&quot;biasSD&quot;</span>, <span class="st">&quot;betaSD&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4 × 10
##   variable  mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;    &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
## 1 biasM    0.538  0.537 0.0870 0.0875 0.397 0.683  1.00    1315.    2025.
## 2 betaM    1.02   1.02  0.0726 0.0732 0.901 1.14   1.00    1187.    2168.
## 3 biasSD   0.281  0.281 0.0702 0.0698 0.168 0.401  1.00     630.     956.
## 4 betaSD   0.411  0.409 0.0497 0.0493 0.333 0.499  1.00    1394.    2137.</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="multilevel-modeling.html#cb165-1" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>()) </span>
<span id="cb165-2"><a href="multilevel-modeling.html#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="multilevel-modeling.html#cb165-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, biasM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb165-4"><a href="multilevel-modeling.html#cb165-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb165-5"><a href="multilevel-modeling.html#cb165-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb165-6"><a href="multilevel-modeling.html#cb165-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-7"><a href="multilevel-modeling.html#cb165-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, biasSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb165-8"><a href="multilevel-modeling.html#cb165-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb165-9"><a href="multilevel-modeling.html#cb165-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb165-10"><a href="multilevel-modeling.html#cb165-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-11"><a href="multilevel-modeling.html#cb165-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, betaM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb165-12"><a href="multilevel-modeling.html#cb165-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb165-13"><a href="multilevel-modeling.html#cb165-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb165-14"><a href="multilevel-modeling.html#cb165-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-15"><a href="multilevel-modeling.html#cb165-15" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb165-16"><a href="multilevel-modeling.html#cb165-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb165-17"><a href="multilevel-modeling.html#cb165-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb165-18"><a href="multilevel-modeling.html#cb165-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-19"><a href="multilevel-modeling.html#cb165-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20markov%20chains-1.png" width="672" /></p>
<div id="predictive-prior-checks-1" class="section level4 hasAnchor" number="6.5.6.1">
<h4><span class="header-section-number">6.5.6.1</span> Predictive prior checks<a href="multilevel-modeling.html#predictive-prior-checks-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="multilevel-modeling.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb166-2"><a href="multilevel-modeling.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb166-3"><a href="multilevel-modeling.html#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds0[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb166-4"><a href="multilevel-modeling.html#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds1[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb166-5"><a href="multilevel-modeling.html#cb166-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds2[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb166-6"><a href="multilevel-modeling.html#cb166-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb166-7"><a href="multilevel-modeling.html#cb166-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb166-8"><a href="multilevel-modeling.html#cb166-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20prior%20checks-1.png" width="672" /></p>
</div>
<div id="prior-posterior-update-checks-1" class="section level4 hasAnchor" number="6.5.6.2">
<h4><span class="header-section-number">6.5.6.2</span> Prior posterior update checks<a href="multilevel-modeling.html#prior-posterior-update-checks-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>biasM &lt;- 0
biasSD &lt;- 0.1
betaM &lt;- 1.5
betaSD &lt;- 0.3</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="multilevel-modeling.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb168-2"><a href="multilevel-modeling.html#cb168-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb168-3"><a href="multilevel-modeling.html#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">logit_scaled</span>(biasM)), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb168-4"><a href="multilevel-modeling.html#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasM_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb168-5"><a href="multilevel-modeling.html#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb168-6"><a href="multilevel-modeling.html#cb168-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean bias&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-7"><a href="multilevel-modeling.html#cb168-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-8"><a href="multilevel-modeling.html#cb168-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb168-9"><a href="multilevel-modeling.html#cb168-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-10"><a href="multilevel-modeling.html#cb168-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb168-11"><a href="multilevel-modeling.html#cb168-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasSD), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb168-12"><a href="multilevel-modeling.html#cb168-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasSD_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb168-13"><a href="multilevel-modeling.html#cb168-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb168-14"><a href="multilevel-modeling.html#cb168-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variance of bias&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-15"><a href="multilevel-modeling.html#cb168-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-16"><a href="multilevel-modeling.html#cb168-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb168-17"><a href="multilevel-modeling.html#cb168-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-18"><a href="multilevel-modeling.html#cb168-18" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb168-19"><a href="multilevel-modeling.html#cb168-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaM), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb168-20"><a href="multilevel-modeling.html#cb168-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaM_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb168-21"><a href="multilevel-modeling.html#cb168-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb168-22"><a href="multilevel-modeling.html#cb168-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean Beta&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-23"><a href="multilevel-modeling.html#cb168-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-24"><a href="multilevel-modeling.html#cb168-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb168-25"><a href="multilevel-modeling.html#cb168-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-26"><a href="multilevel-modeling.html#cb168-26" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb168-27"><a href="multilevel-modeling.html#cb168-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaSD), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb168-28"><a href="multilevel-modeling.html#cb168-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaSD_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb168-29"><a href="multilevel-modeling.html#cb168-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb168-30"><a href="multilevel-modeling.html#cb168-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variance of beta&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-31"><a href="multilevel-modeling.html#cb168-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-32"><a href="multilevel-modeling.html#cb168-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb168-33"><a href="multilevel-modeling.html#cb168-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-34"><a href="multilevel-modeling.html#cb168-34" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 </span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20prior%20posterior%20update%20checks-1.png" width="672" /></p>
</div>
<div id="posterior-predictive-checks-1" class="section level4 hasAnchor" number="6.5.6.3">
<h4><span class="header-section-number">6.5.6.3</span> Posterior predictive checks<a href="multilevel-modeling.html#posterior-predictive-checks-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="multilevel-modeling.html#cb169-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb169-2"><a href="multilevel-modeling.html#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds0[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb169-3"><a href="multilevel-modeling.html#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds0[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb169-4"><a href="multilevel-modeling.html#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb169-5"><a href="multilevel-modeling.html#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb169-6"><a href="multilevel-modeling.html#cb169-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb169-7"><a href="multilevel-modeling.html#cb169-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-8"><a href="multilevel-modeling.html#cb169-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb169-9"><a href="multilevel-modeling.html#cb169-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds1[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb169-10"><a href="multilevel-modeling.html#cb169-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds1[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb169-11"><a href="multilevel-modeling.html#cb169-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb169-12"><a href="multilevel-modeling.html#cb169-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb169-13"><a href="multilevel-modeling.html#cb169-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb169-14"><a href="multilevel-modeling.html#cb169-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-15"><a href="multilevel-modeling.html#cb169-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb169-16"><a href="multilevel-modeling.html#cb169-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds2[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb169-17"><a href="multilevel-modeling.html#cb169-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds2[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb169-18"><a href="multilevel-modeling.html#cb169-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb169-19"><a href="multilevel-modeling.html#cb169-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb169-20"><a href="multilevel-modeling.html#cb169-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb169-21"><a href="multilevel-modeling.html#cb169-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-22"><a href="multilevel-modeling.html#cb169-22" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20posterior%20predictive%20checks-1.png" width="672" /></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="multilevel-modeling.html#cb171-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasM, biasSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb171-2"><a href="multilevel-modeling.html#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb171-3"><a href="multilevel-modeling.html#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb171-4"><a href="multilevel-modeling.html#cb171-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(betaM, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb171-5"><a href="multilevel-modeling.html#cb171-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb171-6"><a href="multilevel-modeling.html#cb171-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb171-7"><a href="multilevel-modeling.html#cb171-7" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasM, betaM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb171-8"><a href="multilevel-modeling.html#cb171-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb171-9"><a href="multilevel-modeling.html#cb171-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb171-10"><a href="multilevel-modeling.html#cb171-10" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasSD, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb171-11"><a href="multilevel-modeling.html#cb171-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb171-12"><a href="multilevel-modeling.html#cb171-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb171-13"><a href="multilevel-modeling.html#cb171-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-14"><a href="multilevel-modeling.html#cb171-14" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20posterior%20predictive%20checks-2.png" width="672" /></p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="multilevel-modeling.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb172-2"><a href="multilevel-modeling.html#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[1]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-3"><a href="multilevel-modeling.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[15]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-4"><a href="multilevel-modeling.html#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[21]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-5"><a href="multilevel-modeling.html#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[31]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-6"><a href="multilevel-modeling.html#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[41]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-7"><a href="multilevel-modeling.html#cb172-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[51]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-8"><a href="multilevel-modeling.html#cb172-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[61]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-9"><a href="multilevel-modeling.html#cb172-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(biasM_prior)), <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-10"><a href="multilevel-modeling.html#cb172-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(bias_prior), <span class="at">fill =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-11"><a href="multilevel-modeling.html#cb172-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Bias parameter&quot;</span>) <span class="sc">+</span></span>
<span id="cb172-12"><a href="multilevel-modeling.html#cb172-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb172-13"><a href="multilevel-modeling.html#cb172-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20posterior%20predictive%20checks-3.png" width="672" /></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="multilevel-modeling.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb173-2"><a href="multilevel-modeling.html#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[1]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb173-3"><a href="multilevel-modeling.html#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[15]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb173-4"><a href="multilevel-modeling.html#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[21]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb173-5"><a href="multilevel-modeling.html#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[31]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb173-6"><a href="multilevel-modeling.html#cb173-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[41]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb173-7"><a href="multilevel-modeling.html#cb173-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[51]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb173-8"><a href="multilevel-modeling.html#cb173-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[61]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb173-9"><a href="multilevel-modeling.html#cb173-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(betaM_prior)), <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb173-10"><a href="multilevel-modeling.html#cb173-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(beta_prior), <span class="at">fill =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb173-11"><a href="multilevel-modeling.html#cb173-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Beta parameter&quot;</span>) <span class="sc">+</span></span>
<span id="cb173-12"><a href="multilevel-modeling.html#cb173-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb173-13"><a href="multilevel-modeling.html#cb173-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20posterior%20predictive%20checks-4.png" width="672" /></p>
</div>
</div>
<div id="multilevel-memory-with-correlation-between-parameters" class="section level3 hasAnchor" number="6.5.7">
<h3><span class="header-section-number">6.5.7</span> Multilevel memory with correlation between parameters<a href="multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="multilevel-modeling.html#cb174-1" aria-hidden="true" tabindex="-1"></a>stan_model_nc_cor <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb174-2"><a href="multilevel-modeling.html#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb174-3"><a href="multilevel-modeling.html#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (heads and tails)</span></span>
<span id="cb174-4"><a href="multilevel-modeling.html#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb174-5"><a href="multilevel-modeling.html#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb174-6"><a href="multilevel-modeling.html#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb174-7"><a href="multilevel-modeling.html#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb174-8"><a href="multilevel-modeling.html#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb174-9"><a href="multilevel-modeling.html#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb174-10"><a href="multilevel-modeling.html#cb174-10" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb174-11"><a href="multilevel-modeling.html#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb174-12"><a href="multilevel-modeling.html#cb174-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-13"><a href="multilevel-modeling.html#cb174-13" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb174-14"><a href="multilevel-modeling.html#cb174-14" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb174-15"><a href="multilevel-modeling.html#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb174-16"><a href="multilevel-modeling.html#cb174-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb174-17"><a href="multilevel-modeling.html#cb174-17" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb174-18"><a href="multilevel-modeling.html#cb174-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb174-19"><a href="multilevel-modeling.html#cb174-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb174-20"><a href="multilevel-modeling.html#cb174-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-21"><a href="multilevel-modeling.html#cb174-21" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb174-22"><a href="multilevel-modeling.html#cb174-22" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb174-23"><a href="multilevel-modeling.html#cb174-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb174-24"><a href="multilevel-modeling.html#cb174-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb174-25"><a href="multilevel-modeling.html#cb174-25" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb174-26"><a href="multilevel-modeling.html#cb174-26" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb174-27"><a href="multilevel-modeling.html#cb174-27" aria-hidden="true" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb174-28"><a href="multilevel-modeling.html#cb174-28" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb174-29"><a href="multilevel-modeling.html#cb174-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-30"><a href="multilevel-modeling.html#cb174-30" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb174-31"><a href="multilevel-modeling.html#cb174-31" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb174-32"><a href="multilevel-modeling.html#cb174-32" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb174-33"><a href="multilevel-modeling.html#cb174-33" aria-hidden="true" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb174-34"><a href="multilevel-modeling.html#cb174-34" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb174-35"><a href="multilevel-modeling.html#cb174-35" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb174-36"><a href="multilevel-modeling.html#cb174-36" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb174-37"><a href="multilevel-modeling.html#cb174-37" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb174-38"><a href="multilevel-modeling.html#cb174-38" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb174-39"><a href="multilevel-modeling.html#cb174-39" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb174-40"><a href="multilevel-modeling.html#cb174-40" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb174-41"><a href="multilevel-modeling.html#cb174-41" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb174-42"><a href="multilevel-modeling.html#cb174-42" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb174-43"><a href="multilevel-modeling.html#cb174-43" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb174-44"><a href="multilevel-modeling.html#cb174-44" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb174-45"><a href="multilevel-modeling.html#cb174-45" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb174-46"><a href="multilevel-modeling.html#cb174-46" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb174-47"><a href="multilevel-modeling.html#cb174-47" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb174-48"><a href="multilevel-modeling.html#cb174-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-49"><a href="multilevel-modeling.html#cb174-49" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb174-50"><a href="multilevel-modeling.html#cb174-50" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb174-51"><a href="multilevel-modeling.html#cb174-51" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb174-52"><a href="multilevel-modeling.html#cb174-52" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb174-53"><a href="multilevel-modeling.html#cb174-53" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb174-54"><a href="multilevel-modeling.html#cb174-54" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb174-55"><a href="multilevel-modeling.html#cb174-55" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb174-56"><a href="multilevel-modeling.html#cb174-56" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb174-57"><a href="multilevel-modeling.html#cb174-57" aria-hidden="true" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb174-58"><a href="multilevel-modeling.html#cb174-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-59"><a href="multilevel-modeling.html#cb174-59" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb174-60"><a href="multilevel-modeling.html#cb174-60" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb174-61"><a href="multilevel-modeling.html#cb174-61" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb174-62"><a href="multilevel-modeling.html#cb174-62" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | biasM + IDs[agent, 1] +  memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb174-63"><a href="multilevel-modeling.html#cb174-63" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb174-64"><a href="multilevel-modeling.html#cb174-64" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb174-65"><a href="multilevel-modeling.html#cb174-65" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb174-66"><a href="multilevel-modeling.html#cb174-66" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb174-67"><a href="multilevel-modeling.html#cb174-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-68"><a href="multilevel-modeling.html#cb174-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-69"><a href="multilevel-modeling.html#cb174-69" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb174-70"><a href="multilevel-modeling.html#cb174-70" aria-hidden="true" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb174-71"><a href="multilevel-modeling.html#cb174-71" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb174-72"><a href="multilevel-modeling.html#cb174-72" aria-hidden="true" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb174-73"><a href="multilevel-modeling.html#cb174-73" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb174-74"><a href="multilevel-modeling.html#cb174-74" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb174-75"><a href="multilevel-modeling.html#cb174-75" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb174-76"><a href="multilevel-modeling.html#cb174-76" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb174-77"><a href="multilevel-modeling.html#cb174-77" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb174-78"><a href="multilevel-modeling.html#cb174-78" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb174-79"><a href="multilevel-modeling.html#cb174-79" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb174-80"><a href="multilevel-modeling.html#cb174-80" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb174-81"><a href="multilevel-modeling.html#cb174-81" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb174-82"><a href="multilevel-modeling.html#cb174-82" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb174-83"><a href="multilevel-modeling.html#cb174-83" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb174-84"><a href="multilevel-modeling.html#cb174-84" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb174-85"><a href="multilevel-modeling.html#cb174-85" aria-hidden="true" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb174-86"><a href="multilevel-modeling.html#cb174-86" aria-hidden="true" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb174-87"><a href="multilevel-modeling.html#cb174-87" aria-hidden="true" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb174-88"><a href="multilevel-modeling.html#cb174-88" aria-hidden="true" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb174-89"><a href="multilevel-modeling.html#cb174-89" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb174-90"><a href="multilevel-modeling.html#cb174-90" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb174-91"><a href="multilevel-modeling.html#cb174-91" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb174-92"><a href="multilevel-modeling.html#cb174-92" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb174-93"><a href="multilevel-modeling.html#cb174-93" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb174-94"><a href="multilevel-modeling.html#cb174-94" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb174-95"><a href="multilevel-modeling.html#cb174-95" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb174-96"><a href="multilevel-modeling.html#cb174-96" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb174-97"><a href="multilevel-modeling.html#cb174-97" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  0 * (betaM + IDs[i,2])));</span></span>
<span id="cb174-98"><a href="multilevel-modeling.html#cb174-98" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  1 * (betaM + IDs[i,2])));</span></span>
<span id="cb174-99"><a href="multilevel-modeling.html#cb174-99" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  2 * (betaM + IDs[i,2])));</span></span>
<span id="cb174-100"><a href="multilevel-modeling.html#cb174-100" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb174-101"><a href="multilevel-modeling.html#cb174-101" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb174-102"><a href="multilevel-modeling.html#cb174-102" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb174-103"><a href="multilevel-modeling.html#cb174-103" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb174-104"><a href="multilevel-modeling.html#cb174-104" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb174-105"><a href="multilevel-modeling.html#cb174-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-106"><a href="multilevel-modeling.html#cb174-106" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb174-107"><a href="multilevel-modeling.html#cb174-107" aria-hidden="true" tabindex="-1"></a>  stan_model_nc_cor,</span>
<span id="cb174-108"><a href="multilevel-modeling.html#cb174-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb174-109"><a href="multilevel-modeling.html#cb174-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelMemory_nc_cor.stan&quot;</span>)</span>
<span id="cb174-110"><a href="multilevel-modeling.html#cb174-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-111"><a href="multilevel-modeling.html#cb174-111" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelMemory_nc_cor.stan&quot;</span>)</span>
<span id="cb174-112"><a href="multilevel-modeling.html#cb174-112" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb174-113"><a href="multilevel-modeling.html#cb174-113" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span>
<span id="cb174-114"><a href="multilevel-modeling.html#cb174-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-115"><a href="multilevel-modeling.html#cb174-115" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb174-116"><a href="multilevel-modeling.html#cb174-116" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb174-117"><a href="multilevel-modeling.html#cb174-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb174-118"><a href="multilevel-modeling.html#cb174-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb174-119"><a href="multilevel-modeling.html#cb174-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb174-120"><a href="multilevel-modeling.html#cb174-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb174-121"><a href="multilevel-modeling.html#cb174-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb174-122"><a href="multilevel-modeling.html#cb174-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb174-123"><a href="multilevel-modeling.html#cb174-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb174-124"><a href="multilevel-modeling.html#cb174-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb174-125"><a href="multilevel-modeling.html#cb174-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb174-126"><a href="multilevel-modeling.html#cb174-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb174-127"><a href="multilevel-modeling.html#cb174-127" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb174-128"><a href="multilevel-modeling.html#cb174-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-129"><a href="multilevel-modeling.html#cb174-129" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/Memory_noncentered_corr.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-multilevel-memory-2" class="section level3 hasAnchor" number="6.5.8">
<h3><span class="header-section-number">6.5.8</span> Assessing multilevel memory<a href="multilevel-modeling.html#assessing-multilevel-memory-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>[MISSING LOTS OF EVALUATION]</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="multilevel-modeling.html#cb175-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W5_MultilevelMemory_noncentered_corr.RDS&quot;</span>)</span>
<span id="cb175-2"><a href="multilevel-modeling.html#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="multilevel-modeling.html#cb175-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code></pre></div>
<pre><code>## File /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory_nc_cor-202303100657-1-969904.csv not found
## File /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory_nc_cor-202303100657-2-969904.csv not found
## No valid input files, exiting.</code></pre>
</div>
<div id="multilevel-memory-no-pooling" class="section level3 hasAnchor" number="6.5.9">
<h3><span class="header-section-number">6.5.9</span> Multilevel memory no pooling<a href="multilevel-modeling.html#multilevel-memory-no-pooling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>[MISSING: EXPLANATION OF NO POOLING]</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="multilevel-modeling.html#cb177-1" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb177-2"><a href="multilevel-modeling.html#cb177-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-3"><a href="multilevel-modeling.html#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of heads</span></span>
<span id="cb177-4"><a href="multilevel-modeling.html#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb177-5"><a href="multilevel-modeling.html#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb177-6"><a href="multilevel-modeling.html#cb177-6" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb177-7"><a href="multilevel-modeling.html#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb177-8"><a href="multilevel-modeling.html#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb177-9"><a href="multilevel-modeling.html#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb177-10"><a href="multilevel-modeling.html#cb177-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-11"><a href="multilevel-modeling.html#cb177-11" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb177-12"><a href="multilevel-modeling.html#cb177-12" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb177-13"><a href="multilevel-modeling.html#cb177-13" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials] real bias;</span></span>
<span id="cb177-14"><a href="multilevel-modeling.html#cb177-14" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials] real beta;</span></span>
<span id="cb177-15"><a href="multilevel-modeling.html#cb177-15" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb177-16"><a href="multilevel-modeling.html#cb177-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-17"><a href="multilevel-modeling.html#cb177-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-18"><a href="multilevel-modeling.html#cb177-18" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb177-19"><a href="multilevel-modeling.html#cb177-19" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb177-20"><a href="multilevel-modeling.html#cb177-20" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb177-21"><a href="multilevel-modeling.html#cb177-21" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb177-22"><a href="multilevel-modeling.html#cb177-22" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb177-23"><a href="multilevel-modeling.html#cb177-23" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb177-24"><a href="multilevel-modeling.html#cb177-24" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb177-25"><a href="multilevel-modeling.html#cb177-25" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb177-26"><a href="multilevel-modeling.html#cb177-26" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb177-27"><a href="multilevel-modeling.html#cb177-27" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb177-28"><a href="multilevel-modeling.html#cb177-28" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb177-29"><a href="multilevel-modeling.html#cb177-29" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb177-30"><a href="multilevel-modeling.html#cb177-30" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb177-31"><a href="multilevel-modeling.html#cb177-31" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb177-32"><a href="multilevel-modeling.html#cb177-32" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb177-33"><a href="multilevel-modeling.html#cb177-33" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb177-34"><a href="multilevel-modeling.html#cb177-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-35"><a href="multilevel-modeling.html#cb177-35" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb177-36"><a href="multilevel-modeling.html#cb177-36" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb177-37"><a href="multilevel-modeling.html#cb177-37" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | 0, 1);</span></span>
<span id="cb177-38"><a href="multilevel-modeling.html#cb177-38" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(beta | 0, 1);</span></span>
<span id="cb177-39"><a href="multilevel-modeling.html#cb177-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-40"><a href="multilevel-modeling.html#cb177-40" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb177-41"><a href="multilevel-modeling.html#cb177-41" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb177-42"><a href="multilevel-modeling.html#cb177-42" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | bias[agent] +  memory[trial, agent] * (beta[agent]));</span></span>
<span id="cb177-43"><a href="multilevel-modeling.html#cb177-43" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb177-44"><a href="multilevel-modeling.html#cb177-44" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb177-45"><a href="multilevel-modeling.html#cb177-45" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb177-46"><a href="multilevel-modeling.html#cb177-46" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb177-47"><a href="multilevel-modeling.html#cb177-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-48"><a href="multilevel-modeling.html#cb177-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-49"><a href="multilevel-modeling.html#cb177-49" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb177-50"><a href="multilevel-modeling.html#cb177-50" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb177-51"><a href="multilevel-modeling.html#cb177-51" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb177-52"><a href="multilevel-modeling.html#cb177-52" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb177-53"><a href="multilevel-modeling.html#cb177-53" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb177-54"><a href="multilevel-modeling.html#cb177-54" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb177-55"><a href="multilevel-modeling.html#cb177-55" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb177-56"><a href="multilevel-modeling.html#cb177-56" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb177-57"><a href="multilevel-modeling.html#cb177-57" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb177-58"><a href="multilevel-modeling.html#cb177-58" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb177-59"><a href="multilevel-modeling.html#cb177-59" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb177-60"><a href="multilevel-modeling.html#cb177-60" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(0,1);</span></span>
<span id="cb177-61"><a href="multilevel-modeling.html#cb177-61" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(0,1);</span></span>
<span id="cb177-62"><a href="multilevel-modeling.html#cb177-62" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb177-63"><a href="multilevel-modeling.html#cb177-63" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds0 = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb177-64"><a href="multilevel-modeling.html#cb177-64" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds1 = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb177-65"><a href="multilevel-modeling.html#cb177-65" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds2 = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb177-66"><a href="multilevel-modeling.html#cb177-66" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb177-67"><a href="multilevel-modeling.html#cb177-67" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb177-68"><a href="multilevel-modeling.html#cb177-68" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(bias[i] +  0 * (beta[i])));</span></span>
<span id="cb177-69"><a href="multilevel-modeling.html#cb177-69" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(bias[i] +  1 * (beta[i])));</span></span>
<span id="cb177-70"><a href="multilevel-modeling.html#cb177-70" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(bias[i] +  2 * (beta[i])));</span></span>
<span id="cb177-71"><a href="multilevel-modeling.html#cb177-71" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb177-72"><a href="multilevel-modeling.html#cb177-72" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb177-73"><a href="multilevel-modeling.html#cb177-73" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb177-74"><a href="multilevel-modeling.html#cb177-74" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb177-75"><a href="multilevel-modeling.html#cb177-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-76"><a href="multilevel-modeling.html#cb177-76" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb177-77"><a href="multilevel-modeling.html#cb177-77" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb177-78"><a href="multilevel-modeling.html#cb177-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb177-79"><a href="multilevel-modeling.html#cb177-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelMemory_nopooling.stan&quot;</span>)</span>
<span id="cb177-80"><a href="multilevel-modeling.html#cb177-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-81"><a href="multilevel-modeling.html#cb177-81" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelMemory_nopooling.stan&quot;</span>)</span>
<span id="cb177-82"><a href="multilevel-modeling.html#cb177-82" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb177-83"><a href="multilevel-modeling.html#cb177-83" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span>
<span id="cb177-84"><a href="multilevel-modeling.html#cb177-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-85"><a href="multilevel-modeling.html#cb177-85" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb177-86"><a href="multilevel-modeling.html#cb177-86" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb177-87"><a href="multilevel-modeling.html#cb177-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb177-88"><a href="multilevel-modeling.html#cb177-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb177-89"><a href="multilevel-modeling.html#cb177-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb177-90"><a href="multilevel-modeling.html#cb177-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb177-91"><a href="multilevel-modeling.html#cb177-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb177-92"><a href="multilevel-modeling.html#cb177-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb177-93"><a href="multilevel-modeling.html#cb177-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb177-94"><a href="multilevel-modeling.html#cb177-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb177-95"><a href="multilevel-modeling.html#cb177-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb177-96"><a href="multilevel-modeling.html#cb177-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb177-97"><a href="multilevel-modeling.html#cb177-97" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb177-98"><a href="multilevel-modeling.html#cb177-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-99"><a href="multilevel-modeling.html#cb177-99" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W5_MultilevelMemory_nopooling.RDS&quot;</span>)</span></code></pre></div>
<p>[MISSING: Evaluation of NO POOLING]</p>
</div>
</div>
<div id="multilevel-full-pooling" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Multilevel full pooling<a href="multilevel-modeling.html#multilevel-full-pooling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: EXPLANATION OF FULL POOLING]</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="multilevel-modeling.html#cb178-1" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb178-2"><a href="multilevel-modeling.html#cb178-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-3"><a href="multilevel-modeling.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of heads</span></span>
<span id="cb178-4"><a href="multilevel-modeling.html#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb178-5"><a href="multilevel-modeling.html#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb178-6"><a href="multilevel-modeling.html#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb178-7"><a href="multilevel-modeling.html#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb178-8"><a href="multilevel-modeling.html#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb178-9"><a href="multilevel-modeling.html#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb178-10"><a href="multilevel-modeling.html#cb178-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-11"><a href="multilevel-modeling.html#cb178-11" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb178-12"><a href="multilevel-modeling.html#cb178-12" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb178-13"><a href="multilevel-modeling.html#cb178-13" aria-hidden="true" tabindex="-1"></a><span class="st">  real bias;</span></span>
<span id="cb178-14"><a href="multilevel-modeling.html#cb178-14" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta;</span></span>
<span id="cb178-15"><a href="multilevel-modeling.html#cb178-15" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb178-16"><a href="multilevel-modeling.html#cb178-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-17"><a href="multilevel-modeling.html#cb178-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-18"><a href="multilevel-modeling.html#cb178-18" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb178-19"><a href="multilevel-modeling.html#cb178-19" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb178-20"><a href="multilevel-modeling.html#cb178-20" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb178-21"><a href="multilevel-modeling.html#cb178-21" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb178-22"><a href="multilevel-modeling.html#cb178-22" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb178-23"><a href="multilevel-modeling.html#cb178-23" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb178-24"><a href="multilevel-modeling.html#cb178-24" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb178-25"><a href="multilevel-modeling.html#cb178-25" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb178-26"><a href="multilevel-modeling.html#cb178-26" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb178-27"><a href="multilevel-modeling.html#cb178-27" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb178-28"><a href="multilevel-modeling.html#cb178-28" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb178-29"><a href="multilevel-modeling.html#cb178-29" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb178-30"><a href="multilevel-modeling.html#cb178-30" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb178-31"><a href="multilevel-modeling.html#cb178-31" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb178-32"><a href="multilevel-modeling.html#cb178-32" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb178-33"><a href="multilevel-modeling.html#cb178-33" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb178-34"><a href="multilevel-modeling.html#cb178-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-35"><a href="multilevel-modeling.html#cb178-35" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb178-36"><a href="multilevel-modeling.html#cb178-36" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb178-37"><a href="multilevel-modeling.html#cb178-37" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | 0, 1);</span></span>
<span id="cb178-38"><a href="multilevel-modeling.html#cb178-38" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(beta | 0, 1);</span></span>
<span id="cb178-39"><a href="multilevel-modeling.html#cb178-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-40"><a href="multilevel-modeling.html#cb178-40" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb178-41"><a href="multilevel-modeling.html#cb178-41" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb178-42"><a href="multilevel-modeling.html#cb178-42" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | bias +  memory[trial, agent] * beta);</span></span>
<span id="cb178-43"><a href="multilevel-modeling.html#cb178-43" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb178-44"><a href="multilevel-modeling.html#cb178-44" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb178-45"><a href="multilevel-modeling.html#cb178-45" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb178-46"><a href="multilevel-modeling.html#cb178-46" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb178-47"><a href="multilevel-modeling.html#cb178-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-48"><a href="multilevel-modeling.html#cb178-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-49"><a href="multilevel-modeling.html#cb178-49" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb178-50"><a href="multilevel-modeling.html#cb178-50" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb178-51"><a href="multilevel-modeling.html#cb178-51" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb178-52"><a href="multilevel-modeling.html#cb178-52" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb178-53"><a href="multilevel-modeling.html#cb178-53" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb178-54"><a href="multilevel-modeling.html#cb178-54" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb178-55"><a href="multilevel-modeling.html#cb178-55" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb178-56"><a href="multilevel-modeling.html#cb178-56" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb178-57"><a href="multilevel-modeling.html#cb178-57" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb178-58"><a href="multilevel-modeling.html#cb178-58" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb178-59"><a href="multilevel-modeling.html#cb178-59" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb178-60"><a href="multilevel-modeling.html#cb178-60" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(0,1);</span></span>
<span id="cb178-61"><a href="multilevel-modeling.html#cb178-61" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(0,1);</span></span>
<span id="cb178-62"><a href="multilevel-modeling.html#cb178-62" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb178-63"><a href="multilevel-modeling.html#cb178-63" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds0 = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb178-64"><a href="multilevel-modeling.html#cb178-64" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds1 = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb178-65"><a href="multilevel-modeling.html#cb178-65" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds2 = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb178-66"><a href="multilevel-modeling.html#cb178-66" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb178-67"><a href="multilevel-modeling.html#cb178-67" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds0 = binomial_rng(trials, inv_logit(bias +  0 * (beta)));</span></span>
<span id="cb178-68"><a href="multilevel-modeling.html#cb178-68" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds1 = binomial_rng(trials, inv_logit(bias +  1 * (beta)));</span></span>
<span id="cb178-69"><a href="multilevel-modeling.html#cb178-69" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds2 = binomial_rng(trials, inv_logit(bias +  2 * (beta)));</span></span>
<span id="cb178-70"><a href="multilevel-modeling.html#cb178-70" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb178-71"><a href="multilevel-modeling.html#cb178-71" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb178-72"><a href="multilevel-modeling.html#cb178-72" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb178-73"><a href="multilevel-modeling.html#cb178-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-74"><a href="multilevel-modeling.html#cb178-74" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb178-75"><a href="multilevel-modeling.html#cb178-75" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb178-76"><a href="multilevel-modeling.html#cb178-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb178-77"><a href="multilevel-modeling.html#cb178-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelMemory_fullpooling.stan&quot;</span>)</span>
<span id="cb178-78"><a href="multilevel-modeling.html#cb178-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-79"><a href="multilevel-modeling.html#cb178-79" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelMemory_fullpooling.stan&quot;</span>)</span>
<span id="cb178-80"><a href="multilevel-modeling.html#cb178-80" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb178-81"><a href="multilevel-modeling.html#cb178-81" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span>
<span id="cb178-82"><a href="multilevel-modeling.html#cb178-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-83"><a href="multilevel-modeling.html#cb178-83" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb178-84"><a href="multilevel-modeling.html#cb178-84" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb178-85"><a href="multilevel-modeling.html#cb178-85" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb178-86"><a href="multilevel-modeling.html#cb178-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb178-87"><a href="multilevel-modeling.html#cb178-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb178-88"><a href="multilevel-modeling.html#cb178-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb178-89"><a href="multilevel-modeling.html#cb178-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb178-90"><a href="multilevel-modeling.html#cb178-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb178-91"><a href="multilevel-modeling.html#cb178-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb178-92"><a href="multilevel-modeling.html#cb178-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb178-93"><a href="multilevel-modeling.html#cb178-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb178-94"><a href="multilevel-modeling.html#cb178-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb178-95"><a href="multilevel-modeling.html#cb178-95" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb178-96"><a href="multilevel-modeling.html#cb178-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-97"><a href="multilevel-modeling.html#cb178-97" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">&quot;simmodels/W5_MultilevelMemory_fullpooling.RDS&quot;</span>)</span></code></pre></div>
<p>[MISSING: Evaluation of FULL POOLING]</p>
<p>[MISSING: PARAMETER RECOVERY IN A MULTILEVEL FRAMEWORK (IND VS POP)]</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="practical-exercise-4---model-quality-checks.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-comparison.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/05-MultilevelModels.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
