<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Multilevel modeling | 05-MultilevelModeling</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Multilevel modeling | 05-MultilevelModeling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Multilevel modeling | 05-MultilevelModeling" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2023" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2023-02-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="practical-exercise-4---model-quality-checks.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-goal-of-the-course"><i class="fa fa-check"></i><b>1.1</b> The goal of the course</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#list-of-lectures-and-practical-exercises"><i class="fa fa-check"></i><b>1.2</b> List of lectures and practical exercises</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preparation-before-the-course"><i class="fa fa-check"></i><b>1.3</b> Preparation before the course</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><i class="fa fa-check"></i><b>2</b> Practical exercise 1 - Building verbal models of the matching pennies game</a>
<ul>
<li class="chapter" data-level="2.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#trying-out-the-game-and-collecting-your-own-data"><i class="fa fa-check"></i><b>2.1</b> Trying out the game and collecting your own data</a></li>
<li class="chapter" data-level="2.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#start-theorizing"><i class="fa fa-check"></i><b>2.2</b> Start Theorizing</a></li>
<li class="chapter" data-level="2.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>2.3</b> The distinction between participant and researcher perspectives</a></li>
<li class="chapter" data-level="2.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#strategies"><i class="fa fa-check"></i><b>2.4</b> Strategies</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#random-strategies"><i class="fa fa-check"></i><b>2.4.1</b> Random strategies</a></li>
<li class="chapter" data-level="2.4.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#immediate-reaction"><i class="fa fa-check"></i><b>2.4.2</b> Immediate reaction</a></li>
<li class="chapter" data-level="2.4.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>2.4.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="2.4.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>2.4.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="2.4.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#reinforcement-learning"><i class="fa fa-check"></i><b>2.4.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="2.4.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#k-tom"><i class="fa fa-check"></i><b>2.4.6</b> k-ToM</a></li>
<li class="chapter" data-level="2.4.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#other-possible-strategies"><i class="fa fa-check"></i><b>2.4.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#cognitive-constraints"><i class="fa fa-check"></i><b>2.5</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#memory"><i class="fa fa-check"></i><b>2.5.1</b> Memory</a></li>
<li class="chapter" data-level="2.5.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#errors"><i class="fa fa-check"></i><b>2.5.2</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#continuity-between-models"><i class="fa fa-check"></i><b>2.6</b> Continuity between models</a></li>
<li class="chapter" data-level="2.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#mixture-of-strategies"><i class="fa fa-check"></i><b>2.7</b> Mixture of strategies</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html"><i class="fa fa-check"></i><b>3</b> Practical exercise 2 - From verbal to formal models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>3.1</b> Defining general conditions</a></li>
<li class="chapter" data-level="3.2" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>3.2</b> Implementing a random agent</a></li>
<li class="chapter" data-level="3.3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>3.3</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="3.4" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>3.4</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>3.4.1</b> And we visualize it</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html"><i class="fa fa-check"></i><b>4</b> Practical exercise 3 - Getting into Stan</a>
<ul>
<li class="chapter" data-level="4.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#simulating-data"><i class="fa fa-check"></i><b>4.2</b> Simulating data</a></li>
<li class="chapter" data-level="4.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#building-our-basic-model-in-stan"><i class="fa fa-check"></i><b>4.3</b> Building our basic model in Stan</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#data"><i class="fa fa-check"></i><b>4.3.1</b> Data</a></li>
<li class="chapter" data-level="4.3.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#model"><i class="fa fa-check"></i><b>4.3.2</b> Model</a></li>
<li class="chapter" data-level="4.3.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#compiling-and-fitting-the-model"><i class="fa fa-check"></i><b>4.3.3</b> Compiling and fitting the model</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#parameter-recovery"><i class="fa fa-check"></i><b>4.4</b> Parameter recovery</a></li>
<li class="chapter" data-level="4.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#the-memory-model-conditioning-theta"><i class="fa fa-check"></i><b>4.5</b> The memory model: conditioning theta</a></li>
<li class="chapter" data-level="4.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#memory-agent-with-internal-parameter"><i class="fa fa-check"></i><b>4.6</b> Memory agent with internal parameter</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#trying-out-a-more-complex-memory-model-with-a-rate-of-forgetting-that-exponentially-discounts-the-past"><i class="fa fa-check"></i><b>4.6.1</b> Trying out a more complex memory model, with a rate of forgetting that exponentially discounts the past</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html"><i class="fa fa-check"></i><b>5</b> Practical exercise 4 - Model quality checks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#generating-and-plotting-additional-variables"><i class="fa fa-check"></i><b>5.1</b> Generating and plotting additional variables</a></li>
<li class="chapter" data-level="5.2" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-priors"><i class="fa fa-check"></i><b>5.2</b> Assessing priors</a></li>
<li class="chapter" data-level="5.3" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-prior-and-posterior-predictions"><i class="fa fa-check"></i><b>5.3</b> Assessing prior and posterior predictions</a></li>
<li class="chapter" data-level="5.4" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>5.4</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="5.5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#the-memory-model"><i class="fa fa-check"></i><b>5.5</b> The memory model</a></li>
<li class="chapter" data-level="5.6" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-check-for-the-memory-model"><i class="fa fa-check"></i><b>5.6</b> Prior sensitivity check for the memory model</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html"><i class="fa fa-check"></i><b>6</b> Multilevel modeling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#intro-to-multilevel-modeling"><i class="fa fa-check"></i><b>6.1</b> Intro to multilevel modeling</a></li>
<li class="chapter" data-level="6.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#a-multilevel-version-of-the-biased-agent-and-of-the-simple-memory-agent"><i class="fa fa-check"></i><b>6.2</b> A multilevel version of the biased agent and of the simple memory agent</a></li>
<li class="chapter" data-level="6.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#generating-the-agents"><i class="fa fa-check"></i><b>6.3</b> Generating the agents</a></li>
<li class="chapter" data-level="6.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#plotting-the-agents"><i class="fa fa-check"></i><b>6.4</b> Plotting the agents</a></li>
<li class="chapter" data-level="6.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#coding-the-multilevel-agents"><i class="fa fa-check"></i><b>6.5</b> Coding the multilevel agents</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-random"><i class="fa fa-check"></i><b>6.5.1</b> Multilevel random</a></li>
<li class="chapter" data-level="6.5.2" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-random-agents"><i class="fa fa-check"></i><b>6.5.2</b> Assessing multilevel random agents</a></li>
<li class="chapter" data-level="6.5.3" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory"><i class="fa fa-check"></i><b>6.5.3</b> Multilevel memory</a></li>
<li class="chapter" data-level="6.5.4" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory"><i class="fa fa-check"></i><b>6.5.4</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.5" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization"><i class="fa fa-check"></i><b>6.5.5</b> Multilevel memory with non centered parameterization</a></li>
<li class="chapter" data-level="6.5.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-1"><i class="fa fa-check"></i><b>6.5.6</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.7" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters"><i class="fa fa-check"></i><b>6.5.7</b> Multilevel memory with correlation between parameters</a></li>
<li class="chapter" data-level="6.5.8" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#assessing-multilevel-memory-2"><i class="fa fa-check"></i><b>6.5.8</b> Assessing multilevel memory</a></li>
<li class="chapter" data-level="6.5.9" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-memory-no-pooling"><i class="fa fa-check"></i><b>6.5.9</b> Multilevel memory no pooling</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="multilevel-modeling.html"><a href="multilevel-modeling.html#multilevel-full-pooling"><i class="fa fa-check"></i><b>6.6</b> Multilevel full pooling</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">05-MultilevelModeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multilevel-modeling" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Multilevel modeling<a href="multilevel-modeling.html#multilevel-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="intro-to-multilevel-modeling" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Intro to multilevel modeling<a href="multilevel-modeling.html#intro-to-multilevel-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[Explanation on what multilevel modeling is - structure in the data, partial pooling, repeated measures]</p>
</div>
<div id="a-multilevel-version-of-the-biased-agent-and-of-the-simple-memory-agent" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> A multilevel version of the biased agent and of the simple memory agent<a href="multilevel-modeling.html#a-multilevel-version-of-the-biased-agent-and-of-the-simple-memory-agent" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We are now conceptualizing our agents as being part of (sampled from) a more general population. This general population is characterized by a population level average parameter value (e.g. a general bias of 0.8 as we all like right hands more) and a certain variation in the population (e.g. a standard deviation of 0.1, as we are all a bit different from each other). Each biased agent’s rate is then sampled from that distribution. Same for the memory agents.</p>
<p>[MISSING: DAG PLOTS OF THE TWO SCENARIOS]</p>
<p>Again, it’s practical to work in log odds. Why? Well, it’s not unconceivable that an agent would be 3 sd from the mean. So a biased agent could have a rate of 0.8 + 3 * 0.1, which gives a rate of 1.1. It’s kinda impossible to choose 110% of the time the right hand. We want an easy way to avoid these situations without too carefully tweaking our parameters, or including exception statements (e.g. if rate &gt; 1, then rate = 1). Conversion to log odds is again a wonderful way to work in a boundless space, and in the last step shrinking everything back to 0-1 probability space.</p>
<p>N.B. we model all agents with some added noise as we assume it cannot be eliminated from our studies.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="multilevel-modeling.html#cb115-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,</span>
<span id="cb115-2"><a href="multilevel-modeling.html#cb115-2" aria-hidden="true" tabindex="-1"></a>               here,</span>
<span id="cb115-3"><a href="multilevel-modeling.html#cb115-3" aria-hidden="true" tabindex="-1"></a>               posterior,</span>
<span id="cb115-4"><a href="multilevel-modeling.html#cb115-4" aria-hidden="true" tabindex="-1"></a>               cmdstanr,</span>
<span id="cb115-5"><a href="multilevel-modeling.html#cb115-5" aria-hidden="true" tabindex="-1"></a>               brms, tidybayes)</span>
<span id="cb115-6"><a href="multilevel-modeling.html#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="multilevel-modeling.html#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Shared parameters</span></span>
<span id="cb115-8"><a href="multilevel-modeling.html#cb115-8" aria-hidden="true" tabindex="-1"></a>agents <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb115-9"><a href="multilevel-modeling.html#cb115-9" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb115-10"><a href="multilevel-modeling.html#cb115-10" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-11"><a href="multilevel-modeling.html#cb115-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-12"><a href="multilevel-modeling.html#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Biased agents parameters</span></span>
<span id="cb115-13"><a href="multilevel-modeling.html#cb115-13" aria-hidden="true" tabindex="-1"></a>rateM <span class="ot">&lt;-</span> <span class="fl">1.386</span> <span class="co"># roughly 0.8 once inv_logit scaled</span></span>
<span id="cb115-14"><a href="multilevel-modeling.html#cb115-14" aria-hidden="true" tabindex="-1"></a>rateSD <span class="ot">&lt;-</span> <span class="fl">0.65</span> <span class="co"># roughly giving a sd of 0.1 in prob scale</span></span>
<span id="cb115-15"><a href="multilevel-modeling.html#cb115-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-16"><a href="multilevel-modeling.html#cb115-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Memory agents parameters</span></span>
<span id="cb115-17"><a href="multilevel-modeling.html#cb115-17" aria-hidden="true" tabindex="-1"></a>biasM <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-18"><a href="multilevel-modeling.html#cb115-18" aria-hidden="true" tabindex="-1"></a>biasSD <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb115-19"><a href="multilevel-modeling.html#cb115-19" aria-hidden="true" tabindex="-1"></a>betaM <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb115-20"><a href="multilevel-modeling.html#cb115-20" aria-hidden="true" tabindex="-1"></a>betaSD <span class="ot">&lt;-</span> <span class="fl">0.3</span></span></code></pre></div>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="multilevel-modeling.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions of the agents</span></span>
<span id="cb116-2"><a href="multilevel-modeling.html#cb116-2" aria-hidden="true" tabindex="-1"></a>RandomAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(rate, noise) {</span>
<span id="cb116-3"><a href="multilevel-modeling.html#cb116-3" aria-hidden="true" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">inv_logit_scaled</span>(rate))</span>
<span id="cb116-4"><a href="multilevel-modeling.html#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb116-5"><a href="multilevel-modeling.html#cb116-5" aria-hidden="true" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb116-6"><a href="multilevel-modeling.html#cb116-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb116-7"><a href="multilevel-modeling.html#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb116-8"><a href="multilevel-modeling.html#cb116-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb116-9"><a href="multilevel-modeling.html#cb116-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-10"><a href="multilevel-modeling.html#cb116-10" aria-hidden="true" tabindex="-1"></a>MemoryAgentNoise_f <span class="ot">&lt;-</span> <span class="cf">function</span>(bias, beta, otherRate, noise) {</span>
<span id="cb116-11"><a href="multilevel-modeling.html#cb116-11" aria-hidden="true" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">inv_logit_scaled</span>(bias <span class="sc">+</span> beta <span class="sc">*</span> <span class="fu">logit_scaled</span>(otherRate))</span>
<span id="cb116-12"><a href="multilevel-modeling.html#cb116-12" aria-hidden="true" tabindex="-1"></a>  choice <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, rate)</span>
<span id="cb116-13"><a href="multilevel-modeling.html#cb116-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, noise) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb116-14"><a href="multilevel-modeling.html#cb116-14" aria-hidden="true" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb116-15"><a href="multilevel-modeling.html#cb116-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb116-16"><a href="multilevel-modeling.html#cb116-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb116-17"><a href="multilevel-modeling.html#cb116-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="generating-the-agents" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Generating the agents<a href="multilevel-modeling.html#generating-the-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: PARALLELIZE]</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="multilevel-modeling.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looping through all the agents to generate the data.</span></span>
<span id="cb117-2"><a href="multilevel-modeling.html#cb117-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb117-3"><a href="multilevel-modeling.html#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="multilevel-modeling.html#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (agent <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>agents) {</span>
<span id="cb117-5"><a href="multilevel-modeling.html#cb117-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb117-6"><a href="multilevel-modeling.html#cb117-6" aria-hidden="true" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, rateM, rateSD)</span>
<span id="cb117-7"><a href="multilevel-modeling.html#cb117-7" aria-hidden="true" tabindex="-1"></a>  bias <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, biasM, biasSD)</span>
<span id="cb117-8"><a href="multilevel-modeling.html#cb117-8" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, betaM, betaSD)</span>
<span id="cb117-9"><a href="multilevel-modeling.html#cb117-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb117-10"><a href="multilevel-modeling.html#cb117-10" aria-hidden="true" tabindex="-1"></a>  randomChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb117-11"><a href="multilevel-modeling.html#cb117-11" aria-hidden="true" tabindex="-1"></a>  memoryChoice <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb117-12"><a href="multilevel-modeling.html#cb117-12" aria-hidden="true" tabindex="-1"></a>  memoryRate <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, trials)</span>
<span id="cb117-13"><a href="multilevel-modeling.html#cb117-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb117-14"><a href="multilevel-modeling.html#cb117-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (trial <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>trials) {</span>
<span id="cb117-15"><a href="multilevel-modeling.html#cb117-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-16"><a href="multilevel-modeling.html#cb117-16" aria-hidden="true" tabindex="-1"></a>    randomChoice[trial] <span class="ot">&lt;-</span> <span class="fu">RandomAgentNoise_f</span>(rate, noise)</span>
<span id="cb117-17"><a href="multilevel-modeling.html#cb117-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trial <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb117-18"><a href="multilevel-modeling.html#cb117-18" aria-hidden="true" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)</span>
<span id="cb117-19"><a href="multilevel-modeling.html#cb117-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb117-20"><a href="multilevel-modeling.html#cb117-20" aria-hidden="true" tabindex="-1"></a>      memoryChoice[trial] <span class="ot">&lt;-</span> <span class="fu">MemoryAgentNoise_f</span>(bias, beta, <span class="fu">mean</span>(randomChoice[<span class="dv">1</span><span class="sc">:</span>trial], <span class="at">na.rm =</span> T), noise)</span>
<span id="cb117-21"><a href="multilevel-modeling.html#cb117-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb117-22"><a href="multilevel-modeling.html#cb117-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb117-23"><a href="multilevel-modeling.html#cb117-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb117-24"><a href="multilevel-modeling.html#cb117-24" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(agent, <span class="at">trial =</span> <span class="fu">seq</span>(trials), randomChoice, <span class="at">randomRate =</span> rate, memoryChoice, memoryRate, noise, rateM, rateSD, bias, beta, biasM, biasSD, betaM, betaSD)</span>
<span id="cb117-25"><a href="multilevel-modeling.html#cb117-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb117-26"><a href="multilevel-modeling.html#cb117-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (agent <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb117-27"><a href="multilevel-modeling.html#cb117-27" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d, temp)</span>
<span id="cb117-28"><a href="multilevel-modeling.html#cb117-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb117-29"><a href="multilevel-modeling.html#cb117-29" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> temp</span>
<span id="cb117-30"><a href="multilevel-modeling.html#cb117-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb117-31"><a href="multilevel-modeling.html#cb117-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb117-32"><a href="multilevel-modeling.html#cb117-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb117-33"><a href="multilevel-modeling.html#cb117-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-34"><a href="multilevel-modeling.html#cb117-34" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(agent) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb117-35"><a href="multilevel-modeling.html#cb117-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomRate =</span> <span class="fu">cumsum</span>(randomChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(randomChoice),</span>
<span id="cb117-36"><a href="multilevel-modeling.html#cb117-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">memoryRate =</span> <span class="fu">cumsum</span>(memoryChoice) <span class="sc">/</span> <span class="fu">seq_along</span>(memoryChoice)</span>
<span id="cb117-37"><a href="multilevel-modeling.html#cb117-37" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="plotting-the-agents" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Plotting the agents<a href="multilevel-modeling.html#plotting-the-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="multilevel-modeling.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot of the proportion of right hand choices for the random agents</span></span>
<span id="cb118-2"><a href="multilevel-modeling.html#cb118-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(d, <span class="fu">aes</span>(trial, randomRate, <span class="at">group =</span> agent, <span class="at">color =</span> agent)) <span class="sc">+</span> </span>
<span id="cb118-3"><a href="multilevel-modeling.html#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb118-4"><a href="multilevel-modeling.html#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb118-5"><a href="multilevel-modeling.html#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb118-6"><a href="multilevel-modeling.html#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() </span>
<span id="cb118-7"><a href="multilevel-modeling.html#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot of the proportion of right hand choices for the memory agents</span></span>
<span id="cb118-8"><a href="multilevel-modeling.html#cb118-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(d, <span class="fu">aes</span>(trial, memoryRate, <span class="at">group =</span> agent, <span class="at">color =</span> agent)) <span class="sc">+</span> </span>
<span id="cb118-9"><a href="multilevel-modeling.html#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb118-10"><a href="multilevel-modeling.html#cb118-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb118-11"><a href="multilevel-modeling.html#cb118-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb118-12"><a href="multilevel-modeling.html#cb118-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() </span>
<span id="cb118-13"><a href="multilevel-modeling.html#cb118-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="series_files/figure-html/Plotitng%20the%20agents-1.png" width="672" /></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="multilevel-modeling.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot of whether memory and random agents are matched in proportion at different stages</span></span>
<span id="cb119-2"><a href="multilevel-modeling.html#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="multilevel-modeling.html#cb119-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(trial <span class="sc">==</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(randomRate, memoryRate)) <span class="sc">+</span></span>
<span id="cb119-4"><a href="multilevel-modeling.html#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb119-5"><a href="multilevel-modeling.html#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb119-6"><a href="multilevel-modeling.html#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb119-7"><a href="multilevel-modeling.html#cb119-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb119-8"><a href="multilevel-modeling.html#cb119-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb119-9"><a href="multilevel-modeling.html#cb119-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;correlation at 10 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb119-10"><a href="multilevel-modeling.html#cb119-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb119-11"><a href="multilevel-modeling.html#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="multilevel-modeling.html#cb119-12" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(trial <span class="sc">==</span> <span class="dv">60</span>) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(randomRate, memoryRate)) <span class="sc">+</span></span>
<span id="cb119-13"><a href="multilevel-modeling.html#cb119-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb119-14"><a href="multilevel-modeling.html#cb119-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb119-15"><a href="multilevel-modeling.html#cb119-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb119-16"><a href="multilevel-modeling.html#cb119-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb119-17"><a href="multilevel-modeling.html#cb119-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb119-18"><a href="multilevel-modeling.html#cb119-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;correlation at 60 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb119-19"><a href="multilevel-modeling.html#cb119-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb119-20"><a href="multilevel-modeling.html#cb119-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-21"><a href="multilevel-modeling.html#cb119-21" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(trial <span class="sc">==</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(randomRate, memoryRate)) <span class="sc">+</span></span>
<span id="cb119-22"><a href="multilevel-modeling.html#cb119-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb119-23"><a href="multilevel-modeling.html#cb119-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb119-24"><a href="multilevel-modeling.html#cb119-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb119-25"><a href="multilevel-modeling.html#cb119-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb119-26"><a href="multilevel-modeling.html#cb119-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb119-27"><a href="multilevel-modeling.html#cb119-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;correlation at 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb119-28"><a href="multilevel-modeling.html#cb119-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb119-29"><a href="multilevel-modeling.html#cb119-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-30"><a href="multilevel-modeling.html#cb119-30" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (`stat_smooth()`).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (`geom_point()`).</code></pre>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (`geom_smooth()`).</code></pre>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 3 rows containing missing values (`geom_smooth()`).</code></pre>
<p><img src="series_files/figure-html/Plotitng%20the%20agents-2.png" width="672" /></p>
<p>Note that as the n of trials increases, the memory model matches the random model better and better</p>
</div>
<div id="coding-the-multilevel-agents" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Coding the multilevel agents<a href="multilevel-modeling.html#coding-the-multilevel-agents" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="multilevel-random" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Multilevel random<a href="multilevel-modeling.html#multilevel-random" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Remember that the simulated parameters are:
* biasM &lt;- 0
* biasSD &lt;- 0.1
* betaM &lt;- 1.5
* betaSD &lt;- 0.3</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="multilevel-modeling.html#cb127-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="multilevel-modeling.html#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb127-3"><a href="multilevel-modeling.html#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb127-4"><a href="multilevel-modeling.html#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb127-5"><a href="multilevel-modeling.html#cb127-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-6"><a href="multilevel-modeling.html#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data</span></span>
<span id="cb127-7"><a href="multilevel-modeling.html#cb127-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb127-8"><a href="multilevel-modeling.html#cb127-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb127-9"><a href="multilevel-modeling.html#cb127-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb127-10"><a href="multilevel-modeling.html#cb127-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb127-11"><a href="multilevel-modeling.html#cb127-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb127-12"><a href="multilevel-modeling.html#cb127-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-13"><a href="multilevel-modeling.html#cb127-13" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb127-14"><a href="multilevel-modeling.html#cb127-14" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb127-15"><a href="multilevel-modeling.html#cb127-15" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (right and left). Now multilevel</span></span>
<span id="cb127-16"><a href="multilevel-modeling.html#cb127-16" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb127-17"><a href="multilevel-modeling.html#cb127-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-18"><a href="multilevel-modeling.html#cb127-18" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb127-19"><a href="multilevel-modeling.html#cb127-19" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) { // normal distribution with a lower bound</span></span>
<span id="cb127-20"><a href="multilevel-modeling.html#cb127-20" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb127-21"><a href="multilevel-modeling.html#cb127-21" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb127-22"><a href="multilevel-modeling.html#cb127-22" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb127-23"><a href="multilevel-modeling.html#cb127-23" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb127-24"><a href="multilevel-modeling.html#cb127-24" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb127-25"><a href="multilevel-modeling.html#cb127-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-26"><a href="multilevel-modeling.html#cb127-26" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of hands</span></span>
<span id="cb127-27"><a href="multilevel-modeling.html#cb127-27" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb127-28"><a href="multilevel-modeling.html#cb127-28" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb127-29"><a href="multilevel-modeling.html#cb127-29" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb127-30"><a href="multilevel-modeling.html#cb127-30" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb127-31"><a href="multilevel-modeling.html#cb127-31" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb127-32"><a href="multilevel-modeling.html#cb127-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-33"><a href="multilevel-modeling.html#cb127-33" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb127-34"><a href="multilevel-modeling.html#cb127-34" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb127-35"><a href="multilevel-modeling.html#cb127-35" aria-hidden="true" tabindex="-1"></a><span class="st">  real thetaM;</span></span>
<span id="cb127-36"><a href="multilevel-modeling.html#cb127-36" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; thetaSD;</span></span>
<span id="cb127-37"><a href="multilevel-modeling.html#cb127-37" aria-hidden="true" tabindex="-1"></a><span class="st">  array[agents] real theta;</span></span>
<span id="cb127-38"><a href="multilevel-modeling.html#cb127-38" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb127-39"><a href="multilevel-modeling.html#cb127-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-40"><a href="multilevel-modeling.html#cb127-40" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb127-41"><a href="multilevel-modeling.html#cb127-41" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb127-42"><a href="multilevel-modeling.html#cb127-42" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaM | 0, 1);</span></span>
<span id="cb127-43"><a href="multilevel-modeling.html#cb127-43" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(thetaSD | 0, .3)  -</span></span>
<span id="cb127-44"><a href="multilevel-modeling.html#cb127-44" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb127-45"><a href="multilevel-modeling.html#cb127-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-46"><a href="multilevel-modeling.html#cb127-46" aria-hidden="true" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb127-47"><a href="multilevel-modeling.html#cb127-47" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | thetaM, thetaSD); </span></span>
<span id="cb127-48"><a href="multilevel-modeling.html#cb127-48" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb127-49"><a href="multilevel-modeling.html#cb127-49" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:agents)</span></span>
<span id="cb127-50"><a href="multilevel-modeling.html#cb127-50" aria-hidden="true" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[,i] | theta[i]);</span></span>
<span id="cb127-51"><a href="multilevel-modeling.html#cb127-51" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb127-52"><a href="multilevel-modeling.html#cb127-52" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb127-53"><a href="multilevel-modeling.html#cb127-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-54"><a href="multilevel-modeling.html#cb127-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-55"><a href="multilevel-modeling.html#cb127-55" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb127-56"><a href="multilevel-modeling.html#cb127-56" aria-hidden="true" tabindex="-1"></a><span class="st">   real thetaM_prior;</span></span>
<span id="cb127-57"><a href="multilevel-modeling.html#cb127-57" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; thetaSD_prior;</span></span>
<span id="cb127-58"><a href="multilevel-modeling.html#cb127-58" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb127-59"><a href="multilevel-modeling.html#cb127-59" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb127-60"><a href="multilevel-modeling.html#cb127-60" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb127-61"><a href="multilevel-modeling.html#cb127-61" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds;</span></span>
<span id="cb127-62"><a href="multilevel-modeling.html#cb127-62" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds;</span></span>
<span id="cb127-63"><a href="multilevel-modeling.html#cb127-63" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb127-64"><a href="multilevel-modeling.html#cb127-64" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaM_prior = normal_rng(0,1);</span></span>
<span id="cb127-65"><a href="multilevel-modeling.html#cb127-65" aria-hidden="true" tabindex="-1"></a><span class="st">   thetaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb127-66"><a href="multilevel-modeling.html#cb127-66" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_prior = inv_logit(normal_rng(thetaM_prior, thetaSD_prior));</span></span>
<span id="cb127-67"><a href="multilevel-modeling.html#cb127-67" aria-hidden="true" tabindex="-1"></a><span class="st">   theta_posterior = inv_logit(normal_rng(thetaM, thetaSD));</span></span>
<span id="cb127-68"><a href="multilevel-modeling.html#cb127-68" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb127-69"><a href="multilevel-modeling.html#cb127-69" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds = binomial_rng(trials, inv_logit(thetaM_prior));</span></span>
<span id="cb127-70"><a href="multilevel-modeling.html#cb127-70" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds = binomial_rng(trials, inv_logit(thetaM));</span></span>
<span id="cb127-71"><a href="multilevel-modeling.html#cb127-71" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb127-72"><a href="multilevel-modeling.html#cb127-72" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb127-73"><a href="multilevel-modeling.html#cb127-73" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb127-74"><a href="multilevel-modeling.html#cb127-74" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb127-75"><a href="multilevel-modeling.html#cb127-75" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb127-76"><a href="multilevel-modeling.html#cb127-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb127-77"><a href="multilevel-modeling.html#cb127-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelBias.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W5_MultilevelBias.stan&quot;</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="multilevel-modeling.html#cb129-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelBias.stan&quot;</span>)</span>
<span id="cb129-2"><a href="multilevel-modeling.html#cb129-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb129-3"><a href="multilevel-modeling.html#cb129-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb129-4"><a href="multilevel-modeling.html#cb129-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="multilevel-modeling.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb131-2"><a href="multilevel-modeling.html#cb131-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb131-3"><a href="multilevel-modeling.html#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb131-4"><a href="multilevel-modeling.html#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb131-5"><a href="multilevel-modeling.html#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb131-6"><a href="multilevel-modeling.html#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb131-7"><a href="multilevel-modeling.html#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb131-8"><a href="multilevel-modeling.html#cb131-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb131-9"><a href="multilevel-modeling.html#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb131-10"><a href="multilevel-modeling.html#cb131-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb131-11"><a href="multilevel-modeling.html#cb131-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb131-12"><a href="multilevel-modeling.html#cb131-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb131-13"><a href="multilevel-modeling.html#cb131-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 26.2 seconds.
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 26.6 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 26.4 seconds.
## Total execution time: 26.7 seconds.</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="multilevel-modeling.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(samples, <span class="st">&quot;simmodels/W5_MultilevelBias.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-multilevel-random-agents" class="section level3 hasAnchor" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Assessing multilevel random agents<a href="multilevel-modeling.html#assessing-multilevel-random-agents" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Besides the usual prior predictive checks, prior posterior update checks, posterior predictive checks, based on the population level estimates; we also want to plot at least a few of the single agents to assess how well the model is doing for them.</p>
<p>[MISSING: PLOT MODEL ESTIMATES AGAINST N OF HEADS BY PARTICIPANT]</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="multilevel-modeling.html#cb134-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;simmodels/W5_MultilevelBias.RDS&quot;</span>)</span>
<span id="cb134-2"><a href="multilevel-modeling.html#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="multilevel-modeling.html#cb134-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code></pre></div>
<pre><code>## Processing csv files: /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelBias-202303100630-1-257131.csv, /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelBias-202303100630-2-257131.csv
## 
## Checking sampler transitions treedepth.
## Treedepth satisfactory for all transitions.
## 
## Checking sampler transitions for divergences.
## No divergent transitions found.
## 
## Checking E-BFMI - sampler transitions HMC potential energy.
## E-BFMI satisfactory.
## 
## Effective sample size satisfactory.
## 
## Split R-hat values satisfactory all parameters.
## 
## Processing complete, no problems detected.</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="multilevel-modeling.html#cb136-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>() </span></code></pre></div>
<pre><code>## # A tibble: 109 × 10
##    variable       mean     median     sd    mad        q5       q95  rhat ess_bulk ess_tail
##    &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 lp__     -5712.     -5711.     7.46   7.47   -5724.    -5700.     1.00    1413.    2006.
##  2 thetaM       1.51       1.51   0.0701 0.0668     1.40      1.63   1.00    7299.    3214.
##  3 thetaSD      0.652      0.649  0.0523 0.0510     0.571     0.742  1.00    5239.    3674.
##  4 theta[1]     0.991      0.991  0.205  0.198      0.656     1.34   1.00   10872.    2445.
##  5 theta[2]     1.90       1.90   0.254  0.256      1.49      2.33   1.00    8183.    2533.
##  6 theta[3]     0.0511     0.0504 0.183  0.184     -0.258     0.354  1.00   10436.    2730.
##  7 theta[4]     1.56       1.56   0.225  0.225      1.20      1.93   1.00   10039.    2900.
##  8 theta[5]     2.81       2.80   0.344  0.332      2.27      3.40   1.00    8840.    2595.
##  9 theta[6]     2.33       2.33   0.284  0.289      1.87      2.81   1.00    9672.    2889.
## 10 theta[7]     2.17       2.17   0.279  0.283      1.74      2.64   1.00   10034.    2888.
## # … with 99 more rows</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="multilevel-modeling.html#cb138-1" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>()) </span>
<span id="cb138-2"><a href="multilevel-modeling.html#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="multilevel-modeling.html#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, thetaM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb138-4"><a href="multilevel-modeling.html#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb138-5"><a href="multilevel-modeling.html#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-1.png" width="672" /></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="multilevel-modeling.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, thetaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb139-2"><a href="multilevel-modeling.html#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb139-3"><a href="multilevel-modeling.html#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-2.png" width="672" /></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="multilevel-modeling.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb140-2"><a href="multilevel-modeling.html#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(prior_preds), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb140-3"><a href="multilevel-modeling.html#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb140-4"><a href="multilevel-modeling.html#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Prior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb140-5"><a href="multilevel-modeling.html#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-3.png" width="672" /></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="multilevel-modeling.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb142-2"><a href="multilevel-modeling.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(thetaM), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb142-3"><a href="multilevel-modeling.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(thetaM_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb142-4"><a href="multilevel-modeling.html#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1.386</span>) <span class="sc">+</span></span>
<span id="cb142-5"><a href="multilevel-modeling.html#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb142-6"><a href="multilevel-modeling.html#cb142-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb142-7"><a href="multilevel-modeling.html#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-4.png" width="672" /></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="multilevel-modeling.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb143-2"><a href="multilevel-modeling.html#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(thetaSD), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-3"><a href="multilevel-modeling.html#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(thetaSD_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-4"><a href="multilevel-modeling.html#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.65</span>) <span class="sc">+</span></span>
<span id="cb143-5"><a href="multilevel-modeling.html#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variance of Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb143-6"><a href="multilevel-modeling.html#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb143-7"><a href="multilevel-modeling.html#cb143-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-5.png" width="672" /></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="multilevel-modeling.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb144-2"><a href="multilevel-modeling.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(theta_posterior), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb144-3"><a href="multilevel-modeling.html#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(theta_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb144-4"><a href="multilevel-modeling.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Overall Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb144-5"><a href="multilevel-modeling.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb144-6"><a href="multilevel-modeling.html#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-6.png" width="672" /></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="multilevel-modeling.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb145-2"><a href="multilevel-modeling.html#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(prior_preds), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb145-3"><a href="multilevel-modeling.html#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(posterior_preds), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb145-4"><a href="multilevel-modeling.html#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb145-5"><a href="multilevel-modeling.html#cb145-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Predictive Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb145-6"><a href="multilevel-modeling.html#cb145-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20pop%20level%20features%20of%20multilevel%20random%20agents-7.png" width="672" /></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="multilevel-modeling.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb147-2"><a href="multilevel-modeling.html#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[1]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb147-3"><a href="multilevel-modeling.html#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[15]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb147-4"><a href="multilevel-modeling.html#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[21]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb147-5"><a href="multilevel-modeling.html#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[31]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb147-6"><a href="multilevel-modeling.html#cb147-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[41]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb147-7"><a href="multilevel-modeling.html#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[51]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb147-8"><a href="multilevel-modeling.html#cb147-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[61]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb147-9"><a href="multilevel-modeling.html#cb147-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(thetaM_prior)), <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb147-10"><a href="multilevel-modeling.html#cb147-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(theta_prior), <span class="at">fill =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb147-11"><a href="multilevel-modeling.html#cb147-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb147-12"><a href="multilevel-modeling.html#cb147-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb147-13"><a href="multilevel-modeling.html#cb147-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20individual%20level%20features%20of%20multilevel%20random%20agents-1.png" width="672" /></p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="multilevel-modeling.html#cb148-1" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> draws_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb148-2"><a href="multilevel-modeling.html#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds1 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[1]</span><span class="st">`</span>)),</span>
<span id="cb148-3"><a href="multilevel-modeling.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds11 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[11]</span><span class="st">`</span>)),</span>
<span id="cb148-4"><a href="multilevel-modeling.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds21 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[21]</span><span class="st">`</span>)),</span>
<span id="cb148-5"><a href="multilevel-modeling.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds31 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[31]</span><span class="st">`</span>)),</span>
<span id="cb148-6"><a href="multilevel-modeling.html#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds41 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[41]</span><span class="st">`</span>)),</span>
<span id="cb148-7"><a href="multilevel-modeling.html#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds51 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[51]</span><span class="st">`</span>)),</span>
<span id="cb148-8"><a href="multilevel-modeling.html#cb148-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds61 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[61]</span><span class="st">`</span>)),</span>
<span id="cb148-9"><a href="multilevel-modeling.html#cb148-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds71 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[71]</span><span class="st">`</span>)),</span>
<span id="cb148-10"><a href="multilevel-modeling.html#cb148-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds81 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[81]</span><span class="st">`</span>)),</span>
<span id="cb148-11"><a href="multilevel-modeling.html#cb148-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">preds91 =</span> <span class="fu">rbinom</span>(<span class="dv">4000</span>,<span class="dv">120</span>, <span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">theta[91]</span><span class="st">`</span>)),</span>
<span id="cb148-12"><a href="multilevel-modeling.html#cb148-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-13"><a href="multilevel-modeling.html#cb148-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-14"><a href="multilevel-modeling.html#cb148-14" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(agent) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">right =</span> <span class="fu">sum</span>(randomChoice))</span>
<span id="cb148-15"><a href="multilevel-modeling.html#cb148-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-16"><a href="multilevel-modeling.html#cb148-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb148-17"><a href="multilevel-modeling.html#cb148-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(posterior_preds), <span class="at">color =</span> <span class="st">&quot;skyblue1&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb148-18"><a href="multilevel-modeling.html#cb148-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> d2, <span class="fu">aes</span>(right),  <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb148-19"><a href="multilevel-modeling.html#cb148-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb148-20"><a href="multilevel-modeling.html#cb148-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb148-21"><a href="multilevel-modeling.html#cb148-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20individual%20level%20features%20of%20multilevel%20random%20agents-2.png" width="672" /></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="multilevel-modeling.html#cb149-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb149-2"><a href="multilevel-modeling.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(preds1), <span class="at">color =</span> <span class="st">&quot;skyblue1&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb149-3"><a href="multilevel-modeling.html#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="fu">subset</span>(d2, agent <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">$</span>right, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb149-4"><a href="multilevel-modeling.html#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb149-5"><a href="multilevel-modeling.html#cb149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-6"><a href="multilevel-modeling.html#cb149-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb149-7"><a href="multilevel-modeling.html#cb149-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(preds11), <span class="at">color =</span> <span class="st">&quot;skyblue1&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb149-8"><a href="multilevel-modeling.html#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="fu">subset</span>(d2, agent <span class="sc">==</span> <span class="dv">11</span>)<span class="sc">$</span>right, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb149-9"><a href="multilevel-modeling.html#cb149-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb149-10"><a href="multilevel-modeling.html#cb149-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-11"><a href="multilevel-modeling.html#cb149-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb149-12"><a href="multilevel-modeling.html#cb149-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(preds21), <span class="at">color =</span> <span class="st">&quot;skyblue1&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb149-13"><a href="multilevel-modeling.html#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="fu">subset</span>(d2, agent <span class="sc">==</span> <span class="dv">21</span>)<span class="sc">$</span>right, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb149-14"><a href="multilevel-modeling.html#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb149-15"><a href="multilevel-modeling.html#cb149-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-16"><a href="multilevel-modeling.html#cb149-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb149-17"><a href="multilevel-modeling.html#cb149-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20individual%20level%20features%20of%20multilevel%20random%20agents-3.png" width="672" /></p>
</div>
<div id="multilevel-memory" class="section level3 hasAnchor" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> Multilevel memory<a href="multilevel-modeling.html#multilevel-memory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>[MISSING: DAGS]
[MISSING: EXPLAIN NEW STAN CODE]
[MISSING: POP VS IND LEVEL PREDICTIONS]</p>
<p>Prep the data</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="multilevel-modeling.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data </span></span>
<span id="cb150-2"><a href="multilevel-modeling.html#cb150-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb150-3"><a href="multilevel-modeling.html#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb150-4"><a href="multilevel-modeling.html#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb150-5"><a href="multilevel-modeling.html#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb150-6"><a href="multilevel-modeling.html#cb150-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-7"><a href="multilevel-modeling.html#cb150-7" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb150-8"><a href="multilevel-modeling.html#cb150-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb150-9"><a href="multilevel-modeling.html#cb150-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb150-10"><a href="multilevel-modeling.html#cb150-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb150-11"><a href="multilevel-modeling.html#cb150-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-12"><a href="multilevel-modeling.html#cb150-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-13"><a href="multilevel-modeling.html#cb150-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb150-14"><a href="multilevel-modeling.html#cb150-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb150-15"><a href="multilevel-modeling.html#cb150-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb150-16"><a href="multilevel-modeling.html#cb150-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d1[<span class="dv">1</span><span class="sc">:</span><span class="dv">120</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb150-17"><a href="multilevel-modeling.html#cb150-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">120</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb150-18"><a href="multilevel-modeling.html#cb150-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Code, compile and fit the model</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="multilevel-modeling.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># , eval = FALSE</span></span>
<span id="cb151-2"><a href="multilevel-modeling.html#cb151-2" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb151-3"><a href="multilevel-modeling.html#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb151-4"><a href="multilevel-modeling.html#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb151-5"><a href="multilevel-modeling.html#cb151-5" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb151-6"><a href="multilevel-modeling.html#cb151-6" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb151-7"><a href="multilevel-modeling.html#cb151-7" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb151-8"><a href="multilevel-modeling.html#cb151-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb151-9"><a href="multilevel-modeling.html#cb151-9" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb151-10"><a href="multilevel-modeling.html#cb151-10" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb151-11"><a href="multilevel-modeling.html#cb151-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb151-12"><a href="multilevel-modeling.html#cb151-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-13"><a href="multilevel-modeling.html#cb151-13" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb151-14"><a href="multilevel-modeling.html#cb151-14" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb151-15"><a href="multilevel-modeling.html#cb151-15" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb151-16"><a href="multilevel-modeling.html#cb151-16" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb151-17"><a href="multilevel-modeling.html#cb151-17" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb151-18"><a href="multilevel-modeling.html#cb151-18" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb151-19"><a href="multilevel-modeling.html#cb151-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb151-20"><a href="multilevel-modeling.html#cb151-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-21"><a href="multilevel-modeling.html#cb151-21" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb151-22"><a href="multilevel-modeling.html#cb151-22" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb151-23"><a href="multilevel-modeling.html#cb151-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb151-24"><a href="multilevel-modeling.html#cb151-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; biasSD;</span></span>
<span id="cb151-25"><a href="multilevel-modeling.html#cb151-25" aria-hidden="true" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb151-26"><a href="multilevel-modeling.html#cb151-26" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; betaSD;</span></span>
<span id="cb151-27"><a href="multilevel-modeling.html#cb151-27" aria-hidden="true" tabindex="-1"></a><span class="st">  array[agents] real bias;</span></span>
<span id="cb151-28"><a href="multilevel-modeling.html#cb151-28" aria-hidden="true" tabindex="-1"></a><span class="st">  array[agents] real beta;</span></span>
<span id="cb151-29"><a href="multilevel-modeling.html#cb151-29" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb151-30"><a href="multilevel-modeling.html#cb151-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-31"><a href="multilevel-modeling.html#cb151-31" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb151-32"><a href="multilevel-modeling.html#cb151-32" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb151-33"><a href="multilevel-modeling.html#cb151-33" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb151-34"><a href="multilevel-modeling.html#cb151-34" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb151-35"><a href="multilevel-modeling.html#cb151-35" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb151-36"><a href="multilevel-modeling.html#cb151-36" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb151-37"><a href="multilevel-modeling.html#cb151-37" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb151-38"><a href="multilevel-modeling.html#cb151-38" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb151-39"><a href="multilevel-modeling.html#cb151-39" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb151-40"><a href="multilevel-modeling.html#cb151-40" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb151-41"><a href="multilevel-modeling.html#cb151-41" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb151-42"><a href="multilevel-modeling.html#cb151-42" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb151-43"><a href="multilevel-modeling.html#cb151-43" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb151-44"><a href="multilevel-modeling.html#cb151-44" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb151-45"><a href="multilevel-modeling.html#cb151-45" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb151-46"><a href="multilevel-modeling.html#cb151-46" aria-hidden="true" tabindex="-1"></a><span class="st"> }</span></span>
<span id="cb151-47"><a href="multilevel-modeling.html#cb151-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-48"><a href="multilevel-modeling.html#cb151-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-49"><a href="multilevel-modeling.html#cb151-49" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb151-50"><a href="multilevel-modeling.html#cb151-50" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb151-51"><a href="multilevel-modeling.html#cb151-51" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb151-52"><a href="multilevel-modeling.html#cb151-52" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasSD | 0, .3)  -</span></span>
<span id="cb151-53"><a href="multilevel-modeling.html#cb151-53" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb151-54"><a href="multilevel-modeling.html#cb151-54" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb151-55"><a href="multilevel-modeling.html#cb151-55" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaSD | 0, .3)  -</span></span>
<span id="cb151-56"><a href="multilevel-modeling.html#cb151-56" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb151-57"><a href="multilevel-modeling.html#cb151-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-58"><a href="multilevel-modeling.html#cb151-58" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | biasM, biasSD); </span></span>
<span id="cb151-59"><a href="multilevel-modeling.html#cb151-59" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(beta | betaM, betaSD); </span></span>
<span id="cb151-60"><a href="multilevel-modeling.html#cb151-60" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb151-61"><a href="multilevel-modeling.html#cb151-61" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents)</span></span>
<span id="cb151-62"><a href="multilevel-modeling.html#cb151-62" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb151-63"><a href="multilevel-modeling.html#cb151-63" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial,agent] | </span></span>
<span id="cb151-64"><a href="multilevel-modeling.html#cb151-64" aria-hidden="true" tabindex="-1"></a><span class="st">            bias[agent] +  logit(memory[trial, agent]) * (beta[agent]));</span></span>
<span id="cb151-65"><a href="multilevel-modeling.html#cb151-65" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb151-66"><a href="multilevel-modeling.html#cb151-66" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb151-67"><a href="multilevel-modeling.html#cb151-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-68"><a href="multilevel-modeling.html#cb151-68" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb151-69"><a href="multilevel-modeling.html#cb151-69" aria-hidden="true" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb151-70"><a href="multilevel-modeling.html#cb151-70" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb151-71"><a href="multilevel-modeling.html#cb151-71" aria-hidden="true" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb151-72"><a href="multilevel-modeling.html#cb151-72" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb151-73"><a href="multilevel-modeling.html#cb151-73" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb151-74"><a href="multilevel-modeling.html#cb151-74" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb151-75"><a href="multilevel-modeling.html#cb151-75" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb151-76"><a href="multilevel-modeling.html#cb151-76" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb151-77"><a href="multilevel-modeling.html#cb151-77" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb151-78"><a href="multilevel-modeling.html#cb151-78" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb151-79"><a href="multilevel-modeling.html#cb151-79" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb151-80"><a href="multilevel-modeling.html#cb151-80" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb151-81"><a href="multilevel-modeling.html#cb151-81" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb151-82"><a href="multilevel-modeling.html#cb151-82" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb151-83"><a href="multilevel-modeling.html#cb151-83" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_predsID0;</span></span>
<span id="cb151-84"><a href="multilevel-modeling.html#cb151-84" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_predsID1;</span></span>
<span id="cb151-85"><a href="multilevel-modeling.html#cb151-85" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_predsID2;</span></span>
<span id="cb151-86"><a href="multilevel-modeling.html#cb151-86" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb151-87"><a href="multilevel-modeling.html#cb151-87" aria-hidden="true" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb151-88"><a href="multilevel-modeling.html#cb151-88" aria-hidden="true" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb151-89"><a href="multilevel-modeling.html#cb151-89" aria-hidden="true" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb151-90"><a href="multilevel-modeling.html#cb151-90" aria-hidden="true" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb151-91"><a href="multilevel-modeling.html#cb151-91" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb151-92"><a href="multilevel-modeling.html#cb151-92" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb151-93"><a href="multilevel-modeling.html#cb151-93" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb151-94"><a href="multilevel-modeling.html#cb151-94" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb151-95"><a href="multilevel-modeling.html#cb151-95" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds0 = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb151-96"><a href="multilevel-modeling.html#cb151-96" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds1 = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb151-97"><a href="multilevel-modeling.html#cb151-97" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds2 = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb151-98"><a href="multilevel-modeling.html#cb151-98" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds0 = binomial_rng(trials, inv_logit(biasM + 0 * betaM));</span></span>
<span id="cb151-99"><a href="multilevel-modeling.html#cb151-99" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds1 = binomial_rng(trials, inv_logit(biasM + 1 * betaM));</span></span>
<span id="cb151-100"><a href="multilevel-modeling.html#cb151-100" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds2 = binomial_rng(trials, inv_logit(biasM + 2 * betaM));</span></span>
<span id="cb151-101"><a href="multilevel-modeling.html#cb151-101" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb151-102"><a href="multilevel-modeling.html#cb151-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-103"><a href="multilevel-modeling.html#cb151-103" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb151-104"><a href="multilevel-modeling.html#cb151-104" aria-hidden="true" tabindex="-1"></a><span class="st">    posterior_predsID0[agent] = binomial_rng(trials, inv_logit(bias[agent] +  0 * beta[agent]));</span></span>
<span id="cb151-105"><a href="multilevel-modeling.html#cb151-105" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_predsID1[agent] = binomial_rng(trials, inv_logit(bias[agent] +  1 * beta[agent]));</span></span>
<span id="cb151-106"><a href="multilevel-modeling.html#cb151-106" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_predsID2[agent] = binomial_rng(trials, inv_logit(bias[agent] +  2 * beta[agent]));</span></span>
<span id="cb151-107"><a href="multilevel-modeling.html#cb151-107" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb151-108"><a href="multilevel-modeling.html#cb151-108" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb151-109"><a href="multilevel-modeling.html#cb151-109" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb151-110"><a href="multilevel-modeling.html#cb151-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-111"><a href="multilevel-modeling.html#cb151-111" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb151-112"><a href="multilevel-modeling.html#cb151-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-113"><a href="multilevel-modeling.html#cb151-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-114"><a href="multilevel-modeling.html#cb151-114" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb151-115"><a href="multilevel-modeling.html#cb151-115" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb151-116"><a href="multilevel-modeling.html#cb151-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb151-117"><a href="multilevel-modeling.html#cb151-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelMemory.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W5_MultilevelMemory.stan&quot;</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="multilevel-modeling.html#cb153-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelMemory.stan&quot;</span>)</span>
<span id="cb153-2"><a href="multilevel-modeling.html#cb153-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb153-3"><a href="multilevel-modeling.html#cb153-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb153-4"><a href="multilevel-modeling.html#cb153-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="multilevel-modeling.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb155-2"><a href="multilevel-modeling.html#cb155-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb155-3"><a href="multilevel-modeling.html#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb155-4"><a href="multilevel-modeling.html#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb155-5"><a href="multilevel-modeling.html#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb155-6"><a href="multilevel-modeling.html#cb155-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb155-7"><a href="multilevel-modeling.html#cb155-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb155-8"><a href="multilevel-modeling.html#cb155-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb155-9"><a href="multilevel-modeling.html#cb155-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb155-10"><a href="multilevel-modeling.html#cb155-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb155-11"><a href="multilevel-modeling.html#cb155-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb155-12"><a href="multilevel-modeling.html#cb155-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb155-13"><a href="multilevel-modeling.html#cb155-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup)</code></pre>
<pre><code>## Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
<pre><code>## Chain 2 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in &#39;/var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/model-1144c7271c712.stan&#39;, line 57, column 2 to column 46)</code></pre>
<pre><code>## Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
<pre><code>## Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
<pre><code>## Chain 2</code></pre>
<pre><code>## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 541.2 seconds.
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 607.2 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 574.2 seconds.
## Total execution time: 607.4 seconds.</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="multilevel-modeling.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(samples, <span class="st">&quot;simmodels/W5_MultilevelMemory_centered.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-multilevel-memory" class="section level3 hasAnchor" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> Assessing multilevel memory<a href="multilevel-modeling.html#assessing-multilevel-memory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="multilevel-modeling.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># samples &lt;- readRDS(&quot;simmodels/W5_MultilevelMemory_centered.RDS&quot;)</span></span>
<span id="cb164-2"><a href="multilevel-modeling.html#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="multilevel-modeling.html#cb164-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code></pre></div>
<pre><code>## Processing csv files: /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory-202303100631-1-200181.csv, /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory-202303100631-2-200181.csv
## 
## Checking sampler transitions treedepth.
## Treedepth satisfactory for all transitions.
## 
## Checking sampler transitions for divergences.
## No divergent transitions found.
## 
## Checking E-BFMI - sampler transitions HMC potential energy.
## E-BFMI satisfactory.
## 
## Effective sample size satisfactory.
## 
## Split R-hat values satisfactory all parameters.
## 
## Processing complete, no problems detected.</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="multilevel-modeling.html#cb166-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;biasM&quot;</span>, <span class="st">&quot;betaM&quot;</span>, <span class="st">&quot;biasSD&quot;</span>, <span class="st">&quot;betaSD&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4 × 10
##   variable  mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 biasM    0.804  0.803 0.0947 0.0940 0.652 0.961  1.00     364.     684.
## 2 betaM    0.838  0.837 0.0636 0.0634 0.734 0.944  1.00     425.     657.
## 3 biasSD   0.375  0.374 0.0685 0.0668 0.262 0.487  1.00     439.     699.
## 4 betaSD   0.310  0.309 0.0500 0.0483 0.230 0.395  1.00     731.     844.</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="multilevel-modeling.html#cb168-1" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>()) </span>
<span id="cb168-2"><a href="multilevel-modeling.html#cb168-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-3"><a href="multilevel-modeling.html#cb168-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, biasM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb168-4"><a href="multilevel-modeling.html#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb168-5"><a href="multilevel-modeling.html#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb168-6"><a href="multilevel-modeling.html#cb168-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-7"><a href="multilevel-modeling.html#cb168-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, biasSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb168-8"><a href="multilevel-modeling.html#cb168-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb168-9"><a href="multilevel-modeling.html#cb168-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb168-10"><a href="multilevel-modeling.html#cb168-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-11"><a href="multilevel-modeling.html#cb168-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, betaM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb168-12"><a href="multilevel-modeling.html#cb168-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb168-13"><a href="multilevel-modeling.html#cb168-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb168-14"><a href="multilevel-modeling.html#cb168-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-15"><a href="multilevel-modeling.html#cb168-15" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb168-16"><a href="multilevel-modeling.html#cb168-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb168-17"><a href="multilevel-modeling.html#cb168-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb168-18"><a href="multilevel-modeling.html#cb168-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-19"><a href="multilevel-modeling.html#cb168-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20centered:%20markov%20chains-1.png" width="672" /></p>
<div id="predictive-prior-checks" class="section level4 hasAnchor" number="6.5.4.1">
<h4><span class="header-section-number">6.5.4.1</span> Predictive prior checks<a href="multilevel-modeling.html#predictive-prior-checks" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="multilevel-modeling.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb169-2"><a href="multilevel-modeling.html#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb169-3"><a href="multilevel-modeling.html#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds0</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb169-4"><a href="multilevel-modeling.html#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds1</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb169-5"><a href="multilevel-modeling.html#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds2</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb169-6"><a href="multilevel-modeling.html#cb169-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb169-7"><a href="multilevel-modeling.html#cb169-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb169-8"><a href="multilevel-modeling.html#cb169-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20centered:%20prior%20checks-1.png" width="672" /></p>
</div>
<div id="prior-posterior-update-checks" class="section level4 hasAnchor" number="6.5.4.2">
<h4><span class="header-section-number">6.5.4.2</span> Prior posterior update checks<a href="multilevel-modeling.html#prior-posterior-update-checks" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>biasM &lt;- 0
biasSD &lt;- 0.1
betaM &lt;- 1.5
betaSD &lt;- 0.3</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="multilevel-modeling.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb171-2"><a href="multilevel-modeling.html#cb171-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb171-3"><a href="multilevel-modeling.html#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasM), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb171-4"><a href="multilevel-modeling.html#cb171-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasM_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb171-5"><a href="multilevel-modeling.html#cb171-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb171-6"><a href="multilevel-modeling.html#cb171-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean bias&quot;</span>) <span class="sc">+</span></span>
<span id="cb171-7"><a href="multilevel-modeling.html#cb171-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb171-8"><a href="multilevel-modeling.html#cb171-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb171-9"><a href="multilevel-modeling.html#cb171-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-10"><a href="multilevel-modeling.html#cb171-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb171-11"><a href="multilevel-modeling.html#cb171-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasSD), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb171-12"><a href="multilevel-modeling.html#cb171-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasSD_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb171-13"><a href="multilevel-modeling.html#cb171-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb171-14"><a href="multilevel-modeling.html#cb171-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variance of bias&quot;</span>) <span class="sc">+</span></span>
<span id="cb171-15"><a href="multilevel-modeling.html#cb171-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb171-16"><a href="multilevel-modeling.html#cb171-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb171-17"><a href="multilevel-modeling.html#cb171-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-18"><a href="multilevel-modeling.html#cb171-18" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb171-19"><a href="multilevel-modeling.html#cb171-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaM), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb171-20"><a href="multilevel-modeling.html#cb171-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaM_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb171-21"><a href="multilevel-modeling.html#cb171-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb171-22"><a href="multilevel-modeling.html#cb171-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean Beta&quot;</span>) <span class="sc">+</span></span>
<span id="cb171-23"><a href="multilevel-modeling.html#cb171-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb171-24"><a href="multilevel-modeling.html#cb171-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb171-25"><a href="multilevel-modeling.html#cb171-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-26"><a href="multilevel-modeling.html#cb171-26" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb171-27"><a href="multilevel-modeling.html#cb171-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaSD), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb171-28"><a href="multilevel-modeling.html#cb171-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaSD_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb171-29"><a href="multilevel-modeling.html#cb171-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb171-30"><a href="multilevel-modeling.html#cb171-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variance of beta&quot;</span>) <span class="sc">+</span></span>
<span id="cb171-31"><a href="multilevel-modeling.html#cb171-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb171-32"><a href="multilevel-modeling.html#cb171-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb171-33"><a href="multilevel-modeling.html#cb171-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-34"><a href="multilevel-modeling.html#cb171-34" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 </span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20centered:%20prior%20posterior%20update%20checks-1.png" width="672" /></p>
</div>
<div id="posterior-predictive-checks" class="section level4 hasAnchor" number="6.5.4.3">
<h4><span class="header-section-number">6.5.4.3</span> Posterior predictive checks<a href="multilevel-modeling.html#posterior-predictive-checks" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="multilevel-modeling.html#cb172-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb172-2"><a href="multilevel-modeling.html#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds0</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-3"><a href="multilevel-modeling.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds0</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-4"><a href="multilevel-modeling.html#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb172-5"><a href="multilevel-modeling.html#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb172-6"><a href="multilevel-modeling.html#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb172-7"><a href="multilevel-modeling.html#cb172-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-8"><a href="multilevel-modeling.html#cb172-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb172-9"><a href="multilevel-modeling.html#cb172-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds1</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-10"><a href="multilevel-modeling.html#cb172-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds1</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-11"><a href="multilevel-modeling.html#cb172-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb172-12"><a href="multilevel-modeling.html#cb172-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb172-13"><a href="multilevel-modeling.html#cb172-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb172-14"><a href="multilevel-modeling.html#cb172-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-15"><a href="multilevel-modeling.html#cb172-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb172-16"><a href="multilevel-modeling.html#cb172-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds2</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-17"><a href="multilevel-modeling.html#cb172-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds2</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb172-18"><a href="multilevel-modeling.html#cb172-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb172-19"><a href="multilevel-modeling.html#cb172-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb172-20"><a href="multilevel-modeling.html#cb172-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb172-21"><a href="multilevel-modeling.html#cb172-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-22"><a href="multilevel-modeling.html#cb172-22" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20centered:%20posterior%20predictive%20checks-1.png" width="672" /></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="multilevel-modeling.html#cb174-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasM, biasSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb174-2"><a href="multilevel-modeling.html#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb174-3"><a href="multilevel-modeling.html#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb174-4"><a href="multilevel-modeling.html#cb174-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(betaM, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb174-5"><a href="multilevel-modeling.html#cb174-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb174-6"><a href="multilevel-modeling.html#cb174-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb174-7"><a href="multilevel-modeling.html#cb174-7" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasM, betaM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb174-8"><a href="multilevel-modeling.html#cb174-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb174-9"><a href="multilevel-modeling.html#cb174-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb174-10"><a href="multilevel-modeling.html#cb174-10" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasSD, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb174-11"><a href="multilevel-modeling.html#cb174-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb174-12"><a href="multilevel-modeling.html#cb174-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb174-13"><a href="multilevel-modeling.html#cb174-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-14"><a href="multilevel-modeling.html#cb174-14" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20centered:%20posterior%20predictive%20checks-2.png" width="672" /></p>
</div>
</div>
<div id="multilevel-memory-with-non-centered-parameterization" class="section level3 hasAnchor" number="6.5.5">
<h3><span class="header-section-number">6.5.5</span> Multilevel memory with non centered parameterization<a href="multilevel-modeling.html#multilevel-memory-with-non-centered-parameterization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Prep the data</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="multilevel-modeling.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data </span></span>
<span id="cb175-2"><a href="multilevel-modeling.html#cb175-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb175-3"><a href="multilevel-modeling.html#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, memoryChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-4"><a href="multilevel-modeling.html#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb175-5"><a href="multilevel-modeling.html#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> memoryChoice)</span>
<span id="cb175-6"><a href="multilevel-modeling.html#cb175-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-7"><a href="multilevel-modeling.html#cb175-7" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb175-8"><a href="multilevel-modeling.html#cb175-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(agent, randomChoice)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-9"><a href="multilevel-modeling.html#cb175-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb175-10"><a href="multilevel-modeling.html#cb175-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agent, <span class="at">values_from =</span> randomChoice)</span>
<span id="cb175-11"><a href="multilevel-modeling.html#cb175-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-12"><a href="multilevel-modeling.html#cb175-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-13"><a href="multilevel-modeling.html#cb175-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb175-14"><a href="multilevel-modeling.html#cb175-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">trials =</span> trials,</span>
<span id="cb175-15"><a href="multilevel-modeling.html#cb175-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">agents =</span> agents,</span>
<span id="cb175-16"><a href="multilevel-modeling.html#cb175-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">as.matrix</span>(d1[<span class="dv">1</span><span class="sc">:</span><span class="dv">120</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>]),</span>
<span id="cb175-17"><a href="multilevel-modeling.html#cb175-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">other =</span> <span class="fu">as.matrix</span>(d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">120</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">101</span>])</span>
<span id="cb175-18"><a href="multilevel-modeling.html#cb175-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Code, compile and and fit the model</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="multilevel-modeling.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># , eval = FALSE</span></span>
<span id="cb176-2"><a href="multilevel-modeling.html#cb176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-3"><a href="multilevel-modeling.html#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="do">## NON-CENTERED PARAMETRIZATION</span></span>
<span id="cb176-4"><a href="multilevel-modeling.html#cb176-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-5"><a href="multilevel-modeling.html#cb176-5" aria-hidden="true" tabindex="-1"></a>stan_model_nc <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb176-6"><a href="multilevel-modeling.html#cb176-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-7"><a href="multilevel-modeling.html#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb176-8"><a href="multilevel-modeling.html#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model is a multilevel memory agent</span></span>
<span id="cb176-9"><a href="multilevel-modeling.html#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb176-10"><a href="multilevel-modeling.html#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb176-11"><a href="multilevel-modeling.html#cb176-11" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb176-12"><a href="multilevel-modeling.html#cb176-12" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb176-13"><a href="multilevel-modeling.html#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb176-14"><a href="multilevel-modeling.html#cb176-14" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb176-15"><a href="multilevel-modeling.html#cb176-15" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb176-16"><a href="multilevel-modeling.html#cb176-16" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb176-17"><a href="multilevel-modeling.html#cb176-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-18"><a href="multilevel-modeling.html#cb176-18" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb176-19"><a href="multilevel-modeling.html#cb176-19" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb176-20"><a href="multilevel-modeling.html#cb176-20" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb176-21"><a href="multilevel-modeling.html#cb176-21" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb176-22"><a href="multilevel-modeling.html#cb176-22" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb176-23"><a href="multilevel-modeling.html#cb176-23" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb176-24"><a href="multilevel-modeling.html#cb176-24" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb176-25"><a href="multilevel-modeling.html#cb176-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-26"><a href="multilevel-modeling.html#cb176-26" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb176-27"><a href="multilevel-modeling.html#cb176-27" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb176-28"><a href="multilevel-modeling.html#cb176-28" aria-hidden="true" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb176-29"><a href="multilevel-modeling.html#cb176-29" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; biasSD;</span></span>
<span id="cb176-30"><a href="multilevel-modeling.html#cb176-30" aria-hidden="true" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb176-31"><a href="multilevel-modeling.html#cb176-31" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; betaSD;</span></span>
<span id="cb176-32"><a href="multilevel-modeling.html#cb176-32" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[agents] biasID_z;</span></span>
<span id="cb176-33"><a href="multilevel-modeling.html#cb176-33" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[agents] betaID_z;</span></span>
<span id="cb176-34"><a href="multilevel-modeling.html#cb176-34" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb176-35"><a href="multilevel-modeling.html#cb176-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-36"><a href="multilevel-modeling.html#cb176-36" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb176-37"><a href="multilevel-modeling.html#cb176-37" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb176-38"><a href="multilevel-modeling.html#cb176-38" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[agents] biasID;</span></span>
<span id="cb176-39"><a href="multilevel-modeling.html#cb176-39" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[agents] betaID;</span></span>
<span id="cb176-40"><a href="multilevel-modeling.html#cb176-40" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb176-41"><a href="multilevel-modeling.html#cb176-41" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb176-42"><a href="multilevel-modeling.html#cb176-42" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb176-43"><a href="multilevel-modeling.html#cb176-43" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb176-44"><a href="multilevel-modeling.html#cb176-44" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb176-45"><a href="multilevel-modeling.html#cb176-45" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb176-46"><a href="multilevel-modeling.html#cb176-46" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb176-47"><a href="multilevel-modeling.html#cb176-47" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb176-48"><a href="multilevel-modeling.html#cb176-48" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb176-49"><a href="multilevel-modeling.html#cb176-49" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb176-50"><a href="multilevel-modeling.html#cb176-50" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb176-51"><a href="multilevel-modeling.html#cb176-51" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb176-52"><a href="multilevel-modeling.html#cb176-52" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb176-53"><a href="multilevel-modeling.html#cb176-53" aria-hidden="true" tabindex="-1"></a><span class="st">  biasID = biasID_z * biasSD;</span></span>
<span id="cb176-54"><a href="multilevel-modeling.html#cb176-54" aria-hidden="true" tabindex="-1"></a><span class="st">  betaID = betaID_z * betaSD;</span></span>
<span id="cb176-55"><a href="multilevel-modeling.html#cb176-55" aria-hidden="true" tabindex="-1"></a><span class="st"> }</span></span>
<span id="cb176-56"><a href="multilevel-modeling.html#cb176-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-57"><a href="multilevel-modeling.html#cb176-57" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb176-58"><a href="multilevel-modeling.html#cb176-58" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb176-59"><a href="multilevel-modeling.html#cb176-59" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb176-60"><a href="multilevel-modeling.html#cb176-60" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasSD | 0, .3)  -</span></span>
<span id="cb176-61"><a href="multilevel-modeling.html#cb176-61" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb176-62"><a href="multilevel-modeling.html#cb176-62" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb176-63"><a href="multilevel-modeling.html#cb176-63" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaSD | 0, .3)  -</span></span>
<span id="cb176-64"><a href="multilevel-modeling.html#cb176-64" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb176-65"><a href="multilevel-modeling.html#cb176-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-66"><a href="multilevel-modeling.html#cb176-66" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(biasID_z)); // target += normal_lpdf(to_vector(biasID_z) | 0, 1);</span></span>
<span id="cb176-67"><a href="multilevel-modeling.html#cb176-67" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(betaID_z)); // target += normal_lpdf(to_vector(betaID_z) | 0, 1);</span></span>
<span id="cb176-68"><a href="multilevel-modeling.html#cb176-68" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb176-69"><a href="multilevel-modeling.html#cb176-69" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb176-70"><a href="multilevel-modeling.html#cb176-70" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb176-71"><a href="multilevel-modeling.html#cb176-71" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial,agent] | </span></span>
<span id="cb176-72"><a href="multilevel-modeling.html#cb176-72" aria-hidden="true" tabindex="-1"></a><span class="st">            biasM + biasID[agent] +  logit(memory[trial, agent]) * (betaM + betaID[agent]));</span></span>
<span id="cb176-73"><a href="multilevel-modeling.html#cb176-73" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb176-74"><a href="multilevel-modeling.html#cb176-74" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb176-75"><a href="multilevel-modeling.html#cb176-75" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb176-76"><a href="multilevel-modeling.html#cb176-76" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb176-77"><a href="multilevel-modeling.html#cb176-77" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb176-78"><a href="multilevel-modeling.html#cb176-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-79"><a href="multilevel-modeling.html#cb176-79" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb176-80"><a href="multilevel-modeling.html#cb176-80" aria-hidden="true" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb176-81"><a href="multilevel-modeling.html#cb176-81" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb176-82"><a href="multilevel-modeling.html#cb176-82" aria-hidden="true" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb176-83"><a href="multilevel-modeling.html#cb176-83" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb176-84"><a href="multilevel-modeling.html#cb176-84" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb176-85"><a href="multilevel-modeling.html#cb176-85" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb176-86"><a href="multilevel-modeling.html#cb176-86" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb176-87"><a href="multilevel-modeling.html#cb176-87" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb176-88"><a href="multilevel-modeling.html#cb176-88" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb176-89"><a href="multilevel-modeling.html#cb176-89" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb176-90"><a href="multilevel-modeling.html#cb176-90" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb176-91"><a href="multilevel-modeling.html#cb176-91" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb176-92"><a href="multilevel-modeling.html#cb176-92" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb176-93"><a href="multilevel-modeling.html#cb176-93" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb176-94"><a href="multilevel-modeling.html#cb176-94" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb176-95"><a href="multilevel-modeling.html#cb176-95" aria-hidden="true" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb176-96"><a href="multilevel-modeling.html#cb176-96" aria-hidden="true" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb176-97"><a href="multilevel-modeling.html#cb176-97" aria-hidden="true" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb176-98"><a href="multilevel-modeling.html#cb176-98" aria-hidden="true" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb176-99"><a href="multilevel-modeling.html#cb176-99" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb176-100"><a href="multilevel-modeling.html#cb176-100" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb176-101"><a href="multilevel-modeling.html#cb176-101" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb176-102"><a href="multilevel-modeling.html#cb176-102" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb176-103"><a href="multilevel-modeling.html#cb176-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-104"><a href="multilevel-modeling.html#cb176-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-105"><a href="multilevel-modeling.html#cb176-105" aria-hidden="true" tabindex="-1"></a><span class="st">for (agent in 1:agents){</span></span>
<span id="cb176-106"><a href="multilevel-modeling.html#cb176-106" aria-hidden="true" tabindex="-1"></a><span class="st">    prior_preds0[agent] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb176-107"><a href="multilevel-modeling.html#cb176-107" aria-hidden="true" tabindex="-1"></a><span class="st">    prior_preds1[agent] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb176-108"><a href="multilevel-modeling.html#cb176-108" aria-hidden="true" tabindex="-1"></a><span class="st">    prior_preds2[agent] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb176-109"><a href="multilevel-modeling.html#cb176-109" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds0[agent] = binomial_rng(trials, inv_logit(biasM + biasID[agent] +  0 * (betaM + betaID[agent])));</span></span>
<span id="cb176-110"><a href="multilevel-modeling.html#cb176-110" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds1[agent] = binomial_rng(trials, inv_logit(biasM + biasID[agent] +  1 * (betaM + betaID[agent])));</span></span>
<span id="cb176-111"><a href="multilevel-modeling.html#cb176-111" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds2[agent] = binomial_rng(trials, inv_logit(biasM + biasID[agent] +  2 * (betaM + betaID[agent])));</span></span>
<span id="cb176-112"><a href="multilevel-modeling.html#cb176-112" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb176-113"><a href="multilevel-modeling.html#cb176-113" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb176-114"><a href="multilevel-modeling.html#cb176-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-115"><a href="multilevel-modeling.html#cb176-115" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb176-116"><a href="multilevel-modeling.html#cb176-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-117"><a href="multilevel-modeling.html#cb176-117" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb176-118"><a href="multilevel-modeling.html#cb176-118" aria-hidden="true" tabindex="-1"></a>  stan_model_nc,</span>
<span id="cb176-119"><a href="multilevel-modeling.html#cb176-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb176-120"><a href="multilevel-modeling.html#cb176-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelMemory_nc.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W5_MultilevelMemory_nc.stan&quot;</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="multilevel-modeling.html#cb178-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelMemory_nc.stan&quot;</span>)</span>
<span id="cb178-2"><a href="multilevel-modeling.html#cb178-2" aria-hidden="true" tabindex="-1"></a>mod_nc <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb178-3"><a href="multilevel-modeling.html#cb178-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb178-4"><a href="multilevel-modeling.html#cb178-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="multilevel-modeling.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb180-2"><a href="multilevel-modeling.html#cb180-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod_nc<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb180-3"><a href="multilevel-modeling.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb180-4"><a href="multilevel-modeling.html#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb180-5"><a href="multilevel-modeling.html#cb180-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb180-6"><a href="multilevel-modeling.html#cb180-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb180-7"><a href="multilevel-modeling.html#cb180-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb180-8"><a href="multilevel-modeling.html#cb180-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb180-9"><a href="multilevel-modeling.html#cb180-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb180-10"><a href="multilevel-modeling.html#cb180-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb180-11"><a href="multilevel-modeling.html#cb180-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb180-12"><a href="multilevel-modeling.html#cb180-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb180-13"><a href="multilevel-modeling.html#cb180-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 783.5 seconds.
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 907.9 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 845.7 seconds.
## Total execution time: 908.1 seconds.</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="multilevel-modeling.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(samples, <span class="st">&quot;simmodels/W5_MultilevelMemory_noncentered.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-multilevel-memory-1" class="section level3 hasAnchor" number="6.5.6">
<h3><span class="header-section-number">6.5.6</span> Assessing multilevel memory<a href="multilevel-modeling.html#assessing-multilevel-memory-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="multilevel-modeling.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># samples &lt;- readRDS(&quot;simmodels/W5_MultilevelMemory_noncentered.RDS&quot;)</span></span>
<span id="cb183-2"><a href="multilevel-modeling.html#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="multilevel-modeling.html#cb183-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code></pre></div>
<pre><code>## Processing csv files: /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory_nc-202303100642-1-5efb19.csv, /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory_nc-202303100642-2-5efb19.csv
## 
## Checking sampler transitions treedepth.
## Treedepth satisfactory for all transitions.
## 
## Checking sampler transitions for divergences.
## No divergent transitions found.
## 
## Checking E-BFMI - sampler transitions HMC potential energy.
## E-BFMI satisfactory.
## 
## Effective sample size satisfactory.
## 
## Split R-hat values satisfactory all parameters.
## 
## Processing complete, no problems detected.</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="multilevel-modeling.html#cb185-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;biasM&quot;</span>, <span class="st">&quot;betaM&quot;</span>, <span class="st">&quot;biasSD&quot;</span>, <span class="st">&quot;betaSD&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4 × 10
##   variable  mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 biasM    0.793  0.791 0.0961 0.0940 0.635 0.954  1.00    1640.    2385.
## 2 betaM    0.845  0.844 0.0639 0.0652 0.740 0.950  1.00    2076.    2676.
## 3 biasSD   0.367  0.367 0.0663 0.0644 0.262 0.476  1.00     959.    1591.
## 4 betaSD   0.312  0.311 0.0503 0.0488 0.230 0.395  1.01    1202.    1334.</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="multilevel-modeling.html#cb187-1" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>()) </span>
<span id="cb187-2"><a href="multilevel-modeling.html#cb187-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-3"><a href="multilevel-modeling.html#cb187-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, biasM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb187-4"><a href="multilevel-modeling.html#cb187-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb187-5"><a href="multilevel-modeling.html#cb187-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb187-6"><a href="multilevel-modeling.html#cb187-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-7"><a href="multilevel-modeling.html#cb187-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, biasSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb187-8"><a href="multilevel-modeling.html#cb187-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb187-9"><a href="multilevel-modeling.html#cb187-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb187-10"><a href="multilevel-modeling.html#cb187-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-11"><a href="multilevel-modeling.html#cb187-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, betaM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb187-12"><a href="multilevel-modeling.html#cb187-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb187-13"><a href="multilevel-modeling.html#cb187-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb187-14"><a href="multilevel-modeling.html#cb187-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-15"><a href="multilevel-modeling.html#cb187-15" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(.iteration, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb187-16"><a href="multilevel-modeling.html#cb187-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb187-17"><a href="multilevel-modeling.html#cb187-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb187-18"><a href="multilevel-modeling.html#cb187-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-19"><a href="multilevel-modeling.html#cb187-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20markov%20chains-1.png" width="672" /></p>
<div id="predictive-prior-checks-1" class="section level4 hasAnchor" number="6.5.6.1">
<h4><span class="header-section-number">6.5.6.1</span> Predictive prior checks<a href="multilevel-modeling.html#predictive-prior-checks-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="multilevel-modeling.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb188-2"><a href="multilevel-modeling.html#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb188-3"><a href="multilevel-modeling.html#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds0[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb188-4"><a href="multilevel-modeling.html#cb188-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds1[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb188-5"><a href="multilevel-modeling.html#cb188-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds2[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb188-6"><a href="multilevel-modeling.html#cb188-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb188-7"><a href="multilevel-modeling.html#cb188-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb188-8"><a href="multilevel-modeling.html#cb188-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20prior%20checks-1.png" width="672" /></p>
</div>
<div id="prior-posterior-update-checks-1" class="section level4 hasAnchor" number="6.5.6.2">
<h4><span class="header-section-number">6.5.6.2</span> Prior posterior update checks<a href="multilevel-modeling.html#prior-posterior-update-checks-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>biasM &lt;- 0
biasSD &lt;- 0.1
betaM &lt;- 1.5
betaSD &lt;- 0.3</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="multilevel-modeling.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb190-2"><a href="multilevel-modeling.html#cb190-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb190-3"><a href="multilevel-modeling.html#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">logit_scaled</span>(biasM)), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb190-4"><a href="multilevel-modeling.html#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasM_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb190-5"><a href="multilevel-modeling.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb190-6"><a href="multilevel-modeling.html#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean bias&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-7"><a href="multilevel-modeling.html#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-8"><a href="multilevel-modeling.html#cb190-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb190-9"><a href="multilevel-modeling.html#cb190-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-10"><a href="multilevel-modeling.html#cb190-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb190-11"><a href="multilevel-modeling.html#cb190-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasSD), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb190-12"><a href="multilevel-modeling.html#cb190-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(biasSD_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb190-13"><a href="multilevel-modeling.html#cb190-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb190-14"><a href="multilevel-modeling.html#cb190-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variance of bias&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-15"><a href="multilevel-modeling.html#cb190-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-16"><a href="multilevel-modeling.html#cb190-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb190-17"><a href="multilevel-modeling.html#cb190-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-18"><a href="multilevel-modeling.html#cb190-18" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb190-19"><a href="multilevel-modeling.html#cb190-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaM), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb190-20"><a href="multilevel-modeling.html#cb190-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaM_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb190-21"><a href="multilevel-modeling.html#cb190-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb190-22"><a href="multilevel-modeling.html#cb190-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Mean Beta&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-23"><a href="multilevel-modeling.html#cb190-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-24"><a href="multilevel-modeling.html#cb190-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb190-25"><a href="multilevel-modeling.html#cb190-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-26"><a href="multilevel-modeling.html#cb190-26" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb190-27"><a href="multilevel-modeling.html#cb190-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaSD), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb190-28"><a href="multilevel-modeling.html#cb190-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(betaSD_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb190-29"><a href="multilevel-modeling.html#cb190-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb190-30"><a href="multilevel-modeling.html#cb190-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variance of beta&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-31"><a href="multilevel-modeling.html#cb190-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-32"><a href="multilevel-modeling.html#cb190-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb190-33"><a href="multilevel-modeling.html#cb190-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-34"><a href="multilevel-modeling.html#cb190-34" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 </span></code></pre></div>
<pre><code>## Warning in log1p(-p): NaNs produced

## Warning in log1p(-p): NaNs produced</code></pre>
<pre><code>## Warning: Removed 70 rows containing non-finite values (`stat_density()`).</code></pre>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20prior%20posterior%20update%20checks-1.png" width="672" /></p>
</div>
<div id="posterior-predictive-checks-1" class="section level4 hasAnchor" number="6.5.6.3">
<h4><span class="header-section-number">6.5.6.3</span> Posterior predictive checks<a href="multilevel-modeling.html#posterior-predictive-checks-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="multilevel-modeling.html#cb193-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb193-2"><a href="multilevel-modeling.html#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds0[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb193-3"><a href="multilevel-modeling.html#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds0[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb193-4"><a href="multilevel-modeling.html#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb193-5"><a href="multilevel-modeling.html#cb193-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb193-6"><a href="multilevel-modeling.html#cb193-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb193-7"><a href="multilevel-modeling.html#cb193-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-8"><a href="multilevel-modeling.html#cb193-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb193-9"><a href="multilevel-modeling.html#cb193-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds1[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb193-10"><a href="multilevel-modeling.html#cb193-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds1[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb193-11"><a href="multilevel-modeling.html#cb193-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb193-12"><a href="multilevel-modeling.html#cb193-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb193-13"><a href="multilevel-modeling.html#cb193-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb193-14"><a href="multilevel-modeling.html#cb193-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-15"><a href="multilevel-modeling.html#cb193-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb193-16"><a href="multilevel-modeling.html#cb193-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds2[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb193-17"><a href="multilevel-modeling.html#cb193-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">posterior_preds2[1]</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb193-18"><a href="multilevel-modeling.html#cb193-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted right hands out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb193-19"><a href="multilevel-modeling.html#cb193-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb193-20"><a href="multilevel-modeling.html#cb193-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb193-21"><a href="multilevel-modeling.html#cb193-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-22"><a href="multilevel-modeling.html#cb193-22" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20posterior%20predictive%20checks-1.png" width="672" /></p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="multilevel-modeling.html#cb195-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasM, biasSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb195-2"><a href="multilevel-modeling.html#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb195-3"><a href="multilevel-modeling.html#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb195-4"><a href="multilevel-modeling.html#cb195-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(betaM, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb195-5"><a href="multilevel-modeling.html#cb195-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb195-6"><a href="multilevel-modeling.html#cb195-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb195-7"><a href="multilevel-modeling.html#cb195-7" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasM, betaM, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb195-8"><a href="multilevel-modeling.html#cb195-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb195-9"><a href="multilevel-modeling.html#cb195-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb195-10"><a href="multilevel-modeling.html#cb195-10" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(draws_df, <span class="fu">aes</span>(biasSD, betaSD, <span class="at">group =</span> .chain, <span class="at">color =</span> .chain)) <span class="sc">+</span></span>
<span id="cb195-11"><a href="multilevel-modeling.html#cb195-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb195-12"><a href="multilevel-modeling.html#cb195-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb195-13"><a href="multilevel-modeling.html#cb195-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-14"><a href="multilevel-modeling.html#cb195-14" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20posterior%20predictive%20checks-2.png" width="672" /></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="multilevel-modeling.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb196-2"><a href="multilevel-modeling.html#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[1]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb196-3"><a href="multilevel-modeling.html#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[15]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb196-4"><a href="multilevel-modeling.html#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[21]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb196-5"><a href="multilevel-modeling.html#cb196-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[31]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb196-6"><a href="multilevel-modeling.html#cb196-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[41]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb196-7"><a href="multilevel-modeling.html#cb196-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[51]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb196-8"><a href="multilevel-modeling.html#cb196-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">biasID[61]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb196-9"><a href="multilevel-modeling.html#cb196-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(biasM_prior)), <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb196-10"><a href="multilevel-modeling.html#cb196-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(bias_prior), <span class="at">fill =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb196-11"><a href="multilevel-modeling.html#cb196-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Bias parameter&quot;</span>) <span class="sc">+</span></span>
<span id="cb196-12"><a href="multilevel-modeling.html#cb196-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb196-13"><a href="multilevel-modeling.html#cb196-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20posterior%20predictive%20checks-3.png" width="672" /></p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="multilevel-modeling.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb197-2"><a href="multilevel-modeling.html#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[1]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb197-3"><a href="multilevel-modeling.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[15]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb197-4"><a href="multilevel-modeling.html#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[21]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb197-5"><a href="multilevel-modeling.html#cb197-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[31]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb197-6"><a href="multilevel-modeling.html#cb197-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[41]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb197-7"><a href="multilevel-modeling.html#cb197-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[51]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb197-8"><a href="multilevel-modeling.html#cb197-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(<span class="st">`</span><span class="at">betaID[61]</span><span class="st">`</span>)), <span class="at">fill =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb197-9"><a href="multilevel-modeling.html#cb197-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="fu">inv_logit_scaled</span>(betaM_prior)), <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb197-10"><a href="multilevel-modeling.html#cb197-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(beta_prior), <span class="at">fill =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb197-11"><a href="multilevel-modeling.html#cb197-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Beta parameter&quot;</span>) <span class="sc">+</span></span>
<span id="cb197-12"><a href="multilevel-modeling.html#cb197-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb197-13"><a href="multilevel-modeling.html#cb197-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/Assessing%20multilevel%20memory%20nc:%20posterior%20predictive%20checks-4.png" width="672" /></p>
</div>
</div>
<div id="multilevel-memory-with-correlation-between-parameters" class="section level3 hasAnchor" number="6.5.7">
<h3><span class="header-section-number">6.5.7</span> Multilevel memory with correlation between parameters<a href="multilevel-modeling.html#multilevel-memory-with-correlation-between-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="multilevel-modeling.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># , eval = FALSE</span></span>
<span id="cb198-2"><a href="multilevel-modeling.html#cb198-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-3"><a href="multilevel-modeling.html#cb198-3" aria-hidden="true" tabindex="-1"></a>stan_model_nc_cor <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb198-4"><a href="multilevel-modeling.html#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb198-5"><a href="multilevel-modeling.html#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="st">// This STAN model infers a random bias from a sequences of 1s and 0s (heads and tails)</span></span>
<span id="cb198-6"><a href="multilevel-modeling.html#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="st">//</span></span>
<span id="cb198-7"><a href="multilevel-modeling.html#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="st">functions{</span></span>
<span id="cb198-8"><a href="multilevel-modeling.html#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="st">  real normal_lb_rng(real mu, real sigma, real lb) {</span></span>
<span id="cb198-9"><a href="multilevel-modeling.html#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="st">    real p = normal_cdf(lb | mu, sigma);  // cdf for bounds</span></span>
<span id="cb198-10"><a href="multilevel-modeling.html#cb198-10" aria-hidden="true" tabindex="-1"></a><span class="st">    real u = uniform_rng(p, 1);</span></span>
<span id="cb198-11"><a href="multilevel-modeling.html#cb198-11" aria-hidden="true" tabindex="-1"></a><span class="st">    return (sigma * inv_Phi(u)) + mu;  // inverse cdf for value</span></span>
<span id="cb198-12"><a href="multilevel-modeling.html#cb198-12" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb198-13"><a href="multilevel-modeling.html#cb198-13" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb198-14"><a href="multilevel-modeling.html#cb198-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-15"><a href="multilevel-modeling.html#cb198-15" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. </span></span>
<span id="cb198-16"><a href="multilevel-modeling.html#cb198-16" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb198-17"><a href="multilevel-modeling.html#cb198-17" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb198-18"><a href="multilevel-modeling.html#cb198-18" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb198-19"><a href="multilevel-modeling.html#cb198-19" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb198-20"><a href="multilevel-modeling.html#cb198-20" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb198-21"><a href="multilevel-modeling.html#cb198-21" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb198-22"><a href="multilevel-modeling.html#cb198-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-23"><a href="multilevel-modeling.html#cb198-23" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb198-24"><a href="multilevel-modeling.html#cb198-24" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb198-25"><a href="multilevel-modeling.html#cb198-25" aria-hidden="true" tabindex="-1"></a><span class="st">  real biasM;</span></span>
<span id="cb198-26"><a href="multilevel-modeling.html#cb198-26" aria-hidden="true" tabindex="-1"></a><span class="st">  real betaM;</span></span>
<span id="cb198-27"><a href="multilevel-modeling.html#cb198-27" aria-hidden="true" tabindex="-1"></a><span class="st">  vector&lt;lower = 0&gt;[2] tau;</span></span>
<span id="cb198-28"><a href="multilevel-modeling.html#cb198-28" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[2, agents] z_IDs;</span></span>
<span id="cb198-29"><a href="multilevel-modeling.html#cb198-29" aria-hidden="true" tabindex="-1"></a><span class="st">  cholesky_factor_corr[2] L_u;</span></span>
<span id="cb198-30"><a href="multilevel-modeling.html#cb198-30" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb198-31"><a href="multilevel-modeling.html#cb198-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-32"><a href="multilevel-modeling.html#cb198-32" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb198-33"><a href="multilevel-modeling.html#cb198-33" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb198-34"><a href="multilevel-modeling.html#cb198-34" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[agents,2] IDs;</span></span>
<span id="cb198-35"><a href="multilevel-modeling.html#cb198-35" aria-hidden="true" tabindex="-1"></a><span class="st">  IDs = (diag_pre_multiply(tau, L_u) * z_IDs)&#39;;</span></span>
<span id="cb198-36"><a href="multilevel-modeling.html#cb198-36" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb198-37"><a href="multilevel-modeling.html#cb198-37" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb198-38"><a href="multilevel-modeling.html#cb198-38" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb198-39"><a href="multilevel-modeling.html#cb198-39" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb198-40"><a href="multilevel-modeling.html#cb198-40" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb198-41"><a href="multilevel-modeling.html#cb198-41" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb198-42"><a href="multilevel-modeling.html#cb198-42" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb198-43"><a href="multilevel-modeling.html#cb198-43" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb198-44"><a href="multilevel-modeling.html#cb198-44" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb198-45"><a href="multilevel-modeling.html#cb198-45" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb198-46"><a href="multilevel-modeling.html#cb198-46" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb198-47"><a href="multilevel-modeling.html#cb198-47" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb198-48"><a href="multilevel-modeling.html#cb198-48" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb198-49"><a href="multilevel-modeling.html#cb198-49" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb198-50"><a href="multilevel-modeling.html#cb198-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-51"><a href="multilevel-modeling.html#cb198-51" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb198-52"><a href="multilevel-modeling.html#cb198-52" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb198-53"><a href="multilevel-modeling.html#cb198-53" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(biasM | 0, 1);</span></span>
<span id="cb198-54"><a href="multilevel-modeling.html#cb198-54" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[1] | 0, .3)  -</span></span>
<span id="cb198-55"><a href="multilevel-modeling.html#cb198-55" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb198-56"><a href="multilevel-modeling.html#cb198-56" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(betaM | 0, .3);</span></span>
<span id="cb198-57"><a href="multilevel-modeling.html#cb198-57" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(tau[2] | 0, .3)  -</span></span>
<span id="cb198-58"><a href="multilevel-modeling.html#cb198-58" aria-hidden="true" tabindex="-1"></a><span class="st">    normal_lccdf(0 | 0, .3);</span></span>
<span id="cb198-59"><a href="multilevel-modeling.html#cb198-59" aria-hidden="true" tabindex="-1"></a><span class="st">  target += lkj_corr_cholesky_lpdf(L_u | 2);</span></span>
<span id="cb198-60"><a href="multilevel-modeling.html#cb198-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-61"><a href="multilevel-modeling.html#cb198-61" aria-hidden="true" tabindex="-1"></a><span class="st">  target += std_normal_lpdf(to_vector(z_IDs));</span></span>
<span id="cb198-62"><a href="multilevel-modeling.html#cb198-62" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb198-63"><a href="multilevel-modeling.html#cb198-63" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb198-64"><a href="multilevel-modeling.html#cb198-64" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | biasM + IDs[agent, 1] +  memory[trial, agent] * (betaM + IDs[agent, 2]));</span></span>
<span id="cb198-65"><a href="multilevel-modeling.html#cb198-65" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb198-66"><a href="multilevel-modeling.html#cb198-66" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb198-67"><a href="multilevel-modeling.html#cb198-67" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb198-68"><a href="multilevel-modeling.html#cb198-68" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb198-69"><a href="multilevel-modeling.html#cb198-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-70"><a href="multilevel-modeling.html#cb198-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-71"><a href="multilevel-modeling.html#cb198-71" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb198-72"><a href="multilevel-modeling.html#cb198-72" aria-hidden="true" tabindex="-1"></a><span class="st">   real biasM_prior;</span></span>
<span id="cb198-73"><a href="multilevel-modeling.html#cb198-73" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; biasSD_prior;</span></span>
<span id="cb198-74"><a href="multilevel-modeling.html#cb198-74" aria-hidden="true" tabindex="-1"></a><span class="st">   real betaM_prior;</span></span>
<span id="cb198-75"><a href="multilevel-modeling.html#cb198-75" aria-hidden="true" tabindex="-1"></a><span class="st">   real&lt;lower=0&gt; betaSD_prior;</span></span>
<span id="cb198-76"><a href="multilevel-modeling.html#cb198-76" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb198-77"><a href="multilevel-modeling.html#cb198-77" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb198-78"><a href="multilevel-modeling.html#cb198-78" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb198-79"><a href="multilevel-modeling.html#cb198-79" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb198-80"><a href="multilevel-modeling.html#cb198-80" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb198-81"><a href="multilevel-modeling.html#cb198-81" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb198-82"><a href="multilevel-modeling.html#cb198-82" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb198-83"><a href="multilevel-modeling.html#cb198-83" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb198-84"><a href="multilevel-modeling.html#cb198-84" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb198-85"><a href="multilevel-modeling.html#cb198-85" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb198-86"><a href="multilevel-modeling.html#cb198-86" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb198-87"><a href="multilevel-modeling.html#cb198-87" aria-hidden="true" tabindex="-1"></a><span class="st">   biasM_prior = normal_rng(0,1);</span></span>
<span id="cb198-88"><a href="multilevel-modeling.html#cb198-88" aria-hidden="true" tabindex="-1"></a><span class="st">   biasSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb198-89"><a href="multilevel-modeling.html#cb198-89" aria-hidden="true" tabindex="-1"></a><span class="st">   betaM_prior = normal_rng(0,1);</span></span>
<span id="cb198-90"><a href="multilevel-modeling.html#cb198-90" aria-hidden="true" tabindex="-1"></a><span class="st">   betaSD_prior = normal_lb_rng(0,0.3,0);</span></span>
<span id="cb198-91"><a href="multilevel-modeling.html#cb198-91" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb198-92"><a href="multilevel-modeling.html#cb198-92" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(biasM_prior, biasSD_prior);</span></span>
<span id="cb198-93"><a href="multilevel-modeling.html#cb198-93" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(betaM_prior, betaSD_prior);</span></span>
<span id="cb198-94"><a href="multilevel-modeling.html#cb198-94" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb198-95"><a href="multilevel-modeling.html#cb198-95" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb198-96"><a href="multilevel-modeling.html#cb198-96" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds0[i] = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb198-97"><a href="multilevel-modeling.html#cb198-97" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds1[i] = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb198-98"><a href="multilevel-modeling.html#cb198-98" aria-hidden="true" tabindex="-1"></a><span class="st">      prior_preds2[i] = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb198-99"><a href="multilevel-modeling.html#cb198-99" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  0 * (betaM + IDs[i,2])));</span></span>
<span id="cb198-100"><a href="multilevel-modeling.html#cb198-100" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  1 * (betaM + IDs[i,2])));</span></span>
<span id="cb198-101"><a href="multilevel-modeling.html#cb198-101" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(biasM + IDs[i,1] +  2 * (betaM + IDs[i,2])));</span></span>
<span id="cb198-102"><a href="multilevel-modeling.html#cb198-102" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb198-103"><a href="multilevel-modeling.html#cb198-103" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb198-104"><a href="multilevel-modeling.html#cb198-104" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb198-105"><a href="multilevel-modeling.html#cb198-105" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb198-106"><a href="multilevel-modeling.html#cb198-106" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb198-107"><a href="multilevel-modeling.html#cb198-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-108"><a href="multilevel-modeling.html#cb198-108" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb198-109"><a href="multilevel-modeling.html#cb198-109" aria-hidden="true" tabindex="-1"></a>  stan_model_nc_cor,</span>
<span id="cb198-110"><a href="multilevel-modeling.html#cb198-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb198-111"><a href="multilevel-modeling.html#cb198-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelMemory_nc_cor.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W5_MultilevelMemory_nc_cor.stan&quot;</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="multilevel-modeling.html#cb200-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelMemory_nc_cor.stan&quot;</span>)</span>
<span id="cb200-2"><a href="multilevel-modeling.html#cb200-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb200-3"><a href="multilevel-modeling.html#cb200-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="multilevel-modeling.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb202-2"><a href="multilevel-modeling.html#cb202-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb202-3"><a href="multilevel-modeling.html#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb202-4"><a href="multilevel-modeling.html#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb202-5"><a href="multilevel-modeling.html#cb202-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb202-6"><a href="multilevel-modeling.html#cb202-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb202-7"><a href="multilevel-modeling.html#cb202-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb202-8"><a href="multilevel-modeling.html#cb202-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb202-9"><a href="multilevel-modeling.html#cb202-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb202-10"><a href="multilevel-modeling.html#cb202-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb202-11"><a href="multilevel-modeling.html#cb202-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb202-12"><a href="multilevel-modeling.html#cb202-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb202-13"><a href="multilevel-modeling.html#cb202-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup)</code></pre>
<pre><code>## Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
<pre><code>## Chain 2 Exception: bernoulli_logit_lpmf: Logit transformed probability parameter is nan, but must be not nan! (in &#39;/var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/model-1144c4220e7b6.stan&#39;, line 62, column 6 to column 128)</code></pre>
<pre><code>## Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
<pre><code>## Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
<pre><code>## Chain 2</code></pre>
<pre><code>## Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
<pre><code>## Chain 2 Exception: bernoulli_logit_lpmf: Logit transformed probability parameter is nan, but must be not nan! (in &#39;/var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/model-1144c4220e7b6.stan&#39;, line 62, column 6 to column 128)</code></pre>
<pre><code>## Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
<pre><code>## Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
<pre><code>## Chain 2</code></pre>
<pre><code>## Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
<pre><code>## Chain 2 Exception: bernoulli_logit_lpmf: Logit transformed probability parameter is nan, but must be not nan! (in &#39;/var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/model-1144c4220e7b6.stan&#39;, line 62, column 6 to column 128)</code></pre>
<pre><code>## Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
<pre><code>## Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
<pre><code>## Chain 2</code></pre>
<pre><code>## Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
<pre><code>## Chain 2 Exception: bernoulli_logit_lpmf: Logit transformed probability parameter is nan, but must be not nan! (in &#39;/var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/model-1144c4220e7b6.stan&#39;, line 62, column 6 to column 128)</code></pre>
<pre><code>## Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
<pre><code>## Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
<pre><code>## Chain 2</code></pre>
<pre><code>## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 1820.0 seconds.
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 1997.5 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 1908.7 seconds.
## Total execution time: 1997.6 seconds.</code></pre>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="multilevel-modeling.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(samples, <span class="st">&quot;simmodels/W5_MultilevelMemory_noncentered_corr.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="assessing-multilevel-memory-2" class="section level3 hasAnchor" number="6.5.8">
<h3><span class="header-section-number">6.5.8</span> Assessing multilevel memory<a href="multilevel-modeling.html#assessing-multilevel-memory-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>[MISSING LOTS OF EVALUATION]</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="multilevel-modeling.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co">#samples &lt;- readRDS(&quot;simmodels/W5_MultilevelMemory_noncentered_corr.RDS&quot;)</span></span>
<span id="cb226-2"><a href="multilevel-modeling.html#cb226-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-3"><a href="multilevel-modeling.html#cb226-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code></pre></div>
<pre><code>## Processing csv files: /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory_nc_cor-202303100657-1-969904.csv, /var/folders/lt/zspkqnxd5yg92kybm5f433_cfjr0d6/T/RtmpTP5vj3/W5_MultilevelMemory_nc_cor-202303100657-2-969904.csv
## 
## Checking sampler transitions treedepth.
## Treedepth satisfactory for all transitions.
## 
## Checking sampler transitions for divergences.
## No divergent transitions found.
## 
## Checking E-BFMI - sampler transitions HMC potential energy.
## E-BFMI satisfactory.
## 
## Effective sample size satisfactory.
## 
## Split R-hat values satisfactory all parameters.
## 
## Processing complete, no problems detected.</code></pre>
</div>
<div id="multilevel-memory-no-pooling" class="section level3 hasAnchor" number="6.5.9">
<h3><span class="header-section-number">6.5.9</span> Multilevel memory no pooling<a href="multilevel-modeling.html#multilevel-memory-no-pooling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>[MISSING: EXPLANATION OF NO POOLING]</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="multilevel-modeling.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># , eval = FALSE</span></span>
<span id="cb228-2"><a href="multilevel-modeling.html#cb228-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-3"><a href="multilevel-modeling.html#cb228-3" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb228-4"><a href="multilevel-modeling.html#cb228-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-5"><a href="multilevel-modeling.html#cb228-5" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of heads</span></span>
<span id="cb228-6"><a href="multilevel-modeling.html#cb228-6" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb228-7"><a href="multilevel-modeling.html#cb228-7" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb228-8"><a href="multilevel-modeling.html#cb228-8" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb228-9"><a href="multilevel-modeling.html#cb228-9" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb228-10"><a href="multilevel-modeling.html#cb228-10" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb228-11"><a href="multilevel-modeling.html#cb228-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb228-12"><a href="multilevel-modeling.html#cb228-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-13"><a href="multilevel-modeling.html#cb228-13" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb228-14"><a href="multilevel-modeling.html#cb228-14" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb228-15"><a href="multilevel-modeling.html#cb228-15" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials] real bias;</span></span>
<span id="cb228-16"><a href="multilevel-modeling.html#cb228-16" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials] real beta;</span></span>
<span id="cb228-17"><a href="multilevel-modeling.html#cb228-17" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb228-18"><a href="multilevel-modeling.html#cb228-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-19"><a href="multilevel-modeling.html#cb228-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-20"><a href="multilevel-modeling.html#cb228-20" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb228-21"><a href="multilevel-modeling.html#cb228-21" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb228-22"><a href="multilevel-modeling.html#cb228-22" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb228-23"><a href="multilevel-modeling.html#cb228-23" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb228-24"><a href="multilevel-modeling.html#cb228-24" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb228-25"><a href="multilevel-modeling.html#cb228-25" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb228-26"><a href="multilevel-modeling.html#cb228-26" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb228-27"><a href="multilevel-modeling.html#cb228-27" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb228-28"><a href="multilevel-modeling.html#cb228-28" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb228-29"><a href="multilevel-modeling.html#cb228-29" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb228-30"><a href="multilevel-modeling.html#cb228-30" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb228-31"><a href="multilevel-modeling.html#cb228-31" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb228-32"><a href="multilevel-modeling.html#cb228-32" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb228-33"><a href="multilevel-modeling.html#cb228-33" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb228-34"><a href="multilevel-modeling.html#cb228-34" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb228-35"><a href="multilevel-modeling.html#cb228-35" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb228-36"><a href="multilevel-modeling.html#cb228-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-37"><a href="multilevel-modeling.html#cb228-37" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb228-38"><a href="multilevel-modeling.html#cb228-38" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb228-39"><a href="multilevel-modeling.html#cb228-39" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | 0, 1);</span></span>
<span id="cb228-40"><a href="multilevel-modeling.html#cb228-40" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(beta | 0, 1);</span></span>
<span id="cb228-41"><a href="multilevel-modeling.html#cb228-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-42"><a href="multilevel-modeling.html#cb228-42" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb228-43"><a href="multilevel-modeling.html#cb228-43" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb228-44"><a href="multilevel-modeling.html#cb228-44" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | bias[agent] +  memory[trial, agent] * (beta[agent]));</span></span>
<span id="cb228-45"><a href="multilevel-modeling.html#cb228-45" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb228-46"><a href="multilevel-modeling.html#cb228-46" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb228-47"><a href="multilevel-modeling.html#cb228-47" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb228-48"><a href="multilevel-modeling.html#cb228-48" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb228-49"><a href="multilevel-modeling.html#cb228-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-50"><a href="multilevel-modeling.html#cb228-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-51"><a href="multilevel-modeling.html#cb228-51" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb228-52"><a href="multilevel-modeling.html#cb228-52" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb228-53"><a href="multilevel-modeling.html#cb228-53" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb228-54"><a href="multilevel-modeling.html#cb228-54" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb228-55"><a href="multilevel-modeling.html#cb228-55" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb228-56"><a href="multilevel-modeling.html#cb228-56" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb228-57"><a href="multilevel-modeling.html#cb228-57" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb228-58"><a href="multilevel-modeling.html#cb228-58" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb228-59"><a href="multilevel-modeling.html#cb228-59" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb228-60"><a href="multilevel-modeling.html#cb228-60" aria-hidden="true" tabindex="-1"></a><span class="st">   array[agents] int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb228-61"><a href="multilevel-modeling.html#cb228-61" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb228-62"><a href="multilevel-modeling.html#cb228-62" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(0,1);</span></span>
<span id="cb228-63"><a href="multilevel-modeling.html#cb228-63" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(0,1);</span></span>
<span id="cb228-64"><a href="multilevel-modeling.html#cb228-64" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb228-65"><a href="multilevel-modeling.html#cb228-65" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds0 = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb228-66"><a href="multilevel-modeling.html#cb228-66" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds1 = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb228-67"><a href="multilevel-modeling.html#cb228-67" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds2 = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb228-68"><a href="multilevel-modeling.html#cb228-68" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb228-69"><a href="multilevel-modeling.html#cb228-69" aria-hidden="true" tabindex="-1"></a><span class="st">   for (i in 1:agents){</span></span>
<span id="cb228-70"><a href="multilevel-modeling.html#cb228-70" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds0[i] = binomial_rng(trials, inv_logit(bias[i] +  0 * (beta[i])));</span></span>
<span id="cb228-71"><a href="multilevel-modeling.html#cb228-71" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds1[i] = binomial_rng(trials, inv_logit(bias[i] +  1 * (beta[i])));</span></span>
<span id="cb228-72"><a href="multilevel-modeling.html#cb228-72" aria-hidden="true" tabindex="-1"></a><span class="st">      posterior_preds2[i] = binomial_rng(trials, inv_logit(bias[i] +  2 * (beta[i])));</span></span>
<span id="cb228-73"><a href="multilevel-modeling.html#cb228-73" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb228-74"><a href="multilevel-modeling.html#cb228-74" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb228-75"><a href="multilevel-modeling.html#cb228-75" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb228-76"><a href="multilevel-modeling.html#cb228-76" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb228-77"><a href="multilevel-modeling.html#cb228-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-78"><a href="multilevel-modeling.html#cb228-78" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb228-79"><a href="multilevel-modeling.html#cb228-79" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb228-80"><a href="multilevel-modeling.html#cb228-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb228-81"><a href="multilevel-modeling.html#cb228-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelMemory_nopooling.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W5_MultilevelMemory_nopooling.stan&quot;</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="multilevel-modeling.html#cb230-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelMemory_nopooling.stan&quot;</span>)</span>
<span id="cb230-2"><a href="multilevel-modeling.html#cb230-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb230-3"><a href="multilevel-modeling.html#cb230-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="multilevel-modeling.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb232-2"><a href="multilevel-modeling.html#cb232-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb232-3"><a href="multilevel-modeling.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb232-4"><a href="multilevel-modeling.html#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb232-5"><a href="multilevel-modeling.html#cb232-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb232-6"><a href="multilevel-modeling.html#cb232-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb232-7"><a href="multilevel-modeling.html#cb232-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb232-8"><a href="multilevel-modeling.html#cb232-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb232-9"><a href="multilevel-modeling.html#cb232-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb232-10"><a href="multilevel-modeling.html#cb232-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb232-11"><a href="multilevel-modeling.html#cb232-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb232-12"><a href="multilevel-modeling.html#cb232-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb232-13"><a href="multilevel-modeling.html#cb232-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 1002.8 seconds.
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 1019.7 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 1011.2 seconds.
## Total execution time: 1019.8 seconds.</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="multilevel-modeling.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(samples, <span class="st">&quot;simmodels/W5_MultilevelMemory_nopooling.RDS&quot;</span>)</span></code></pre></div>
<p>[MISSING: Evaluation of NO POOLING]</p>
</div>
</div>
<div id="multilevel-full-pooling" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Multilevel full pooling<a href="multilevel-modeling.html#multilevel-full-pooling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>[MISSING: EXPLANATION OF FULL POOLING]</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="multilevel-modeling.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co"># , eval = FALSE</span></span>
<span id="cb235-2"><a href="multilevel-modeling.html#cb235-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-3"><a href="multilevel-modeling.html#cb235-3" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb235-4"><a href="multilevel-modeling.html#cb235-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-5"><a href="multilevel-modeling.html#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h of heads</span></span>
<span id="cb235-6"><a href="multilevel-modeling.html#cb235-6" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb235-7"><a href="multilevel-modeling.html#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; trials;</span></span>
<span id="cb235-8"><a href="multilevel-modeling.html#cb235-8" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower = 1&gt; agents;</span></span>
<span id="cb235-9"><a href="multilevel-modeling.html#cb235-9" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int h;</span></span>
<span id="cb235-10"><a href="multilevel-modeling.html#cb235-10" aria-hidden="true" tabindex="-1"></a><span class="st"> array[trials, agents] int other;</span></span>
<span id="cb235-11"><a href="multilevel-modeling.html#cb235-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb235-12"><a href="multilevel-modeling.html#cb235-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-13"><a href="multilevel-modeling.html#cb235-13" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb235-14"><a href="multilevel-modeling.html#cb235-14" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb235-15"><a href="multilevel-modeling.html#cb235-15" aria-hidden="true" tabindex="-1"></a><span class="st">  real bias;</span></span>
<span id="cb235-16"><a href="multilevel-modeling.html#cb235-16" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta;</span></span>
<span id="cb235-17"><a href="multilevel-modeling.html#cb235-17" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb235-18"><a href="multilevel-modeling.html#cb235-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-19"><a href="multilevel-modeling.html#cb235-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-20"><a href="multilevel-modeling.html#cb235-20" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb235-21"><a href="multilevel-modeling.html#cb235-21" aria-hidden="true" tabindex="-1"></a><span class="st">  array[trials, agents] real memory;</span></span>
<span id="cb235-22"><a href="multilevel-modeling.html#cb235-22" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb235-23"><a href="multilevel-modeling.html#cb235-23" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb235-24"><a href="multilevel-modeling.html#cb235-24" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb235-25"><a href="multilevel-modeling.html#cb235-25" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial == 1) {</span></span>
<span id="cb235-26"><a href="multilevel-modeling.html#cb235-26" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial, agent] = 0.5;</span></span>
<span id="cb235-27"><a href="multilevel-modeling.html#cb235-27" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb235-28"><a href="multilevel-modeling.html#cb235-28" aria-hidden="true" tabindex="-1"></a><span class="st">      if (trial &lt; trials){</span></span>
<span id="cb235-29"><a href="multilevel-modeling.html#cb235-29" aria-hidden="true" tabindex="-1"></a><span class="st">        memory[trial + 1, agent] = memory[trial, agent] + ((other[trial, agent] - memory[trial, agent]) / trial);</span></span>
<span id="cb235-30"><a href="multilevel-modeling.html#cb235-30" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 0){memory[trial + 1, agent] = 0.01;}</span></span>
<span id="cb235-31"><a href="multilevel-modeling.html#cb235-31" aria-hidden="true" tabindex="-1"></a><span class="st">        if (memory[trial + 1, agent] == 1){memory[trial + 1, agent] = 0.99;}</span></span>
<span id="cb235-32"><a href="multilevel-modeling.html#cb235-32" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb235-33"><a href="multilevel-modeling.html#cb235-33" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb235-34"><a href="multilevel-modeling.html#cb235-34" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb235-35"><a href="multilevel-modeling.html#cb235-35" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb235-36"><a href="multilevel-modeling.html#cb235-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-37"><a href="multilevel-modeling.html#cb235-37" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb235-38"><a href="multilevel-modeling.html#cb235-38" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb235-39"><a href="multilevel-modeling.html#cb235-39" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | 0, 1);</span></span>
<span id="cb235-40"><a href="multilevel-modeling.html#cb235-40" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(beta | 0, 1);</span></span>
<span id="cb235-41"><a href="multilevel-modeling.html#cb235-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-42"><a href="multilevel-modeling.html#cb235-42" aria-hidden="true" tabindex="-1"></a><span class="st">  for (agent in 1:agents){</span></span>
<span id="cb235-43"><a href="multilevel-modeling.html#cb235-43" aria-hidden="true" tabindex="-1"></a><span class="st">    for (trial in 1:trials){</span></span>
<span id="cb235-44"><a href="multilevel-modeling.html#cb235-44" aria-hidden="true" tabindex="-1"></a><span class="st">      target += bernoulli_logit_lpmf(h[trial, agent] | bias +  memory[trial, agent] * beta);</span></span>
<span id="cb235-45"><a href="multilevel-modeling.html#cb235-45" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb235-46"><a href="multilevel-modeling.html#cb235-46" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb235-47"><a href="multilevel-modeling.html#cb235-47" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb235-48"><a href="multilevel-modeling.html#cb235-48" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb235-49"><a href="multilevel-modeling.html#cb235-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-50"><a href="multilevel-modeling.html#cb235-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-51"><a href="multilevel-modeling.html#cb235-51" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb235-52"><a href="multilevel-modeling.html#cb235-52" aria-hidden="true" tabindex="-1"></a><span class="st">   real bias_prior;</span></span>
<span id="cb235-53"><a href="multilevel-modeling.html#cb235-53" aria-hidden="true" tabindex="-1"></a><span class="st">   real beta_prior;</span></span>
<span id="cb235-54"><a href="multilevel-modeling.html#cb235-54" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb235-55"><a href="multilevel-modeling.html#cb235-55" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds0;</span></span>
<span id="cb235-56"><a href="multilevel-modeling.html#cb235-56" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds1;</span></span>
<span id="cb235-57"><a href="multilevel-modeling.html#cb235-57" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; prior_preds2;</span></span>
<span id="cb235-58"><a href="multilevel-modeling.html#cb235-58" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds0;</span></span>
<span id="cb235-59"><a href="multilevel-modeling.html#cb235-59" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds1;</span></span>
<span id="cb235-60"><a href="multilevel-modeling.html#cb235-60" aria-hidden="true" tabindex="-1"></a><span class="st">   int&lt;lower=0, upper = trials&gt; posterior_preds2;</span></span>
<span id="cb235-61"><a href="multilevel-modeling.html#cb235-61" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb235-62"><a href="multilevel-modeling.html#cb235-62" aria-hidden="true" tabindex="-1"></a><span class="st">   bias_prior = normal_rng(0,1);</span></span>
<span id="cb235-63"><a href="multilevel-modeling.html#cb235-63" aria-hidden="true" tabindex="-1"></a><span class="st">   beta_prior = normal_rng(0,1);</span></span>
<span id="cb235-64"><a href="multilevel-modeling.html#cb235-64" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb235-65"><a href="multilevel-modeling.html#cb235-65" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds0 = binomial_rng(trials, inv_logit(bias_prior + 0 * beta_prior));</span></span>
<span id="cb235-66"><a href="multilevel-modeling.html#cb235-66" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds1 = binomial_rng(trials, inv_logit(bias_prior + 1 * beta_prior));</span></span>
<span id="cb235-67"><a href="multilevel-modeling.html#cb235-67" aria-hidden="true" tabindex="-1"></a><span class="st">   prior_preds2 = binomial_rng(trials, inv_logit(bias_prior + 2 * beta_prior));</span></span>
<span id="cb235-68"><a href="multilevel-modeling.html#cb235-68" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb235-69"><a href="multilevel-modeling.html#cb235-69" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds0 = binomial_rng(trials, inv_logit(bias +  0 * (beta)));</span></span>
<span id="cb235-70"><a href="multilevel-modeling.html#cb235-70" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds1 = binomial_rng(trials, inv_logit(bias +  1 * (beta)));</span></span>
<span id="cb235-71"><a href="multilevel-modeling.html#cb235-71" aria-hidden="true" tabindex="-1"></a><span class="st">   posterior_preds2 = binomial_rng(trials, inv_logit(bias +  2 * (beta)));</span></span>
<span id="cb235-72"><a href="multilevel-modeling.html#cb235-72" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb235-73"><a href="multilevel-modeling.html#cb235-73" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb235-74"><a href="multilevel-modeling.html#cb235-74" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb235-75"><a href="multilevel-modeling.html#cb235-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-76"><a href="multilevel-modeling.html#cb235-76" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb235-77"><a href="multilevel-modeling.html#cb235-77" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb235-78"><a href="multilevel-modeling.html#cb235-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb235-79"><a href="multilevel-modeling.html#cb235-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W5_MultilevelMemory_fullpooling.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W5_MultilevelMemory_fullpooling.stan&quot;</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="multilevel-modeling.html#cb237-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W5_MultilevelMemory_fullpooling.stan&quot;</span>)</span>
<span id="cb237-2"><a href="multilevel-modeling.html#cb237-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb237-3"><a href="multilevel-modeling.html#cb237-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## Model executable is up to date!</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="multilevel-modeling.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb239-2"><a href="multilevel-modeling.html#cb239-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb239-3"><a href="multilevel-modeling.html#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb239-4"><a href="multilevel-modeling.html#cb239-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb239-5"><a href="multilevel-modeling.html#cb239-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb239-6"><a href="multilevel-modeling.html#cb239-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb239-7"><a href="multilevel-modeling.html#cb239-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb239-8"><a href="multilevel-modeling.html#cb239-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb239-9"><a href="multilevel-modeling.html#cb239-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb239-10"><a href="multilevel-modeling.html#cb239-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb239-11"><a href="multilevel-modeling.html#cb239-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb239-12"><a href="multilevel-modeling.html#cb239-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb239-13"><a href="multilevel-modeling.html#cb239-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
## Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
## Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
## Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
## Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
## Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 2 finished in 200.1 seconds.
## Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
## Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
## Chain 1 finished in 245.3 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 222.7 seconds.
## Total execution time: 245.5 seconds.</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="multilevel-modeling.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(samples, <span class="st">&quot;simmodels/W5_MultilevelMemory_fullpooling.RDS&quot;</span>)</span></code></pre></div>
<p>[MISSING: Evaluation of FULL POOLING]</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="practical-exercise-4---model-quality-checks.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/05-MultilevelModels.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
