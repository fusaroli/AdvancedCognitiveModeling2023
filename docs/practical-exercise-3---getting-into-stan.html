<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Practical exercise 3 - Getting into Stan | Advanced Cognitive Modeling Notes</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Practical exercise 3 - Getting into Stan | Advanced Cognitive Modeling Notes" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Practical exercise 3 - Getting into Stan | Advanced Cognitive Modeling Notes" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2023" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2023-02-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="practical-exercise-2---from-verbal-to-formal-models.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-goal-of-the-course"><i class="fa fa-check"></i><b>1.1</b> The goal of the course</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#list-of-lectures-and-practical-exercises"><i class="fa fa-check"></i><b>1.2</b> List of lectures and practical exercises</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preparation-before-the-course"><i class="fa fa-check"></i><b>1.3</b> Preparation before the course</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><i class="fa fa-check"></i><b>2</b> Practical exercise 1 - Building verbal models of the matching pennies game</a>
<ul>
<li class="chapter" data-level="2.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#trying-out-the-game-and-collecting-your-own-data"><i class="fa fa-check"></i><b>2.1</b> Trying out the game and collecting your own data</a></li>
<li class="chapter" data-level="2.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#start-theorizing"><i class="fa fa-check"></i><b>2.2</b> Start Theorizing</a></li>
<li class="chapter" data-level="2.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>2.3</b> The distinction between participant and researcher perspectives</a></li>
<li class="chapter" data-level="2.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#strategies"><i class="fa fa-check"></i><b>2.4</b> Strategies</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#random-strategies"><i class="fa fa-check"></i><b>2.4.1</b> Random strategies</a></li>
<li class="chapter" data-level="2.4.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#immediate-reaction"><i class="fa fa-check"></i><b>2.4.2</b> Immediate reaction</a></li>
<li class="chapter" data-level="2.4.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>2.4.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="2.4.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>2.4.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="2.4.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#reinforcement-learning"><i class="fa fa-check"></i><b>2.4.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="2.4.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#k-tom"><i class="fa fa-check"></i><b>2.4.6</b> k-ToM</a></li>
<li class="chapter" data-level="2.4.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#other-possible-strategies"><i class="fa fa-check"></i><b>2.4.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#cognitive-constraints"><i class="fa fa-check"></i><b>2.5</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#memory"><i class="fa fa-check"></i><b>2.5.1</b> Memory</a></li>
<li class="chapter" data-level="2.5.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#errors"><i class="fa fa-check"></i><b>2.5.2</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#continuity-between-models"><i class="fa fa-check"></i><b>2.6</b> Continuity between models</a></li>
<li class="chapter" data-level="2.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#mixture-of-strategies"><i class="fa fa-check"></i><b>2.7</b> Mixture of strategies</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html"><i class="fa fa-check"></i><b>3</b> Practical exercise 2 - From verbal to formal models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>3.1</b> Defining general conditions</a></li>
<li class="chapter" data-level="3.2" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>3.2</b> Implementing a random agent</a></li>
<li class="chapter" data-level="3.3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>3.3</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="3.4" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>3.4</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>3.4.1</b> And we visualize it</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html"><i class="fa fa-check"></i><b>4</b> Practical exercise 3 - Getting into Stan</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Cognitive Modeling Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="practical-exercise-3---getting-into-stan" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Practical exercise 3 - Getting into Stan<a href="practical-exercise-3---getting-into-stan.html#practical-exercise-3---getting-into-stan" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We start our adventures in Stan with the simplest possible model. After observing the behavior of a Matching Pennies player a certain amount of trials n, we can count how many times (k) the player chooses “head” (denoted by 1 in the data). This means we are inferring the player’s underlying bias for choosing “head”.
By the way, is this exactly the same process (but different outcome variable) as modeling performance (how many k successes out of n trials).</p>
<p>Note that we are not really interested in k. We are interested in the underlying bias of the agent, that is, their propensity to choose head. This underlying unobserved variable is the rate or theta.
Theta is of interest because it goes beyond the observed data and allows us to predict, e.g. how many heads would be produced over an arbitrary amount of trials. Analogously, theta allows us to compare this agent’s propensity to choose head (bias) with another agent’s bias even if they undergo a different amount of trials.</p>
<p>The exercises present 3 modeling issues:
1. Inferring the posterior distribution of a rate θ after having observed k successes from n trials.
2. Inferring the posterior distribution of the difference between two rates (θ1 and θ2) after having observed two different processes, producing k1 and k2 successes out of n1 and n2 trials, respectively.
3. Inferring the posterior distribution of a rate θ after having observed two instances of the rate in action: two binary processes, producing k1 and k2 successes out of n1 and n2 trials, respectively.</p>
<p>For each of these exercises, I’ll first generate the data, then setup the model, then add the code necessary to do proper quality checks of the model: prior predictive checks, posterior predictive checks, prior/posterior update checks.</p>
<p>First we want to generate the data. Note that usually we would want to set a fixed theta, then generate the predicted k successes given n trials, since that’d allow to see how well the model recovers the underlying theta.
But for now we follow the book.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="practical-exercise-3---getting-into-stan.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># underlying rate</span></span>
<span id="cb35-2"><a href="practical-exercise-3---getting-into-stan.html#cb35-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb35-3"><a href="practical-exercise-3---getting-into-stan.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># amount of trials</span></span>
<span id="cb35-4"><a href="practical-exercise-3---getting-into-stan.html#cb35-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb35-5"><a href="practical-exercise-3---getting-into-stan.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># generating successes (nb the book would say 7)</span></span>
<span id="cb35-6"><a href="practical-exercise-3---getting-into-stan.html#cb35-6" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">prob =</span> theta)</span>
<span id="cb35-7"><a href="practical-exercise-3---getting-into-stan.html#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="practical-exercise-3---getting-into-stan.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data</span></span>
<span id="cb35-9"><a href="practical-exercise-3---getting-into-stan.html#cb35-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb35-10"><a href="practical-exercise-3---getting-into-stan.html#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> n,</span>
<span id="cb35-11"><a href="practical-exercise-3---getting-into-stan.html#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> k</span>
<span id="cb35-12"><a href="practical-exercise-3---getting-into-stan.html#cb35-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Second we want to define a basic rate inferring model.
A stan program is composed (in its minimal form) by 3 blocks: data, parameters and model.</p>
<p><strong>data</strong> identifies the variables that are passed to the model and defines their type (e.g. whether they are real or integer numbers) and whether they are bounded (e.g. cannot be below 0). Here it’s easy, we have 2 variables that we are observing: the number of trials (n) and the number of success (k). Both are integers, we need to observe at least 1 trial, or there’s no data (n&gt;0) and there cannot be a negative number of successes (k&gt;=0).</p>
<p><strong>parameters</strong> identifies the parameters that need to be inferred thorugh the model. In this case, we only have one parameter: rate, which is bound between 0 (never successes) and 1 (always successes).</p>
<p><strong>model</strong> includes two parts: the priors for each of the parameters and the likelihood formula(s).
Here, again, we have the prior for our one parameter theta and the likelihood stating that k is
generated according to a binomial distribution with a number of trial n and a rate theta.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="practical-exercise-3---getting-into-stan.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span></code></pre></div>
<pre><code>## This is cmdstanr version 0.5.3</code></pre>
<pre><code>## - CmdStanR documentation and vignettes: mc-stan.org/cmdstanr</code></pre>
<pre><code>## - CmdStan path: /Users/au209589/.cmdstan/cmdstan-2.31.0</code></pre>
<pre><code>## - CmdStan version: 2.31.0</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="practical-exercise-3---getting-into-stan.html#cb41-1" aria-hidden="true" tabindex="-1"></a>stan_file <span class="ot">&lt;-</span> <span class="fu">write_stan_file</span>(<span class="st">&quot;</span></span>
<span id="cb41-2"><a href="practical-exercise-3---getting-into-stan.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="st">// This Stan model infers a rate (theta) from a number of trials (n) and successes (k)</span></span>
<span id="cb41-3"><a href="practical-exercise-3---getting-into-stan.html#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="practical-exercise-3---getting-into-stan.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="st">// The input data is two integer numbers: n and k.</span></span>
<span id="cb41-5"><a href="practical-exercise-3---getting-into-stan.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb41-6"><a href="practical-exercise-3---getting-into-stan.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; n; // n of trials (there has to be at least 1 to have observable data) </span></span>
<span id="cb41-7"><a href="practical-exercise-3---getting-into-stan.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; k;  // n of successes (lowest n is no successes)</span></span>
<span id="cb41-8"><a href="practical-exercise-3---getting-into-stan.html#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb41-9"><a href="practical-exercise-3---getting-into-stan.html#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="practical-exercise-3---getting-into-stan.html#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. Our model accepts only theta, the rate, </span></span>
<span id="cb41-11"><a href="practical-exercise-3---getting-into-stan.html#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="st">// which is bound at 0 (no chances of success) and 1 (always success)</span></span>
<span id="cb41-12"><a href="practical-exercise-3---getting-into-stan.html#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb41-13"><a href="practical-exercise-3---getting-into-stan.html#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; theta;</span></span>
<span id="cb41-14"><a href="practical-exercise-3---getting-into-stan.html#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb41-15"><a href="practical-exercise-3---getting-into-stan.html#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="practical-exercise-3---getting-into-stan.html#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated; prior and likelihood</span></span>
<span id="cb41-17"><a href="practical-exercise-3---getting-into-stan.html#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb41-18"><a href="practical-exercise-3---getting-into-stan.html#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="st">  // The prior for theta is a uniform distribution between 0 and 1</span></span>
<span id="cb41-19"><a href="practical-exercise-3---getting-into-stan.html#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="st">  theta ~ beta(1, 1);</span></span>
<span id="cb41-20"><a href="practical-exercise-3---getting-into-stan.html#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-21"><a href="practical-exercise-3---getting-into-stan.html#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="st">  // The model consists in a binomial distribution with a rate theta, </span></span>
<span id="cb41-22"><a href="practical-exercise-3---getting-into-stan.html#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="st">  // and a number of trials n generating k successes</span></span>
<span id="cb41-23"><a href="practical-exercise-3---getting-into-stan.html#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="st">  k ~ binomial(n, theta);</span></span>
<span id="cb41-24"><a href="practical-exercise-3---getting-into-stan.html#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-25"><a href="practical-exercise-3---getting-into-stan.html#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb41-26"><a href="practical-exercise-3---getting-into-stan.html#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>)</span></code></pre></div>
<p>Then we fit the model and assess the estimates: do they capture the simulated values?</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="practical-exercise-3---getting-into-stan.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mod &lt;- cmdstan_model(stan_file, cpp_options = list(stan_threads = TRUE), pedantic = TRUE)</span></span>
<span id="cb42-2"><a href="practical-exercise-3---getting-into-stan.html#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="practical-exercise-3---getting-into-stan.html#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="practical-exercise-3---getting-into-stan.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># samples &lt;- mod$sample(</span></span>
<span id="cb42-5"><a href="practical-exercise-3---getting-into-stan.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   data = data,</span></span>
<span id="cb42-6"><a href="practical-exercise-3---getting-into-stan.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   seed = 123,</span></span>
<span id="cb42-7"><a href="practical-exercise-3---getting-into-stan.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   chains = 2,</span></span>
<span id="cb42-8"><a href="practical-exercise-3---getting-into-stan.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   parallel_chains = 2,</span></span>
<span id="cb42-9"><a href="practical-exercise-3---getting-into-stan.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   threads_per_chain = 2,</span></span>
<span id="cb42-10"><a href="practical-exercise-3---getting-into-stan.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   iter_warmup = 2000,</span></span>
<span id="cb42-11"><a href="practical-exercise-3---getting-into-stan.html#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   iter_sampling = 2000,</span></span>
<span id="cb42-12"><a href="practical-exercise-3---getting-into-stan.html#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   refresh = 500,</span></span>
<span id="cb42-13"><a href="practical-exercise-3---getting-into-stan.html#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   max_treedepth = 20,</span></span>
<span id="cb42-14"><a href="practical-exercise-3---getting-into-stan.html#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   adapt_delta = 0.99,</span></span>
<span id="cb42-15"><a href="practical-exercise-3---getting-into-stan.html#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb42-16"><a href="practical-exercise-3---getting-into-stan.html#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="practical-exercise-3---getting-into-stan.html#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co">#samples</span></span></code></pre></div>
<p>As you know from the Bayesian workflow discussion [MISSING], there is a lot of model checking that we should do.
We haven’t assessed our priors, nor the model posteriors against priors and against data, nor the quality of the model fitting process.</p>
<p>Here is a reminder of what we need to do:
* plot our priors and the predicted outcome based on prior modeling only (no fitting on data), that is performing prior predictive checks
* assess the fitting process: diagnostics and traceplots/rankplots
* plot our predicted outcomes based on the fitted model (posterior predictive checks)
* plot our posteriors overlayed on the priors</p>
<p>Some of this, in particular, point 1, could/should be run before fitting the model. However, it’s very practical to get the model to do it all: sample from the priors and save those samples, while also fitting the model.</p>
<p>Let’s test things by hand, first. We first sample from the prior and visualize it</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="practical-exercise-3---getting-into-stan.html#cb43-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb43-2"><a href="practical-exercise-3---getting-into-stan.html#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="practical-exercise-3---getting-into-stan.html#cb43-3" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">prior =</span> <span class="fu">rbeta</span>(<span class="fl">1e4</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb43-4"><a href="practical-exercise-3---getting-into-stan.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prior, <span class="fu">aes</span>(prior)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Then we use the sampled prior to generate plausible outcomes.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="practical-exercise-3---getting-into-stan.html#cb44-1" aria-hidden="true" tabindex="-1"></a>pred_outcomes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pred_outcomes =</span> <span class="fu">rbinom</span>(<span class="fl">1e4</span>, <span class="dv">10</span>, prior<span class="sc">$</span>prior))</span>
<span id="cb44-2"><a href="practical-exercise-3---getting-into-stan.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred_outcomes, <span class="fu">aes</span>(pred_outcomes)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>So these roughly tell us that we have no ideas as to the plausible rate (all values between 0 and 1 are equally plausible), and that gives us</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="practical-exercise-2---from-verbal-to-formal-models.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/Draft_03.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
