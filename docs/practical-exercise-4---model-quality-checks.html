<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Practical exercise 4 - Model quality checks | 04-ModelQualityChecks</title>
  <meta name="description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Practical exercise 4 - Model quality checks | 04-ModelQualityChecks" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My notes for the advanced cognitive modeling course - 2023" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Practical exercise 4 - Model quality checks | 04-ModelQualityChecks" />
  
  <meta name="twitter:description" content="My notes for the advanced cognitive modeling course - 2023" />
  

<meta name="author" content="Riccardo Fusaroli" />


<meta name="date" content="2023-02-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="practical-exercise-3---getting-into-stan.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Cognitive Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Advanced Cognitive Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-goal-of-the-course"><i class="fa fa-check"></i><b>1.1</b> The goal of the course</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#list-of-lectures-and-practical-exercises"><i class="fa fa-check"></i><b>1.2</b> List of lectures and practical exercises</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preparation-before-the-course"><i class="fa fa-check"></i><b>1.3</b> Preparation before the course</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><i class="fa fa-check"></i><b>2</b> Practical exercise 1 - Building verbal models of the matching pennies game</a>
<ul>
<li class="chapter" data-level="2.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#trying-out-the-game-and-collecting-your-own-data"><i class="fa fa-check"></i><b>2.1</b> Trying out the game and collecting your own data</a></li>
<li class="chapter" data-level="2.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#start-theorizing"><i class="fa fa-check"></i><b>2.2</b> Start Theorizing</a></li>
<li class="chapter" data-level="2.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#the-distinction-between-participant-and-researcher-perspectives"><i class="fa fa-check"></i><b>2.3</b> The distinction between participant and researcher perspectives</a></li>
<li class="chapter" data-level="2.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#strategies"><i class="fa fa-check"></i><b>2.4</b> Strategies</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#random-strategies"><i class="fa fa-check"></i><b>2.4.1</b> Random strategies</a></li>
<li class="chapter" data-level="2.4.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#immediate-reaction"><i class="fa fa-check"></i><b>2.4.2</b> Immediate reaction</a></li>
<li class="chapter" data-level="2.4.3" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-perfect-memory"><i class="fa fa-check"></i><b>2.4.3</b> Keep track of the bias (perfect memory)</a></li>
<li class="chapter" data-level="2.4.4" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#keep-track-of-the-bias-imperfect-memory"><i class="fa fa-check"></i><b>2.4.4</b> Keep track of the bias (imperfect memory)</a></li>
<li class="chapter" data-level="2.4.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#reinforcement-learning"><i class="fa fa-check"></i><b>2.4.5</b> Reinforcement learning</a></li>
<li class="chapter" data-level="2.4.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#k-tom"><i class="fa fa-check"></i><b>2.4.6</b> k-ToM</a></li>
<li class="chapter" data-level="2.4.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#other-possible-strategies"><i class="fa fa-check"></i><b>2.4.7</b> Other possible strategies</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#cognitive-constraints"><i class="fa fa-check"></i><b>2.5</b> Cognitive constraints</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#memory"><i class="fa fa-check"></i><b>2.5.1</b> Memory</a></li>
<li class="chapter" data-level="2.5.2" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#errors"><i class="fa fa-check"></i><b>2.5.2</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#continuity-between-models"><i class="fa fa-check"></i><b>2.6</b> Continuity between models</a></li>
<li class="chapter" data-level="2.7" data-path="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html"><a href="practical-exercise-1---building-verbal-models-of-the-matching-pennies-game.html#mixture-of-strategies"><i class="fa fa-check"></i><b>2.7</b> Mixture of strategies</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html"><i class="fa fa-check"></i><b>3</b> Practical exercise 2 - From verbal to formal models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#defining-general-conditions"><i class="fa fa-check"></i><b>3.1</b> Defining general conditions</a></li>
<li class="chapter" data-level="3.2" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-random-agent"><i class="fa fa-check"></i><b>3.2</b> Implementing a random agent</a></li>
<li class="chapter" data-level="3.3" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#implementing-a-win-stay-lose-shift-agent"><i class="fa fa-check"></i><b>3.3</b> Implementing a Win-Stay-Lose-Shift agent</a></li>
<li class="chapter" data-level="3.4" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#now-we-scale-it-up"><i class="fa fa-check"></i><b>3.4</b> Now we scale it up</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="practical-exercise-2---from-verbal-to-formal-models.html"><a href="practical-exercise-2---from-verbal-to-formal-models.html#and-we-visualize-it"><i class="fa fa-check"></i><b>3.4.1</b> And we visualize it</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html"><i class="fa fa-check"></i><b>4</b> Practical exercise 3 - Getting into Stan</a>
<ul>
<li class="chapter" data-level="4.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#simulating-data"><i class="fa fa-check"></i><b>4.2</b> Simulating data</a></li>
<li class="chapter" data-level="4.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#building-our-basic-model-in-stan"><i class="fa fa-check"></i><b>4.3</b> Building our basic model in Stan</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#data"><i class="fa fa-check"></i><b>4.3.1</b> Data</a></li>
<li class="chapter" data-level="4.3.2" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#model"><i class="fa fa-check"></i><b>4.3.2</b> Model</a></li>
<li class="chapter" data-level="4.3.3" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#compiling-and-fitting-the-model"><i class="fa fa-check"></i><b>4.3.3</b> Compiling and fitting the model</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#parameter-recovery"><i class="fa fa-check"></i><b>4.4</b> Parameter recovery</a></li>
<li class="chapter" data-level="4.5" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#the-memory-model-conditioning-theta"><i class="fa fa-check"></i><b>4.5</b> The memory model: conditioning theta</a></li>
<li class="chapter" data-level="4.6" data-path="practical-exercise-3---getting-into-stan.html"><a href="practical-exercise-3---getting-into-stan.html#memory-agent-with-internal-parameter"><i class="fa fa-check"></i><b>4.6</b> Memory agent with internal parameter</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html"><i class="fa fa-check"></i><b>5</b> Practical exercise 4 - Model quality checks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#generating-and-plotting-additional-variables"><i class="fa fa-check"></i><b>5.1</b> Generating and plotting additional variables</a></li>
<li class="chapter" data-level="5.2" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-priors"><i class="fa fa-check"></i><b>5.2</b> Assessing priors</a></li>
<li class="chapter" data-level="5.3" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#assessing-prior-and-posterior-predictions"><i class="fa fa-check"></i><b>5.3</b> Assessing prior and posterior predictions</a></li>
<li class="chapter" data-level="5.4" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>5.4</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="5.5" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#the-memory-model"><i class="fa fa-check"></i><b>5.5</b> The memory model</a></li>
<li class="chapter" data-level="5.6" data-path="practical-exercise-4---model-quality-checks.html"><a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-check-for-the-memory-model"><i class="fa fa-check"></i><b>5.6</b> Prior sensitivity check for the memory model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">04-ModelQualityChecks</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="practical-exercise-4---model-quality-checks" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Practical exercise 4 - Model quality checks<a href="practical-exercise-4---model-quality-checks.html#practical-exercise-4---model-quality-checks" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This document covers:
- generating and plotting priors (against posteriors)
- generating and plotting predictive checks (prior and posterior ones)
- prior sensitivity checks</p>
<div id="generating-and-plotting-additional-variables" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Generating and plotting additional variables<a href="practical-exercise-4---model-quality-checks.html#generating-and-plotting-additional-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As we try to understand our model, we might want to plot how the prior relates to the posterior, or - in other words, what has the model learned from looking at the data? We can do so by overlaying the prior and the posterior distributions, what is also called a “prior - posterior update check”.</p>
<p>Stan does not automatically save the prior distribution, so we need to tell it to generate and save prior distributions in a convenient place so we can easily plot or use them at will from R. Luckily, Stan gives us a dedicated code chunk to do that: the generated quantities chunk. As before, we need to define the kind of variable we want to save, and then how to generate it.</p>
<p>If we take the example of the random agent (with a bias), we have one parameter: theta.
We can then generate theta according to the prior in generated quantities. While we are at this, we can also generate a nicer version of the posterior estimate for the theta parameter, now in probability scale (instead of log odds).</p>
<p>However, prior and posterior estimates are not always the most immediate thing to understand. For instance, we might have trouble having a good grasp for how the uncertainty in the estimate will play out on 120 trials, or 6 trials, or however many trials we are planning for our experiment. Luckily, we can ask Stan to run predictions from either priors or posteriors, or both: given the priors how many trials will have “right hand” choice? and given the posterior estimates?</p>
<p>As we use complex models, the relation between prior/posterior estimates and predictions becomes less and less intuitive. Simulating their implications for the outcomes - also called prior/posterior predictive checks - becomes a very useful tool to adjust our priors and their uncertainty so that they reflect what we know of the outcome scale; as well as to assess whether the model (and its posterior estimates) can appropriately describe the data we observe, or there’s some bias there. More discussion of this can be found at <a href="https://4ccoxau.github.io/PriorsWorkshop/" class="uri">https://4ccoxau.github.io/PriorsWorkshop/</a>.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="practical-exercise-4---model-quality-checks.html#cb78-1" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb78-2"><a href="practical-exercise-4---model-quality-checks.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="st">// This model infers a random bias from a sequences of 1s and 0s (right and left hand choices)</span></span>
<span id="cb78-3"><a href="practical-exercise-4---model-quality-checks.html#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="practical-exercise-4---model-quality-checks.html#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and the sequence of choices (right as 1, left as 0)</span></span>
<span id="cb78-5"><a href="practical-exercise-4---model-quality-checks.html#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb78-6"><a href="practical-exercise-4---model-quality-checks.html#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower=1&gt; n; // n of trials</span></span>
<span id="cb78-7"><a href="practical-exercise-4---model-quality-checks.html#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="st"> array[n] int h; // sequence of choices (right as 1, left as 0) as long as n</span></span>
<span id="cb78-8"><a href="practical-exercise-4---model-quality-checks.html#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb78-9"><a href="practical-exercise-4---model-quality-checks.html#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="practical-exercise-4---model-quality-checks.html#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters that the model needs to estimate (theta)</span></span>
<span id="cb78-11"><a href="practical-exercise-4---model-quality-checks.html#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb78-12"><a href="practical-exercise-4---model-quality-checks.html#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="st">    real theta; // note it is unbounded as we now work on log odds</span></span>
<span id="cb78-13"><a href="practical-exercise-4---model-quality-checks.html#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb78-14"><a href="practical-exercise-4---model-quality-checks.html#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="practical-exercise-4---model-quality-checks.html#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated (a bernoulli, parameter theta, prior on the theta)</span></span>
<span id="cb78-16"><a href="practical-exercise-4---model-quality-checks.html#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb78-17"><a href="practical-exercise-4---model-quality-checks.html#cb78-17" aria-hidden="true" tabindex="-1"></a><span class="st">  // The prior for theta on a log odds scale is a normal distribution with a mean of 0 and a sd of 1.</span></span>
<span id="cb78-18"><a href="practical-exercise-4---model-quality-checks.html#cb78-18" aria-hidden="true" tabindex="-1"></a><span class="st">  // This covers most of the probability space between 0 and 1, after being converted to probability.</span></span>
<span id="cb78-19"><a href="practical-exercise-4---model-quality-checks.html#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | 0, 1);</span></span>
<span id="cb78-20"><a href="practical-exercise-4---model-quality-checks.html#cb78-20" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb78-21"><a href="practical-exercise-4---model-quality-checks.html#cb78-21" aria-hidden="true" tabindex="-1"></a><span class="st">  // The model consists of a bernoulli distribution (binomial w 1 trial only) with a rate theta,</span></span>
<span id="cb78-22"><a href="practical-exercise-4---model-quality-checks.html#cb78-22" aria-hidden="true" tabindex="-1"></a><span class="st">  // note we specify it uses a logit link (theta is in logodds)</span></span>
<span id="cb78-23"><a href="practical-exercise-4---model-quality-checks.html#cb78-23" aria-hidden="true" tabindex="-1"></a><span class="st">  target += bernoulli_logit_lpmf(h | theta);</span></span>
<span id="cb78-24"><a href="practical-exercise-4---model-quality-checks.html#cb78-24" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb78-25"><a href="practical-exercise-4---model-quality-checks.html#cb78-25" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb78-26"><a href="practical-exercise-4---model-quality-checks.html#cb78-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-27"><a href="practical-exercise-4---model-quality-checks.html#cb78-27" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb78-28"><a href="practical-exercise-4---model-quality-checks.html#cb78-28" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; theta_prior;  // theta prior parameter, on a prob scale (0-1)</span></span>
<span id="cb78-29"><a href="practical-exercise-4---model-quality-checks.html#cb78-29" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; theta_posterior; // theta posterior parameter, on a prob scale (0-1)</span></span>
<span id="cb78-30"><a href="practical-exercise-4---model-quality-checks.html#cb78-30" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; prior_preds;  // distribution of right hand choices according to the prior</span></span>
<span id="cb78-31"><a href="practical-exercise-4---model-quality-checks.html#cb78-31" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; posterior_preds; // distribution of right hand choices according to the posterior</span></span>
<span id="cb78-32"><a href="practical-exercise-4---model-quality-checks.html#cb78-32" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb78-33"><a href="practical-exercise-4---model-quality-checks.html#cb78-33" aria-hidden="true" tabindex="-1"></a><span class="st">  theta_prior = inv_logit(normal_rng(0,1)); // generating the prior on a log odds scale and converting</span></span>
<span id="cb78-34"><a href="practical-exercise-4---model-quality-checks.html#cb78-34" aria-hidden="true" tabindex="-1"></a><span class="st">  theta_posterior = inv_logit(theta);  // converting the posterior estimate from log odds to prob.</span></span>
<span id="cb78-35"><a href="practical-exercise-4---model-quality-checks.html#cb78-35" aria-hidden="true" tabindex="-1"></a><span class="st">  prior_preds = binomial_rng(n, theta_prior);</span></span>
<span id="cb78-36"><a href="practical-exercise-4---model-quality-checks.html#cb78-36" aria-hidden="true" tabindex="-1"></a><span class="st">  posterior_preds = binomial_rng(n, inv_logit(theta));</span></span>
<span id="cb78-37"><a href="practical-exercise-4---model-quality-checks.html#cb78-37" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb78-38"><a href="practical-exercise-4---model-quality-checks.html#cb78-38" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb78-39"><a href="practical-exercise-4---model-quality-checks.html#cb78-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-40"><a href="practical-exercise-4---model-quality-checks.html#cb78-40" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb78-41"><a href="practical-exercise-4---model-quality-checks.html#cb78-41" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb78-42"><a href="practical-exercise-4---model-quality-checks.html#cb78-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb78-43"><a href="practical-exercise-4---model-quality-checks.html#cb78-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W4_SimpleBernoulli_logodds.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W4_SimpleBernoulli_logodds.stan&quot;</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="practical-exercise-4---model-quality-checks.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="do">## With the logit format</span></span>
<span id="cb80-2"><a href="practical-exercise-4---model-quality-checks.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Specify where the model is</span></span>
<span id="cb80-3"><a href="practical-exercise-4---model-quality-checks.html#cb80-3" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W4_SimpleBernoulli_logodds.stan&quot;</span>)</span>
<span id="cb80-4"><a href="practical-exercise-4---model-quality-checks.html#cb80-4" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, </span>
<span id="cb80-5"><a href="practical-exercise-4---model-quality-checks.html#cb80-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-6"><a href="practical-exercise-4---model-quality-checks.html#cb80-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span>
<span id="cb80-7"><a href="practical-exercise-4---model-quality-checks.html#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="practical-exercise-4---model-quality-checks.html#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="practical-exercise-4---model-quality-checks.html#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="practical-exercise-4---model-quality-checks.html#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="practical-exercise-4---model-quality-checks.html#cb80-11" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(noise <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> rate <span class="sc">==</span> <span class="fl">0.8</span>)</span>
<span id="cb80-12"><a href="practical-exercise-4---model-quality-checks.html#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="practical-exercise-4---model-quality-checks.html#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data. N.B. note the two variables have different lengths: 1 for n, n for h.</span></span>
<span id="cb80-14"><a href="practical-exercise-4---model-quality-checks.html#cb80-14" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb80-15"><a href="practical-exercise-4---model-quality-checks.html#cb80-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">120</span>,  <span class="co"># n of trials</span></span>
<span id="cb80-16"><a href="practical-exercise-4---model-quality-checks.html#cb80-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> d1<span class="sc">$</span>choice <span class="co"># sequence of choices (h stands for hand)</span></span>
<span id="cb80-17"><a href="practical-exercise-4---model-quality-checks.html#cb80-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-18"><a href="practical-exercise-4---model-quality-checks.html#cb80-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-19"><a href="practical-exercise-4---model-quality-checks.html#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb80-20"><a href="practical-exercise-4---model-quality-checks.html#cb80-20" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb80-21"><a href="practical-exercise-4---model-quality-checks.html#cb80-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb80-22"><a href="practical-exercise-4---model-quality-checks.html#cb80-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb80-23"><a href="practical-exercise-4---model-quality-checks.html#cb80-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb80-24"><a href="practical-exercise-4---model-quality-checks.html#cb80-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb80-25"><a href="practical-exercise-4---model-quality-checks.html#cb80-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb80-26"><a href="practical-exercise-4---model-quality-checks.html#cb80-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb80-27"><a href="practical-exercise-4---model-quality-checks.html#cb80-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb80-28"><a href="practical-exercise-4---model-quality-checks.html#cb80-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb80-29"><a href="practical-exercise-4---model-quality-checks.html#cb80-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb80-30"><a href="practical-exercise-4---model-quality-checks.html#cb80-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb80-31"><a href="practical-exercise-4---model-quality-checks.html#cb80-31" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 2 parallel chains, with 2 thread(s) per chain...
## 
## Chain 1 finished in 0.1 seconds.
## Chain 2 finished in 0.1 seconds.
## 
## Both chains finished successfully.
## Mean chain execution time: 0.1 seconds.
## Total execution time: 0.1 seconds.</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="practical-exercise-4---model-quality-checks.html#cb82-1" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>()) </span></code></pre></div>
</div>
<div id="assessing-priors" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Assessing priors<a href="practical-exercise-4---model-quality-checks.html#assessing-priors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="practical-exercise-4---model-quality-checks.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let&#39;s plot the density for theta (prior and posterior)</span></span>
<span id="cb83-2"><a href="practical-exercise-4---model-quality-checks.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb83-3"><a href="practical-exercise-4---model-quality-checks.html#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(theta_posterior), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb83-4"><a href="practical-exercise-4---model-quality-checks.html#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(theta_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb83-5"><a href="practical-exercise-4---model-quality-checks.html#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb83-6"><a href="practical-exercise-4---model-quality-checks.html#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-7"><a href="practical-exercise-4---model-quality-checks.html#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Estimate Densities&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-8"><a href="practical-exercise-4---model-quality-checks.html#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/assessing%20priors-1.png" width="672" /></p>
</div>
<div id="assessing-prior-and-posterior-predictions" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Assessing prior and posterior predictions<a href="practical-exercise-4---model-quality-checks.html#assessing-prior-and-posterior-predictions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="practical-exercise-4---model-quality-checks.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb84-2"><a href="practical-exercise-4---model-quality-checks.html#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(prior_preds), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb84-3"><a href="practical-exercise-4---model-quality-checks.html#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted heads out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-4"><a href="practical-exercise-4---model-quality-checks.html#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-5"><a href="practical-exercise-4---model-quality-checks.html#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/predictive%20checks-1.png" width="672" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="practical-exercise-4---model-quality-checks.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb85-2"><a href="practical-exercise-4---model-quality-checks.html#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(posterior_preds), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">bins =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb85-3"><a href="practical-exercise-4---model-quality-checks.html#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="fu">sum</span>(data<span class="sc">$</span>h), <span class="at">y =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">shape =</span> <span class="dv">17</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb85-4"><a href="practical-exercise-4---model-quality-checks.html#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted heads out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-5"><a href="practical-exercise-4---model-quality-checks.html#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-6"><a href="practical-exercise-4---model-quality-checks.html#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/predictive%20checks-2.png" width="672" /></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="practical-exercise-4---model-quality-checks.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb86-2"><a href="practical-exercise-4---model-quality-checks.html#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(prior_preds), <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">bins =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb86-3"><a href="practical-exercise-4---model-quality-checks.html#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(posterior_preds), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">bins =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb86-4"><a href="practical-exercise-4---model-quality-checks.html#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="fu">sum</span>(data<span class="sc">$</span>h), <span class="at">y =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">shape =</span> <span class="dv">17</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb86-5"><a href="practical-exercise-4---model-quality-checks.html#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted heads out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-6"><a href="practical-exercise-4---model-quality-checks.html#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-7"><a href="practical-exercise-4---model-quality-checks.html#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/predictive%20checks-3.png" width="672" /></p>
</div>
<div id="prior-sensitivity-analysis" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Prior sensitivity analysis<a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="practical-exercise-4---model-quality-checks.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we adding different priors for theta</span></span>
<span id="cb87-2"><a href="practical-exercise-4---model-quality-checks.html#cb87-2" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, .<span class="dv">5</span>)</span>
<span id="cb87-3"><a href="practical-exercise-4---model-quality-checks.html#cb87-3" aria-hidden="true" tabindex="-1"></a>prior_sd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)</span>
<span id="cb87-4"><a href="practical-exercise-4---model-quality-checks.html#cb87-4" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span>  <span class="fu">expand.grid</span>(prior_mean, prior_sd)</span>
<span id="cb87-5"><a href="practical-exercise-4---model-quality-checks.html#cb87-5" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">prior_mean =</span> priors<span class="sc">$</span>Var1, <span class="at">prior_sd =</span> priors<span class="sc">$</span>Var2)</span>
<span id="cb87-6"><a href="practical-exercise-4---model-quality-checks.html#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="practical-exercise-4---model-quality-checks.html#cb87-7" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb87-8"><a href="practical-exercise-4---model-quality-checks.html#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="st">  // The input (data) for the model</span></span>
<span id="cb87-9"><a href="practical-exercise-4---model-quality-checks.html#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb87-10"><a href="practical-exercise-4---model-quality-checks.html#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; n;</span></span>
<span id="cb87-11"><a href="practical-exercise-4---model-quality-checks.html#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="st">  array[n] int h;</span></span>
<span id="cb87-12"><a href="practical-exercise-4---model-quality-checks.html#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="st">  real prior_mean;</span></span>
<span id="cb87-13"><a href="practical-exercise-4---model-quality-checks.html#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; prior_sd;</span></span>
<span id="cb87-14"><a href="practical-exercise-4---model-quality-checks.html#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb87-15"><a href="practical-exercise-4---model-quality-checks.html#cb87-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-16"><a href="practical-exercise-4---model-quality-checks.html#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb87-17"><a href="practical-exercise-4---model-quality-checks.html#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb87-18"><a href="practical-exercise-4---model-quality-checks.html#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="st">  real theta;</span></span>
<span id="cb87-19"><a href="practical-exercise-4---model-quality-checks.html#cb87-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb87-20"><a href="practical-exercise-4---model-quality-checks.html#cb87-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-21"><a href="practical-exercise-4---model-quality-checks.html#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb87-22"><a href="practical-exercise-4---model-quality-checks.html#cb87-22" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb87-23"><a href="practical-exercise-4---model-quality-checks.html#cb87-23" aria-hidden="true" tabindex="-1"></a><span class="st">  // Prior</span></span>
<span id="cb87-24"><a href="practical-exercise-4---model-quality-checks.html#cb87-24" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(theta | prior_mean, prior_sd);</span></span>
<span id="cb87-25"><a href="practical-exercise-4---model-quality-checks.html#cb87-25" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb87-26"><a href="practical-exercise-4---model-quality-checks.html#cb87-26" aria-hidden="true" tabindex="-1"></a><span class="st">  // Model</span></span>
<span id="cb87-27"><a href="practical-exercise-4---model-quality-checks.html#cb87-27" aria-hidden="true" tabindex="-1"></a><span class="st">  target += bernoulli_logit_lpmf(h | theta);</span></span>
<span id="cb87-28"><a href="practical-exercise-4---model-quality-checks.html#cb87-28" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb87-29"><a href="practical-exercise-4---model-quality-checks.html#cb87-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-30"><a href="practical-exercise-4---model-quality-checks.html#cb87-30" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb87-31"><a href="practical-exercise-4---model-quality-checks.html#cb87-31" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; theta_prior;</span></span>
<span id="cb87-32"><a href="practical-exercise-4---model-quality-checks.html#cb87-32" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0, upper=1&gt; theta_posterior;</span></span>
<span id="cb87-33"><a href="practical-exercise-4---model-quality-checks.html#cb87-33" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; prior_preds;</span></span>
<span id="cb87-34"><a href="practical-exercise-4---model-quality-checks.html#cb87-34" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; posterior_preds;</span></span>
<span id="cb87-35"><a href="practical-exercise-4---model-quality-checks.html#cb87-35" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb87-36"><a href="practical-exercise-4---model-quality-checks.html#cb87-36" aria-hidden="true" tabindex="-1"></a><span class="st">  theta_prior = inv_logit(normal_rng(0,1));</span></span>
<span id="cb87-37"><a href="practical-exercise-4---model-quality-checks.html#cb87-37" aria-hidden="true" tabindex="-1"></a><span class="st">  theta_posterior = inv_logit(theta);</span></span>
<span id="cb87-38"><a href="practical-exercise-4---model-quality-checks.html#cb87-38" aria-hidden="true" tabindex="-1"></a><span class="st">  prior_preds = binomial_rng(n, theta_prior);</span></span>
<span id="cb87-39"><a href="practical-exercise-4---model-quality-checks.html#cb87-39" aria-hidden="true" tabindex="-1"></a><span class="st">  posterior_preds = binomial_rng(n, inv_logit(theta));</span></span>
<span id="cb87-40"><a href="practical-exercise-4---model-quality-checks.html#cb87-40" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb87-41"><a href="practical-exercise-4---model-quality-checks.html#cb87-41" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb87-42"><a href="practical-exercise-4---model-quality-checks.html#cb87-42" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb87-43"><a href="practical-exercise-4---model-quality-checks.html#cb87-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-44"><a href="practical-exercise-4---model-quality-checks.html#cb87-44" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb87-45"><a href="practical-exercise-4---model-quality-checks.html#cb87-45" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb87-46"><a href="practical-exercise-4---model-quality-checks.html#cb87-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb87-47"><a href="practical-exercise-4---model-quality-checks.html#cb87-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W4_PriorBernoulli.stan&quot;</span>)</span>
<span id="cb87-48"><a href="practical-exercise-4---model-quality-checks.html#cb87-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-49"><a href="practical-exercise-4---model-quality-checks.html#cb87-49" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W4_PriorBernoulli.stan&quot;</span>)</span>
<span id="cb87-50"><a href="practical-exercise-4---model-quality-checks.html#cb87-50" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>))</span>
<span id="cb87-51"><a href="practical-exercise-4---model-quality-checks.html#cb87-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-52"><a href="practical-exercise-4---model-quality-checks.html#cb87-52" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(noise <span class="sc">==</span> <span class="fl">0.1</span> <span class="sc">&amp;</span> rate <span class="sc">==</span> <span class="fl">0.8</span>)</span>
<span id="cb87-53"><a href="practical-exercise-4---model-quality-checks.html#cb87-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-54"><a href="practical-exercise-4---model-quality-checks.html#cb87-54" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(future, purrr, furrr)</span>
<span id="cb87-55"><a href="practical-exercise-4---model-quality-checks.html#cb87-55" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">4</span>)</span>
<span id="cb87-56"><a href="practical-exercise-4---model-quality-checks.html#cb87-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-57"><a href="practical-exercise-4---model-quality-checks.html#cb87-57" aria-hidden="true" tabindex="-1"></a>sim_d_and_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(prior_mean, prior_sd) {</span>
<span id="cb87-58"><a href="practical-exercise-4---model-quality-checks.html#cb87-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-59"><a href="practical-exercise-4---model-quality-checks.html#cb87-59" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb87-60"><a href="practical-exercise-4---model-quality-checks.html#cb87-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">n =</span> <span class="fu">nrow</span>(dd),</span>
<span id="cb87-61"><a href="practical-exercise-4---model-quality-checks.html#cb87-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">h =</span> dd<span class="sc">$</span>choice,</span>
<span id="cb87-62"><a href="practical-exercise-4---model-quality-checks.html#cb87-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">prior_mean =</span> prior_mean,</span>
<span id="cb87-63"><a href="practical-exercise-4---model-quality-checks.html#cb87-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">prior_sd =</span> prior_sd</span>
<span id="cb87-64"><a href="practical-exercise-4---model-quality-checks.html#cb87-64" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb87-65"><a href="practical-exercise-4---model-quality-checks.html#cb87-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-66"><a href="practical-exercise-4---model-quality-checks.html#cb87-66" aria-hidden="true" tabindex="-1"></a>    samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb87-67"><a href="practical-exercise-4---model-quality-checks.html#cb87-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb87-68"><a href="practical-exercise-4---model-quality-checks.html#cb87-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">1000</span>,</span>
<span id="cb87-69"><a href="practical-exercise-4---model-quality-checks.html#cb87-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb87-70"><a href="practical-exercise-4---model-quality-checks.html#cb87-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb87-71"><a href="practical-exercise-4---model-quality-checks.html#cb87-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">threads_per_chain =</span> <span class="dv">1</span>,</span>
<span id="cb87-72"><a href="practical-exercise-4---model-quality-checks.html#cb87-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb87-73"><a href="practical-exercise-4---model-quality-checks.html#cb87-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb87-74"><a href="practical-exercise-4---model-quality-checks.html#cb87-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb87-75"><a href="practical-exercise-4---model-quality-checks.html#cb87-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb87-76"><a href="practical-exercise-4---model-quality-checks.html#cb87-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb87-77"><a href="practical-exercise-4---model-quality-checks.html#cb87-77" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb87-78"><a href="practical-exercise-4---model-quality-checks.html#cb87-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-79"><a href="practical-exercise-4---model-quality-checks.html#cb87-79" aria-hidden="true" tabindex="-1"></a>    draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>()) </span>
<span id="cb87-80"><a href="practical-exercise-4---model-quality-checks.html#cb87-80" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta_prior =</span> draws_df<span class="sc">$</span>theta_prior, </span>
<span id="cb87-81"><a href="practical-exercise-4---model-quality-checks.html#cb87-81" aria-hidden="true" tabindex="-1"></a>                     <span class="at">theta_posterior =</span> draws_df<span class="sc">$</span>theta_posterior, </span>
<span id="cb87-82"><a href="practical-exercise-4---model-quality-checks.html#cb87-82" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_preds =</span> draws_df<span class="sc">$</span>prior_preds, </span>
<span id="cb87-83"><a href="practical-exercise-4---model-quality-checks.html#cb87-83" aria-hidden="true" tabindex="-1"></a>                     <span class="at">posterior_preds =</span> draws_df<span class="sc">$</span>posterior_preds, </span>
<span id="cb87-84"><a href="practical-exercise-4---model-quality-checks.html#cb87-84" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_mean =</span> prior_mean,</span>
<span id="cb87-85"><a href="practical-exercise-4---model-quality-checks.html#cb87-85" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_sd =</span> prior_sd)</span>
<span id="cb87-86"><a href="practical-exercise-4---model-quality-checks.html#cb87-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-87"><a href="practical-exercise-4---model-quality-checks.html#cb87-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(temp)</span>
<span id="cb87-88"><a href="practical-exercise-4---model-quality-checks.html#cb87-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-89"><a href="practical-exercise-4---model-quality-checks.html#cb87-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-90"><a href="practical-exercise-4---model-quality-checks.html#cb87-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-91"><a href="practical-exercise-4---model-quality-checks.html#cb87-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-92"><a href="practical-exercise-4---model-quality-checks.html#cb87-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-93"><a href="practical-exercise-4---model-quality-checks.html#cb87-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-94"><a href="practical-exercise-4---model-quality-checks.html#cb87-94" aria-hidden="true" tabindex="-1"></a>recovery_df <span class="ot">&lt;-</span> <span class="fu">future_pmap_dfr</span>(priors, sim_d_and_fit, <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb87-95"><a href="practical-exercise-4---model-quality-checks.html#cb87-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-96"><a href="practical-exercise-4---model-quality-checks.html#cb87-96" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(recovery_df, <span class="st">&quot;simdata/W4_priorSensitivityRecovery.csv&quot;</span>)</span></code></pre></div>
<p>Now we load the data and plot it</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="practical-exercise-4---model-quality-checks.html#cb88-1" aria-hidden="true" tabindex="-1"></a>recovery_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;simdata/W4_priorSensitivityRecovery.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 260000 Columns: 6
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (6): theta_prior, theta_posterior, prior_preds, posterior_preds, prior_mean, prior_sd
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="practical-exercise-4---model-quality-checks.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(recovery_df, <span class="fu">aes</span>(prior_mean, theta_posterior)) <span class="sc">+</span></span>
<span id="cb90-2"><a href="practical-exercise-4---model-quality-checks.html#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb90-3"><a href="practical-exercise-4---model-quality-checks.html#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.8</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-4"><a href="practical-exercise-4---model-quality-checks.html#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb90-5"><a href="practical-exercise-4---model-quality-checks.html#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>prior_sd) <span class="sc">+</span></span>
<span id="cb90-6"><a href="practical-exercise-4---model-quality-checks.html#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula = &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
<div id="the-memory-model" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> The memory model<a href="practical-exercise-4---model-quality-checks.html#the-memory-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can do the same for the memory model: generate prior distributions to overlay to the posteriors (prior-posterior update checks), generate predicted outcomes based on the priors (prior predictive checks) and on the posteriors (posterior predictive checks).
N.B. prior and posterior predictions now depend on the value on memory. I identified 3 meaningful values for the memory value (e.g. 0.5, 0.7, 0.9) and used those to generate 3 prior and posterior predictive checks.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="practical-exercise-4---model-quality-checks.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We subset to only include no noise and a specific rate</span></span>
<span id="cb92-2"><a href="practical-exercise-4---model-quality-checks.html#cb92-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb92-3"><a href="practical-exercise-4---model-quality-checks.html#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(noise <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> rate <span class="sc">==</span> <span class="fl">0.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-4"><a href="practical-exercise-4---model-quality-checks.html#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Other =</span> choice) <span class="sc">%&gt;%</span> </span>
<span id="cb92-5"><a href="practical-exercise-4---model-quality-checks.html#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cumulativerate =</span> <span class="fu">logit_scaled</span>(<span class="fu">lag</span>(cumulativerate, <span class="dv">1</span>)))</span>
<span id="cb92-6"><a href="practical-exercise-4---model-quality-checks.html#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="practical-exercise-4---model-quality-checks.html#cb92-7" aria-hidden="true" tabindex="-1"></a>d1<span class="sc">$</span>cumulativerate[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># no prior info at first trial</span></span>
<span id="cb92-8"><a href="practical-exercise-4---model-quality-checks.html#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="practical-exercise-4---model-quality-checks.html#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we create the memory agent with a coefficient of 0.9</span></span>
<span id="cb92-10"><a href="practical-exercise-4---model-quality-checks.html#cb92-10" aria-hidden="true" tabindex="-1"></a>bias <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb92-11"><a href="practical-exercise-4---model-quality-checks.html#cb92-11" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">=</span> <span class="fl">0.9</span></span>
<span id="cb92-12"><a href="practical-exercise-4---model-quality-checks.html#cb92-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-13"><a href="practical-exercise-4---model-quality-checks.html#cb92-13" aria-hidden="true" tabindex="-1"></a>MemoryAgent_f <span class="ot">&lt;-</span> <span class="cf">function</span>(bias, beta, cumulativerate){</span>
<span id="cb92-14"><a href="practical-exercise-4---model-quality-checks.html#cb92-14" aria-hidden="true" tabindex="-1"></a>    choice <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">inv_logit_scaled</span>(bias <span class="sc">+</span> beta <span class="sc">*</span> cumulativerate))</span>
<span id="cb92-15"><a href="practical-exercise-4---model-quality-checks.html#cb92-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(choice)</span>
<span id="cb92-16"><a href="practical-exercise-4---model-quality-checks.html#cb92-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-17"><a href="practical-exercise-4---model-quality-checks.html#cb92-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-18"><a href="practical-exercise-4---model-quality-checks.html#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>trials) {</span>
<span id="cb92-19"><a href="practical-exercise-4---model-quality-checks.html#cb92-19" aria-hidden="true" tabindex="-1"></a>  d1<span class="sc">$</span>Self[i] <span class="ot">&lt;-</span> <span class="fu">MemoryAgent_f</span>(bias, beta, d1<span class="sc">$</span>cumulativerate[i])</span>
<span id="cb92-20"><a href="practical-exercise-4---model-quality-checks.html#cb92-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-21"><a href="practical-exercise-4---model-quality-checks.html#cb92-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-22"><a href="practical-exercise-4---model-quality-checks.html#cb92-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-23"><a href="practical-exercise-4---model-quality-checks.html#cb92-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the data. </span></span>
<span id="cb92-24"><a href="practical-exercise-4---model-quality-checks.html#cb92-24" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb92-25"><a href="practical-exercise-4---model-quality-checks.html#cb92-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">120</span>,</span>
<span id="cb92-26"><a href="practical-exercise-4---model-quality-checks.html#cb92-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> d1<span class="sc">$</span>Self,</span>
<span id="cb92-27"><a href="practical-exercise-4---model-quality-checks.html#cb92-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">other =</span> d1<span class="sc">$</span>Other</span>
<span id="cb92-28"><a href="practical-exercise-4---model-quality-checks.html#cb92-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb92-29"><a href="practical-exercise-4---model-quality-checks.html#cb92-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-30"><a href="practical-exercise-4---model-quality-checks.html#cb92-30" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb92-31"><a href="practical-exercise-4---model-quality-checks.html#cb92-31" aria-hidden="true" tabindex="-1"></a><span class="st">// The input (data) for the model. n of trials and h for (right and left) hand</span></span>
<span id="cb92-32"><a href="practical-exercise-4---model-quality-checks.html#cb92-32" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb92-33"><a href="practical-exercise-4---model-quality-checks.html#cb92-33" aria-hidden="true" tabindex="-1"></a><span class="st"> int&lt;lower=1&gt; n;</span></span>
<span id="cb92-34"><a href="practical-exercise-4---model-quality-checks.html#cb92-34" aria-hidden="true" tabindex="-1"></a><span class="st"> array[n] int h;</span></span>
<span id="cb92-35"><a href="practical-exercise-4---model-quality-checks.html#cb92-35" aria-hidden="true" tabindex="-1"></a><span class="st"> array[n] int other;</span></span>
<span id="cb92-36"><a href="practical-exercise-4---model-quality-checks.html#cb92-36" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb92-37"><a href="practical-exercise-4---model-quality-checks.html#cb92-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-38"><a href="practical-exercise-4---model-quality-checks.html#cb92-38" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb92-39"><a href="practical-exercise-4---model-quality-checks.html#cb92-39" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb92-40"><a href="practical-exercise-4---model-quality-checks.html#cb92-40" aria-hidden="true" tabindex="-1"></a><span class="st">  real bias; // how likely is the agent to pick right when the previous rate has no information (50-50)?</span></span>
<span id="cb92-41"><a href="practical-exercise-4---model-quality-checks.html#cb92-41" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta; // how strongly is previous rate impacting the decision?</span></span>
<span id="cb92-42"><a href="practical-exercise-4---model-quality-checks.html#cb92-42" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb92-43"><a href="practical-exercise-4---model-quality-checks.html#cb92-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-44"><a href="practical-exercise-4---model-quality-checks.html#cb92-44" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters{</span></span>
<span id="cb92-45"><a href="practical-exercise-4---model-quality-checks.html#cb92-45" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[n] memory;</span></span>
<span id="cb92-46"><a href="practical-exercise-4---model-quality-checks.html#cb92-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-47"><a href="practical-exercise-4---model-quality-checks.html#cb92-47" aria-hidden="true" tabindex="-1"></a><span class="st">  for (trial in 1:n){</span></span>
<span id="cb92-48"><a href="practical-exercise-4---model-quality-checks.html#cb92-48" aria-hidden="true" tabindex="-1"></a><span class="st">  if (trial == 1) {</span></span>
<span id="cb92-49"><a href="practical-exercise-4---model-quality-checks.html#cb92-49" aria-hidden="true" tabindex="-1"></a><span class="st">    memory[trial] = 0.5;</span></span>
<span id="cb92-50"><a href="practical-exercise-4---model-quality-checks.html#cb92-50" aria-hidden="true" tabindex="-1"></a><span class="st">  } </span></span>
<span id="cb92-51"><a href="practical-exercise-4---model-quality-checks.html#cb92-51" aria-hidden="true" tabindex="-1"></a><span class="st">  if (trial &lt; n){</span></span>
<span id="cb92-52"><a href="practical-exercise-4---model-quality-checks.html#cb92-52" aria-hidden="true" tabindex="-1"></a><span class="st">      memory[trial + 1] = memory[trial] + ((other[trial] - memory[trial]) / trial);</span></span>
<span id="cb92-53"><a href="practical-exercise-4---model-quality-checks.html#cb92-53" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb92-54"><a href="practical-exercise-4---model-quality-checks.html#cb92-54" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb92-55"><a href="practical-exercise-4---model-quality-checks.html#cb92-55" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb92-56"><a href="practical-exercise-4---model-quality-checks.html#cb92-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-57"><a href="practical-exercise-4---model-quality-checks.html#cb92-57" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb92-58"><a href="practical-exercise-4---model-quality-checks.html#cb92-58" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb92-59"><a href="practical-exercise-4---model-quality-checks.html#cb92-59" aria-hidden="true" tabindex="-1"></a><span class="st">  // Priors</span></span>
<span id="cb92-60"><a href="practical-exercise-4---model-quality-checks.html#cb92-60" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | 0, .3);</span></span>
<span id="cb92-61"><a href="practical-exercise-4---model-quality-checks.html#cb92-61" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(beta | 0, .5);</span></span>
<span id="cb92-62"><a href="practical-exercise-4---model-quality-checks.html#cb92-62" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb92-63"><a href="practical-exercise-4---model-quality-checks.html#cb92-63" aria-hidden="true" tabindex="-1"></a><span class="st">  // Model, looping to keep track of memory</span></span>
<span id="cb92-64"><a href="practical-exercise-4---model-quality-checks.html#cb92-64" aria-hidden="true" tabindex="-1"></a><span class="st">  for (trial in 1:n) {</span></span>
<span id="cb92-65"><a href="practical-exercise-4---model-quality-checks.html#cb92-65" aria-hidden="true" tabindex="-1"></a><span class="st">    target += bernoulli_logit_lpmf(h[trial] | bias + beta * inv_logit(memory[trial]));</span></span>
<span id="cb92-66"><a href="practical-exercise-4---model-quality-checks.html#cb92-66" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb92-67"><a href="practical-exercise-4---model-quality-checks.html#cb92-67" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb92-68"><a href="practical-exercise-4---model-quality-checks.html#cb92-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-69"><a href="practical-exercise-4---model-quality-checks.html#cb92-69" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb92-70"><a href="practical-exercise-4---model-quality-checks.html#cb92-70" aria-hidden="true" tabindex="-1"></a><span class="st">  real bias_prior;</span></span>
<span id="cb92-71"><a href="practical-exercise-4---model-quality-checks.html#cb92-71" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta_prior;</span></span>
<span id="cb92-72"><a href="practical-exercise-4---model-quality-checks.html#cb92-72" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; prior_preds5;</span></span>
<span id="cb92-73"><a href="practical-exercise-4---model-quality-checks.html#cb92-73" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; post_preds5;</span></span>
<span id="cb92-74"><a href="practical-exercise-4---model-quality-checks.html#cb92-74" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; prior_preds7;</span></span>
<span id="cb92-75"><a href="practical-exercise-4---model-quality-checks.html#cb92-75" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; post_preds7;</span></span>
<span id="cb92-76"><a href="practical-exercise-4---model-quality-checks.html#cb92-76" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; prior_preds9;</span></span>
<span id="cb92-77"><a href="practical-exercise-4---model-quality-checks.html#cb92-77" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; post_preds9;</span></span>
<span id="cb92-78"><a href="practical-exercise-4---model-quality-checks.html#cb92-78" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb92-79"><a href="practical-exercise-4---model-quality-checks.html#cb92-79" aria-hidden="true" tabindex="-1"></a><span class="st">  bias_prior = normal_rng(0, 0.1);</span></span>
<span id="cb92-80"><a href="practical-exercise-4---model-quality-checks.html#cb92-80" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_prior = normal_rng(0, 0.5);</span></span>
<span id="cb92-81"><a href="practical-exercise-4---model-quality-checks.html#cb92-81" aria-hidden="true" tabindex="-1"></a><span class="st">  prior_preds5 = binomial_rng(n, inv_logit(bias_prior + beta_prior * 0.5));</span></span>
<span id="cb92-82"><a href="practical-exercise-4---model-quality-checks.html#cb92-82" aria-hidden="true" tabindex="-1"></a><span class="st">  prior_preds7 = binomial_rng(n, inv_logit(bias_prior + beta_prior * 0.7));</span></span>
<span id="cb92-83"><a href="practical-exercise-4---model-quality-checks.html#cb92-83" aria-hidden="true" tabindex="-1"></a><span class="st">  prior_preds9 = binomial_rng(n, inv_logit(bias_prior + beta_prior * 0.9));</span></span>
<span id="cb92-84"><a href="practical-exercise-4---model-quality-checks.html#cb92-84" aria-hidden="true" tabindex="-1"></a><span class="st">  post_preds5 = binomial_rng(n, inv_logit(bias + beta * 0.5));</span></span>
<span id="cb92-85"><a href="practical-exercise-4---model-quality-checks.html#cb92-85" aria-hidden="true" tabindex="-1"></a><span class="st">  post_preds7 = binomial_rng(n, inv_logit(bias + beta * 0.7));</span></span>
<span id="cb92-86"><a href="practical-exercise-4---model-quality-checks.html#cb92-86" aria-hidden="true" tabindex="-1"></a><span class="st">  post_preds9 = binomial_rng(n, inv_logit(bias + beta * 0.9));</span></span>
<span id="cb92-87"><a href="practical-exercise-4---model-quality-checks.html#cb92-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-88"><a href="practical-exercise-4---model-quality-checks.html#cb92-88" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb92-89"><a href="practical-exercise-4---model-quality-checks.html#cb92-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-90"><a href="practical-exercise-4---model-quality-checks.html#cb92-90" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb92-91"><a href="practical-exercise-4---model-quality-checks.html#cb92-91" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb92-92"><a href="practical-exercise-4---model-quality-checks.html#cb92-92" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb92-93"><a href="practical-exercise-4---model-quality-checks.html#cb92-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb92-94"><a href="practical-exercise-4---model-quality-checks.html#cb92-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W4_MemoryBernoulli.stan&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/Users/au209589/Dropbox/Teaching/AdvancedCognitiveModeling23_book/stan/W4_MemoryBernoulli.stan&quot;</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="practical-exercise-4---model-quality-checks.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Specify where the model is</span></span>
<span id="cb94-2"><a href="practical-exercise-4---model-quality-checks.html#cb94-2" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W4_MemoryBernoulli.stan&quot;</span>)</span>
<span id="cb94-3"><a href="practical-exercise-4---model-quality-checks.html#cb94-3" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>),</span>
<span id="cb94-4"><a href="practical-exercise-4---model-quality-checks.html#cb94-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">&quot;O1&quot;</span>))</span></code></pre></div>
<pre><code>## 
-

\

|

/

-

\

|

/

-

\

|

/

-

\

|

/

-

\

|

/

-

\

|

/

-

 </code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="practical-exercise-4---model-quality-checks.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command calls Stan with specific options.</span></span>
<span id="cb96-2"><a href="practical-exercise-4---model-quality-checks.html#cb96-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb96-3"><a href="practical-exercise-4---model-quality-checks.html#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb96-4"><a href="practical-exercise-4---model-quality-checks.html#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb96-5"><a href="practical-exercise-4---model-quality-checks.html#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb96-6"><a href="practical-exercise-4---model-quality-checks.html#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> <span class="dv">2</span>,</span>
<span id="cb96-7"><a href="practical-exercise-4---model-quality-checks.html#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads_per_chain =</span> <span class="dv">2</span>,</span>
<span id="cb96-8"><a href="practical-exercise-4---model-quality-checks.html#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb96-9"><a href="practical-exercise-4---model-quality-checks.html#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb96-10"><a href="practical-exercise-4---model-quality-checks.html#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb96-11"><a href="practical-exercise-4---model-quality-checks.html#cb96-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb96-12"><a href="practical-exercise-4---model-quality-checks.html#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb96-13"><a href="practical-exercise-4---model-quality-checks.html#cb96-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 1 chain, with 2 thread(s) per chain...
## 
## Chain 1 finished in 0.6 seconds.</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="practical-exercise-4---model-quality-checks.html#cb98-1" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span><span class="fu">summary</span>() </span></code></pre></div>
<pre><code>## # A tibble: 131 × 10
##    variable     mean  median    sd   mad       q5     q95  rhat ess_bulk ess_tail
##    &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 lp__      -75.6   -75.3   1.00  0.662 -77.7    -74.7    1.00     393.     402.
##  2 bias        0.295   0.285 0.230 0.215  -0.0744   0.671  1.01     282.     264.
##  3 beta        0.612   0.613 0.363 0.356   0.0237   1.23   1.00     254.     251.
##  4 memory[1]   0.5     0.5   0     0       0.5      0.5   NA         NA       NA 
##  5 memory[2]   1       1     0     0       1        1     NA         NA       NA 
##  6 memory[3]   1       1     0     0       1        1     NA         NA       NA 
##  7 memory[4]   1       1     0     0       1        1     NA         NA       NA 
##  8 memory[5]   1       1     0     0       1        1     NA         NA       NA 
##  9 memory[6]   1       1     0     0       1        1     NA         NA       NA 
## 10 memory[7]   0.833   0.833 0     0       0.833    0.833 NA         NA       NA 
## # … with 121 more rows</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="practical-exercise-4---model-quality-checks.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract posterior samples and include sampling of the prior:</span></span>
<span id="cb100-2"><a href="practical-exercise-4---model-quality-checks.html#cb100-2" aria-hidden="true" tabindex="-1"></a>draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>())</span>
<span id="cb100-3"><a href="practical-exercise-4---model-quality-checks.html#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="practical-exercise-4---model-quality-checks.html#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="practical-exercise-4---model-quality-checks.html#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let&#39;s plot the density for bias (prior and posterior)</span></span>
<span id="cb100-6"><a href="practical-exercise-4---model-quality-checks.html#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb100-7"><a href="practical-exercise-4---model-quality-checks.html#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(bias), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb100-8"><a href="practical-exercise-4---model-quality-checks.html#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(bias_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb100-9"><a href="practical-exercise-4---model-quality-checks.html#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb100-10"><a href="practical-exercise-4---model-quality-checks.html#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Bias&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-11"><a href="practical-exercise-4---model-quality-checks.html#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-12"><a href="practical-exercise-4---model-quality-checks.html#cb100-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/memory%20model-1.png" width="672" /></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="practical-exercise-4---model-quality-checks.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb101-2"><a href="practical-exercise-4---model-quality-checks.html#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(beta), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb101-3"><a href="practical-exercise-4---model-quality-checks.html#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(beta_prior), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb101-4"><a href="practical-exercise-4---model-quality-checks.html#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.9</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb101-5"><a href="practical-exercise-4---model-quality-checks.html#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;MemoryBeta&quot;</span>) <span class="sc">+</span></span>
<span id="cb101-6"><a href="practical-exercise-4---model-quality-checks.html#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb101-7"><a href="practical-exercise-4---model-quality-checks.html#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/memory%20model-2.png" width="672" /></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="practical-exercise-4---model-quality-checks.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb102-2"><a href="practical-exercise-4---model-quality-checks.html#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds5</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightyellow&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb102-3"><a href="practical-exercise-4---model-quality-checks.html#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds7</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;green&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb102-4"><a href="practical-exercise-4---model-quality-checks.html#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds9</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb102-5"><a href="practical-exercise-4---model-quality-checks.html#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted heads out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb102-6"><a href="practical-exercise-4---model-quality-checks.html#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb102-7"><a href="practical-exercise-4---model-quality-checks.html#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/memory%20model-3.png" width="672" /></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="practical-exercise-4---model-quality-checks.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb103-2"><a href="practical-exercise-4---model-quality-checks.html#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">post_preds5</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightyellow&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">bins =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb103-3"><a href="practical-exercise-4---model-quality-checks.html#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">post_preds7</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;green&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">bins =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb103-4"><a href="practical-exercise-4---model-quality-checks.html#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">post_preds9</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">bins =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb103-5"><a href="practical-exercise-4---model-quality-checks.html#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(x = sum(data$h), y = 0, color = &quot;red&quot;, shape = 17, size = 5) +</span></span>
<span id="cb103-6"><a href="practical-exercise-4---model-quality-checks.html#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted heads out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-7"><a href="practical-exercise-4---model-quality-checks.html#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-8"><a href="practical-exercise-4---model-quality-checks.html#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/memory%20model-4.png" width="672" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="practical-exercise-4---model-quality-checks.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(draws_df) <span class="sc">+</span></span>
<span id="cb104-2"><a href="practical-exercise-4---model-quality-checks.html#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">prior_preds5</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">bins =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb104-3"><a href="practical-exercise-4---model-quality-checks.html#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">post_preds5</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">bins =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb104-4"><a href="practical-exercise-4---model-quality-checks.html#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Predicted heads out of 120 trials&quot;</span>) <span class="sc">+</span></span>
<span id="cb104-5"><a href="practical-exercise-4---model-quality-checks.html#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Posterior Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb104-6"><a href="practical-exercise-4---model-quality-checks.html#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/memory%20model-5.png" width="672" /></p>
</div>
<div id="prior-sensitivity-check-for-the-memory-model" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> Prior sensitivity check for the memory model<a href="practical-exercise-4---model-quality-checks.html#prior-sensitivity-check-for-the-memory-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="practical-exercise-4---model-quality-checks.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we adding different priors for theta</span></span>
<span id="cb105-2"><a href="practical-exercise-4---model-quality-checks.html#cb105-2" aria-hidden="true" tabindex="-1"></a>prior_mean_bias <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb105-3"><a href="practical-exercise-4---model-quality-checks.html#cb105-3" aria-hidden="true" tabindex="-1"></a>prior_sd_bias <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>)</span>
<span id="cb105-4"><a href="practical-exercise-4---model-quality-checks.html#cb105-4" aria-hidden="true" tabindex="-1"></a>prior_mean_beta <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb105-5"><a href="practical-exercise-4---model-quality-checks.html#cb105-5" aria-hidden="true" tabindex="-1"></a>prior_sd_beta <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>)</span>
<span id="cb105-6"><a href="practical-exercise-4---model-quality-checks.html#cb105-6" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="fu">expand.grid</span>(<span class="fu">tibble</span>(prior_mean_bias, prior_sd_bias, prior_mean_beta, prior_sd_beta)))</span>
<span id="cb105-7"><a href="practical-exercise-4---model-quality-checks.html#cb105-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-8"><a href="practical-exercise-4---model-quality-checks.html#cb105-8" aria-hidden="true" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb105-9"><a href="practical-exercise-4---model-quality-checks.html#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="st">  // The input (data) for the model</span></span>
<span id="cb105-10"><a href="practical-exercise-4---model-quality-checks.html#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb105-11"><a href="practical-exercise-4---model-quality-checks.html#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=1&gt; n;</span></span>
<span id="cb105-12"><a href="practical-exercise-4---model-quality-checks.html#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="st">  array[n] int h;</span></span>
<span id="cb105-13"><a href="practical-exercise-4---model-quality-checks.html#cb105-13" aria-hidden="true" tabindex="-1"></a><span class="st">  array[n] int other;</span></span>
<span id="cb105-14"><a href="practical-exercise-4---model-quality-checks.html#cb105-14" aria-hidden="true" tabindex="-1"></a><span class="st">  real prior_mean_bias;</span></span>
<span id="cb105-15"><a href="practical-exercise-4---model-quality-checks.html#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; prior_sd_bias;</span></span>
<span id="cb105-16"><a href="practical-exercise-4---model-quality-checks.html#cb105-16" aria-hidden="true" tabindex="-1"></a><span class="st">  real prior_mean_beta;</span></span>
<span id="cb105-17"><a href="practical-exercise-4---model-quality-checks.html#cb105-17" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; prior_sd_beta;</span></span>
<span id="cb105-18"><a href="practical-exercise-4---model-quality-checks.html#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb105-19"><a href="practical-exercise-4---model-quality-checks.html#cb105-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-20"><a href="practical-exercise-4---model-quality-checks.html#cb105-20" aria-hidden="true" tabindex="-1"></a><span class="st">// The parameters accepted by the model. </span></span>
<span id="cb105-21"><a href="practical-exercise-4---model-quality-checks.html#cb105-21" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb105-22"><a href="practical-exercise-4---model-quality-checks.html#cb105-22" aria-hidden="true" tabindex="-1"></a><span class="st">  real bias; // how likely is the agent to pick right when the previous rate has no information (50-50)?</span></span>
<span id="cb105-23"><a href="practical-exercise-4---model-quality-checks.html#cb105-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta; // how strongly is previous rate impacting the decision?</span></span>
<span id="cb105-24"><a href="practical-exercise-4---model-quality-checks.html#cb105-24" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb105-25"><a href="practical-exercise-4---model-quality-checks.html#cb105-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-26"><a href="practical-exercise-4---model-quality-checks.html#cb105-26" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters{</span></span>
<span id="cb105-27"><a href="practical-exercise-4---model-quality-checks.html#cb105-27" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[n] memory;</span></span>
<span id="cb105-28"><a href="practical-exercise-4---model-quality-checks.html#cb105-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-29"><a href="practical-exercise-4---model-quality-checks.html#cb105-29" aria-hidden="true" tabindex="-1"></a><span class="st">  for (trial in 1:n){</span></span>
<span id="cb105-30"><a href="practical-exercise-4---model-quality-checks.html#cb105-30" aria-hidden="true" tabindex="-1"></a><span class="st">  if (trial == 1) {</span></span>
<span id="cb105-31"><a href="practical-exercise-4---model-quality-checks.html#cb105-31" aria-hidden="true" tabindex="-1"></a><span class="st">    memory[trial] = 0.5;</span></span>
<span id="cb105-32"><a href="practical-exercise-4---model-quality-checks.html#cb105-32" aria-hidden="true" tabindex="-1"></a><span class="st">  } </span></span>
<span id="cb105-33"><a href="practical-exercise-4---model-quality-checks.html#cb105-33" aria-hidden="true" tabindex="-1"></a><span class="st">  if (trial &lt; n){</span></span>
<span id="cb105-34"><a href="practical-exercise-4---model-quality-checks.html#cb105-34" aria-hidden="true" tabindex="-1"></a><span class="st">      memory[trial + 1] = memory[trial] + ((other[trial] - memory[trial]) / trial);</span></span>
<span id="cb105-35"><a href="practical-exercise-4---model-quality-checks.html#cb105-35" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb105-36"><a href="practical-exercise-4---model-quality-checks.html#cb105-36" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb105-37"><a href="practical-exercise-4---model-quality-checks.html#cb105-37" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb105-38"><a href="practical-exercise-4---model-quality-checks.html#cb105-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-39"><a href="practical-exercise-4---model-quality-checks.html#cb105-39" aria-hidden="true" tabindex="-1"></a><span class="st">// The model to be estimated. </span></span>
<span id="cb105-40"><a href="practical-exercise-4---model-quality-checks.html#cb105-40" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb105-41"><a href="practical-exercise-4---model-quality-checks.html#cb105-41" aria-hidden="true" tabindex="-1"></a><span class="st">  // The priors </span></span>
<span id="cb105-42"><a href="practical-exercise-4---model-quality-checks.html#cb105-42" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(bias | prior_mean_bias, prior_sd_bias);</span></span>
<span id="cb105-43"><a href="practical-exercise-4---model-quality-checks.html#cb105-43" aria-hidden="true" tabindex="-1"></a><span class="st">  target += normal_lpdf(beta | prior_mean_beta, prior_sd_beta);</span></span>
<span id="cb105-44"><a href="practical-exercise-4---model-quality-checks.html#cb105-44" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb105-45"><a href="practical-exercise-4---model-quality-checks.html#cb105-45" aria-hidden="true" tabindex="-1"></a><span class="st">  // The model</span></span>
<span id="cb105-46"><a href="practical-exercise-4---model-quality-checks.html#cb105-46" aria-hidden="true" tabindex="-1"></a><span class="st">  target += bernoulli_logit_lpmf(h | bias + beta * memory);</span></span>
<span id="cb105-47"><a href="practical-exercise-4---model-quality-checks.html#cb105-47" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb105-48"><a href="practical-exercise-4---model-quality-checks.html#cb105-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-49"><a href="practical-exercise-4---model-quality-checks.html#cb105-49" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb105-50"><a href="practical-exercise-4---model-quality-checks.html#cb105-50" aria-hidden="true" tabindex="-1"></a><span class="st">  real bias_prior;</span></span>
<span id="cb105-51"><a href="practical-exercise-4---model-quality-checks.html#cb105-51" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta_prior;</span></span>
<span id="cb105-52"><a href="practical-exercise-4---model-quality-checks.html#cb105-52" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; prior_preds5;</span></span>
<span id="cb105-53"><a href="practical-exercise-4---model-quality-checks.html#cb105-53" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; post_preds5;</span></span>
<span id="cb105-54"><a href="practical-exercise-4---model-quality-checks.html#cb105-54" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; prior_preds7;</span></span>
<span id="cb105-55"><a href="practical-exercise-4---model-quality-checks.html#cb105-55" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; post_preds7;</span></span>
<span id="cb105-56"><a href="practical-exercise-4---model-quality-checks.html#cb105-56" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; prior_preds9;</span></span>
<span id="cb105-57"><a href="practical-exercise-4---model-quality-checks.html#cb105-57" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0, upper=n&gt; post_preds9;</span></span>
<span id="cb105-58"><a href="practical-exercise-4---model-quality-checks.html#cb105-58" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb105-59"><a href="practical-exercise-4---model-quality-checks.html#cb105-59" aria-hidden="true" tabindex="-1"></a><span class="st">  bias_prior = normal_rng(prior_mean_bias, prior_sd_bias);</span></span>
<span id="cb105-60"><a href="practical-exercise-4---model-quality-checks.html#cb105-60" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_prior = normal_rng(prior_mean_beta, prior_sd_beta);</span></span>
<span id="cb105-61"><a href="practical-exercise-4---model-quality-checks.html#cb105-61" aria-hidden="true" tabindex="-1"></a><span class="st">  prior_preds5 = binomial_rng(n, inv_logit(bias_prior + beta_prior * 0.5));</span></span>
<span id="cb105-62"><a href="practical-exercise-4---model-quality-checks.html#cb105-62" aria-hidden="true" tabindex="-1"></a><span class="st">  prior_preds7 = binomial_rng(n, inv_logit(bias_prior + beta_prior * 0.7));</span></span>
<span id="cb105-63"><a href="practical-exercise-4---model-quality-checks.html#cb105-63" aria-hidden="true" tabindex="-1"></a><span class="st">  prior_preds9 = binomial_rng(n, inv_logit(bias_prior + beta_prior * 0.9));</span></span>
<span id="cb105-64"><a href="practical-exercise-4---model-quality-checks.html#cb105-64" aria-hidden="true" tabindex="-1"></a><span class="st">  post_preds5 = binomial_rng(n, inv_logit(bias + beta * 0.5));</span></span>
<span id="cb105-65"><a href="practical-exercise-4---model-quality-checks.html#cb105-65" aria-hidden="true" tabindex="-1"></a><span class="st">  post_preds7 = binomial_rng(n, inv_logit(bias + beta * 0.7));</span></span>
<span id="cb105-66"><a href="practical-exercise-4---model-quality-checks.html#cb105-66" aria-hidden="true" tabindex="-1"></a><span class="st">  post_preds9 = binomial_rng(n, inv_logit(bias + beta * 0.9));</span></span>
<span id="cb105-67"><a href="practical-exercise-4---model-quality-checks.html#cb105-67" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb105-68"><a href="practical-exercise-4---model-quality-checks.html#cb105-68" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb105-69"><a href="practical-exercise-4---model-quality-checks.html#cb105-69" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb105-70"><a href="practical-exercise-4---model-quality-checks.html#cb105-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-71"><a href="practical-exercise-4---model-quality-checks.html#cb105-71" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_file</span>(</span>
<span id="cb105-72"><a href="practical-exercise-4---model-quality-checks.html#cb105-72" aria-hidden="true" tabindex="-1"></a>  stan_model,</span>
<span id="cb105-73"><a href="practical-exercise-4---model-quality-checks.html#cb105-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">&quot;stan/&quot;</span>,</span>
<span id="cb105-74"><a href="practical-exercise-4---model-quality-checks.html#cb105-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">basename =</span> <span class="st">&quot;W4_PriorMemory.stan&quot;</span>)</span>
<span id="cb105-75"><a href="practical-exercise-4---model-quality-checks.html#cb105-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-76"><a href="practical-exercise-4---model-quality-checks.html#cb105-76" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;stan/W4_PriorMemory.stan&quot;</span>)</span>
<span id="cb105-77"><a href="practical-exercise-4---model-quality-checks.html#cb105-77" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file, <span class="at">cpp_options =</span> <span class="fu">list</span>(<span class="at">stan_threads =</span> <span class="cn">TRUE</span>))</span>
<span id="cb105-78"><a href="practical-exercise-4---model-quality-checks.html#cb105-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-79"><a href="practical-exercise-4---model-quality-checks.html#cb105-79" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">subset</span>(noise <span class="sc">==</span> <span class="fl">0.1</span> <span class="sc">&amp;</span> rate <span class="sc">==</span> <span class="fl">0.8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-80"><a href="practical-exercise-4---model-quality-checks.html#cb105-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">memory =</span> <span class="fu">lag</span>(cumulativerate, <span class="dv">1</span>))</span>
<span id="cb105-81"><a href="practical-exercise-4---model-quality-checks.html#cb105-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-82"><a href="practical-exercise-4---model-quality-checks.html#cb105-82" aria-hidden="true" tabindex="-1"></a>dd<span class="sc">$</span>memory[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb105-83"><a href="practical-exercise-4---model-quality-checks.html#cb105-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-84"><a href="practical-exercise-4---model-quality-checks.html#cb105-84" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(future, purrr, furrr)</span>
<span id="cb105-85"><a href="practical-exercise-4---model-quality-checks.html#cb105-85" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">4</span>)</span>
<span id="cb105-86"><a href="practical-exercise-4---model-quality-checks.html#cb105-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-87"><a href="practical-exercise-4---model-quality-checks.html#cb105-87" aria-hidden="true" tabindex="-1"></a>sim_d_and_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(prior_mean_bias, prior_sd_bias, prior_mean_beta, prior_sd_beta) {</span>
<span id="cb105-88"><a href="practical-exercise-4---model-quality-checks.html#cb105-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-89"><a href="practical-exercise-4---model-quality-checks.html#cb105-89" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb105-90"><a href="practical-exercise-4---model-quality-checks.html#cb105-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">n =</span> <span class="fu">nrow</span>(dd),</span>
<span id="cb105-91"><a href="practical-exercise-4---model-quality-checks.html#cb105-91" aria-hidden="true" tabindex="-1"></a>        <span class="at">h =</span> dd<span class="sc">$</span>choice,</span>
<span id="cb105-92"><a href="practical-exercise-4---model-quality-checks.html#cb105-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">memory =</span> dd<span class="sc">$</span>memory,</span>
<span id="cb105-93"><a href="practical-exercise-4---model-quality-checks.html#cb105-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">prior_mean_bias =</span> prior_mean_bias,</span>
<span id="cb105-94"><a href="practical-exercise-4---model-quality-checks.html#cb105-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">prior_sd_bias =</span> prior_sd_bias,</span>
<span id="cb105-95"><a href="practical-exercise-4---model-quality-checks.html#cb105-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">prior_mean_beta =</span> prior_mean_beta,</span>
<span id="cb105-96"><a href="practical-exercise-4---model-quality-checks.html#cb105-96" aria-hidden="true" tabindex="-1"></a>        <span class="at">prior_sd_beta =</span> prior_sd_beta</span>
<span id="cb105-97"><a href="practical-exercise-4---model-quality-checks.html#cb105-97" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb105-98"><a href="practical-exercise-4---model-quality-checks.html#cb105-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-99"><a href="practical-exercise-4---model-quality-checks.html#cb105-99" aria-hidden="true" tabindex="-1"></a>    samples <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb105-100"><a href="practical-exercise-4---model-quality-checks.html#cb105-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb105-101"><a href="practical-exercise-4---model-quality-checks.html#cb105-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">1000</span>,</span>
<span id="cb105-102"><a href="practical-exercise-4---model-quality-checks.html#cb105-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb105-103"><a href="practical-exercise-4---model-quality-checks.html#cb105-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb105-104"><a href="practical-exercise-4---model-quality-checks.html#cb105-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">threads_per_chain =</span> <span class="dv">1</span>,</span>
<span id="cb105-105"><a href="practical-exercise-4---model-quality-checks.html#cb105-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb105-106"><a href="practical-exercise-4---model-quality-checks.html#cb105-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb105-107"><a href="practical-exercise-4---model-quality-checks.html#cb105-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb105-108"><a href="practical-exercise-4---model-quality-checks.html#cb105-108" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_treedepth =</span> <span class="dv">20</span>,</span>
<span id="cb105-109"><a href="practical-exercise-4---model-quality-checks.html#cb105-109" aria-hidden="true" tabindex="-1"></a>      <span class="at">adapt_delta =</span> <span class="fl">0.99</span>,</span>
<span id="cb105-110"><a href="practical-exercise-4---model-quality-checks.html#cb105-110" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb105-111"><a href="practical-exercise-4---model-quality-checks.html#cb105-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-112"><a href="practical-exercise-4---model-quality-checks.html#cb105-112" aria-hidden="true" tabindex="-1"></a>    draws_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(samples<span class="sc">$</span><span class="fu">draws</span>()) </span>
<span id="cb105-113"><a href="practical-exercise-4---model-quality-checks.html#cb105-113" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">bias_prior =</span> draws_df<span class="sc">$</span>bias_prior, </span>
<span id="cb105-114"><a href="practical-exercise-4---model-quality-checks.html#cb105-114" aria-hidden="true" tabindex="-1"></a>                     <span class="at">beta_prior =</span> draws_df<span class="sc">$</span>beta_prior, </span>
<span id="cb105-115"><a href="practical-exercise-4---model-quality-checks.html#cb105-115" aria-hidden="true" tabindex="-1"></a>                     <span class="at">bias_posterior =</span> draws_df<span class="sc">$</span>bias, </span>
<span id="cb105-116"><a href="practical-exercise-4---model-quality-checks.html#cb105-116" aria-hidden="true" tabindex="-1"></a>                     <span class="at">beta_posterior =</span> draws_df<span class="sc">$</span>beta, </span>
<span id="cb105-117"><a href="practical-exercise-4---model-quality-checks.html#cb105-117" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_preds5 =</span> draws_df<span class="sc">$</span>prior_preds5, </span>
<span id="cb105-118"><a href="practical-exercise-4---model-quality-checks.html#cb105-118" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_preds7 =</span> draws_df<span class="sc">$</span>prior_preds7, </span>
<span id="cb105-119"><a href="practical-exercise-4---model-quality-checks.html#cb105-119" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_preds9 =</span> draws_df<span class="sc">$</span>prior_preds9, </span>
<span id="cb105-120"><a href="practical-exercise-4---model-quality-checks.html#cb105-120" aria-hidden="true" tabindex="-1"></a>                     <span class="at">posterior_preds5 =</span> draws_df<span class="sc">$</span>post_preds5,</span>
<span id="cb105-121"><a href="practical-exercise-4---model-quality-checks.html#cb105-121" aria-hidden="true" tabindex="-1"></a>                     <span class="at">posterior_preds7 =</span> draws_df<span class="sc">$</span>post_preds7,</span>
<span id="cb105-122"><a href="practical-exercise-4---model-quality-checks.html#cb105-122" aria-hidden="true" tabindex="-1"></a>                     <span class="at">posterior_preds9 =</span> draws_df<span class="sc">$</span>post_preds9, </span>
<span id="cb105-123"><a href="practical-exercise-4---model-quality-checks.html#cb105-123" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_mean_bias =</span> prior_mean_bias,</span>
<span id="cb105-124"><a href="practical-exercise-4---model-quality-checks.html#cb105-124" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_sd_bias =</span> prior_sd_bias, </span>
<span id="cb105-125"><a href="practical-exercise-4---model-quality-checks.html#cb105-125" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_mean_beta =</span> prior_mean_beta,</span>
<span id="cb105-126"><a href="practical-exercise-4---model-quality-checks.html#cb105-126" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_sd_beta =</span> prior_sd_beta)</span>
<span id="cb105-127"><a href="practical-exercise-4---model-quality-checks.html#cb105-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-128"><a href="practical-exercise-4---model-quality-checks.html#cb105-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(temp)</span>
<span id="cb105-129"><a href="practical-exercise-4---model-quality-checks.html#cb105-129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-130"><a href="practical-exercise-4---model-quality-checks.html#cb105-130" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb105-131"><a href="practical-exercise-4---model-quality-checks.html#cb105-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-132"><a href="practical-exercise-4---model-quality-checks.html#cb105-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-133"><a href="practical-exercise-4---model-quality-checks.html#cb105-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-134"><a href="practical-exercise-4---model-quality-checks.html#cb105-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-135"><a href="practical-exercise-4---model-quality-checks.html#cb105-135" aria-hidden="true" tabindex="-1"></a>recovery_df <span class="ot">&lt;-</span> <span class="fu">future_pmap_dfr</span>(priors, sim_d_and_fit, <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb105-136"><a href="practical-exercise-4---model-quality-checks.html#cb105-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-137"><a href="practical-exercise-4---model-quality-checks.html#cb105-137" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(recovery_df, <span class="st">&quot;simdata/W4_MemoryPriorSensitivity.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="practical-exercise-4---model-quality-checks.html#cb106-1" aria-hidden="true" tabindex="-1"></a>recovery_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;simdata/W4_MemoryPriorSensitivity.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 1250000 Columns: 14
## ── Column specification ──────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (14): bias_prior, beta_prior, bias_posterior, beta_posterior, prior_preds5, prior_preds7, prior_pr...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="practical-exercise-4---model-quality-checks.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(recovery_df, <span class="fu">aes</span>(prior_sd_beta, beta_posterior)) <span class="sc">+</span></span>
<span id="cb108-2"><a href="practical-exercise-4---model-quality-checks.html#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb108-3"><a href="practical-exercise-4---model-quality-checks.html#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.8</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb108-4"><a href="practical-exercise-4---model-quality-checks.html#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb108-5"><a href="practical-exercise-4---model-quality-checks.html#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>prior_sd_bias) <span class="sc">+</span></span>
<span id="cb108-6"><a href="practical-exercise-4---model-quality-checks.html#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="series_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="practical-exercise-3---getting-into-stan.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fusaroli/AdvancedCognitiveModeling/edit/master/04-ModelQualityChecks.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
